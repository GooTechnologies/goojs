goo.State=function(t){"use strict";function e(t){this.uuid=t,this._fsm=null,this.parent=null,this._actions=[],this._machines=[],this._transitions={},this.vars={},this.transitionTarget=null,this.proxy={getTpf:function(){return this._fsm.entity._world.tpf}.bind(this),getWorld:function(){return this._fsm.entity._world}.bind(this),getTime:function(){return this._fsm.system.time}.bind(this),getState:function(){return this}.bind(this),getFsm:function(){return this._fsm}.bind(this),getOwnerEntity:function(){return this._fsm&&this._fsm.entity}.bind(this),getEntityById:function(t){return this._fsm.entity._world.by.id(t).first()}.bind(this),send:function(t){t&&"string"==typeof t&&this._transitions[t]&&this.requestTransition(this._transitions[t])}.bind(this),addListener:function(t,e){this._fsm._bus.addListener(t,e)}.bind(this),removeListener:function(t,e){this._fsm._bus.removeListener(t,e)}.bind(this),defineVariable:function(t,e){this.vars[t]=e}.bind(this),removeVariable:function(t){delete this.vars[t]}.bind(this),getVariable:function(t){return void 0!==this.vars[t]?this.vars[t]:this._fsm.getVariable(t)}.bind(this),applyOnVariable:function(t,e){void 0!==this.vars[t]?this.vars[t]=e(this.vars[t]):this._fsm.applyOnVariable(t,e)}.bind(this),getEvalProxy:function(){return this._fsm.system.evalProxy}.bind(this)}}return e.prototype.setRefs=function(t){this._fsm=t;for(var e=0;e<this._machines.length;e++){var n=this._machines[e];n.setRefs(t)}},e.prototype.isCurrentState=function(){return this===this.parent.getCurrentState()},e.prototype.requestTransition=function(t){this.isCurrentState()&&(this.transitionTarget=t)},e.prototype.setTransition=function(t,e){this._transitions[t]=e},e.prototype.clearTransition=function(t){delete this._transitions[t]},e.prototype.update=function(){for(var t=0;t<this._actions.length;t++)if(this._actions[t].update(this.proxy),this.transitionTarget){var e=this.transitionTarget;return this.transitionTarget=null,e}for(var n,t=0;t<this._machines.length;t++){var o=this._machines[t];if(n=o.update())return n}},e.prototype.reset=function(){for(var t=0;t<this._machines.length;t++)this._machines[t].reset()},e.prototype.kill=function(){for(var t=0;t<this._machines.length;t++)this._machines[t].kill();for(var t=0;t<this._actions.length;t++)this._actions[t].exit(this.proxy)},e.prototype.ready=function(){for(var t=0;t<this._machines.length;t++)this._machines[t].ready();for(var t=0;t<this._actions.length;t++)this._actions[t].ready(this.proxy)},e.prototype.cleanup=function(){for(var t=0;t<this._machines.length;t++)this._machines[t].cleanup();for(var t=0;t<this._actions.length;t++)this._actions[t].cleanup(this.proxy)},e.prototype.enter=function(){for(var t=0;t<this._actions.length;t++)this._actions[t].enter(this.proxy);for(var t=0;t<this._machines.length;t++)this._machines[t].enter()},e.prototype.getAction=function(t){if(!this._actions)return void 0;for(var e=0;e<this._actions.length;e++){var n=this._actions[e];if(void 0!==t&&n.id===t)return n}return void 0},e.prototype.addAction=function(t){this._actions[t.id]||(t.onCreate&&t.onCreate(this.proxy),this._actions.push(t))},e.prototype.recursiveRemove=function(){this.removeAllActions();for(var t=0;t<this._machines.length;t++)this._machines[t].recursiveRemove();this._machines=[]},e.prototype.removeAllActions=function(){for(var t=0;t<this._actions.length;t++){var e=this._actions[t];e.onDestroy&&e.onDestroy(this.proxy)}this._actions=[]},e.prototype.removeAction=function(e){e.onDestroy&&e.onDestroy(this.proxy),t.remove(this._actions,e)},e.prototype.addMachine=function(t){var e=this._machines.indexOf(t);-1===e&&(t._fsm=this._fsm,t.parent=this,this._machines.push(t))},e.prototype.removeMachine=function(e){e.recursiveRemove(),t.remove(this._machines,e)},e}(goo.ArrayUtils),goo.Machine=function(){"use strict";function t(t){this.name=t,this._fsm=null,this.initialState="entry",this.currentState=null,this.parent=null}return t.prototype.setRefs=function(t){this._fsm=t;for(var e=Object.keys(this._states),n=0;n<e.length;n++){var o=this._states[e[n]];o.setRefs(t)}},t.prototype.update=function(){if(this.currentState){var t=this.currentState.update();return t&&this.contains(t)&&(this.currentState.kill(),this.setState(this._states[t])),t}},t.prototype.contains=function(t){return!!this._states[t]},t.prototype.setState=function(t){this.currentState=t,this.currentState.reset(),this.currentState.enter()},t.prototype.reset=function(){this.currentState=this._states[this.initialState],this.currentState&&this.currentState.reset()},t.prototype.kill=function(){this.currentState&&this.currentState.kill()},t.prototype.ready=function(){for(var t=Object.keys(this._states),e=0;e<t.length;e++){var n=this._states[t[e]];n.ready()}},t.prototype.cleanup=function(){for(var t=Object.keys(this._states),e=0;e<t.length;e++){var n=this._states[t[e]];n.cleanup()}},t.prototype.enter=function(){this.currentState&&this.currentState.enter()},t.prototype.getCurrentState=function(){return this.currentState},t.prototype.addState=function(t){this._states||(this._states={},this.initialState=t.uuid),t.parent=this,t._fsm=this._fsm,this._states[t.uuid]=t},t.prototype.removeFromParent=function(){this.parent&&this.parent.removeMachine(this)},t.prototype.recursiveRemove=function(){for(var t=Object.keys(this._states),e=0;e<t.length;e++){var n=this._states[t[e]];n.recursiveRemove()}this._states={}},t.prototype.removeState=function(t){if(this._states[t]){if(this.initialState===t)throw new Error("Cannot remove initial state");this.currentState===this._states[t]&&this.reset(),delete this._states[t]}},t.prototype.setInitialState=function(t){this.initialState=t},t}(),goo.FsmUtils=function(){"use strict";function t(){}function e(t){for(var e=[],n=Object.keys(t),o=0;o<n.length;o++)e[t[n[o]]]=n[o];return e}t.setParameters=function(t,e){for(var n=0;n<e.length;n++){var o=e[n],i=o.key;"undefined"!=typeof t[i]?this[i]=t[i]:this[i]=o["default"]}},t.setTransitions=function(t,e){for(var n=0;n<e.length;n++){var o=e[n],i=o.key;this.transitions=this.transitions||{},this.transitions[i]=t.transitions[i]}},t.getKey=function(e){return t.keys[e]?t.keys[e]:e.charCodeAt(0)},t.keys={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,Capslock:20,Esc:27,Space:32,Pageup:33,Pagedown:34,End:35,Home:36,Leftarrow:37,Uparrow:38,Rightarrow:39,Downarrow:40,Insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0numpad":96,"1numpad":97,"2numpad":98,"3numpad":99,"4numpad":100,"5numpad":101,"6numpad":102,"7numpad":103,"8numpad":104,"9numpad":105,Multiply:106,Plus:107,Minus:109,Dot:110,Slash1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Equals:187,Comma:188,Slash:191,Backslash:220},t.keyInverse=[],t.keyInverse=e(t.keys),t.keyForCode=function(e){return t.keyInverse[e]?t.keyInverse[e]:"FsmUtils.keyForCode: key not found for code "+e};var n=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t.guid=function(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},t.getValue=function(t,e){return"number"==typeof t?t:e.getVariable(t)},t}(),goo.Action=function(t){"use strict";function e(t,e){this.id=t,this.configure(e||{})}return e.prototype._setup=function(){},e.prototype._run=function(){},e.prototype.configure=function(e){t.setParameters.call(this,e,this.constructor.external.parameters),t.setTransitions.call(this,e,this.constructor.external.transitions)},e.prototype.enter=function(t){this._setup(t),this.everyFrame||this._run(t)},e.prototype.update=function(t){this.everyFrame&&this._run(t)},e.prototype.ready=function(){},e.prototype.cleanup=function(){},e.prototype.exit=function(){},e}(goo.FsmUtils),goo.ArrowsAction=function(t){"use strict";function e(){t.apply(this,arguments),this.updated=!1,this.keysPressed={},this.eventListener=function(t){var n=e._keys[t.which];void 0!==n&&(this.updated=!0,this.keysPressed[n]=!0)}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.configure=function(t){this.everyFrame=!0,this.targets=t.transitions},e._keys={38:"up",37:"left",40:"down",39:"right"},e.external=function(){var t=[];for(var n in e._keys){var o=e._keys[n];t.push({name:"Key "+o.toUpperCase(),key:o,description:"Key '"+o+"' pressed"})}return{key:"Arrow Keys Listener",name:"Arrow Keys",type:"controls",description:"Transitions to other states when arrow keys are pressed",canTransition:!0,parameters:[],transitions:t}}(),e.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},e.prototype._run=function(t){if(this.updated){this.updated=!1;for(var e in this.keysPressed){var n=this.targets[e];"string"==typeof n&&t.send(n)}this.keysPressed={}}},e.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},e}(goo.Action),goo.MouseUpAction=function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.button=null,this.mouseEventListener=function(t){this.button=t.button,this.updated=!0}.bind(this),this.touchEventListener=function(t){this.button="touch",this.updated=!0}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Mouse Up",type:"controls",description:"Listens for a mouse button release and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mouseLeftUp",name:"Left mouse up",description:"State to transition to when the left mouse button is released"},{key:"middleMouseUp",name:"Middle mouse up",description:"State to transition to when the middle mouse button is released"},{key:"rightMouseUp",name:"Right mouse up",description:"State to transition to when the right mouse button is released"},{key:"touchUp",name:"Touch release",description:"State to transition to when the touch event ends"}]},e.prototype._setup=function(){document.addEventListener("mouseup",this.mouseEventListener),document.addEventListener("touchend",this.touchEventListener)},e.prototype._run=function(t){this.updated&&(this.updated=!1,"touch"===this.button?t.send(this.transitions.touchUp):t.send([this.transitions.mouseLeftUp,this.transitions.middleMouseUp,this.transitions.rightMouseUp][this.button]))},e.prototype.exit=function(){document.removeEventListener("mouseup",this.mouseEventListener),document.removeEventListener("touchend",this.touchEventListener)},e}(goo.Action),goo.MouseDownAction=function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.button=null,this.mouseEventListener=function(t){this.button=t.button,this.updated=!0}.bind(this),this.touchEventListener=function(t){this.button="touch",this.updated=!0}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Mouse Down",type:"controls",description:"Listens for a mouse button press and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mouseLeftDown",name:"Left mouse down",description:"State to transition to when the left mouse button is pressed"},{key:"middleMouseDown",name:"Middle mouse down",description:"State to transition to when the middle mouse button is pressed"},{key:"rightMouseDown",name:"Right mouse down",description:"State to transition to when the right mouse button is pressed"},{key:"touchDown",name:"Touch begin",description:"State to transition to when the touch event begins"}]},e.prototype._setup=function(){document.addEventListener("mousedown",this.mouseEventListener),document.addEventListener("touchstart",this.touchEventListener)},e.prototype._run=function(t){this.updated&&(this.updated=!1,"touch"===this.button?t.send(this.transitions.touchDown):t.send([this.transitions.mouseLeftDown,this.transitions.middleMouseDown,this.transitions.rightMouseDown][this.button]))},e.prototype.exit=function(){document.removeEventListener("mousedown",this.mouseEventListener),document.removeEventListener("touchstart",this.touchEventListener)},e}(goo.Action),goo.MouseMoveAction=function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.mouseOrTouch=null,this.mouseEventListener=function(){this.updated=!0,this.mouseOrTouch="mouse"}.bind(this),this.touchEventListener=function(){this.updated=!0,this.mouseOrTouch="touch"}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Mouse Move",type:"controls",description:"Listens for mouse movement and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mousemove",name:"Mouse move",description:"State to transition to on mouse movement"},{key:"touchmove",name:"Touch move",description:"State to transition to on touch movement"}]},e.prototype._setup=function(){document.addEventListener("mousemove",this.mouseEventListener),document.addEventListener("touchmove",this.touchEventListener)},e.prototype._run=function(t){this.updated&&(this.updated=!1,"mouse"===this.mouseOrTouch?t.send(this.transitions.mousemove):t.send(this.transitions.touchmove))},e.prototype.exit=function(){document.removeEventListener("mousemove",this.mouseEventListener),document.removeEventListener("touchmove",this.touchEventListener)},e}(goo.Action),goo.KeyUpAction=function(t,e){"use strict";function n(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(t){this.key&&t.which!==+this.key||(this.updated=!0)}.bind(this)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"Key Up",type:"controls",description:"Listens for a key release and performs a transition",canTransition:!0,parameters:[{name:"Key",key:"key",type:"string",control:"key",description:"Key to listen for","default":"A"}],transitions:[{key:"keyup",name:"Key up",description:"State to transition to when the key is released"}]},n.prototype.configure=function(t){this.key=t.key?e.getKey(t.key):null,this.transitions={keyup:t.transitions.keyup}},n.prototype._setup=function(){document.addEventListener("keyup",this.eventListener)},n.prototype._run=function(t){this.updated&&(this.updated=!1,t.send(this.transitions.keyup))},n.prototype.exit=function(){document.removeEventListener("keyup",this.eventListener)},n}(goo.Action,goo.FsmUtils),goo.KeyDownAction=function(t,e){"use strict";function n(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(t){this.key&&t.which===+this.key&&(this.updated=!0)}.bind(this)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"Key Down",type:"controls",description:"Listens for a key press and performs a transition",canTransition:!0,parameters:[{name:"Key",key:"key",type:"string",control:"key",description:"Key to listen for","default":"A"}],transitions:[{key:"keydown",name:"Key down",description:"State to transition to when the key is pressed"}]},n.prototype.configure=function(t){this.key=t.key?e.getKey(t.key):null,this.transitions={keydown:t.transitions.keydown}},n.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},n.prototype._run=function(t){this.updated&&(this.updated=!1,t.send(this.transitions.keydown))},n.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},n}(goo.Action,goo.FsmUtils),goo.KeyPressedAction=function(t,e){"use strict";function n(){t.apply(this,arguments),this.everyFrame=!0,this.keyIsDown=!1,this.eventListenerDown=function(t){t.which===+this.key&&(this.keyIsDown=!0)}.bind(this),this.eventListenerUp=function(t){t.which===+this.key&&(document.removeEventListener("keydown",this.eventListenerUp),this.keyIsDown=!1)}.bind(this)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"Key Pressed",type:"controls",description:"Listens for a key press event and performs a transition. Works over transition boundaries.",canTransition:!0,parameters:[{name:"Key",key:"key",type:"string",control:"key",description:"Key to listen for"}],transitions:[{key:"keydown",name:"Key pressed",description:"State to transition to when the key is pressed"}]},n.prototype.configure=function(t){this.key=t.key?e.getKey(t.key):null,this.transitions={keydown:t.transitions.keydown}},n.prototype._setup=function(){document.addEventListener("keydown",this.eventListenerDown),document.addEventListener("keyup",this.eventListenerUp)},n.prototype._run=function(t){this.keyIsDown&&t.send(this.transitions.keydown)},n.prototype.exit=function(){document.removeEventListener("keydown",this.eventListenerDown)},n}(goo.Action,goo.FsmUtils),goo.PickAction=function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1;var e=this;this.eventListener=function(t){t.entity&&t.entity.traverseUp(function(t){return t===e.ownerEntity?(e.updated=!0,!1):void 0})}}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Pick",type:"controls",description:"Listens for a picking event on the entity and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"pick",name:"Pick",description:"State to transition to when entity is picked"}]},e.prototype._setup=function(t){this.ownerEntity=t.getOwnerEntity(),this.goo=this.ownerEntity._world.gooRunner,this.goo.addEventListener("click",this.eventListener),this.goo.addEventListener("touchstart",this.eventListener)},e.prototype._run=function(t){this.updated&&(this.updated=!1,t.send(this.transitions.pick))},e.prototype.exit=function(){this.goo&&(this.goo.removeEventListener("click",this.eventListener),this.goo.removeEventListener("touchstart",this.eventListener))},e}(goo.Action),goo.PickAndExitAction=function(t){"use strict";function e(){t.apply(this,arguments),this.eventListener=function(t){var e=this.ownerEntity.getComponent("HtmlComponent"),n=e&&e.domElement.contains(t.target);if(n)return void this.handleExit();if(t.target===this.canvasElement){var o,i;t.touches?(o=t.touches[0].clientX,i=t.touches[0].clientY):(o=t.offsetX,i=t.offsetY);var r=this.goo.pickSync(o,i);if(-1!==r.id){var s=this.goo.world.entityManager.getEntityByIndex(r.id),a=[];this.ownerEntity.traverse(a.push.bind(a)),-1!==a.indexOf(s)&&this.handleExit()}}}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Pick and Exit",type:"controls",description:"Listens for a picking event on the entity and opens a new browser window",canTransition:!0,parameters:[{name:"URL",key:"url",type:"string",description:"URL to open","default":"http://www.goocreate.com/"},{name:"Exit name",key:"exitName",type:"string",description:"Name of the exit, used to track this exit in Ads.","default":"clickEntityExit"}],transitions:[]},e.prototype._setup=function(t){this.ownerEntity=t.getOwnerEntity(),this.goo=this.ownerEntity._world.gooRunner,this.canvasElement=this.goo.renderer.domElement,this.domElement=this.canvasElement.parentNode,this.domElement.addEventListener("click",this.eventListener,!1),this.domElement.addEventListener("touchstart",this.eventListener,!1)},e.prototype._run=function(){},e.prototype.handleExit=function(){var t=window.gooHandleExit||function(t){window.open(t,"_blank")};t(this.url,this.exitName)},e.prototype.exit=function(){this.domElement&&(this.domElement.removeEventListener("click",this.eventListener),this.domElement.removeEventListener("touchstart",this.eventListener))},e}(goo.Action),goo.WasdAction=function(t){"use strict";function e(){t.apply(this,arguments),this.updated=!1,this.keysPressed={},this.eventListener=function(t){var n=e._keys[t.which];void 0!==n&&(this.updated=!0,this.keysPressed[n]=!0)}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.configure=function(t){this.everyFrame=!0,this.targets=t.transitions},e._keys={87:"w",65:"a",83:"s",68:"d"},e.external=function(){var t=[];for(var n in e._keys){var o=e._keys[n];t.push({key:o,name:"Key "+o.toUpperCase(),description:"Key '"+o+"' pressed"})}return{key:"WASD Keys Listener",name:"WASD Keys",type:"controls",description:"Transitions to other states when the WASD keys are pressed",canTransition:!0,parameters:[],transitions:t}}(),e.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},e.prototype._run=function(t){if(this.updated){this.updated=!1;for(var e in this.keysPressed){var n=this.targets[e];"string"==typeof n&&t.send(n)}this.keysPressed=[]}},e.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},e}(goo.Action),goo.MoveAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"Move",type:"animation",description:"Moves the entity",parameters:[{name:"Translation",key:"translation",type:"position",description:"Move","default":[0,0,0]},{name:"Oriented",key:"oriented",type:"boolean",description:"If true translate with rotation","default":!0},{name:"Relative",key:"relative",type:"boolean",description:"If true add to current translation","default":!0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._setup=function(t){var n=t.getOwnerEntity(),o=n.transformComponent.transform;this.forward=e.fromArray(this.translation);var i=o.rotation;this.forward.applyPost(i)},n.prototype._run=function(t){var n=t.getOwnerEntity(),o=n.transformComponent.transform,i=o.translation;if(this.oriented)if(this.relative){var r=e.fromArray(this.translation),s=o.rotation;r.applyPost(s),this.everyFrame?(r.scale(10*t.getTpf()),i.add(r)):i.add(r)}else i.set(this.forward);else if(this.relative)if(this.everyFrame){var a=10*t.getTpf();i.addDirect(this.translation[0],this.translation[1],this.translation[2]).scale(a)}else i.addDirect(this.translation[0],this.translation[1],this.translation[2]);else i.setDirect(this.translation[0],this.translation[1],this.translation[2]);n.transformComponent.setUpdated()},n}(goo.Action,goo.Vector3),goo.RotateAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"Rotate",type:"animation",description:"Rotates the entity with the set angles (in degrees).",parameters:[{name:"Rotation",key:"rotation",type:"rotation",description:"Rotate","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add to current rotation","default":!0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._run=function(t){var n=t.getOwnerEntity(),o=n.transformComponent.transform;if(this.relative)if(this.everyFrame){var i=t.getTpf();o.rotation.rotateX(this.rotation[0]*e.DEG_TO_RAD*i),o.rotation.rotateY(this.rotation[1]*e.DEG_TO_RAD*i),o.rotation.rotateZ(this.rotation[2]*e.DEG_TO_RAD*i)}else o.rotation.rotateX(this.rotation[0]*e.DEG_TO_RAD),o.rotation.rotateY(this.rotation[1]*e.DEG_TO_RAD),o.rotation.rotateZ(this.rotation[2]*e.DEG_TO_RAD);else if(this.everyFrame){var i=t.getTpf();o.setRotationXYZ(this.rotation[0]*e.DEG_TO_RAD*i,this.rotation[1]*e.DEG_TO_RAD*i,this.rotation[2]*e.DEG_TO_RAD*i)}else o.setRotationXYZ(this.rotation[0]*e.DEG_TO_RAD,this.rotation[1]*e.DEG_TO_RAD,this.rotation[2]*e.DEG_TO_RAD);n.transformComponent.setUpdated()},n}(goo.Action,goo.MathUtils),goo.ScaleAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Scale",type:"animation",description:"Scales the entity",parameters:[{name:"Scale",key:"scale",type:"position",description:"Scale","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true, add/multiply the current scaling","default":!0},{name:"Multiply",key:"multiply",type:"boolean",description:"If true multiply, otherwise add","default":!1},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity(),n=e.transformComponent.transform;if(this.relative)if(this.multiply)if(this.everyFrame){var o=10*t.getTpf();n.scale.x*=this.scale[0]*o,n.scale.y*=this.scale[1]*o,n.scale.z*=this.scale[2]*o}else n.scale.mulDirect(this.scale[0],this.scale[1],this.scale[2]);else if(this.everyFrame){var o=10*t.getTpf();n.scale.x+=this.scale[0]*o,n.scale.y+=this.scale[1]*o,n.scale.z+=this.scale[2]*o}else n.scale.addDirect(this.scale[0],this.scale[1],this.scale[2]);else n.scale.set(this.scale);e.transformComponent.setUpdated()},e}(goo.Action),goo.LookAtAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"Look At",type:"animation",description:"Reorients an entity so that it's facing a specific point",parameters:[{name:"Look at",key:"lookAt",type:"position",description:"Position to look at","default":[0,0,0]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._run=function(t){var n=t.getOwnerEntity(),o=n.transformComponent;o.transform.lookAt(new e(this.lookAt),e.UNIT_Y),o.setUpdated()},n}(goo.Action,goo.Vector3),goo.TweenMoveAction=function(t,e,n){"use strict";function o(){t.apply(this,arguments)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={name:"Tween Move",type:"animation",description:"Transition to the set location.",canTransition:!0,parameters:[{name:"Translation",key:"to",type:"position",description:"Move","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"string",control:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"string",control:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the movement completes"}]},o.prototype.configure=function(t){this.to=t.to,this.relative=t.relative,this.time=t.time,"Linear"===t.easing1?this.easing=n.Easing.Linear.None:this.easing=n.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},o.prototype._setup=function(){this.tween=new n.Tween},o.prototype.cleanup=function(){this.tween&&this.tween.stop()},o.prototype._run=function(t){var n,o=t.getOwnerEntity(),i=o.transformComponent,r=i.transform.translation,s=r.clone(),a=1e3*o._world.time,c={x:s.x,y:s.y,z:s.z},p={x:c.x,y:c.y,z:c.z};if(this.relative){var u=e.fromArray(this.to).add(s);n={x:u.x,y:u.y,z:u.z},"0"===this.time?(r.x+=n.x-p.x,r.y+=n.y-p.y,r.z+=n.z-p.z,i.setUpdated(),t.send(this.eventToEmit.channel)):this.tween.from(c).to(n,+this.time).easing(this.easing).onUpdate(function(){r.x+=this.x-p.x,r.y+=this.y-p.y,r.z+=this.z-p.z,p.x=this.x,p.y=this.y,p.z=this.z,i.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(a)}else n={x:this.to[0],y:this.to[1],z:this.to[2]},"0"===this.time?(r.x+=n.x-p.x,r.y+=n.y-p.y,r.z+=n.z-p.z,i.setUpdated(),t.send(this.eventToEmit.channel)):this.tween.from(c).to(n,+this.time).easing(this.easing).onUpdate(function(){r.x+=this.x-p.x,r.y+=this.y-p.y,r.z+=this.z-p.z,p.x=this.x,p.y=this.y,p.z=this.z,i.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(a)},o}(goo.Action,goo.Vector3,goo.TWEEN),goo.TweenRotationAction=function(t,e,n,o,i){"use strict";function r(){t.apply(this,arguments)}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.external={key:"Tween Rotation",name:"Tween Rotate",type:"animation",description:"Transition to the set rotation, in angles.",canTransition:!0,parameters:[{name:"Rotation",key:"to",type:"rotation",description:"Rotation","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"string",control:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"string",control:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the rotation completes"}]},r.prototype.configure=function(t){this.to=t.to,this.relative=t.relative,this.time=t.time,"Linear"===t.easing1?this.easing=i.Easing.Linear.None:this.easing=i.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},r.prototype._setup=function(){this.tween=new i.Tween},r.prototype.cleanup=function(){this.tween&&this.tween.stop()},r.prototype._run=function(t){var i=t.getOwnerEntity(),r=i.transformComponent,s=r.transform.rotation,a=(new e).fromRotationMatrix(s),c=(new e).fromRotationMatrix((new n).fromAngles(this.to[0]*o.DEG_TO_RAD,this.to[1]*o.DEG_TO_RAD,this.to[2]*o.DEG_TO_RAD)),p=new e,u=1e3*i._world.time;this.relative&&c.mul(a),this.tween.from({t:0}).to({t:1},+this.time).easing(this.easing).onUpdate(function(){e.slerp(a,c,this.t,p),s.copyQuaternion(p),r.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(u)},r}(goo.Action,goo.Quaternion,goo.Matrix3,goo.MathUtils,goo.TWEEN),goo.TweenScaleAction=function(t,e,n){"use strict";function o(){t.apply(this,arguments)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={name:"Tween Scale",type:"animation",description:"Transition to the set scale.",canTransition:!0,parameters:[{name:"Scale",key:"to",type:"position",description:"Scale","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"string",control:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"string",control:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the scaling completes"}]},o.prototype.configure=function(t){this.to=t.to,this.relative=t.relative,this.time=t.time,"Linear"===t.easing1?this.easing=n.Easing.Linear.None:this.easing=n.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},o.prototype._setup=function(){this.tween=new n.Tween},o.prototype.cleanup=function(){this.tween&&this.tween.stop()},o.prototype._run=function(t){var n,o=t.getOwnerEntity(),i=o.transformComponent,r=i.transform.scale,s=r.clone(),a={x:s.x,y:s.y,z:s.z},c=1e3*o._world.time;if(this.relative){var p=e.fromArray(this.to).add(s);n={x:p.x,y:p.y,z:p.z},this.tween.from(a).to(n,+this.time).easing(this.easing).onUpdate(function(){r.setDirect(this.x,this.y,this.z),i.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(c)}else n={x:this.to[0],y:this.to[1],z:this.to[2]},this.tween.from(a).to(n,+this.time).easing(this.easing).onUpdate(function(){r.setDirect(this.x,this.y,this.z),i.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(c)},o}(goo.Action,goo.Vector3,goo.TWEEN),
goo.TweenLookAtAction=function(t,e,n){"use strict";function o(){t.apply(this,arguments)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={name:"Tween Look At",type:"animation",description:"Transition the entity's rotation to face the set position.",canTransition:!0,parameters:[{name:"Position",key:"to",type:"position",description:"Look at point","default":[0,0,0]},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"string",control:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"string",control:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On completion",description:"State to transition to when the transition completes"}]},o.prototype.configure=function(t){this.to=t.to,this.relative=t.relative,this.time=t.time,"Linear"===t.easing1?this.easing=n.Easing.Linear.None:this.easing=n.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},o.prototype._setup=function(){this.tween=new n.Tween},o.prototype.cleanup=function(){this.tween&&this.tween.stop()},o.prototype._run=function(t){var n=t.getOwnerEntity(),o=n.transformComponent,i=o.transform,r=e.fromArray(this.to).distance(i.translation),s=1e3*n._world.time,a=new e(0,0,1),c=i.rotation;a.applyPost(c),a.scale(r);var p={x:a.x,y:a.y,z:a.z},u={x:this.to[0],y:this.to[1],z:this.to[2]},m=new e;this.tween.from(p).to(u,+this.time).easing(this.easing).onUpdate(function(){m.x=this.x,m.y=this.y,m.z=this.z,i.lookAt(m,e.UNIT_Y),o.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(s)},o}(goo.Action,goo.Vector3,goo.TWEEN),goo.ShakeAction=function(t,e,n){"use strict";function o(){t.apply(this,arguments)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={name:"Shake",type:"animation",description:"Shakes the entity. Optionally performs a transition.",canTransition:!0,parameters:[{name:"Start level",key:"startLevel",type:"float",description:"Shake amount at start","default":0},{name:"End level",key:"endLevel",type:"float",description:"Shake amount at the end","default":10},{name:"Time (ms)",key:"time",type:"float",description:"Shake time amount","default":1e3},{name:"Speed",key:"speed",type:"string",control:"dropdown",description:"Speed of shaking","default":"Fast",options:["Fast","Medium","Slow"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the shake completes"}]},o.prototype.configure=function(t){this.startLevel=t.startLevel,this.endLevel=t.endLevel,this.time=t.time,this.speed={Fast:1,Medium:2,Slow:4}[t.speed],this.easing=n.Easing.Quadratic.InOut,this.eventToEmit={channel:t.transitions.complete}},o.prototype._setup=function(){this.tween=new n.Tween},o.prototype.cleanup=function(){this.tween&&this.tween.stop()},o.prototype._run=function(t){var n=t.getOwnerEntity(),o=n.transformComponent,i=o.transform.translation,r=1e3*n._world.time,s=new e,a=new e,c=new e,p=this,u=0;this.tween.from({level:+this.startLevel}).to({level:+this.endLevel},+this.time).easing(this.easing).onUpdate(function(){u++,u>p.speed&&(u=0,a.setDirect(-s.x+(Math.random()-.5)*this.level*2,-s.y+(Math.random()-.5)*this.level*2,-s.z+(Math.random()-.5)*this.level*2)),c.setDirect(.98*c.x+.1*a.x,.98*c.y+.1*a.y,.98*c.z+.1*a.z),i.add(c).sub(s),s.copy(c),o.setUpdated()}).onComplete(function(){i.sub(s),o.setUpdated(),t.send(this.eventToEmit.channel)}.bind(this)).start(r)},o}(goo.Action,goo.Vector3,goo.TWEEN),goo.PauseAnimationAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Pause Animation",type:"animation",description:"Pauses skeleton animations",parameters:[{name:"On all entities",key:"onAll",type:"boolean",description:"Pause animation on all entities or just one","default":!1}],transitions:[]},e.prototype._run=function(t){if(this.onAll){var e=t.getWorld(),n=e.getSystem("AnimationSystem");n.pause()}else{var o=t.getOwnerEntity();o.animationComponent&&o.animationComponent.pause()}},e}(goo.Action),goo.ResumeAnimationAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Resume Animation",type:"animation",description:"Continues playing a skeleton animation",parameters:[{name:"On all entities",key:"onAll",type:"boolean",description:"Resume animation on all entities or just one","default":!1}],transitions:[]},e.prototype._run=function(t){if(this.onAll){var e=t.getWorld(),n=e.getSystem("AnimationSystem");n.resume()}else{var o=t.getOwnerEntity();o.animationComponent&&o.animationComponent.resume()}},e}(goo.Action),goo.SetAnimationAction=function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!1}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Set Animation",type:"animation",description:"Transitions to a selected animation",parameters:[{name:"Animation",key:"animation",type:"animation"}],transitions:[{key:"complete",name:"On completion",description:"State to transition to when the target animation completes"}]},e.prototype._run=function(t){var e=t.getOwnerEntity(),n=this;"string"==typeof this.animation&&e.animationComponent&&e.animationComponent.transitionTo(this.animation,!0,function(){t.send(n.transitions.complete)})},e}(goo.Action),goo.SetTimeScale=function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!1}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Set Animation Time Scale",type:"animation",description:"Sets the time scale for the current animation",parameters:[{name:"Scale",key:"scale",type:"number",description:"Scale factor for the animation timer","default":1}],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity();e.animationComponent&&e.animationComponent.setTimeScale(this.scale)},e}(goo.Action),goo.WaitAction=function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0,this.currentTime=0,this.totalWait=0}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Wait",type:"animation",description:"Performs a transition after a specified amount of time. A random time can be set, this will add between 0 and the set random time to the specified wait time.",canTransition:!0,parameters:[{name:"Time (ms)",key:"waitTime",type:"number",description:"Base time in milliseconds before transition fires","default":5e3},{name:"Random (ms)",key:"randomTime",type:"number",description:"A random number of milliseconds (between 0 and this value) will be added to the base wait time","default":0}],transitions:[{key:"timeUp",name:"Time up",description:"State to transition to when time up"}]},e.prototype._setup=function(){this.currentTime=0,this.totalWait=parseFloat(this.waitTime)+Math.random()*parseFloat(this.randomTime)},e.prototype._run=function(t){this.currentTime+=1e3*t.getTpf(),this.currentTime>=this.totalWait&&t.send(this.transitions.timeUp)},e}(goo.Action),goo.TransitionAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Transition",type:"transitions",description:"Transition to a selected state",canTransition:!0,parameters:[],transitions:[{key:"transition",name:"To",description:"State to transition to"}]},e.prototype._run=function(t){t.send(this.transitions.transition)},e}(goo.Action),goo.RandomTransitionAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Random Transition",type:"transitions",description:"Performs a random transition",canTransition:!0,parameters:[{name:"Skewness",key:"skewness",type:"float",control:"slider",min:0,max:1,description:"Determines the chance that the first destination is picked over the second","default":1}],transitions:[{key:"transition1",name:"Destination 1",description:"First choice"},{key:"transition2",name:"Destination 2",description:"Second choice"}]},e.prototype._run=function(t){Math.random()<+this.skewness?t.send(this.transitions.transition1):t.send(this.transitions.transition2)},e}(goo.Action),goo.EmitAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={key:"Emit message",name:"Emit Message",type:"transitions",description:"Emits a message (a ping) to a channel on the bus. Messages can be listened to by the Listen action, or by scripts using the SystemBus.addListener(channel, callback) function.",parameters:[{name:"Channel",key:"channel",type:"string",description:"Channel to transmit a message (a ping) on","default":""}],transitions:[]},n.prototype._run=function(){e.emit(this.channel,this.data)},n}(goo.Action,goo.SystemBus),goo.TransitionOnMessageAction=function(t,e){"use strict";function n(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(){this.updated=!0}.bind(this)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={key:"Transition on Message",name:"Listen",type:"transitions",description:"Performs a transition on receiving a system bus message (a ping) on a specific channel",canTransition:!0,parameters:[{name:"Message channel",key:"channel",type:"string",description:"Channel to listen to","default":""}],transitions:[{key:"transition",name:"To",description:"State to transition to"}]},n.prototype._setup=function(){e.addListener(this.channel,this.eventListener,!1)},n.prototype._run=function(t){this.updated&&(this.updated=!1,t.send(this.transitions.transition))},n.prototype.exit=function(){e.removeListener(this.channel,this.eventListener)},n}(goo.Action,goo.SystemBus),goo.EvalAction=function(t){"use strict";function e(){t.apply(this,arguments),this.expressionFunction=null}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Eval",description:"Evaluates a JS expression",parameters:[{name:"expression",key:"expression",type:"string",description:"JavaScript expression to evaluate","default":""}],transitions:[]},e.prototype._setup=function(){this.expressionFunction=new Function("goo",this.expression)},e.prototype._run=function(t){if(this.expressionFunction)try{this.expressionFunction(t.getEvalProxy())}catch(e){console.warn("Eval code error: "+e.message)}},e}(goo.Action),goo.HideAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Hide",type:"display",description:"Hides an entity and its children",parameters:[],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity();e.hide()},e}(goo.Action),goo.ShowAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Show",type:"display",description:"Makes an entity visible",parameters:[],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity();e.show()},e}(goo.Action),goo.RemoveAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Remove",type:"display",description:"Removes the entity from the world",parameters:[{name:"Recursive",key:"recursive",type:"boolean",description:"Remove children too","default":!1}],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity();e.removeFromWorld(this.recursive)},e}(goo.Action),goo.AddLightAction=function(t,e,n,o,i){"use strict";function r(){t.apply(this,arguments)}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.external={name:"Add Light",description:"Adds a point light to the entity",type:"light",parameters:[{name:"Color",key:"color",type:"vec3",control:"color",description:"Color of the light","default":[1,1,1]},{name:"Light type",key:"type",type:"string",control:"dropdown",description:"Light type","default":"Point",options:["Point","Directional","Spot"]},{name:"Range",key:"range",type:"float",control:"slider",min:0,max:1e3,description:"Range of the light","default":200},{name:"Cone Angle",key:"angle",type:"float",control:"slider",min:1,max:170,description:"Cone angle (applies only to spot lights)","default":30},{name:"Penumbra",key:"penumbra",type:"float",control:"slider",min:0,max:170,description:"Penumbra (applies only to spot lights)","default":30}],transitions:[]},r.prototype._run=function(t){var r=t.getOwnerEntity();if(r.lightComponent)return void(this._untouched=!0);var s;"Directional"===this.type?s=new o:"Spot"===this.type?(s=new i,s.range=+this.range,s.angle=+this.angle,s.penumbra=+this.penumbra):(s=new n,s.range=+this.range),s.color.setDirect(this.color[0],this.color[1],this.color[2]),r.setComponent(new e(s))},r.prototype.cleanup=function(t){if(!this._untouched){var e=t.getOwnerEntity();e&&e.clearComponent("LightComponent")}},r}(goo.Action,goo.LightComponent,goo.PointLight,goo.DirectionalLight,goo.SpotLight),goo.RemoveLightAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Remove Light",type:"light",description:"Removes the light attached to the entity",parameters:[],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity();e.hasComponent("LightComponent")&&e.clearComponent("LightComponent")},e}(goo.Action),goo.TweenLightColorAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={key:"Tween Light Color",name:"Tween Light",type:"light",description:"Tweens the color of the light",parameters:[{name:"Color",key:"to",type:"vec3",control:"color",description:"Color of the light","default":[1,1,1]},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for the transition to complete","default":1e3},{name:"Easing type",key:"easing1",type:"string",control:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"string",control:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},n.prototype.configure=function(t){this.to=t.to,this.time=t.time,"Linear"===t.easing1?this.easing=e.Easing.Linear.None:this.easing=e.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},n.prototype._setup=function(){this.tween=new e.Tween},n.prototype.cleanup=function(){this.tween&&this.tween.stop()},n.prototype._run=function(t){var e=t.getOwnerEntity();if(e.lightComponent){var n=e.lightComponent,o=n.light.color,i=1e3*e._world.time,r={x:o.x,y:o.y,z:o.z},s={x:this.to[0],y:this.to[1],z:this.to[2]},a={x:r.x,y:r.y,z:r.z};this.tween.from(r).to(s,+this.time).easing(this.easing).onUpdate(function(){o.x+=this.x-a.x,o.y+=this.y-a.y,o.z+=this.z-a.z,a.x=this.x,a.y=this.y,a.z=this.z}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(i)}},n}(goo.Action,goo.TWEEN),goo.SetClearColorAction=function(t){"use strict";function e(){t.apply(this,arguments),this._oldClearColor=[]}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={key:"Set Clear Color",name:"Background Color",description:"Sets the clear color",parameters:[{name:"Color",key:"color",type:"vec3",control:"color",description:"Color","default":[1,1,1]}],transitions:[]},e.prototype.ready=function(t){var e=t.getOwnerEntity(),n=e._world.gooRunner;this._oldClearColor[0]=n.renderer._clearColor.x,this._oldClearColor[1]=n.renderer._clearColor.y,this._oldClearColor[2]=n.renderer._clearColor.z,this._oldClearColor[3]=n.renderer._clearColor.w},e.prototype._run=function(t){var e=t.getOwnerEntity(),n=e._world.gooRunner;n.renderer.setClearColor(this.color[0],this.color[1],this.color[2],1)},e.prototype.cleanup=function(t){var e=t.getOwnerEntity();if(e){var n=e._world.gooRunner;n.renderer.setClearColor(this._oldClearColor[0],this._oldClearColor[1],this._oldClearColor[2],this._oldClearColor[3])}},e}(goo.Action),goo.SwitchCameraAction=function(t,e,n){"use strict";function o(){t.apply(this,arguments),this._camera=null}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={name:"Switch Camera",type:"camera",description:"Switches to a selected camera",parameters:[{name:"Camera",key:"cameraEntityRef",type:"camera",description:"Camera to switch to","default":null}],transitions:[]},o.prototype.ready=function(){this._camera=n.mainCamera},o.prototype._run=function(t){var n=t.getOwnerEntity()._world,o=n.entityManager.getEntityById(this.cameraEntityRef);o&&o.cameraComponent&&e.emit("goo.setCurrentCamera",{camera:o.cameraComponent.camera,entity:o})},o.prototype.cleanup=function(){},o}(goo.Action,goo.SystemBus,goo.Renderer),goo.InFrustumAction=function(t,e,n){"use strict";function o(){t.apply(this,arguments)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={key:"In Frustum",name:"In View",type:"camera",description:"Performs a transition based on whether the entity is in a camera's frustum or not",canTransition:!0,parameters:[{name:"Current camera",key:"current",type:"boolean",description:"Check this to always use the current camera","default":!0},{name:"Camera",key:"cameraEntityRef",type:"camera",description:"Other camera; Will be ignored if the previous option is checked","default":null},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"inside",name:"Inside",description:"State to transition to if entity is in the frustum"},{key:"outside",name:"Outside",description:"State to transition to if entity is outside the frustum"}]},o.prototype._setup=function(t){if(!this.current){var e=t.getOwnerEntity()._world,n=e.entityManager.getEntityById(this.cameraEntityRef);this.camera=n.cameraComponent.camera}},o.prototype._run=function(t){var o=t.getOwnerEntity();if(this.current)o.isVisible?t.send(this.transitions.inside):t.send(this.transitions.outside);else{var i=o.meshRendererComponent?o.meshRendererComponent.worldBound:new n(o.transformComponent.worldTransform.translation,.001);this.camera.contains(i)===e.Outside?t.send(this.transitions.outside):t.send(this.transitions.inside)}},o}(goo.Action,goo.Camera,goo.BoundingSphere),goo.DollyZoomAction=function(t,e,n){"use strict";function o(){t.apply(this,arguments)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={name:"Dolly Zoom",type:"camera",description:"Performs dolly zoom",parameters:[{name:"Forward",key:"forward",type:"number",description:"Number of units to move towards the focus point. Enter negative values to move away.","default":100},{name:"Focus point",key:"lookAt",type:"position",description:"Point to focus on while transitioning","default":[0,0,0]},{name:"Time (ms)",key:"time",type:"number",description:"Time","default":1e4},{name:"Easing type",key:"easing1",type:"string",control:"dropdown",description:"Easing","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"string",control:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},o.prototype.configure=function(t){this.forward=t.forward,this.lookAt=t.lookAt,this.time=t.time,"Linear"===t.easing1?this.easing=n.Easing.Linear.None:this.easing=n.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},o.prototype._setup=function(t){this.tween=new n.Tween;var o=t.getOwnerEntity();if(o.cameraComponent&&o.cameraComponent.camera){var i=o.cameraComponent.camera;this.initialDistance=new e(this.lookAt).distance(i.translation),this.eyeTargetScale=Math.tan(i.fov*(Math.PI/180)/2)*this.initialDistance}else this.eyeTargetScale=null},o.prototype.cleanup=function(){this.tween&&this.tween.stop()},o.prototype._run=function(t){if(this.eyeTargetScale){var n=t.getOwnerEntity(),o=n.transformComponent,i=o.transform.translation,r=(new e).copy(i),s=n.cameraComponent.camera,a=1e3*n._world.time,c=e.fromArray(this.lookAt).sub(r).normalize().scale(this.forward).add(r),p={x:r.x,y:r.y,z:r.z,d:this.initialDistance},u={x:c.x,y:c.y,z:c.z,d:+this.initialDistance-+this.forward},m={x:p.x,y:p.y,z:p.z},l=this;this.tween.from(p).to(u,+this.time).easing(this.easing).onUpdate(function(){i.x+=this.x-m.x,i.y+=this.y-m.y,i.z+=this.z-m.z,m.x=this.x,m.y=this.y,m.z=this.z,o.setUpdated();var t=180/Math.PI*2*Math.atan(l.eyeTargetScale/this.d);s.setFrustumPerspective(t)}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(a)}},o}(goo.Action,goo.Vector3,goo.TWEEN),goo.InBoxAction=function(t){"use strict";function e(){t.apply(this,arguments)}function n(t,e,n){var o=!1,i=function(t,e,n){if(e>n){if(e>t&&t>n)return!0}else if(n>e){if(n>t&&t>e)return!0}else if(t===n)return!0;return!1},r=i(t[0],e[0],n[0]),s=i(t[1],e[1],n[1]),a=i(t[2],e[2],n[2]);return r&&s&&a&&(o=!0),o}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"In Box",type:"collision",description:"Performs a transition based on whether an entity is inside a user defined box volume or not.The volume is defined by setting two points which, when connected, form a diagonal through the box volume.",canTransition:!0,parameters:[{name:"Point1",key:"point1",type:"position",description:"First box point","default":[-1,-1,-1]},{name:"Point2",key:"point2",type:"position",description:"Second box point","default":[1,1,1]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"inside",name:"Inside",description:"State to transition to if the entity is inside the box"},{key:"outside",name:"Outside",description:"State to transition to if the entity is outside the box"}]},e.prototype._run=function(t){var e=t.getOwnerEntity(),o=e.transformComponent.worldTransform.translation,i=n([o.x,o.y,o.z],this.point1,this.point2);i?t.send(this.transitions.inside):t.send(this.transitions.outside)},e}(goo.Action),goo.CompareDistanceAction=function(t,e,n){"use strict";function o(){t.apply(this,arguments)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={key:"Compare Distance",name:"Camera Distance",type:"collision",description:"Performs a transition based on the distance to the main camera or to a location",canTransition:!0,parameters:[{name:"Current camera",key:"camera",type:"boolean",description:"Measure the distance to the current camera or to an arbitrary point","default":!0},{name:"Position",key:"position",type:"position",description:"Position to measure the distance to; Will be ignored if previous option is selected","default":[0,0,0]},{name:"Value",key:"value",type:"number",description:"Value to compare to","default":0},{name:"Tolerance",key:"tolerance",type:"number","default":.1},{name:"Type",key:"distanceType",type:"string",control:"dropdown",description:"The type of distance","default":"Euclidean",options:["Euclidean","Manhattan"]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"less",name:"Less",description:"State to transition to if the measured distance is smaller than the specified value"},{key:"equal",name:"Equal",description:"State to transition to if the measured distance is about the same as the specified value"},{key:"greater",name:"Greater",description:"State to transition to if the measured distance is greater than the specified value"}]},o.prototype._run=function(t){var e,o=t.getOwnerEntity(),i=o.transformComponent.worldTransform.translation;e=this.camera?i.clone().sub(n.mainCamera.translation):i.clone().subDirect(this.position[0],this.position[1],this.position[2]);var r;r="Euclidean"===this.type?e.length():Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z);var s=this.value-r;Math.abs(s)<=this.tolerance?t.send(this.transitions.equal):s>0?t.send(this.transitions.less):t.send(this.transitions.greater)},o}(goo.Action,goo.Vector3,goo.Renderer),goo.ProximitySystem=function(t,e,n){"use strict";function o(){t.call(this,"ProximitySystem",["ProximityComponent"]),this.collections={Red:{name:"Red",collection:[]},Blue:{name:"Blue",collection:[]},Green:{name:"Green",collection:[]},Yellow:{name:"Yellow",collection:[]}}}function i(t){return n.capitalize(t)}return o.prototype=Object.create(t.prototype),o.prototype._collides=function(t,n){for(var o=0;o<t.collection.length;o++)for(var i=t.collection[o],r=0;r<n.collection.length;r++){var s=n.collection[r];i.meshRendererComponent.worldBound.intersects(s.meshRendererComponent.worldBound)&&e.send("collides."+t.name+"."+n.name)}},o.prototype.getFor=function(t){return t=i(t),this.collections[t]?this.collections[t].collection:[]},o.prototype.add=function(t,e){e=i(e),this.collections[e]||(this.collections[e]={name:e,collection:[]}),this.collections[e].collection.push(t)},o.prototype.remove=function(t,e){e=i(e);var n=this.collections[e].collection,o=n.indexOf(t);n.splice(o,1)},o.prototype.process=function(){},o}(goo.System,goo.SystemBus,goo.StringUtils),goo.CollidesAction=function(t,e,n){"use strict";function o(){e.apply(this,arguments),this.everyFrame=!0}return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.external={key:"Collides",name:"Collision",type:"collision",description:"Checks for collisions or non-collisions with other entities. Collisions are based on the entities' bounding volumes. Before using collisions you first need to tag entities via the entity panel or using the 'Tag' action.",canTransition:!0,parameters:[{name:"Tag",key:"tag",type:"string",description:"Checks for collisions with other objects having this tag","default":"red"}],transitions:[{key:"collides",name:"On Collision",description:"State to transition to when a collision occurs"},{key:"notCollides",name:"On Divergence",description:"State to transition to when a collision is not occurring"}]},o.prototype.ready=function(t){var e=t.getOwnerEntity(),o=e._world;o.getSystem("ProximitySystem")||o.setSystem(new n)},o.prototype._run=function(e){var n=e.getOwnerEntity(),o=n._world,i=o.getSystem("ProximitySystem"),r=new t(i.getFor(this.tag)).and(o.by.tag(this.tag)).toArray(),s=!1;n.traverse(function(t){if(!t.meshRendererComponent||t.particleComponent)return!1;for(var e=t.meshRendererComponent.worldBound,n=0;n<r.length;n++)if(r[n].traverse(function(t){if(!t.meshRendererComponent||t.particleComponent)return!0;var n=t.meshRendererComponent.worldBound;return n&&e.intersects(n)?(s=!0,!1):void 0}),s)return!1}),e.send(s?this.transitions.collides:this.transitions.notCollides)},o}(goo.EntitySelection,goo.Action,goo.ProximitySystem),goo.ProximityComponent=function(t){"use strict";function e(e){t.apply(this,arguments),this.type="ProximityComponent",Object.defineProperty(this,"tag",{value:e||"red",writable:!1})}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.attached=function(t){var e=t._world;if(e){var n=e.getSystem("ProximitySystem");n&&n.add(t,this.tag)}},e.prototype.detached=function(t){var e=t._world;if(e){var n=e.getSystem("ProximitySystem");n&&n.remove(t,this.tag)}},e}(goo.Component),goo.TagAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"Tag",type:"collision",description:"Sets a tag on the entity. Use tags to be able to capture collision events with the 'Collides' action",parameters:[{name:"Tag",key:"tag",type:"string",control:"dropdown",description:"Checks for collisions with other objects having this tag","default":"red",options:["red","blue","green","yellow"]}],transitions:[]},n.prototype._run=function(t){var n=t.getOwnerEntity();n.proximityComponent?n.proximityComponent.tag!==this.tag&&(n.clearComponent("ProximityComponent"),n.setComponent(new e(this.tag))):n.setComponent(new e(this.tag))},n.prototype.cleanup=function(t){var e=t.getOwnerEntity();e&&e.clearComponent("ProximityComponent")},n}(goo.Action,goo.ProximityComponent),goo.SmokeAction=function(t,e,n,o,i,r){"use strict";function s(){t.apply(this,arguments),this.smokeEntity=null}return s.material=null,s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.external={key:"Smoke",name:"Smoke FX",type:"fx",description:'Makes the entity emit smoke. To cancel the smoke emitter use the "Remove Particles" action.',parameters:[{name:"Color",key:"color",type:"vec3",control:"color",description:"Smoke color","default":[0,0,0]}],transitions:[]},s.prototype._run=function(t){var o=t.getOwnerEntity();if(!this.smokeEntity||-1===o.transformComponent.children.indexOf(this.smokeEntity.transformComponent)){var a=o._world.gooRunner;if(!s.material){s.material=new e(n.particles);var c=r.createFlareTexture();c.generateMipmaps=!0,s.material.setTexture("DIFFUSE_MAP",c),s.material.blendState.blending="TransparencyBlending",s.material.cullState.enabled=!1,s.material.depthState.write=!1,s.material.renderQueue=2001}var p=o.transformComponent.worldTransform.scale,u=(p.x+p.y+p.z)/3;this.smokeEntity=r.createParticleSystemEntity(a.world,i.getSmoke({scale:u,color:this.color}),s.material),this.smokeEntity.meshRendererComponent.isPickable=!1,this.smokeEntity.meshRendererComponent.castShadows=!1,this.smokeEntity.meshRendererComponent.receiveShadows=!1,this.smokeEntity.name="_ParticleSystemSmoke",o.transformComponent.attachChild(this.smokeEntity.transformComponent),this.smokeEntity.addToWorld()}},s.prototype.cleanup=function(){this.smokeEntity&&(this.smokeEntity.removeFromWorld(),this.smokeEntity=null)},s}(goo.Action,goo.Material,goo.ShaderLib,goo.TextureCreator,goo.ParticleLib,goo.ParticleSystemUtils),goo.FireAction=function(t,e,n,o,i){"use strict";function r(){t.apply(this,arguments),this.fireEntity=null}return r.material=null,r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.external={key:"Fire",name:"Fire FX",type:"fx",description:'Makes the entity emit fire. To "extinguish" the fire use the "Remove Particles" action.',parameters:[{name:"Start Color",key:"startColor",type:"vec3",control:"color",description:"Flame color at source","default":[1,1,0]},{name:"End color",key:"endColor",type:"vec3",control:"color",description:"Color near the end of a flame's life","default":[1,0,0]}],transitions:[]},r.prototype._run=function(t){var s=t.getOwnerEntity();if(!this.fireEntity||-1===s.transformComponent.children.indexOf(this.fireEntity.transformComponent)){var a=s._world.gooRunner;if(!r.material){r.material=new e(n.particles);var c=i.createFlareTexture();c.generateMipmaps=!0,r.material.setTexture("DIFFUSE_MAP",c),r.material.blendState.blending="AdditiveBlending",r.material.cullState.enabled=!1,r.material.depthState.write=!1,r.material.renderQueue=2002}var p=s.transformComponent.worldTransform.scale,u=(p.x+p.y+p.z)/3;this.fireEntity=i.createParticleSystemEntity(a.world,o.getFire({scale:u,startColor:this.startColor,endColor:this.endColor}),r.material),this.fireEntity.meshRendererComponent.isPickable=!1,this.fireEntity.meshRendererComponent.castShadows=!1,this.fireEntity.meshRendererComponent.receiveShadows=!1,this.fireEntity.name="_ParticleSystemFire",s.transformComponent.attachChild(this.fireEntity.transformComponent),this.fireEntity.addToWorld();
}},r.prototype.cleanup=function(){this.fireEntity&&(this.fireEntity.removeFromWorld(),this.fireEntity=null)},r}(goo.Action,goo.Material,goo.ShaderLib,goo.ParticleLib,goo.ParticleSystemUtils),goo.RemoveParticlesAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Remove Particles",type:"fx",description:"Removes any particle emitter attached to the entity",parameters:[],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity();e.children().each(function(t){-1!==t.name.indexOf("_ParticleSystem")&&t.hasComponent("ParticleComponent")&&t.removeFromWorld()})},e}(goo.Action),goo.TogglePostFxAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Toggle Post FX",type:"fx",description:"Enabled/disables post fx globally",parameters:[{name:"Set Post FX state",key:"enabled",type:"boolean",description:"Set Post FX on/off","default":!0}],transitions:[]},e.prototype._run=function(t){var e=t.getWorld().gooRunner.renderSystem;e&&e.enableComposers(this.enabled)},e}(goo.Action),goo.SoundFadeInAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"Sound Fade In",type:"sound",description:"Fades in a sound. NOTE: will not work on iOS devices.",canTransition:!0,parameters:[{name:"Sound",key:"sound",type:"sound",description:"Sound","default":0},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for the fading to complete","default":1e3},{name:"On Sound End",key:"onSoundEnd",type:"boolean",description:"Whether to transition when the sound finishes playing, regardless of the specified transition time","default":!1}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the time expires or when the sound finishes playing"}]},n.prototype._run=function(t){var n=t.getOwnerEntity();if(n.hasComponent("SoundComponent")){var o=n.soundComponent.getSoundById(this.sound);if(o){var i;try{o.fadeIn(this.time/1e3),i=this.onSoundEnd?o.play():e.delay(null,this.time)}catch(r){console.warn("Could not play sound: "+r),i=e.resolve()}i.then(function(){t.send(this.transitions.complete)}.bind(this))}}},n}(goo.Action,goo.PromiseUtil),goo.SoundFadeOutAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Sound Fade Out",type:"sound",description:"Fades out a sound and stops it.",canTransition:!0,parameters:[{name:"Sound",key:"sound",type:"sound",description:"Sound","default":0},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for the fading to complete","default":1e3}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the movement completes"}]},e.prototype._run=function(t){var e=t.getOwnerEntity();if(e.hasComponent("SoundComponent")){var n=e.soundComponent.getSoundById(this.sound);n&&n.fadeOut(this.time/1e3).then(function(){t.send(this.transitions.complete)}.bind(this))}},e}(goo.Action),goo.SetRenderTargetAction=function(t,e,n,o,i,r,s,a){"use strict";function c(){t.apply(this,arguments)}return c.prototype=Object.create(t.prototype),c.prototype.constructor=c,c.external={name:"Set Render Target",type:"texture",description:"Renders what a camera sees on the current entity's texture",parameters:[{name:"Camera",key:"cameraEntityRef",type:"camera",description:"Camera to use as source","default":null}],transitions:[]},c.prototype.ready=function(t){var e=t.getOwnerEntity(),o=e._world;if(!o.getSystem("PortalSystem")){var i=o.getSystem("RenderSystem"),r=o.gooRunner.renderer;o.setSystem(new n(r,i))}},c.prototype._run=function(t){var n=t.getOwnerEntity(),o=n._world,i=o.entityManager.getEntityById(this.cameraEntityRef);if(i&&i.cameraComponent&&i.cameraComponent.camera){var r=i.cameraComponent.camera,c=new s(a.textured);if(n.meshRendererComponent){this.oldMaterials=n.meshRendererComponent.materials,n.meshRendererComponent.materials=[c];var p=new e(r,500,{preciseRecursion:!0});n.setComponent(p)}}},c.prototype.cleanup=function(t){var e=t.getOwnerEntity();e&&(this.oldMaterials&&e.meshRendererComponent&&(e.meshRendererComponent.materials=this.oldMaterials),e.clearComponent("portalComponent")),this.oldMaterials=null},c}(goo.Action,goo.PortalComponent,goo.PortalSystem,goo.Vector3,goo.CameraComponent,goo.Camera,goo.Material,goo.ShaderLib),goo.TweenTextureOffsetAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={key:"Tween Texture Offset",name:"Tween Texture Offset",type:"texture",description:"Smoothly changes the texture offset of the entity",canTransition:!0,parameters:[{name:"X Offset",key:"toX",type:"float",control:"slider",min:0,max:1,description:"X Offset","default":1},{name:"Y Offset",key:"toY",type:"float",control:"slider",min:0,max:1,description:"Y Offset","default":1},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for this transition to complete","default":1e3},{name:"Easing type",key:"easing1",type:"string",control:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"string",control:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},n.prototype.configure=function(t){this.toX=+t.toX,this.toY=+t.toY,this.time=+t.time,"Linear"===t.easing1?this.easing=e.Easing.Linear.None:this.easing=e.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},n.prototype._setup=function(){this.tween=new e.Tween},n.prototype.cleanup=function(){this.tween&&this.tween.stop()},n.prototype._run=function(t){var e=t.getOwnerEntity();if(e.meshRendererComponent&&e.meshRendererComponent.materials.length>0){var n=e.meshRendererComponent,o=n.materials[0],i=o.getTexture("DIFFUSE_MAP");if(!i)return;var r=i.offset,s=1e3*e._world.time,a={x:r.x,y:r.y},c={x:this.toX,y:this.toY};this.tween.from(a).to(c,this.time).easing(this.easing).onUpdate(function(){i.offset.setDirect(this.x,this.y)}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(s)}},n}(goo.Action,goo.TWEEN),goo.SetMaterialColorAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Set Material Color",type:"texture",description:"Sets the color of a material",parameters:[{name:"Entity (optional)",key:"entity",type:"entity",description:"Entity that has a material"},{name:"Color type",key:"type",type:"string",control:"dropdown",description:"Color type","default":"Diffuse",options:["Diffuse","Emissive","Specular","Ambient"]},{name:"Color",key:"color",type:"vec3",control:"color",description:"Color","default":[1,1,1]}],transitions:[]},e.MAPPING={Diffuse:"materialDiffuse",Emissive:"materialEmissive",Specular:"materialSpecular",Ambient:"materialAmbient"},e.prototype._run=function(t){var n=this.entity&&t.getEntityById(this.entity.entityRef)||t.getOwnerEntity();if(n&&n.meshRendererComponent){var o=n.meshRendererComponent.materials[0],i=e.MAPPING[this.type];o.uniforms[i]=o.uniforms[i]||[1,1,1,1];var r=o.uniforms[i];r[0]=this.color[0],r[1]=this.color[1],r[2]=this.color[2]}},e}(goo.Action),goo.LogMessageAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Log Message",description:"Prints a message in the debug console of your browser",parameters:[{name:"Message",key:"message",type:"string",description:"Message to print","default":"hello"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},e.prototype._run=function(){console.log(this.message)},e}(goo.Action),goo.TweenOpacityAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={key:"Tween Opacity",name:"Tween Material Opacity",type:"texture",description:"Tweens the opacity of a material",parameters:[{name:"Opacity",key:"to",type:"float",control:"spinner",description:"Opacity","default":1},{name:"Time (ms)",key:"time",type:"float",control:"spinner",description:"Time it takes for the transition to complete","default":1e3},{name:"Easing type",key:"easing1",type:"string",control:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Bounce"]},{name:"Direction",key:"easing2",type:"string",control:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},n.prototype.configure=function(t){this.to=t.to,this.time=t.time,"Linear"===t.easing1?this.easing=e.Easing.Linear.None:this.easing=e.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},n.prototype._setup=function(t){var n=t.getOwnerEntity(),o=n.meshRendererComponent;o&&(this.tween=new e.Tween,this.material=o.materials[0],this.oldBlending=this.material.blendState.blending,this.oldQueue=this.material.renderQueue,this.oldOpacity=this.material.uniforms.opacity,this.material.blendState.blending="CustomBlending",this.material.renderQueue<2e3&&(this.material.renderQueue=2e3),void 0===this.material.uniforms.opacity&&(this.material.uniforms.opacity=1))},n.prototype.cleanup=function(){this.tween&&(this.tween.stop(),this.material.blendState.blending=this.oldBlending,this.material.renderQueue=this.oldQueue,this.material.uniforms.opacity=this.oldOpacity)},n.prototype._run=function(t){var e=t.getOwnerEntity();if(e.meshRendererComponent){var n=this.material.uniforms,o=1e3*e._world.time,i={opacity:n.opacity},r={opacity:this.to},s={opacity:i.opacity};this.tween.from(i).to(r,+this.time).easing(this.easing).onUpdate(function(){n.opacity+=this.opacity-s.opacity,s.opacity=this.opacity}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(o)}},n}(goo.Action,goo.TWEEN),goo.HtmlAction=function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(){this.updated=!0}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"HTMLPick",type:"controls",description:"Listens for a picking event and performs a transition. Can only be used on HTML entities.",canTransition:!0,parameters:[],transitions:[{key:"pick",name:"Pick",description:"State to transition to when the HTML entity is picked"}]},e.prototype._setup=function(t){var e=t.getOwnerEntity();e.htmlComponent&&(this.domElement=e.htmlComponent.domElement,this.domElement.addEventListener("click",this.eventListener))},e.prototype._run=function(t){this.updated&&(this.updated=!1,t.send(this.transitions.pick))},e.prototype.exit=function(){this.domElement&&this.domElement.removeEventListener("click",this.eventListener)},e}(goo.Action),goo.CopyJointTransformAction=function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0}function n(t){t.updateWorldTransform();var e=t.entity;e&&e.meshDataComponent&&e.meshRendererComponent&&e.meshRendererComponent.updateBounds(e.meshDataComponent.modelBound,t.worldTransform);for(var o=0;o<t.children.length;o++)n(t.children[o])}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Copy Joint Transform",type:"animation",description:"Copies a joint's transform from another entity, and applies it to this entity. This entity must be a child of an entity with an animation component",parameters:[{name:"Joint",key:"jointIndex",type:"int",control:"jointSelector","default":null,description:"Joint transform to copy"}],transitions:[]},e.prototype._run=function(t){if(null!==this.jointIndex){var e=t.getOwnerEntity(),o=e.transformComponent.parent;if(o&&(o=o.entity,o.animationComponent&&o.animationComponent._skeletonPose)){var i=o.animationComponent._skeletonPose,r=i._globalTransforms[this.jointIndex];r&&(e.transformComponent.transform.matrix.copy(r.matrix),r.matrix.getTranslation(e.transformComponent.transform.translation),r.matrix.getScale(e.transformComponent.transform.scale),r.matrix.getRotation(e.transformComponent.transform.rotation),n(e.transformComponent),e.transformComponent._dirty=!0)}}},e}(goo.Action),goo.TriggerEnterAction=function(t,e){"use strict";function n(){t.apply(this,arguments),this.entered=!1,this.everyFrame=!0;var e=this;this.listener=function(t){(t.entityA===e.entity||t.entityB===e.entity)&&(e.entered=!0)}}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"TriggerEnter",type:"collision",description:"Transitions when a trigger volume is entered.",canTransition:!0,parameters:[],transitions:[{key:"enter",name:"On enter",description:"State to transition to when enter occurs"}]},n.prototype._setup=function(t){this.entity=t.getOwnerEntity(),this.entered=!1,e.addListener("goo.physics.triggerEnter",this.listener)},n.prototype._cleanup=function(){this.entity=null},n.prototype.exit=function(){e.removeListener("goo.physics.triggerEnter",this.listener),this.entered=!1},n.prototype._run=function(t){this.entered&&(t.send(this.transitions.enter),this.entered=!1)},n}(goo.Action,goo.SystemBus),goo.TriggerLeaveAction=function(t,e){"use strict";function n(){t.apply(this,arguments),this.leaved=!1,this.everyFrame=!0;var e=this;this.listener=function(t){(t.entityA===e.entity||t.entityB===e.entity)&&(e.leaved=!0)}}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"TriggerLeave",type:"collision",description:"Transitions when a collider is leaving the trigger volume.",canTransition:!0,parameters:[],transitions:[{key:"leave",name:"On leave",description:"State to transition to when leave occurs"}]},n.prototype._setup=function(t){this.entity=t.getOwnerEntity(),this.leaved=!1,e.addListener("goo.physics.triggerExit",this.listener)},n.prototype._cleanup=function(){this.entity=null},n.prototype.exit=function(){e.removeListener("goo.physics.triggerExit",this.listener),this.leaved=!1},n.prototype._run=function(t){this.leaved&&(t.send(this.transitions.leave),this.leaved=!1)},n}(goo.Action,goo.SystemBus),goo.ApplyImpulseAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"ApplyImpulse",type:"physics",description:"Apply an impulse to the attached rigid body.",canTransition:!1,parameters:[{name:"Impulse",key:"impulse",type:"position",description:"Impulse to apply to the body.","default":[0,0,0]},{name:"Apply point",key:"point",type:"position",description:"Where on the body to apply the impulse, relative to the center of mass.","default":[0,0,0]},{name:"Space",key:"space",type:"string",control:"dropdown",description:"The space where the impulse and apply point are defined.","default":"World",options:["World","Local"]}],transitions:[]};var o=new e,i=new e;return n.prototype._run=function(t){var e=t.getOwnerEntity();e.rigidBodyComponent&&(o.setArray(this.impulse),i.setArray(this.point),"World"===this.space?e.rigidBodyComponent.applyImpulse(o,i):e.rigidBodyComponent.applyImpulseLocal(o,i))},n}(goo.Action,goo.Vector3),goo.CompareCounterAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={key:"Compare Counter",name:"Compare Counter",type:"transitions",description:"Compares a counter with a value",canTransition:!0,parameters:[{name:"Name",key:"name",type:"string",description:"Counter name"},{name:"Value",key:"value",type:"number",description:"Value to compare the counter with","default":0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"less",name:"Less",description:"State to transition to if the counter is smaller than the specified value"},{key:"equal",name:"Equal",description:"State to transition to if the counter is the same as the specified value"},{key:"greater",name:"Greater",description:"State to transition to if the counter is greater than the specified value"}]},e.prototype._run=function(t){var e=+t.getFsm().getVariable(this.name),n=+this.value;e>n?t.send(this.transitions.greater):e===n?t.send(this.transitions.equal):t.send(this.transitions.less)},e}(goo.Action),goo.CompareCountersAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={key:"Compare 2 Counters",name:"Compare 2 Counters",type:"transitions",description:"Compares the value of 2 counters",canTransition:!0,parameters:[{name:"First counter",key:"name1",type:"string",description:"First counter name"},{name:"Second counter",key:"name2",type:"string",description:"Second counter name"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"less",name:"Less",description:"State to transition to if the first counter is smaller than the second counter"},{key:"equal",name:"Equal",description:"State to transition to if the first counter is the same as the second counter"},{key:"greater",name:"Greater",description:"State to transition to if the first counter is greater than the second counter"}]},e.prototype._run=function(t){var e=+t.getFsm().getVariable(this.name1),n=+t.getFsm().getVariable(this.name2);e>n?t.send(this.transitions.greater):e===n?t.send(this.transitions.equal):t.send(this.transitions.less)},e}(goo.Action),goo.SetCounterAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={key:"Set Counter",name:"Set Counter",type:"transitions",description:"Sets a counter to a value",parameters:[{name:"Name",key:"name",type:"string",description:"Counter name"},{name:"Value",key:"value",type:"number",description:"Value to set the counter to","default":0}],transitions:[]},e.prototype._run=function(t){t.getFsm().defineVariable(this.name,+this.value)},e.prototype.cleanup=function(t){t.getFsm().removeVariable(this.name)},e}(goo.Action),goo.IncrementCounterAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={key:"Increment Counter",name:"Increment Counter",type:"transitions",description:"Increments a counter with a value",parameters:[{name:"Name",key:"name",type:"string",description:"Counter name"},{name:"Increment",key:"increment",type:"number",description:"Value to increment the counter with","default":1},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},e.prototype._run=function(t){var e=+this.increment;return void 0===t.getFsm().vars[this.name]?void t.getFsm().defineVariable(this.name,e):void t.getFsm().applyOnVariable(this.name,function(t){return t+e})},e.prototype.cleanup=function(t){t.getFsm().removeVariable(this.name)},e}(goo.Action),goo.Actions=function(t){"use strict";function e(t){for(var e=0,n=e;n<t.length;n++){var i=t[n];o.register(i.external.key||i.external.name,i)}}var n={},o={},i=["Eval","HTMLPick","Remove","Collides","Tag"];return o.register=function(t,e){n[t]=e},o.actionForType=function(t){return n[t]},o.allActions=function(){for(var t={},e=Object.keys(n),o=0;o<e.length;o++){var r=e[o];-1===i.indexOf(r)&&(t[r]=n[r])}return t},o.allActionsArray=function(){for(var t=[],e=Object.keys(n),o=0;o<e.length;o++){var i=e[o];"Eval"!==i&&"HTMLPick"!==i&&"Remove"!==i&&t.push(n[i])}return t},e(arguments),o}(goo.ArrowsAction,goo.MouseUpAction,goo.MouseDownAction,goo.MouseMoveAction,goo.KeyUpAction,goo.KeyDownAction,goo.KeyPressedAction,goo.PickAction,goo.PickAndExitAction,goo.WasdAction,goo.MoveAction,goo.RotateAction,goo.ScaleAction,goo.LookAtAction,goo.TweenMoveAction,goo.TweenRotationAction,goo.TweenScaleAction,goo.TweenLookAtAction,goo.ShakeAction,goo.PauseAnimationAction,goo.ResumeAnimationAction,goo.SetAnimationAction,goo.SetTimeScale,goo.WaitAction,goo.TransitionAction,goo.RandomTransitionAction,goo.EmitAction,goo.TransitionOnMessageAction,goo.EvalAction,goo.HideAction,goo.ShowAction,goo.RemoveAction,goo.AddLightAction,goo.RemoveLightAction,goo.TweenLightColorAction,goo.SetClearColorAction,goo.SwitchCameraAction,goo.InFrustumAction,goo.DollyZoomAction,goo.InBoxAction,goo.CompareDistanceAction,goo.CollidesAction,goo.TagAction,goo.SmokeAction,goo.FireAction,goo.RemoveParticlesAction,goo.TogglePostFxAction,goo.SoundFadeInAction,goo.SoundFadeOutAction,goo.SetRenderTargetAction,goo.TweenTextureOffsetAction,goo.SetMaterialColorAction,goo.LogMessageAction,goo.TweenOpacityAction,goo.HtmlAction,goo.CopyJointTransformAction,goo.TweenOpacityAction,goo.TriggerEnterAction,goo.TriggerLeaveAction,goo.ApplyImpulseAction,goo.CompareCounterAction,goo.CompareCountersAction,goo.SetCounterAction,goo.IncrementCounterAction),goo.MachineHandler=function(t,e,n,o,i,r){"use strict";function s(){t.apply(this,arguments)}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,t._registerClass("machine",s),s.prototype._create=function(){return new o},s.prototype._update=function(e,n,o){var i=this;return t.prototype._update.call(this,e,n,o).then(function(t){if(t){t.name=n.name;for(var e in t._states)n.states[e]||t.removeState(e);var s=[];for(var e in n.states)s.push(i._updateState(t,n.states[e],o));return r.all(s).then(function(){return t.setInitialState(n.initialState),t})}})},s.prototype._updateActions=function(t,n){for(var o=0;o<t._actions.length;o++){var r=t._actions[o];n.actions&&n.actions[r.id]||(t.removeAction(r),o--)}var s=[];e.forEach(n.actions,function(e){var n=t.getAction(e.id);if(n)n.configure(e.options);else{var o=i.actionForType(e.type);n=new o(e.id,e.options),n.onCreate&&n.onCreate(t.proxy)}s.push(n)},null,"sortValue"),t._actions=s},s.prototype._updateTransitions=function(t,e){t._transitions={};for(var n in e.transitions){var o=e.transitions[n];t.setTransition(o.id,o.targetState)}},s.prototype._updateState=function(t,e,o){var i;t._states&&t._states[e.id]?i=t._states[e.id]:(i=new n(e.id),t.addState(i)),i.name=e.name,this._updateActions(i,e),this._updateTransitions(i,e);for(var s=0;s<i._machines;s++){var a=i._machines[s];e.childMachines[a.id]||(i.removeMachine(a),s--)}var c=[];for(var p in e.childMachines)c.push(this._load(e.childMachines[p].machineRef,o));return r.all(c).then(function(t){for(var e=0;t>e;e++)i.addMachine(t[e]);return i})},s}(goo.ConfigHandler,goo.ObjectUtils,goo.State,goo.Machine,goo.Actions,goo.rsvp),goo.StateMachineComponent=function(t,e,n){"use strict";function o(){t.apply(this,arguments),this.type="StateMachineComponent",this._machines=[],this.entity=null,this.vars={},this.system=null,this.time=0,this.entered=!1,this.active=!0}return o.prototype=Object.create(t.prototype),o.vars={},o.getVariable=function(t){return o.vars[t]},o.prototype.getVariable=function(t){return void 0!==this.vars[t]?this.vars[t]:o.getVariable(t)},o.applyOnVariable=function(t,e){o.vars[t]=e(o.vars[t])},o.prototype.applyOnVariable=function(t,e){void 0!==this.vars[t]?this.vars[t]=e(this.vars[t]):o.applyOnVariable(t,e)},o.prototype.defineVariable=function(t,e){this.vars[t]=e},o.prototype.removeVariable=function(t){delete this.vars[t]},o.applyOnVariable=function(t,e){this.vars[t]?this.vars[t]=e(this.vars[t]):o.vars[t]&&o.applyOnVariable(t,e)},o.prototype.addMachine=function(t){t._fsm=this,t.parent=this,this._machines.push(t)},o.prototype.removeMachine=function(t){t.recursiveRemove(),e.remove(this._machines,t)},o.prototype.init=function(){for(var t=0;t<this._machines.length;t++){var e=this._machines[t];e.setRefs(this),e.reset(),e.ready()}},o.prototype.doEnter=function(){for(var t=0;t<this._machines.length;t++){var e=this._machines[t];e.enter()}},o.prototype.kill=function(){for(var t=0;t<this._machines.length;t++){var e=this._machines[t];e.kill()}},o.prototype.cleanup=function(){for(var t=0;t<this._machines.length;t++){var e=this._machines[t];e.cleanup()}},o.prototype.update=function(){if(this.active)for(var t=0;t<this._machines.length;t++){var e=this._machines[t];e.update()}},o.prototype.pause=function(){this.active=!1,n.emit("goo.entity."+this.entity.name+".fsm.pause")},o.prototype.play=function(){this.active=!0,n.emit("goo.entity."+this.entity.name+".fsm.play")},o}(goo.Component,goo.ArrayUtils,goo.SystemBus),goo.StateMachineComponentHandler=function(t,e,n,o){"use strict";function i(){t.apply(this,arguments),this._type="StateMachineComponent"}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,t._registerClass("stateMachine",i),i.prototype._create=function(){return new e},i.prototype._remove=function(t){var e=t.stateMachineComponent;e&&(e._machines.forEach(function(t){t.cleanup(),e.removeMachine(t)}),e.cleanup()),t.clearComponent(this._type)},i.prototype.update=function(e,i,r){var s=this;return r=r||{},r.reload=!0,r.instantiate=!0,t.prototype.update.call(this,e,i,r).then(function(t){if(t){var e=[];return o.forEach(i.machines,function(t){e.push(s._load(t.machineRef,r))},null,"sortValue"),n.all(e).then(function(e){for(var n=0;n<e.length;n++)-1===t._machines.indexOf(e[n])&&t.addMachine(e[n]);for(var n=0;n<t._machines.length;n++)-1===e.indexOf(t._machines[n])&&t.removeMachine(t._machines[n]);return t})}})},i}(goo.ComponentHandler,goo.StateMachineComponent,goo.rsvp,goo.ObjectUtils),goo.StateMachineHandlers=function(){}(goo.StateMachineComponentHandler,goo.MachineHandler),goo.FSMUtil=function(t){return t}(goo.FsmUtils),goo.StateMachineSystem=function(t,e){"use strict";function n(e){t.call(this,"StateMachineSystem",["StateMachineComponent"]),this.engine=e,this.resetRequest=!1,this.passive=!1,this.paused=!1,this.time=0,this.evalProxy={test:function(){console.log("test")}},this.priority=1e3}return n.prototype=Object.create(t.prototype),n.prototype.process=function(t,n){var o;if(this.resetRequest){this.resetRequest=!1;for(var i=0;i<t.length;i++)o=t[i].stateMachineComponent,o.kill(),o.cleanup();return this.time=0,e.removeAll(),void(this.passive=!0)}this.time+=n;for(var i=0;i<t.length;i++)o=t[i].stateMachineComponent,o.entered||(o.init(),o.doEnter(),o.entered=!0);e.update(1e3*this.engine.world.time);for(var i=0;i<t.length;i++)o=t[i].stateMachineComponent,o.update(n)},n.prototype.inserted=function(t){var e=t.stateMachineComponent;e.entity=t,e.system=this,e.init()},n.prototype.play=function(){if(this.passive=!1,!this.paused)for(var t=this._activeEntities,e=0;e<t.length;e++){var n=t[e].stateMachineComponent;n.entered=!1}this.paused=!1},n.prototype.pause=function(){this.passive=!0,this.paused=!0},n.prototype.resume=n.prototype.play,n.prototype.stop=function(){this.passive=!1,this.resetRequest=!0,this.paused=!1},n}(goo.System,goo.TWEEN,goo.Actions),goo.AddPositionAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.configure=function(t){this.everyFrame=t.everyFrame!==!1,this.entity=t.entity||null,this.amountX=t.amountX||0,this.amountY=t.amountY||0,this.amountZ=t.amountZ||0,this.speed=t.speed||1},n.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Amount to move on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Amount to move on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Amount to move on the Z axis","default":0},{name:"Speed",key:"speed",type:"float",description:"Speed to multiply","default":1},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._run=function(t){if(null!==this.entity){var n=t.getTpf(),o=e.getValue(this.amountX,t),i=e.getValue(this.amountY,t),r=e.getValue(this.amountZ,t);this.entity.transformComponent.transform.translation.addDirect(o*this.speed*n,i*this.speed*n,r*this.speed*n),this.entity.transformComponent.setUpdated()}},n}(goo.Action,goo.FsmUtils),goo.AddVariableAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.configure=function(t){this.everyFrame=!!t.everyFrame,this.variable=t.variable||null,this.amount=t.amount||1},n.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},n.prototype._run=function(t){t.applyOnVariable(this.variable,function(n){return n+e.getValue(this.amount,t)}.bind(this))},n}(goo.Action,goo.FsmUtils),goo.GetPositionAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.configure=function(t){this.everyFrame=t.everyFrame!==!1,this.entity=t.entity||null,this.variableX=t.variableX||null,this.variableY=t.variableY||null,this.variableZ=t.variableZ||null},e.external={parameters:[{name:"VariableX",key:"variableX",type:"identifier"},{name:"VariableY",key:"variableY",type:"identifier"},{name:"VariableZ",key:"variableZ",type:"identifier"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},e.prototype._run=function(t){var e=this.entity.transformComponent.transform.translation;null!==this.entity&&(this.variableX&&t.applyOnVariable(this.variableX,function(){return e.x}),this.variableY&&t.applyOnVariable(this.variableY,function(){return e.y}),this.variableZ&&t.applyOnVariable(this.variableZ,function(){return e.z}))},e}(goo.Action),goo.MultiplyVariableAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.configure=function(t){this.everyFrame=!!t.everyFrame,this.variable=t.variable||null,this.amount=t.amount||1},n.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},n.prototype._run=function(t){t.applyOnVariable(this.variable,function(n){return n*e.getValue(this.amount,t)}.bind(this))},n}(goo.Action,goo.FsmUtils),goo.NumberCompareAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.configure=function(t){this.everyFrame=t.everyFrame!==!1,this.leftHand=t.leftHand||0,this.rightHand=t.rightHand||0,this.tolerance=t.tolerance||1e-4,this.lessThanEvent={channel:t.transitions.less},this.equalEvent={channel:t.transitions.equal},this.greaterThanEvent={channel:t.transitions.greater}},n.external={parameters:[{name:"Left hand value",key:"leftHand",type:"float"},{name:"Right hand value",key:"rightHand",type:"float"},{name:"Tolerance",key:"tolerance",type:"float","default":.001},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{name:"less",description:"Event fired if left hand argument is smaller than right hand argument"},{name:"equal",description:"Event fired if both sides are approximately equal"},{name:"greater",description:"Event fired if left hand argument is greater than right hand argument"}]},n.prototype._run=function(t){var n=e.getValue(this.leftHand,t),o=e.getValue(this.rightHand,t),i=o-n;
Math.abs(i)<=this.tolerance?this.equalEvent.channel&&t.send(this.equalEvent.channel):i>0?this.lessThanEvent.channel&&t.send(this.lessThanEvent.channel):this.greaterThanEvent.channel&&t.send(this.greaterThanEvent.channel)},n}(goo.Action,goo.FsmUtils),goo.SetLightRangeAction=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.configure=function(t){this.everyFrame=!!t.everyFrame,this.entity=t.entity||null,this.range=t.range||100},e.external={name:"Set Light Range",description:"Sets the range of a light",parameters:[{name:"Entity",key:"entity",type:"entity",description:"Light entity"},{name:"Range",key:"range",type:"real",description:"Light range","default":100,min:0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},e.prototype._run=function(){this.entity&&this.entity.lightComponent&&this.entity.lightComponent.light&&(this.entity.lightComponent.light.range=this.range)},e}(goo.Action),goo.SetPositionAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.configure=function(t){this.everyFrame=!!t.everyFrame,this.entity=t.entity||null,this.amountX=t.amountX||0,this.amountY=t.amountY||0,this.amountZ=t.amountZ||0},n.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Position on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Position on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Position on the Z axis","default":0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._run=function(t){null!==this.entity&&(this.entity.transformComponent.transform.translation.setDirect(e.getValue(this.amountX,t),e.getValue(this.amountY,t),e.getValue(this.amountZ,t)),this.entity.transformComponent.setUpdated())},n}(goo.Action,goo.FsmUtils),goo.SetRotationAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.configure=function(t){this.everyFrame=!!t.everyFrame,this.entity=t.entity||null,this.amountX=t.amountX||0,this.amountY=t.amountY||0,this.amountZ=t.amountZ||0},n.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Amount to rotate on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Amount to rotate on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Amount to rotate on the Z axis","default":0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._run=function(t){null!==this.entity&&(this.entity.transformComponent.transform.setRotationXYZ(e.getValue(this.amountX,t),e.getValue(this.amountY,t),e.getValue(this.amountZ,t)),this.entity.transformComponent.setUpdated())},n}(goo.Action,goo.FsmUtils),goo.SetVariableAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.configure=function(t){this.everyFrame=t.everyFrame!==!1,this.variable=t.variable||null,this.amount=t.amount||0},n.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},n.prototype._run=function(t){this.variable&&t.applyOnVariable(this.variable,function(){return e.getValue(this.amount,t)}.bind(this))},n}(goo.Action,goo.FsmUtils),goo.ToggleFullscreenAction=function(t,e){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.external={name:"Toggle Fullscreen",type:"display",description:"Toggles fullscreen on/off",parameters:[],transitions:[]},n.prototype._run=function(){e.toggleFullScreen()},n}(goo.Action,goo.GameUtils),"function"==typeof require&&(define("goo/fsmpack/statemachine/State",[],function(){return goo.State}),define("goo/fsmpack/statemachine/Machine",[],function(){return goo.Machine}),define("goo/fsmpack/statemachine/FsmUtils",[],function(){return goo.FsmUtils}),define("goo/fsmpack/statemachine/actions/Action",[],function(){return goo.Action}),define("goo/fsmpack/statemachine/actions/ArrowsAction",[],function(){return goo.ArrowsAction}),define("goo/fsmpack/statemachine/actions/MouseUpAction",[],function(){return goo.MouseUpAction}),define("goo/fsmpack/statemachine/actions/MouseDownAction",[],function(){return goo.MouseDownAction}),define("goo/fsmpack/statemachine/actions/MouseMoveAction",[],function(){return goo.MouseMoveAction}),define("goo/fsmpack/statemachine/actions/KeyUpAction",[],function(){return goo.KeyUpAction}),define("goo/fsmpack/statemachine/actions/KeyDownAction",[],function(){return goo.KeyDownAction}),define("goo/fsmpack/statemachine/actions/KeyPressedAction",[],function(){return goo.KeyPressedAction}),define("goo/fsmpack/statemachine/actions/PickAction",[],function(){return goo.PickAction}),define("goo/fsmpack/statemachine/actions/PickAndExitAction",[],function(){return goo.PickAndExitAction}),define("goo/fsmpack/statemachine/actions/WasdAction",[],function(){return goo.WasdAction}),define("goo/fsmpack/statemachine/actions/MoveAction",[],function(){return goo.MoveAction}),define("goo/fsmpack/statemachine/actions/RotateAction",[],function(){return goo.RotateAction}),define("goo/fsmpack/statemachine/actions/ScaleAction",[],function(){return goo.ScaleAction}),define("goo/fsmpack/statemachine/actions/LookAtAction",[],function(){return goo.LookAtAction}),define("goo/fsmpack/statemachine/actions/TweenMoveAction",[],function(){return goo.TweenMoveAction}),define("goo/fsmpack/statemachine/actions/TweenRotationAction",[],function(){return goo.TweenRotationAction}),define("goo/fsmpack/statemachine/actions/TweenScaleAction",[],function(){return goo.TweenScaleAction}),define("goo/fsmpack/statemachine/actions/TweenLookAtAction",[],function(){return goo.TweenLookAtAction}),define("goo/fsmpack/statemachine/actions/ShakeAction",[],function(){return goo.ShakeAction}),define("goo/fsmpack/statemachine/actions/PauseAnimationAction",[],function(){return goo.PauseAnimationAction}),define("goo/fsmpack/statemachine/actions/ResumeAnimationAction",[],function(){return goo.ResumeAnimationAction}),define("goo/fsmpack/statemachine/actions/SetAnimationAction",[],function(){return goo.SetAnimationAction}),define("goo/fsmpack/statemachine/actions/SetTimeScale",[],function(){return goo.SetTimeScale}),define("goo/fsmpack/statemachine/actions/WaitAction",[],function(){return goo.WaitAction}),define("goo/fsmpack/statemachine/actions/TransitionAction",[],function(){return goo.TransitionAction}),define("goo/fsmpack/statemachine/actions/RandomTransitionAction",[],function(){return goo.RandomTransitionAction}),define("goo/fsmpack/statemachine/actions/EmitAction",[],function(){return goo.EmitAction}),define("goo/fsmpack/statemachine/actions/TransitionOnMessageAction",[],function(){return goo.TransitionOnMessageAction}),define("goo/fsmpack/statemachine/actions/EvalAction",[],function(){return goo.EvalAction}),define("goo/fsmpack/statemachine/actions/HideAction",[],function(){return goo.HideAction}),define("goo/fsmpack/statemachine/actions/ShowAction",[],function(){return goo.ShowAction}),define("goo/fsmpack/statemachine/actions/RemoveAction",[],function(){return goo.RemoveAction}),define("goo/fsmpack/statemachine/actions/AddLightAction",[],function(){return goo.AddLightAction}),define("goo/fsmpack/statemachine/actions/RemoveLightAction",[],function(){return goo.RemoveLightAction}),define("goo/fsmpack/statemachine/actions/TweenLightColorAction",[],function(){return goo.TweenLightColorAction}),define("goo/fsmpack/statemachine/actions/SetClearColorAction",[],function(){return goo.SetClearColorAction}),define("goo/fsmpack/statemachine/actions/SwitchCameraAction",[],function(){return goo.SwitchCameraAction}),define("goo/fsmpack/statemachine/actions/InFrustumAction",[],function(){return goo.InFrustumAction}),define("goo/fsmpack/statemachine/actions/DollyZoomAction",[],function(){return goo.DollyZoomAction}),define("goo/fsmpack/statemachine/actions/InBoxAction",[],function(){return goo.InBoxAction}),define("goo/fsmpack/statemachine/actions/CompareDistanceAction",[],function(){return goo.CompareDistanceAction}),define("goo/fsmpack/proximity/ProximitySystem",[],function(){return goo.ProximitySystem}),define("goo/fsmpack/statemachine/actions/CollidesAction",[],function(){return goo.CollidesAction}),define("goo/fsmpack/proximity/ProximityComponent",[],function(){return goo.ProximityComponent}),define("goo/fsmpack/statemachine/actions/TagAction",[],function(){return goo.TagAction}),define("goo/fsmpack/statemachine/actions/SmokeAction",[],function(){return goo.SmokeAction}),define("goo/fsmpack/statemachine/actions/FireAction",[],function(){return goo.FireAction}),define("goo/fsmpack/statemachine/actions/RemoveParticlesAction",[],function(){return goo.RemoveParticlesAction}),define("goo/fsmpack/statemachine/actions/TogglePostFxAction",[],function(){return goo.TogglePostFxAction}),define("goo/fsmpack/statemachine/actions/SoundFadeInAction",[],function(){return goo.SoundFadeInAction}),define("goo/fsmpack/statemachine/actions/SoundFadeOutAction",[],function(){return goo.SoundFadeOutAction}),define("goo/fsmpack/statemachine/actions/SetRenderTargetAction",[],function(){return goo.SetRenderTargetAction}),define("goo/fsmpack/statemachine/actions/TweenTextureOffsetAction",[],function(){return goo.TweenTextureOffsetAction}),define("goo/fsmpack/statemachine/actions/SetMaterialColorAction",[],function(){return goo.SetMaterialColorAction}),define("goo/fsmpack/statemachine/actions/LogMessageAction",[],function(){return goo.LogMessageAction}),define("goo/fsmpack/statemachine/actions/TweenOpacityAction",[],function(){return goo.TweenOpacityAction}),define("goo/fsmpack/statemachine/actions/HtmlAction",[],function(){return goo.HtmlAction}),define("goo/fsmpack/statemachine/actions/CopyJointTransformAction",[],function(){return goo.CopyJointTransformAction}),define("goo/fsmpack/statemachine/actions/TriggerEnterAction",[],function(){return goo.TriggerEnterAction}),define("goo/fsmpack/statemachine/actions/TriggerLeaveAction",[],function(){return goo.TriggerLeaveAction}),define("goo/fsmpack/statemachine/actions/ApplyImpulseAction",[],function(){return goo.ApplyImpulseAction}),define("goo/fsmpack/statemachine/actions/CompareCounterAction",[],function(){return goo.CompareCounterAction}),define("goo/fsmpack/statemachine/actions/CompareCountersAction",[],function(){return goo.CompareCountersAction}),define("goo/fsmpack/statemachine/actions/SetCounterAction",[],function(){return goo.SetCounterAction}),define("goo/fsmpack/statemachine/actions/IncrementCounterAction",[],function(){return goo.IncrementCounterAction}),define("goo/fsmpack/statemachine/actions/Actions",[],function(){return goo.Actions}),define("goo/fsmpack/MachineHandler",[],function(){return goo.MachineHandler}),define("goo/fsmpack/statemachine/StateMachineComponent",[],function(){return goo.StateMachineComponent}),define("goo/fsmpack/StateMachineComponentHandler",[],function(){return goo.StateMachineComponentHandler}),define("goo/fsmpack/StateMachineHandlers",[],function(){return goo.StateMachineHandlers}),define("goo/fsmpack/statemachine/FSMUtil",[],function(){return goo.FSMUtil}),define("goo/fsmpack/statemachine/StateMachineSystem",[],function(){return goo.StateMachineSystem}),define("goo/fsmpack/statemachine/actions/AddPositionAction",[],function(){return goo.AddPositionAction}),define("goo/fsmpack/statemachine/actions/AddVariableAction",[],function(){return goo.AddVariableAction}),define("goo/fsmpack/statemachine/actions/GetPositionAction",[],function(){return goo.GetPositionAction}),define("goo/fsmpack/statemachine/actions/MultiplyVariableAction",[],function(){return goo.MultiplyVariableAction}),define("goo/fsmpack/statemachine/actions/NumberCompareAction",[],function(){return goo.NumberCompareAction}),define("goo/fsmpack/statemachine/actions/SetLightRangeAction",[],function(){return goo.SetLightRangeAction}),define("goo/fsmpack/statemachine/actions/SetPositionAction",[],function(){return goo.SetPositionAction}),define("goo/fsmpack/statemachine/actions/SetRotationAction",[],function(){return goo.SetRotationAction}),define("goo/fsmpack/statemachine/actions/SetVariableAction",[],function(){return goo.SetVariableAction}),define("goo/fsmpack/statemachine/actions/ToggleFullscreenAction",[],function(){return goo.ToggleFullscreenAction}));