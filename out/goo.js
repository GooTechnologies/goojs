/* Goo Engine UNOFFICIAL
 * Copyright 2015 Goo Technologies AB
 */
!function(){"use strict";function t(t,r){function i(t){return this&&this.constructor===i?(this._keys=[],this._values=[],this.objectOnly=r,void(t&&e.call(this,t))):new i(t)}return r||g(t,"size",{get:d}),t.constructor=i,i.prototype=t,i}function e(t){this.add?t.forEach(this.add,this):t.forEach(function(t){this.set(t[0],t[1])},this)}function r(t){return this.has(t)&&(this._keys.splice(m,1),this._values.splice(m,1)),m>-1}function i(t){return this.has(t)?this._values[m]:void 0}function o(t,e){if(this.objectOnly&&e!==Object(e))throw new TypeError("Invalid value used as weak collection key");if(e!=e||0===e)for(m=t.length;m--&&!y(t[m],e););else m=t.indexOf(e);return m>-1}function n(t){return o.call(this,this._values,t)}function a(t){return o.call(this,this._keys,t)}function s(t,e){return this.has(t)?this._values[m]=e:this._values[this._keys.push(t)-1]=e,this}function h(t){return this.has(t)||this._values.push(t),this}function u(){this._values.length=0}function c(){return this._values.slice()}function l(){return this._keys.slice()}function d(){return this._values.length}function p(t,e){var r=this,i=r._values.slice();r._keys.slice().forEach(function(o,n){t.call(e,i[n],o,r)})}function f(t,e){var r=this;r._values.slice().forEach(function(i){t.call(e,i,i,r)})}Object.is||(Object.is=function(t,e){return 0===t&&0===e?1/t===1/e:t!==t?e!==e:t===e});var m,g=Object.defineProperty,y=Object.is;window.Set||(window.Map=t({"delete":r,has:a,get:i,set:s,keys:l,values:c,forEach:p,clear:u}),window.Set=t({has:n,add:h,"delete":r,clear:u,values:c,forEach:f}))}();
window.goo={},goo.Bus=function(){"use strict";function t(){this.trie={name:"",listeners:[],children:new Map}}function e(t,e,r,i){for(var o=0;o<t.listeners.length;o++){var n=t.listeners[o];n?n(e,r,i):(t.listeners.splice(o,1),o--)}}function r(t,r,i,o){function n(t){e(t,r,i,o),t.children.forEach(n)}n(t)}function i(t,e){var r=t.indexOf(e);-1!==r&&(t[r]=null)}return t.prototype.emit=function(t,e,r){if(r=!!r,"string"==typeof t)this._emitToSingle(t,e,r);else for(var i=0;i<t.length;i++)this._emitToSingle(t[i],e,r);return this},t.prototype.getLastMessageOn=function(t){var e=this._getNode(t);return e?e.latestData:void 0},t.prototype._getNode=function(t,e){for(var r=this.trie,i=t.split("."),o=0;o<i.length;o++){var n=i[o];if(r.children.has(n))r=r.children.get(n);else{if(!e)return;var a={listeners:[],children:new Map};r.children.set(n,a),r=a}}return r},t.prototype._emitToSingle=function(t,e,i){var o=this._getNode(t,i);o&&(r(o,e,t,this),i&&(o.latestData=e,o.latestChannel=t))},t.prototype.addListener=function(t,e,r){r=!!r;for(var i=this.trie,o=t.split("."),n=0;n<o.length;n++){var a=o[n];if(i.children.has(a))i=i.children.get(a);else{var s={listeners:[],children:new Map};i.children.set(a,s),i=s}}return-1===i.listeners.indexOf(e)&&(i.listeners.push(e),r&&i.latestData&&e(i.latestData,i.latestChannel,this)),this},t.prototype.removeListener=function(t,e){var r=this._getNode(t);return r&&i(r.listeners,e),this},t.prototype.removeAllOnChannel=function(t){var e=this._getNode(t);return e&&(e.listeners=[]),this},t.prototype.removeChannelAndChildren=function(t){var e=t.split(".");if(e.length>1){var r=e.pop(),i=e.join("."),o=this._getNode(i);o.children["delete"](r)}else this.trie.children["delete"](t);return this},t.prototype._removeListener=function(t,e){i(t.listeners,e),t.children.forEach(function(t){this._removeListener(t,e)},this)},t.prototype.removeListenerFromAllChannels=function(t){return this._removeListener(this.trie,t),this},t.prototype.clear=function(){this.trie={name:"",listeners:[],children:new Map}},t}(),goo.Selection=function(){"use strict";function t(){if(this.stack=[],1===arguments.length){var r=arguments[0];r instanceof t?r.top&&this.stack.push(r.top):Array.isArray(r)?this.stack.push(r):this.stack.push([r])}else arguments.length>1&&this.stack.push(Array.prototype.slice.call(arguments,0));this.stack.length>0&&(this.stack[0]=e(this.stack[0])),this.top=0===this.stack.length?null:this.stack[0]}function e(t){for(var e=[],r=0;r<t.length;r++){var i=t[r];t.lastIndexOf(i)===r&&e.push(i)}return e}function r(){if(1===arguments.length){var e=arguments[0];return e instanceof t?e.top?e.top:[]:Array.isArray(e)?e:[e]}return arguments.length>1?Array.prototype.slice.call(arguments,0):[]}return t.EMPTY=new t,t.prototype.contains=function(t){return null===this.top?!1:-1!==this.top.indexOf(t)},t.prototype.size=function(){return null===this.top?0:this.top.length},t.prototype.each=function(t){if(null===this.top)return this;for(var e=0;e<this.top.length&&t(this.top[e],e)!==!1;e++);return this},t.prototype.forEach=t.prototype.each,t.prototype.filter=function(t){if(null===this.top)return this;var e=this.top.filter(t);return this.stack.push(e),this.top=e,this},t.prototype.map=function(t){if(null===this.top)return this;var e=this.top.map(t);return this.stack.push(e),this.top=e,this},t.prototype.flatMap=function(t){if(null===this.top)return this;var e=this.top.map(t),r=e.reduce(function(t,e){return t.concat(e)},[]);return this.stack.push(r),this.top=r,this},t.prototype.reduce=function(t,e){if(null===this.top)return this;var r=[this.top.reduce(t,e)];return this.stack.push(r),this.top=r,this},t.prototype.and=function(){if(null===this.top)return this;var t=r.apply(null,arguments),i=this.top.concat(t);return i=e(i),this.stack.push(i),this.top=i,this},t.prototype.intersects=function(){if(null===this.top)return this;var t,e,i=r.apply(null,arguments),o=[];i.length>this.top.length?(t=this.top,e=i):(t=i,e=this.top);for(var n=0;n<t.length;n++){var a=t[n];-1!==e.indexOf(a)&&o.push(a)}return this.stack.push(o),this.top=o,this},t.prototype.without=function(){if(null===this.top)return this;for(var t=r.apply(null,arguments),e=[],i=0;i<this.top.length;i++){var o=this.top[i];-1===t.indexOf(o)&&e.push(o)}return this.stack.push(e),this.top=e,this},t.prototype.andSelf=function(){if(null===this.top)return this;if(this.stack.length<=1)return this;var t=this.stack[this.stack.length-2],r=t.concat(this.top);return r=e(r),this.stack.push(r),this.top=r,this},t.prototype.end=function(){return null===this.top?this:(this.stack.pop(),0===this.stack.length?this.top=null:this.top=this.stack[this.stack.length-1],this)},t.prototype.first=function(){return null===this.top?null:this.top[0]},t.prototype.clone=function(){var e=new t;return e.top=this.top,e.stack=this.stack.concat([]),e},t.prototype.get=function(t){return"number"!=typeof t?null===this.top?[]:this.top.concat([]):0>t?null===this.top?void 0:this.top[this.top.length+t]:null===this.top?void 0:this.top[t]},t.prototype.toArray=function(){return null===this.top?[]:this.top.concat([])},t}(),goo.EntitySelection=function(t){"use strict";function e(){t.apply(this,arguments)}function r(){if(1===arguments.length){var t=arguments[0];return t instanceof e?t.top?t.top:[]:Array.isArray(t)?t:[t]}return arguments.length>1?Array.prototype.slice.call(arguments,0):[]}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.and=function(){if(null===this.top)return this;var t,e,i,o=r.apply(null,arguments);o.length>this.top.length?(e=this.top,i=o):(e=o,i=this.top);for(var n=[],a=0;a<i.length;a++){var s=i[a].id;n[s]=!0}t=i.concat([]);for(var a=0;a<e.length;a++)n[e[a].id]||t.push(e[a]);return this.stack.push(t),this.top=t,this},e.prototype.intersects=function(){if(null===this.top)return this;var t,e,i,o=r.apply(null,arguments);o.length>this.top.length?(e=this.top,i=o):(e=o,i=this.top);for(var n=[],a=0;a<i.length;a++){var s=i[a].id;n[s]=!0}t=[];for(var a=0;a<e.length;a++)n[e[a].id]&&t.push(e[a]);return this.stack.push(t),this.top=t,this},e.prototype.without=function(){if(null===this.top)return this;for(var t,e=r.apply(null,arguments),i=[],o=0;o<e.length;o++){var n=e[o].id;i[n]=!0}t=[];for(var o=0;o<this.top.length;o++)i[this.top[o].id]||t.push(this.top[o]);return this.stack.push(t),this.top=t,this},e.prototype.andSelf=function(){if(null===this.top)return this;if(this.stack.length<=1)return this;var t=this.stack[this.stack.length-2];return this.and.apply(this,t)},e.prototype.parent=function(){if(null===this.top)return this;var t=[],e=this.top.filter(function(e){return e.transformComponent.parent?t[e.transformComponent.parent.entity.id]?!1:(t[e.transformComponent.parent.entity.id]=!0,!0):!1}).map(function(t){return t.transformComponent.parent.entity});return this.stack.push(e),this.top=e,this},e.prototype.children=function(){if(null===this.top)return this;var t=this.top.map(function(t){return t.transformComponent.children.map(function(t){return t.entity})}),e=t.reduce(function(t,e){return t.concat(e)},[]);return this.stack.push(e),this.top=e,this},e.installMethod=function(t,r,i){e.prototype[r]=function(){if(null===this.top)return this;for(var e=0;e<this.top.length;e++){var r=this.top[e];r.hasComponent(i)&&t.apply(r,arguments)}return this}},e}(goo.Selection),goo.Component=function(t){"use strict";function e(){this.enabled=!0,this.installedAPI=new Set,this.forceDebug=!1}return e.prototype.applyAPI=function(t){var e=this.api;if(e)for(var r=Object.keys(e),i=0;i<r.length;i++){var o=r[i];"undefined"==typeof t[o]?(t[o]=e[o],this.installedAPI.add(o)):console.warn("Could not install method "+o+" of "+this.type+" as it is already taken")}},e.prototype.removeAPI=function(t){this.installedAPI.forEach(function(e){delete t[e]})},e.applyEntitySelectionAPI=function(e,r){if(e)for(var i=Object.keys(e),o=0;o<i.length;o++){var n=i[o];"undefined"==typeof t[n]?t.installMethod(e[n],n,r):console.warn("Could not install method "+n+" on EntitySelection as it is already taken")}},e}(goo.EntitySelection),goo.StringUtils=function(){"use strict";function t(){}t.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},t.startsWith=function(t,e){return 0===t.indexOf(e)},t.capitalize=function(t){return t.charAt(0).toUpperCase()+t.substring(1)},t.uncapitalize=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},t.createUniqueId=function(t){var e=Date.now(),r="xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return"x"===t?r.toString(16):(3&r|8).toString(16)});return void 0===t?r:r+"."+t},t.getUntil=function(t,e){var r=t.indexOf(e);return-1===r?t:t.slice(0,r)},t.getAfterLast=function(t,e){var r=t.lastIndexOf(e);return-1===r?t:t.slice(r+e.length,t.length)},t.getFrom=function(t,e){var r=t.indexOf(e);return-1===r?"":t.slice(r+e.length,t.length)},t.getIndexedName=function(t,e,r){r||(r="_");var i,o=new RegExp(t+"("+r+"\\d+)?"),n=0;for(i in e){var a=e[i],s=o.exec(a);if(s)if(s.length>1&&s[1]){var h=parseInt(s[1].substring(r.length),10);h>=n&&(n=h+1)}else n=1}return t+r+n},t.getUniqueName=function(e,r,i){return-1===r.indexOf(e)?e:t.getIndexedName(e,r,i)},t.toAscii=function(t){return t.replace(/([^\x00-\x7F])/g,"x")},t.hashCode=function(t){var e=0;if(0===t.length)return e;for(var r=0;r<t.length;r++){var i=t.charCodeAt(r);e=(e<<5)-e+i,e&=e}return btoa(e).replace("/","_").replace("+","-")};var e=Date.now();t.getUniqueId=function(){e++;var r=Array.prototype.slice.call(arguments,0).join("");return t.hashCode(e+""+r)},t.escapeHtmlEntities=function(t){var e=document.createElement("div");e.appendChild(document.createTextNode(t));var r={34:"quot"};return e.innerHTML.replace(/[\u00A0-\u2666\"\']/g,function(t){var e=r[t.charCodeAt(0)];return"&"+(e||"#"+t.charCodeAt(0))+";"})};var r=new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");return t.parseURL=function(t){var e=t.match(r);return{scheme:e[1],user_info:e[2],domain:e[3],port:e[4],path:e[5],query_data:e[6],fragment:e[7]}},t}(),goo.Entity=function(t,e){"use strict";function r(t,i,o){this._world=t,this._components=[],this.id=void 0!==o?o:e.createUniqueId("entity"),this._index=r.entityCount,this._tags=new Set,this._attributes=new Map,this.name=void 0!==i?i:"Entity_"+this._index,this.skip=!1,this.hidden=!1,this._hidden=!1,this.isVisible=!1,this["static"]=!1,r.entityCount++}function i(t){return t.charAt(0).toLowerCase()+t.substr(1)}return r.prototype.set=function(){for(var e=0;e<arguments.length;e++){var r=arguments[e];if(r instanceof t)this.setComponent(r);else{if(!this._world)return this;for(var i=this._world._components,o=0;o<i.length;o++){var n=i[o],a=n.applyOnEntity(r,this);if(a)break}}}return this},r.prototype.addToWorld=function(t){return this._world.addEntity(this,t),this},r.prototype.removeFromWorld=function(t){return this._world.removeEntity(this,t),this},r.prototype.setComponent=function(t){return this.hasComponent(t.type)?this:(this._components.push(t),this[i(t.type)]=t,t.attached&&t.attached(this),t.applyAPI(this),this._world&&this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,t,"addedComponent"),this)},r.prototype.hasComponent=function(t){var e=i(t);return!!this[e]},r.prototype.getComponent=function(t){var e=i(t);return this[e]},r.prototype.clearComponent=function(t){var e=i(t),r=this[e];if(r&&this._components.indexOf(r)>-1){r.detached&&r.detached(this),r.removeAPI(this);var o=this._components.indexOf(r);this._components.splice(o,1),delete this[e],this._world&&this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,r,"removedComponent")}return this},r.prototype.setTag=function(t){return this._tags.add(t),this},r.prototype.hasTag=function(t){return this._tags.has(t)},r.prototype.clearTag=function(t){return this._tags["delete"](t),this},r.prototype.setAttribute=function(t,e){return this._attributes.set(t,e),this},r.prototype.hasAttribute=function(t){return this._attributes.has(t)},r.prototype.getAttribute=function(t){return this._attributes.get(t)},r.prototype.clearAttribute=function(t){return this._attributes["delete"](t),this},r.prototype.toString=function(){return this.name},r.entityCount=0,r}(goo.Component,goo.StringUtils),goo.ObjectUtils=function(){"use strict";function t(){}t.contains=function(t,e){return-1!==t.indexOf(e)},t.defaults=function(t,e){for(var r=Object.keys(e),i=0;i<r.length;i++){var o=r[i];("undefined"==typeof t[o]||null===t[o])&&(t[o]=e[o])}return t},t.copyOptions=function(e,r,i){var o=Object.keys(i);if(r)for(var n=0;n<o.length;n++){var a=o[n],s=r[a];e[a]="undefined"==typeof s||null===s?i[a]:s}else t.extend(e,i);return e},t.extend=function(t,e){if(e){for(var r=Object.keys(e),i=0;i<r.length;i++){var o=r[i];t[o]=e[o]}return t}},t.clone=function(e){return t.isObject(e)?Array.isArray(e)?e.slice():t.extend({},e):e};var e=Array.prototype.forEach;return t.each=t.forEach=function(t,r,i,o){if("undefined"!=typeof t&&null!==t)if(e&&t.forEach===e)t.forEach(r,i);else if(t.length===+t.length)for(var n=0,a=t.length;a>n;n++)r.call(i,t[n],n,t);else{var s=Object.keys(t);void 0!==o&&s.sort(function(e,r){return t[e][o]-t[r][o]});for(var n=0,h=s.length;h>n;n++)r.call(i,t[s[n]],s[n],t)}},t.map=function(e,r,i,o){var n=[];return t.forEach(e,function(t,o){n.push(r.call(i,t,o,e))},i,o),n},t.deepClone=function(e){if(null===e||"object"!=typeof e)return e;if("[object ArrayBuffer]"===Object.prototype.toString.call(e.buffer))return new e.constructor(e);if(e instanceof Array)return e.map(t.deepClone);if(e.nodeType&&"function"==typeof e.cloneNode)return e.cloneNode(!0);for(var r={},i=Object.keys(e),o=0;o<i.length;o++){var n=i[o];r[n]=t.deepClone(e[n])}return r},t.shallowSelectiveClone=function(t,e){var r={};return e.forEach(function(e){r[e]=t[e]}),r},t.cloneMap=function(t){var e=new Map;return t.forEach(function(t,r){e.set(r,t)}),e},t.cloneSet=function(t){var e=new Set;return t.forEach(function(t){e.add(t)}),e},t.warnOnce=function(t,e){var r=!1;return function(){return r||(console.warn(t),r=!0),e.apply(this,arguments)}},t.constant=function(t){return function(){return t}},t.property=function(t){return function(e){return e[t]}},t.isObject=function(t){return t===Object(t)},t.isString=function(t){return"string"==typeof t},t.isBoolean=function(t){return t===!0||t===!1},t.isNumber=function(t){return"number"==typeof t},t.isInteger=function(e){return t.isNumber(e)&&e%1===0},t.getExtension=function(e){if(t.isString(e)){var r=e.lastIndexOf(".");if(r>=-1)return e.substr(r+1).toLowerCase()}return""},t}(),goo.ScriptUtils=function(t){"use strict";function e(){}return e.DEFAULTS_BY_TYPE={"float":0,"int":0,string:"",vec2:[0,0],vec3:[0,0,0],vec4:[0,0,0,0],"boolean":!1,animation:null,camera:null,entity:null,image:null,sound:null,texture:null},e.REF_TYPES=["animation","camera","entity","image","sound","texture"],e.isRefType=function(r){return t.contains(e.REF_TYPES,r)},e.TYPE_VALIDATORS=function(){var e=function(t){return function(e){return Array.isArray(e)&&e.length===t}},r=function(e){function r(r){return t.isString(r)&&t.getExtension(r)===e}function i(t){return t&&r(t[e+"Ref"])}return function(t){return r(t)||i(t)}};return{"float":t.isNumber,string:t.isString,"boolean":t.isBoolean,"int":t.isInteger,vec2:e(2),vec3:e(3),vec4:e(4),animation:r("animation"),camera:r("camera"),entity:r("entity"),image:r("image"),sound:r("sound"),texture:r("texture")}}(),e.fillDefaultValues=function(r,i){if(i instanceof Array){var o=[];i.forEach(function(i){i&&"string"==typeof i.key&&((null===i["default"]||void 0===i["default"])&&(i["default"]=t.deepClone(e.DEFAULTS_BY_TYPE[i.type])),o.push(i.key),"undefined"==typeof r[i.key]&&(r[i.key]=t.clone(i["default"])))});for(var n in r)-1===o.indexOf(n)&&"enabled"!==n&&delete r[n]}},e.fillDefaultNames=function(t){function e(t){if("string"!=typeof t||0===t.length)return"";var e=t[0].toUpperCase()+t.slice(1);return e.replace(/(.)([A-Z])/g,"$1 $2")}t instanceof Array&&t.forEach(function(t){t&&"undefined"==typeof t.name&&(t.name=e(t.key))})},e.getKey=function(t){return e._keys[t]?e._keys[t]:t.charCodeAt(0)},e._keys={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Meta:91,Pause:19,Capslock:20,Esc:27,Space:32,Pageup:33,Pagedown:34,End:35,Home:36,Leftarrow:37,Uparrow:38,Rightarrow:39,Downarrow:40,Insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0numpad":96,"1numpad":97,"2numpad":98,"3numpad":99,"4numpad":100,"5numpad":101,"6numpad":102,"7numpad":103,"8numpad":104,"9numpad":105,Multiply:106,Plus:107,Minus:109,Dot:110,Slash1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Equals:187,Comma:188,Slash:191,Backslash:220},e._keyInverse=function(t){for(var e={},r=Object.keys(t),i=0;i<r.length;i++)e[t[r[i]]]=r[i];return e}(e._keys),e.keyForCode=function(t){return e._keyInverse[t]},e}(goo.ObjectUtils),goo.Scripts=function(t,e){"use strict";var r={},i={};return i.register=function(e){var i=e.externals.key||e.externals.name;return r[i]?void console.warn("Script already registered for key "+i):(t.fillDefaultNames(e.externals.parameters),void(r[i]=e))},i.addClass=e.warnOnce("Scripts.addClass is deprecated; please consider using the global goo object instead",function(t,e){}),i.getClasses=e.warnOnce("Scripts.getClasses is deprecated; please consider using the global goo object instead",function(){return window.goo}),i.getScript=function(t){return r[t]},i.create=function(i,o){var n;if("string"==typeof i){if(n=r[i],!n)throw new Error('Script "'+i+'" is not registered')}else"function"==typeof i&&(n=i);var a=n();return a.parameters={},a.environment=null,a.externals=n.externals,n.externals&&(t.fillDefaultNames(a.externals.parameters),t.fillDefaultValues(a.parameters,n.externals.parameters)),o&&e.extend(a.parameters,o),a},i.allScripts=function(){for(var t={},e=Object.keys(r),i=0;i<e.length;i++){var o=e[i];t[o]=r[o]}return t},i}(goo.ScriptUtils,goo.ObjectUtils),goo.MathUtils=function(){"use strict";function t(){}return t.DEG_TO_RAD=Math.PI/180,t.RAD_TO_DEG=180/Math.PI,t.HALF_PI=.5*Math.PI,t.TWO_PI=2*Math.PI,t.EPSILON=1e-5,t.radFromDeg=function(e){return e*t.DEG_TO_RAD},t.degFromRad=function(e){return e*t.RAD_TO_DEG},t.lerp=function(t,e,r){return e===r?e:e+(r-e)*t},t.clamp=function(t,e,r){return r>e?e>t?e:t>r?r:t:r>t?r:t>e?e:t},t.radialClamp=function(e,r,i){var o=(r+i)/2+(i>r?Math.PI:0),n=t.moduloPositive(e-o,t.TWO_PI),a=t.moduloPositive(r-o,t.TWO_PI),s=t.moduloPositive(i-o,t.TWO_PI);return 0>e&&r>0?r-=t.TWO_PI:e>0&&0>r&&(r+=t.TWO_PI),e>t.TWO_PI&&i<t.TWO_PI&&(i+=t.TWO_PI),a>n?r:n>s?i:e},t.moduloPositive=function(t,e){var r=t%e;return r+=0>r?e:0},t.scurve3=function(t){return(-2*t+3)*t*t},t.scurve5=function(t){return((6*t-15)*t+10)*t*t*t},t.sphericalToCartesian=function(t,e,r,i){var o=t*Math.cos(r);i.x=o*Math.cos(e),i.y=t*Math.sin(r),i.z=o*Math.sin(e)},t.cartesianToSpherical=function(t,e,r,i){var o=Math.sqrt(t*t+r*r);i.x=Math.sqrt(t*t+e*e+r*r),i.y=Math.atan2(r,t),i.z=Math.atan2(e,o)},t.getTriangleNormal=function(t,e,r,i,o,n,a,s,h){var u=i-t,c=o-e,l=n-r,d=a-t,p=s-e,f=h-r,m=c*f-l*p,g=l*d-u*f,y=u*p-c*d;return[m,g,y]},t.isPowerOfTwo=function(t){return 0===(t&t-1)},t.nearestPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t},t.nearestHigherPowerOfTwo=t.nearestPowerOfTwo,t.closeTo=function(t,e,r){return r="undefined"!=typeof r?r:.001,Math.abs(t-e)<=r},t.sign=function(t){return 0>t?-1:t>0?1:0},t.triangleArea=function(t,e,r){return Math.abs(t.x*e.y+e.x*r.y+r.x*t.y-e.y*r.x-r.y*t.x-t.y*e.x)/2},t.barycentricInterpolation=function(e,r,i,o){var n=t.triangleArea(r,i,o),a=t.triangleArea(e,i,o),s=t.triangleArea(e,r,o),h=n+a+s;if(!h){if(o[0]===e[0]&&o[2]===e[2])return e;if(o[0]===r[0]&&o[2]===r[2])return r;if(o[0]===i[0]&&o[2]===i[2])return i}return o.z=(n*e.z+a*r.z+s*i.z)/h,o},t.smoothstep=function(e,r,i){return i=t.clamp((i-e)/(r-e),0,1),i*i*(3-2*i)},t.randomSeed=1337,t.fastRandom=function(){return t.randomSeed=(9301*t.randomSeed+49297)%233280,t.randomSeed/233280},t.warnNaN=function(t,e){var r=t[e];Object.defineProperty(t,e,{get:function(){return r},set:function(t){if(isNaN(t))throw new Error("Tried to assign NaN to "+e);r=t}})},t}(),goo.Vector=function(t,e){"use strict";function r(t){this._size=t}var i=["x","y","z","w"];return r.setupAliases=function(t,e){e.forEach(function(e,r){var o=i[r];e.forEach(function(e){Object.defineProperty(t,e,{get:function(){return this[o]},set:function(t){this[o]=t}})})})},Object.defineProperty(r.prototype,"data",{get:t.warnOnce("The .data property of Vector was removed, please use the .x, .y, .z, .w properties instead.",function(){var t=[],e=this;return Object.defineProperties(t,{0:{get:function(){return e.x},set:function(t){e.x=t}},1:{get:function(){return e.y},set:function(t){e.y=t}},2:{get:function(){return e.z},set:function(t){e.z=t}},3:{get:function(){return e.w},set:function(t){e.w=t}}}),t})}),r.add=t.warnOnce("Vector.add is deprecated.",function(t,e,i){var o=t.data||t,n=e.data||e,a=t._size;i||(i=new r(a));for(var s=0;a>s;s++)i.data[s]=o[s]+n[s];return i}),r.prototype.add=t.warnOnce("Vector.prototype.add is deprecated.",function(t){return r.add(this,t,this)}),r.sub=t.warnOnce("Vector.sub is deprecated.",function(t,e,i){var o=t.data||t,n=e.data||e,a=t._size;i||(i=new r(a));for(var s=0;a>s;s++)i.data[s]=o[s]-n[s];return i}),r.prototype.sub=t.warnOnce("Vector.prototype.sub is deprecated.",function(t){return r.sub(this,t,this)}),r.mul=t.warnOnce("Vector.mul is deprecated.",function(t,e,i){var o=t.data||t,n=e.data||e,a=t._size;i||(i=new r(a));for(var s=0;a>s;s++)i.data[s]=o[s]*n[s];return i}),r.prototype.mul=t.warnOnce("Vector.prototype.mul is deprecated.",function(t){return r.mul(this,t,this)}),r.div=t.warnOnce("Vector.div is deprecated.",function(t,e,i){var o=t.data||t,n=e.data||e,a=t._size;i||(i=new r(a));for(var s=0;a>s;s++)i.data[s]=o[s]/n[s];return i}),r.prototype.div=t.warnOnce("Vector.prototype.div is deprecated.",function(t){return r.div(this,t,this)}),r.copy=t.warnOnce("Vector.copy is deprecated.",function(t,e){var i=t._size;e||(e=new r(i));for(var o=0;i>o;o++)e.data[o]=t.data[o];return e}),r.prototype.copy=t.warnOnce("Vector.prototype.copy  is deprecated.",function(t){for(var e=t._size,r=0;e>r;r++)this.data[r]=t.data[r];return this}),r.dot=t.warnOnce("Vector.dot is deprecated.",function(t,e){for(var r=t.data||t,i=e.data||e,o=t._size,n=0,a=0;o>a;a++)n+=r[a]*i[a];return n}),r.prototype.dot=t.warnOnce("Vector.prototype.dot is deprecated.",function(t){return r.dot(this,t)}),r.apply=t.warnOnce("Vector.apply is deprecated.",function(t,e,i){var o=t.rows,n=t.cols,a=e._size;if(i||(i=new r(o)),i===e)return r.copy(r.apply(t,e),i);for(var s=0;n>s;s++)for(var h=s*o,u=0;o>u;u++){for(var c=0,l=0;a>l;l++)c+=t.data[l*t.rows+u]*e.data[l];i.data[h+u]=c}return i}),r.prototype.apply=t.warnOnce("Vector.prototype.apply is deprecated.",function(t){return r.apply(t,this,this)}),r.equals=t.warnOnce("Vector.equals is deprecated.",function(t,r){var i=t._size;if(i!==r._size)return!1;for(var o=0;i>o;o++)if(!(Math.abs(t.data[o]-r.data[o])<=e.EPSILON))return!1;return!0}),r.prototype.equals=t.warnOnce("Vector.prototype.equals is deprecated.",function(t){return r.equals(this,t)}),r.distanceSquared=t.warnOnce("Vector.distanceSquared is deprecated.",function(t,e){return r.sub(t,e).lengthSquared()}),r.prototype.distanceSquared=t.warnOnce("Vector.prototype.distanceSquared is deprecated.",function(t){return r.sub(this,t).lengthSquared()}),r.distance=t.warnOnce("Vector.distance is deprecated.",function(t,e){return r.sub(t,e).length()}),r.prototype.distance=t.warnOnce("Vector.prototype.distance is deprecated.",function(t){return r.sub(this,t).length()}),r.prototype.lengthSquared=t.warnOnce("Vector.prototype.lengthSquared is deprecated.",function(){return r.dot(this,this)}),r.prototype.length=t.warnOnce("Vector.prototype.length is deprecated.",function(){return Math.sqrt(r.dot(this,this))}),r.prototype.scale=t.warnOnce("Vector.prototype.scale is deprecated.",function(t){for(var e=this._size-1;e>=0;e--)this.data[e]*=t;return this}),r.prototype.invert=t.warnOnce("Vector.prototype.invert is deprecated.",function(){for(var t=0;t<this._size;t++)this.data[t]=0-this.data[t];return this}),r.prototype.normalize=t.warnOnce("Vector.prototype.normalize is deprecated.",function(){var t=this.length(),r=this._size;if(t<e.EPSILON)for(var i=0;r>i;i++)this.data[i]=0;else{t=1/t;for(var i=0;r>i;i++)this.data[i]*=t}return this}),r.prototype.clone=t.warnOnce("Vector.prototype.clone is deprecated.",function(){return r.copy(this)}),r.prototype.set=t.warnOnce("Vector.prototype.set is deprecated.",function(){if(1===arguments.length&&"object"==typeof arguments[0])if(arguments[0]instanceof r)this.copy(arguments[0]);else for(var t=0;t<arguments[0].length;t++)this.data[t]=arguments[0][t];else for(var t=0;t<arguments.length;t++)this.data[t]=arguments[t];return this}),r.prototype.toString=t.warnOnce("Vector.prototype.toString is deprecated.",function(){var t="";t+="[";for(var e=0;e<this._size;e++)t+=this.data[e],t+=e!==this._size-1?", ":"";return t+="]"}),r}(goo.ObjectUtils,goo.MathUtils),goo.Vector4=function(t,e,r){"use strict";function i(t,e,r,o){0===arguments.length?(this.x=0,this.y=0,this.z=0,this.w=0):1===arguments.length&&"object"==typeof arguments[0]?arguments[0]instanceof i?this.copy(arguments[0]):(this.x=arguments[0][0],this.y=arguments[0][1],this.z=arguments[0][2],this.w=arguments[0][3]):(this.x=t,this.y=e,this.z=r,this.w=o)}return i.prototype=Object.create(r.prototype),i.prototype.constructor=i,r.setupAliases(i.prototype,[["r"],["g"],["b"],["a"]]),i.ZERO=new i(0,0,0,0),i.ONE=new i(1,1,1,1),i.UNIT_X=new i(1,0,0,0),i.UNIT_Y=new i(0,1,0,0),i.UNIT_Z=new i(0,0,1,0),i.UNIT_W=new i(0,0,0,1),i.prototype.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w}},i.prototype.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e}return this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.prototype.addDirect=function(t,e,r,i){return this.x+=t,this.y+=e,this.z+=r,this.w+=i,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.prototype.subDirect=function(t,e,r,i){return this.x-=t,this.y-=e,this.z-=r,this.w-=i,this},i.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},i.prototype.mul=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.prototype.mulDirect=function(t,e,r,i){return this.x*=t,this.y*=e,this.z*=r,this.w*=i,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.div=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},i.prototype.divDirect=function(t,e,r,i){return this.x/=t,this.y/=e,this.z/=r,this.w/=i,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},i.prototype.dotDirect=function(t,e,r,i){return this.x*t+this.y*e+this.z*r+this.w*i},i.prototype.equals=function(t){return Math.abs(this.x-t.x)<=e.EPSILON&&Math.abs(this.y-t.y)<=e.EPSILON&&Math.abs(this.z-t.z)<=e.EPSILON&&Math.abs(this.w-t.w)<=e.EPSILON},i.prototype.equalsDirect=function(t,r,i,o){return Math.abs(this.x-t)<=e.EPSILON&&Math.abs(this.y-r)<=e.EPSILON&&Math.abs(this.z-i)<=e.EPSILON&&Math.abs(this.w-o)<=e.EPSILON},i.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},function(){var t=new i;i.prototype.reflect=function(e){return t.copy(e),t.scale(2*this.dot(e)),this.sub(t),this}}(),i.prototype.set=function(t){return t instanceof i?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2],this.w=arguments[3]),this},i.prototype.setDirect=function(t,e,r,i){return this.x=t,this.y=e,this.z=r,this.w=i,this},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.prototype.length=function(){return Math.sqrt(this.lengthSquared())},i.prototype.normalize=function(){var t=this.length();return t<e.EPSILON?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this},i.prototype.unsafeNormalize=function(){var t=this.length();return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},i.prototype.distanceSquared=function(t){var e=this.x-t.x,r=this.y-t.y,i=this.z-t.z,o=this.w-t.w;return e*e+r*r+i*i+o*o},i.prototype.distance=function(t){return Math.sqrt(this.distanceSquared(t))},i.prototype.applyPre=function(t){var e=t.data,r=this.x,i=this.y,o=this.z,n=this.w;return this.x=e[0]*r+e[1]*i+e[2]*o+e[3]*n,this.y=e[4]*r+e[5]*i+e[6]*o+e[7]*n,this.z=e[8]*r+e[9]*i+e[10]*o+e[11]*n,this.w=e[12]*r+e[13]*i+e[14]*o+e[15]*n,this},i.prototype.applyPost=function(t){var e=t.data,r=this.x,i=this.y,o=this.z,n=this.w;return this.x=e[0]*r+e[4]*i+e[8]*o+e[12]*n,this.y=e[1]*r+e[5]*i+e[9]*o+e[13]*n,this.z=e[2]*r+e[6]*i+e[10]*o+e[14]*n,this.w=e[3]*r+e[7]*i+e[11]*o+e[15]*n,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copy=i.prototype.set,i.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,this},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.fromAny=function(){if(4===arguments.length)return i.fromArray(arguments);if(arguments[0]instanceof Array)return i.fromArray(arguments[0]);var t=arguments[0];return new i(t.x,t.y,t.z,t.w)},i.prototype.setArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3],this},i.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},Object.defineProperty(i.prototype,"data",{get:t.warnOnce("The .data property of Vector4 was removed. Please use the .x, .y, .z and .w properties instead.",function(){var t=[],e=this;return Object.defineProperties(t,{0:{get:function(){return e.x},set:function(t){e.x=t}},1:{get:function(){return e.y},set:function(t){e.y=t}},2:{get:function(){return e.z},set:function(t){e.z=t}},3:{get:function(){return e.w},set:function(t){e.w=t}}}),t})}),i.prototype.setVector=t.warnOnce("The setVector method of Vector4 is deprecated. Please use the set method instead.",function(t){return this.set(t)}),i.add=t.warnOnce("Vector4.add is deprecated. Use Vector4.prototype.add instead.",function(t,e,r){"number"==typeof t&&(t=[t,t,t,t]),"number"==typeof e&&(e=[e,e,e,e]),r||(r=new i);var o=t.data||t,n=e.data||e;return r.data[0]=o[0]+n[0],r.data[1]=o[1]+n[1],r.data[2]=o[2]+n[2],r.data[3]=o[3]+n[3],r}),i.sub=t.warnOnce("Vector4.sub is deprecated. Use Vector4.prototype.sub instead.",function(t,e,r){"number"==typeof t&&(t=[t,t,t,t]),"number"==typeof e&&(e=[e,e,e,e]),r||(r=new i);var o=t.data||t,n=e.data||e;return r.data[0]=o[0]-n[0],r.data[1]=o[1]-n[1],r.data[2]=o[2]-n[2],r.data[3]=o[3]-n[3],r}),i.mul=t.warnOnce("Vector4.mul is deprecated. Use Vector4.prototype.mul instead.",function(t,e,r){"number"==typeof t&&(t=[t,t,t,t]),"number"==typeof e&&(e=[e,e,e,e]),r||(r=new i);var o=t.data||t,n=e.data||e;return r.data[0]=o[0]*n[0],r.data[1]=o[1]*n[1],r.data[2]=o[2]*n[2],r.data[3]=o[3]*n[3],r}),i.div=t.warnOnce("Vector4.div is deprecated. Use Vector4.prototype.div instead.",function(t,e,r){"number"==typeof t&&(t=[t,t,t,t]),"number"==typeof e&&(e=[e,e,e,e]),r||(r=new i);var o=t.data||t,n=e.data||e;return r.data[0]=o[0]/n[0],r.data[1]=o[1]/n[1],r.data[2]=o[2]/n[2],r.data[3]=o[3]/n[3],r}),i.dot=t.warnOnce("Vector4.dot is deprecated. Use Vector4.prototype.dot instead.",function(t,e){"number"==typeof t&&(t=[t,t,t,t]),"number"==typeof e&&(e=[e,e,e,e]);var r=t.data||t,i=e.data||e;return r[0]*i[0]+r[1]*i[1]+r[2]*i[2]+r[3]*i[3]}),i.prototype.addVector=t.warnOnce("Vector4.prototype.addVector is deprecated. Use .add instead.",function(t){
return this.data[0]+=t.data[0],this.data[1]+=t.data[1],this.data[2]+=t.data[2],this.data[3]+=t.data[3],this}),i.prototype.dotVector=t.warnOnce("Vector4.prototype.dotVector is deprecated. Use .dot instead.",function(t){var e=this.data,r=t.data;return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]}),i.prototype.mulVector=t.warnOnce("Vector4.prototype.mulVector is deprecated. Use .mul instead.",function(t){return this.data[0]*=t.data[0],this.data[1]*=t.data[1],this.data[2]*=t.data[2],this.data[3]*=t.data[3],this}),i.prototype.setVector=t.warnOnce("Vector4.prototype.setVector is deprecated. Use .set instead.",function(t){return this.data[0]=t.data[0],this.data[1]=t.data[1],this.data[2]=t.data[2],this.data[3]=t.data[3],this}),i.prototype.subVector=t.warnOnce("Vector4.prototype.subVector is deprecated. Use .sub instead.",function(t){return this.data[0]-=t.data[0],this.data[1]-=t.data[1],this.data[2]-=t.data[2],this.data[3]-=t.data[3],this}),i}(goo.ObjectUtils,goo.MathUtils,goo.Vector),goo.Vector3=function(t,e,r,i){"use strict";function o(t,e,r){0===arguments.length?(this.x=0,this.y=0,this.z=0):1===arguments.length&&"object"==typeof arguments[0]?arguments[0]instanceof o?this.copy(arguments[0]):(this.x=arguments[0][0],this.y=arguments[0][1],this.z=arguments[0][2]):(this.x=t,this.y=e,this.z=r)}return o.prototype=Object.create(r.prototype),o.prototype.constructor=o,r.setupAliases(o.prototype,[["u","r"],["v","g"],["w","b"]]),o.ZERO=new o(0,0,0),o.ONE=new o(1,1,1),o.UNIT_X=new o(1,0,0),o.UNIT_Y=new o(0,1,0),o.UNIT_Z=new o(0,0,1),o.prototype.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z}},o.prototype.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e}return this},o.prototype.add=function(t){return t instanceof o?(this.x+=t.x,this.y+=t.y,this.z+=t.z):t instanceof i?(console.warn("Passing a Vector4 argument to Vector3.prototype.add is deprecated. Consider using .addDirect instead."),this.x+=t.x,this.y+=t.y,this.z+=t.z):"object"==typeof t&&"number"==typeof t.length?(console.warn("Passing arrays to Vector3.prototype.add is deprecated - use Vector3.prototype.addDirect instead."),this.x+=t[0],this.y+=t[1],this.z+=t[2]):"number"==typeof t?(console.warn("Passing numbers to Vector3.prototype.add is deprecated - use Vector3.prototype.addDirect instead."),this.x+=t,this.y+=t,this.z+=t):console.warn("Vector3.prototype.add only supports vector arguments now."),this},o.prototype.addDirect=function(t,e,r){return this.x+=t,this.y+=e,this.z+=r,this},o.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},o.prototype.subDirect=function(t,e,r){return this.x-=t,this.y-=e,this.z-=r,this},o.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},o.prototype.mul=function(t){return"number"==typeof t?(console.warn("Vector3.prototype.mul only accepts vector arguments now. Please use Vector3.prototype.scale instead."),this.x*=t,this.y*=t,this.z*=t):(this.x*=t.x,this.y*=t.y,this.z*=t.z),this},o.prototype.mulDirect=function(t,e,r){return this.x*=t,this.y*=e,this.z*=r,this},o.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},o.prototype.div=function(t){return"number"==typeof t?(console.warn("Passing a number argument to Vector3.prototype.div is deprecated. Use Vector3.prototype.divDirect instead."),this.x/=t,this.y/=t,this.z/=t):(this.x/=t.x,this.y/=t.y,this.z/=t.z),this},o.prototype.divDirect=function(t,e,r){return this.x/=t,this.y/=e,this.z/=r,this},o.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},o.prototype.dotDirect=function(t,e,r){return this.x*t+this.y*e+this.z*r},o.prototype.equals=function(t){return Math.abs(this.x-t.x)<=e.EPSILON&&Math.abs(this.y-t.y)<=e.EPSILON&&Math.abs(this.z-t.z)<=e.EPSILON},o.prototype.equalsDirect=function(t,r,i){return Math.abs(this.x-t)<=e.EPSILON&&Math.abs(this.y-r)<=e.EPSILON&&Math.abs(this.z-i)<=e.EPSILON},o.prototype.cross=function(t){var e=this.x,r=this.y,i=this.z;return this.x=t.z*r-t.y*i,this.y=t.x*i-t.z*e,this.z=t.y*e-t.x*r,this},o.prototype.crossDirect=function(t,e,r){var i=this.x,o=this.y,n=this.z;return this.x=r*o-e*n,this.y=t*n-r*i,this.z=e*i-t*o,this},o.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},function(){var t=new o;o.prototype.reflect=function(e){return t.copy(e),t.scale(2*this.dot(e)),this.sub(t),this}}(),o.prototype.set=function(t){return t instanceof o||t instanceof i?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2]),this},o.prototype.setDirect=function(t,e,r){return this.x=t,this.y=e,this.z=r,this},o.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},o.prototype.length=function(){return Math.sqrt(this.lengthSquared())},o.prototype.normalize=function(){var t=this.length();return t<e.EPSILON?(this.x=0,this.y=0,this.z=0):(this.x/=t,this.y/=t,this.z/=t),this},o.prototype.unsafeNormalize=function(){var t=this.length();return this.x/=t,this.y/=t,this.z/=t,this},o.prototype.distanceSquared=function(t){var e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return e*e+r*r+i*i},o.prototype.distance=function(t){return Math.sqrt(this.distanceSquared(t))},o.prototype.applyPre=function(t){var e=t.data,r=this.x,i=this.y,o=this.z;return this.x=e[0]*r+e[1]*i+e[2]*o,this.y=e[3]*r+e[4]*i+e[5]*o,this.z=e[6]*r+e[7]*i+e[8]*o,this},o.prototype.applyPost=function(t){var e=t.data,r=this.x,i=this.y,o=this.z;return this.x=e[0]*r+e[3]*i+e[6]*o,this.y=e[1]*r+e[4]*i+e[7]*o,this.z=e[2]*r+e[5]*i+e[8]*o,this},o.prototype.applyPostPoint=function(t){var e=t.data,r=this.x,i=this.y,o=this.z;return this.x=e[0]*r+e[4]*i+e[8]*o+e[12],this.y=e[1]*r+e[5]*i+e[9]*o+e[13],this.z=e[2]*r+e[6]*i+e[10]*o+e[14],this},o.prototype.applyPostVector=function(t){var e=t.data,r=this.x,i=this.y,o=this.z;return this.x=e[0]*r+e[4]*i+e[8]*o,this.y=e[1]*r+e[5]*i+e[9]*o,this.z=e[2]*r+e[6]*i+e[10]*o,this},o.prototype.clone=function(){return new o(this.x,this.y,this.z)},o.prototype.copy=o.prototype.set,o.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.z=this.z,this},o.prototype.toArray=function(){return[this.x,this.y,this.z]},o.fromArray=function(t){return new o(t[0],t[1],t[2])},o.fromAny=function(){if(3===arguments.length)return o.fromArray(arguments);if(arguments[0]instanceof Array)return o.fromArray(arguments[0]);var t=arguments[0];return new o(t.x,t.y,t.z)},o.prototype.setArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this},Object.defineProperty(o.prototype,"data",{get:t.warnOnce("The .data property of Vector3 was removed. Please use the .x, .y and .z properties instead.",function(){var t=[],e=this;return Object.defineProperties(t,{0:{get:function(){return e.x},set:function(t){e.x=t}},1:{get:function(){return e.y},set:function(t){e.y=t}},2:{get:function(){return e.z},set:function(t){e.z=t}}}),t})}),o.prototype.setVector=t.warnOnce("The setVector method of Vector3 is deprecated. Please use the set method instead.",function(t){return this.set(t)}),o.add=t.warnOnce("Vector3.add is deprecated. Use Vector3.prototype.add instead.",function(t,e,r){"number"==typeof t&&(t=[t,t,t]),"number"==typeof e&&(e=[e,e,e]),r||(r=new o);var i=t.data||t,n=e.data||e;return r.data[0]=i[0]+n[0],r.data[1]=i[1]+n[1],r.data[2]=i[2]+n[2],r}),o.cross=t.warnOnce("Vector3.cross is deprecated. Use Vector3.prototype.cross instead.",function(t,e,r){r||(r=new o);var i=t.data||t,n=e.data||e,a=n[2]*i[1]-n[1]*i[2],s=n[0]*i[2]-n[2]*i[0],h=n[1]*i[0]-n[0]*i[1];return r.data[0]=a,r.data[1]=s,r.data[2]=h,r}),o.distance=t.warnOnce("Vector3.distance is deprecated. Use Vector3.prototype.distance instead.",function(t,e){return Math.sqrt(o.distanceSquared(t,e))}),o.distanceSquared=t.warnOnce("Vector3.distanceSquared is deprecated. Use Vector3.prototype.distanceSquared instead.",function(t,e){var r=t.x-e.x,i=t.y-e.y,o=t.z-e.z;return r*r+i*i+o*o}),o.div=t.warnOnce("Vector3.div is deprecated. Use Vector3.prototype.div instead.",function(t,e,r){if(r||(r=new o),"number"==typeof t){var i=e.data||e;r.data[0]=t/i[0],r.data[1]=t/i[1],r.data[2]=t/i[2]}else if("number"==typeof e){var n=1/e,a=t.data||t;r.data[0]=a[0]*n,r.data[1]=a[1]*n,r.data[2]=a[2]*n}else{var a=t.data||t,i=e.data||e;r.data[0]=a[0]/i[0],r.data[1]=a[1]/i[1],r.data[2]=a[2]/i[2]}return r}),o.dot=t.warnOnce("Vector3.dot is deprecated. Use Vector3.prototype.dot instead.",function(t,e){"number"==typeof t&&(t=[t,t,t]),"number"==typeof e&&(e=[e,e,e]);var r=t.data||t,i=e.data||e;return r[0]*i[0]+r[1]*i[1]+r[2]*i[2]}),o.mul=t.warnOnce("Vector3.mul is deprecated. Use Vector3.prototype.mul instead.",function(t,e,r){if(r||(r=new o),"number"==typeof t){var i=e.data||e;r.data[0]=t*i[0],r.data[1]=t*i[1],r.data[2]=t*i[2]}else if("number"==typeof e){var n=t.data||t;r.data[0]=n[0]*e,r.data[1]=n[1]*e,r.data[2]=n[2]*e}else{var n=t.data||t,i=e.data||e;r.data[0]=n[0]*i[0],r.data[1]=n[1]*i[1],r.data[2]=n[2]*i[2]}return r}),o.prototype.addVector=t.warnOnce("Vector3.prototype.addVector is deprecated. Use Vector3.prototype.add instead.",function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}),o.prototype.mulVector=t.warnOnce("Vector3.prototype.mulVector is deprecated. Use .mul instead.",function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}),o.prototype.dotVector=t.warnOnce("Vector3.prototype.dotVector is deprecated. Use .dot instead.",function(t){var e=this.data,r=t.data;return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}),o.prototype.invert=t.warnOnce("Vector3.prototype.invert is deprecated. Use .negate instead.",function(){return this.x=0-this.x,this.y=0-this.y,this.z=0-this.z,this}),o.prototype.subVector=t.warnOnce("Vector3.prototype.subVector is deprecated. Use .sub instead.",function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}),o.sub=t.warnOnce("Vector3.sub is deprecated. Use Vector3.prototype.sub instead.",function(t,e,r){"number"==typeof t&&(t=[t,t,t]),"number"==typeof e&&(e=[e,e,e]),r||(r=new o);var i=t.data||t,n=e.data||e;return r.data[0]=i[0]-n[0],r.data[1]=i[1]-n[1],r.data[2]=i[2]-n[2],r}),o}(goo.ObjectUtils,goo.MathUtils,goo.Vector,goo.Vector4),goo.BoundingVolume=function(t){"use strict";function e(e){this.center=new t,e&&this.center.set(e),this.min=new t(1/0,1/0,1/0),this.max=new t(-(1/0),-(1/0),-(1/0))}return e.prototype.copy=function(t){return this.center.copy(t.center),this.min.copy(t.min),this.min.copy(t.min),this},e.Outside=0,e.Inside=1,e.Intersects=2,e}(goo.Vector3),goo.Capabilities=function(){"use strict";function t(){}return t.init=function(e){t.CompressedTextureS3TC=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),t.TextureFloat=e.getExtension("OES_texture_float"),t.TextureFloatLinear=e.getExtension("OES_texture_float_linear"),t.TextureHalfFloat=e.getExtension("OES_texture_half_float"),t.TextureHalfFloatLinear=e.getExtension("OES_texture_half_float_linear"),t.StandardDerivatives=e.getExtension("OES_standard_derivatives"),t.TextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),t.DepthTexture=e.getExtension("WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture"),t.ElementIndexUInt=e.getExtension("OES_element_index_uint"),t.InstancedArrays=e.getExtension("ANGLE_instanced_arrays"),t.BlendMinmax=e.getExtension("EXT_blend_minmax"),t.FragDepth=e.getExtension("EXT_frag_depth"),t.ShaderTextureLod=e.getExtension("EXT_shader_texture_lod"),t.VertexArrayObject=e.getExtension("OES_vertex_array_object"),t.DrawBuffers=e.getExtension("WEBGL_draw_buffers"),t.maxTexureSize=e.getParameter(e.MAX_TEXTURE_SIZE),t.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),t.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),t.maxViewPortDims=e.getParameter(e.MAX_VIEWPORT_DIMS),t.maxAnisotropy=t.TextureFilterAnisotropic?e.getParameter(t.TextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,t.maxVertexTextureUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),t.maxFragmentTextureUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),t.maxCombinedTextureUnits=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),t.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),t.maxVertexUniformVectors=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),t.maxFragmentUniformVectors=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),t.maxVaryingVectors=e.getParameter(e.MAX_VARYING_VECTORS),t.aliasedPointSizeRange=e.getParameter(e.ALIASED_POINT_SIZE_RANGE),t.aliasedLineWidthRange=e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),t.samples=e.getParameter(e.SAMPLES),t.sampleBuffers=e.getParameter(e.SAMPLE_BUFFERS),t.depthBits=e.getParameter(e.DEPTH_BITS),t.stencilBits=e.getParameter(e.STENCIL_BITS),t.subpixelBits=e.getParameter(e.SUBPIXEL_BITS),t.supportedExtensionsList=e.getSupportedExtensions(),t.renderer=e.getParameter(e.RENDERER),t.vendor=e.getParameter(e.VENDOR),t.version=e.getParameter(e.VERSION),t.shadingLanguageVersion=e.getParameter(e.SHADING_LANGUAGE_VERSION),t.vertexShaderHighpFloat=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT),t.vertexShaderMediumpFloat=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT),t.vertexShaderLowpFloat=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_FLOAT),t.fragmentShaderHighpFloat=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),t.fragmentShaderMediumpFloat=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT),t.fragmentShaderLowpFloat=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_FLOAT),t.vertexShaderHighpInt=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_INT),t.vertexShaderMediumpInt=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_INT),t.vertexShaderLowpInt=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_INT),t.fragmentShaderHighpInt=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_INT),t.fragmentShaderMediumpInt=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_INT),t.fragmentShaderLowpInt=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_INT)},t.getCapabilitiesString=function(){var e=[],r=function(t){return t&&t.buffer instanceof ArrayBuffer&&void 0!==t.byteLength};for(var i in t){var o=t[i];if(!(o instanceof Function||"object"==typeof o&&!(o instanceof Array||r(o)))){var n="";if(r(o)){n+="[";for(var a=0;a<o.length;a++)n+=o[a],a<o.length-1&&(n+=",");n+="]"}else n=o;e.push(i+": "+n)}}return e.join("\n")},t}(),goo.BufferUtils=function(t){"use strict";function e(){}function r(){var t=["Trident","MSIE","Firefox","Safari","Chrome","Opera"],r=navigator.userAgent,i=t.length-1;for(i;i>-1&&-1===r.indexOf(t[i]);i--);e.browserType=t[i]}return e.createIndexBuffer=function(r,i){var o;if(256>=i)o="Trident"===e.browserType?new Uint16Array(r):new Uint8Array(r);else if(65536>=i)o=new Uint16Array(r);else{if(!t.ElementIndexUInt)throw new Error("Maximum number of vertices is 65536. Got: "+i);o=new Uint32Array(r)}return o},r(),e.cloneTypedArray=function(t){return new t.constructor(t)},e}(goo.Capabilities),goo.BufferData=function(t){"use strict";function e(t,e){this.data=t,this.target=e,this.glBuffer=null,this._dataUsage="StaticDraw",this._dataNeedsRefresh=!1}return e.prototype.setDataUsage=function(t){this._dataUsage=t},e.prototype.setDataNeedsRefresh=function(){this._dataNeedsRefresh=!0},e.prototype.destroy=function(t){t.deleteBuffer(this.glBuffer),this.glBuffer=null},e.prototype.copy=function(t){if(this.data instanceof ArrayBuffer){var e=new Uint8Array(t.data),r=new Uint8Array(this.data);r.set(e)}else this.data.set(t.data);return this.target=t.target,this.glBuffer=null,this._dataUsage=t._dataUsage,this._dataNeedsRefresh=!1,this},e.prototype.clone=function(){var r;r=this.data instanceof ArrayBuffer?this.data.slice(0):t.cloneTypedArray(this.data);var i=new e(r,this.target);return i._dataUsage=this._dataUsage,i._dataNeedsRefresh=!1,i},e}(goo.BufferUtils),goo.RendererUtils=function(t,e){"use strict";function r(){}function i(t,e,r){var i=document.createElement("canvas");i.width=e,i.height=r;var o=i.getContext("2d"),n=o.createImageData(e,r);return n.data.set(t),o.putImageData(n,0,0),i}return r.getByteSize=function(t){var e;switch(t){case"Byte":case"UnsignedByte":e=1;break;case"Short":case"UnsignedShort":case"HalfFloat":e=2;break;case"Int":case"Float":e=4;break;case"Double":e=8;break;default:throw new Error("Unknown type: "+t)}return e},r.checkGLError=function(t){for(var e=t.getError(),r=!1;e!==t.NO_ERROR;){if(r=!0,e===t.INVALID_ENUM)console.error("An unacceptable value is specified for an enumerated argument. The offending command is ignored and has no other side effect than to set the error flag.");else if(e===t.INVALID_VALUE)console.error("A numeric argument is out of range. The offending command is ignored and has no other side effect than to set the error flag.");else if(e===t.INVALID_OPERATION)console.error("The specified operation is not allowed in the current state. The offending command is ignored and has no other side effect than to set the error flag.");else if(e===t.FRAMEBUFFER_COMPLETE)console.error("The command is trying to render to or read from the framebuffer while the currently bound framebuffer is not framebuffer complete (i.e. the return value from glCheckFramebufferStatus is not GL_FRAMEBUFFER_COMPLETE). The offending command is ignored and has no other side effect than to set the error flag.");else if(e===t.OUT_OF_MEMORY)throw new Error("There is not enough memory left to execute the command. The state of the GL is undefined, except for the state of the error flags, after this error is recorded.");e=t.getError()}if(r)throw new Error("Stopping due to error")},r.isPowerOfTwo=e.isPowerOfTwo,r.nearestPowerOfTwo=e.nearestPowerOfTwo,r.clone=t.deepClone,r._blankImages={},r.getBlankImage=function(t,i,o,n,a,s){var h=e.nearestPowerOfTwo(o),u=e.nearestPowerOfTwo(n);h=Math.min(h,a),u=Math.min(u,a);var c=4===i.length?"rgba("+Number(255*i[0]).toFixed(0)+","+Number(255*i[1]).toFixed(0)+","+Number(255*i[2]).toFixed(0)+","+Number(i[3]).toFixed(2)+")":"rgb("+Number(255*i[0]).toFixed(0)+","+Number(255*i[1]).toFixed(0)+","+Number(255*i[2]).toFixed(0)+")",l=c+h+"x"+u,d=r._blankImages[l];if(!d){d=document.createElement("canvas"),d.width=h,d.height=u;var p=d.getContext("2d");p.beginPath(),p.rect(0,0,h,u),p.fillStyle=c,p.fill(),r._blankImages[l]=d}void 0===s?t.image=d:(t.image.isData=!1,t.image.data[s]=d)},r.scaleImage=function(t,r,o,n,a,s){var h=e.nearestPowerOfTwo(o),u=e.nearestPowerOfTwo(n);if(h=Math.min(h,a),u=Math.min(u,a),r.width!==h||r.height!==u){var c=document.createElement("canvas");c.width=h,c.height=u,r.getAttribute&&c.setAttribute("data-ref",r.getAttribute("data-ref"));var l=c.getContext("2d");r.data?l.drawImage(i(r.data,r.width,r.height),0,0,r.width,r.height,0,0,h,u):l.drawImage(r,0,0,r.width,r.height,0,0,h,u),c.dataReady=!0,c.src=r.src,c.originalWidth=o,c.originalHeight=n,void 0===s?t.image=c:t.image.data[s]=c}},r.getGLType=function(t,e){var r;switch(e){case"2D":r=t.TEXTURE_2D;break;case"CUBE":r=t.TEXTURE_CUBE_MAP;break;default:throw new Error("Invalid texture type: "+e)}return r},r.getGLWrap=function(t,e){var r;switch(e){case"Repeat":r=t.REPEAT;break;case"MirroredRepeat":r=t.MIRRORED_REPEAT;break;case"EdgeClamp":r=t.CLAMP_TO_EDGE;break;default:throw new Error("Invalid WrapMode type: "+e)}return r},r.getGLInternalFormat=function(t,e){var r;switch(e){case"RGBA":r=t.RGBA;break;case"RGB":r=t.RGB;break;case"Alpha":r=t.ALPHA;break;case"Luminance":r=t.LUMINANCE;break;case"LuminanceAlpha":r=t.LUMINANCE_ALPHA;break;default:throw new Error("Unsupported format: "+e)}return r},r.getGLPixelDataType=function(t,e){var r;switch(e){case"UnsignedByte":r=t.UNSIGNED_BYTE;break;case"UnsignedShort565":r=t.UNSIGNED_SHORT_5_6_5;break;case"UnsignedShort4444":r=t.UNSIGNED_SHORT_4_4_4_4;break;case"UnsignedShort5551":r=t.UNSIGNED_SHORT_5_5_5_1;break;case"Float":r=t.FLOAT;break;default:throw new Error("Unsupported type: "+e)}return r},r.getFilterFallback=function(t){var e;switch(t){case"NearestNeighborNoMipMaps":case"NearestNeighborNearestMipMap":case"NearestNeighborLinearMipMap":e="NearestNeighborNoMipMaps";break;case"BilinearNoMipMaps":case"Trilinear":case"BilinearNearestMipMap":e="BilinearNoMipMaps";break;default:e="NearestNeighborNoMipMaps"}return e},r.getGLMagFilter=function(t,e){var r;switch(e){case"Bilinear":r=t.LINEAR;break;case"NearestNeighbor":r=t.NEAREST;break;default:throw new Error("Invalid MagnificationFilter type: "+e)}return r},r.getGLMinFilter=function(t,e){var r;switch(e){case"BilinearNoMipMaps":r=t.LINEAR;break;case"Trilinear":r=t.LINEAR_MIPMAP_LINEAR;break;case"BilinearNearestMipMap":r=t.LINEAR_MIPMAP_NEAREST;break;case"NearestNeighborNoMipMaps":r=t.NEAREST;break;case"NearestNeighborNearestMipMap":r=t.NEAREST_MIPMAP_NEAREST;break;case"NearestNeighborLinearMipMap":r=t.NEAREST_MIPMAP_LINEAR;break;default:throw new Error("Invalid MinificationFilter type: "+e)}return r},r.getGLBufferTarget=function(t,e){return"ElementArrayBuffer"===e?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER},r.getGLArrayType=function(t,e){var r=null;return e instanceof Uint8Array?r=t.UNSIGNED_BYTE:e instanceof Uint16Array?r=t.UNSIGNED_SHORT:e instanceof Uint32Array?r=t.UNSIGNED_INT:e instanceof Int8Array?r=t.UNSIGNED_BYTE:e instanceof Int16Array?r=t.UNSIGNED_SHORT:e instanceof Int32Array&&(r=t.UNSIGNED_INT),r},r.getGLByteSize=function(t){return t.BYTES_PER_ELEMENT||1},r.getGLCubeMapFace=function(t,e){var r;switch(e){case"PositiveX":r=t.TEXTURE_CUBE_MAP_POSITIVE_X;break;case"NegativeX":r=t.TEXTURE_CUBE_MAP_NEGATIVE_X;break;case"PositiveY":r=t.TEXTURE_CUBE_MAP_POSITIVE_Y;break;case"NegativeY":r=t.TEXTURE_CUBE_MAP_NEGATIVE_Y;break;case"PositiveZ":r=t.TEXTURE_CUBE_MAP_POSITIVE_Z;break;case"NegativeZ":r=t.TEXTURE_CUBE_MAP_NEGATIVE_Z;break;default:throw new Error("Invalid cubemap face: "+e)}return r},r.getGLBufferUsage=function(t,e){var r;switch(e){case"StaticDraw":r=t.STATIC_DRAW;break;case"DynamicDraw":r=t.DYNAMIC_DRAW;break;case"StreamDraw":r=t.STREAM_DRAW;break;default:r=t.STATIC_DRAW}return r},r.getGLIndexMode=function(t,e){var r;switch(e){case"Triangles":r=t.TRIANGLES;break;case"TriangleStrip":r=t.TRIANGLE_STRIP;break;case"TriangleFan":r=t.TRIANGLE_FAN;break;case"Lines":r=t.LINES;break;case"LineStrip":r=t.LINE_STRIP;break;case"LineLoop":r=t.LINE_LOOP;break;case"Points":r=t.POINTS;break;default:r=t.TRIANGLES}return r},r.getGLDataType=function(t,e){var r;switch(e){case"Float":case"HalfFloat":case"Double":r=t.FLOAT;break;case"Byte":r=t.BYTE;break;case"UnsignedByte":r=t.UNSIGNED_BYTE;break;case"Short":r=t.SHORT;break;case"UnsignedShort":r=t.UNSIGNED_SHORT;break;case"Int":r=t.INT;break;case"UnsignedInt":r=t.UNSIGNED_INT;break;default:throw new Error("Unknown datatype: "+e)}return r},r.getGLBlendParam=function(t,e){var r;switch(e){case"AddEquation":r=t.FUNC_ADD;break;case"SubtractEquation":r=t.FUNC_SUBTRACT;break;case"ReverseSubtractEquation":r=t.FUNC_REVERSE_SUBTRACT;break;case"ZeroFactor":r=t.ZERO;break;case"OneFactor":r=t.ONE;break;case"SrcColorFactor":r=t.SRC_COLOR;break;case"OneMinusSrcColorFactor":r=t.ONE_MINUS_SRC_COLOR;break;case"SrcAlphaFactor":r=t.SRC_ALPHA;break;case"OneMinusSrcAlphaFactor":r=t.ONE_MINUS_SRC_ALPHA;break;case"DstAlphaFactor":r=t.DST_ALPHA;break;case"OneMinusDstAlphaFactor":r=t.ONE_MINUS_DST_ALPHA;break;case"DstColorFactor":r=t.DST_COLOR;break;case"OneMinusDstColorFactor":r=t.ONE_MINUS_DST_COLOR;break;case"SrcAlphaSaturateFactor":r=t.SRC_ALPHA_SATURATE;break;default:throw new Error("Unknown blend param: "+e)}return r},r}(goo.ObjectUtils,goo.MathUtils),goo.Vector2=function(t,e,r,i,o){"use strict";function n(t,e){0===arguments.length?(this.x=0,this.y=0):1===arguments.length&&"object"==typeof arguments[0]?arguments[0]instanceof n?this.copy(arguments[0]):(this.x=arguments[0][0],this.y=arguments[0][1]):(this.x=t,this.y=e)}return n.prototype=Object.create(r.prototype),n.prototype.constructor=n,r.setupAliases(n.prototype,[["u"],["v"]]),n.ZERO=new n(0,0),n.ONE=new n(1,1),n.UNIT_X=new n(1,0),n.UNIT_Y=new n(0,1),n.prototype.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y}},n.prototype.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e}return this},n.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.prototype.addDirect=function(t,e){return this.x+=t,this.y+=e,this},n.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.subDirect=function(t,e){return this.x-=t,this.y-=e,this},n.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},n.prototype.mul=function(t){return this.x*=t.x,this.y*=t.y,this},n.prototype.mulDirect=function(t,e){return this.x*=t,this.y*=e,this},n.prototype.scale=function(t){return this.x*=t,this.y*=t,this},n.prototype.div=function(t){return this.x/=t.x,this.y/=t.y,this},n.prototype.divDirect=function(t,e){return this.x/=t,this.y/=e,this},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y},n.prototype.dotDirect=function(t,e){return this.x*t+this.y*e},n.prototype.equals=function(t){return Math.abs(this.x-t.x)<=e.EPSILON&&Math.abs(this.y-t.y)<=e.EPSILON},n.prototype.equalsDirect=function(t,r){return Math.abs(this.x-t)<=e.EPSILON&&Math.abs(this.y-r)<=e.EPSILON},n.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},function(){var t=new n;n.prototype.reflect=function(e){return t.copy(e),t.scale(2*this.dot(e)),this.sub(t),this}}(),n.prototype.set=function(t){return t instanceof n||t instanceof i||t instanceof o?(this.x=t.x,this.y=t.y):(this.x=arguments[0],this.y=arguments[1]),this},n.prototype.setDirect=function(t,e){return this.x=t,this.y=e,this},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},n.prototype.length=function(){return Math.sqrt(this.lengthSquared())},n.prototype.normalize=function(){var t=this.length();return t<e.EPSILON?(this.x=0,this.y=0):(this.x/=t,this.y/=t),this},n.prototype.unsafeNormalize=function(){var t=this.length();return this.x/=t,this.y/=t,this},n.prototype.distanceSquared=function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},n.prototype.distance=function(t){return Math.sqrt(this.distanceSquared(t))},n.prototype.applyPre=function(t){var e=t.data,r=this.x,i=this.y;return this.x=e[0]*r+e[1]*i,this.y=e[2]*r+e[3]*i,this},n.prototype.applyPost=function(t){var e=t.data,r=this.x,i=this.y;return this.x=e[0]*r+e[2]*i,this.y=e[1]*r+e[3]*i,this},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.copy=n.prototype.set,n.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,this},n.fromArray=function(t){return new n(t[0],t[1])},n.fromAny=function(){if(2===arguments.length)return n.fromArray(arguments);if(arguments[0]instanceof Array)return n.fromArray(arguments[0]);var t=arguments[0];return new n(t.x,t.y)},n.prototype.setArray=function(t){return this.x=t[0],this.y=t[1],this},n.prototype.toArray=function(){return[this.x,this.y]},Object.defineProperty(n.prototype,"data",{get:t.warnOnce("The .data property of Vector2 was removed. Please use the .x and .y properties instead.",function(){var t=[],e=this;return Object.defineProperties(t,{0:{get:function(){return e.x},set:function(t){e.x=t}},1:{get:function(){return e.y},set:function(t){e.y=t}}}),t})}),n.prototype.setVector=t.warnOnce("The setVector method of Vector2 was removed. Please use the set method instead.",function(t){return this.set(t)}),n.add=t.warnOnce("Vector2.add is deprecated.",function(t,e,r){"number"==typeof t&&(t=[t,t]),"number"==typeof e&&(e=[e,e]),r||(r=new n);var i=t.data||t,o=e.data||e;return r.data[0]=i[0]+o[0],r.data[1]=i[1]+o[1],r}),n.sub=t.warnOnce("Vector2.sub is deprecated.",function(t,e,r){"number"==typeof t&&(t=[t,t]),"number"==typeof e&&(e=[e,e]),r||(r=new n);var i=t.data||t,o=e.data||e;return r.data[0]=i[0]-o[0],r.data[1]=i[1]-o[1],r}),n.mul=t.warnOnce("Vector2.mul is deprecated.",function(t,e,r){"number"==typeof t&&(t=[t,t]),"number"==typeof e&&(e=[e,e]),r||(r=new n);var i=t.data||t,o=e.data||e;return r.data[0]=i[0]*o[0],r.data[1]=i[1]*o[1],r}),n.div=t.warnOnce("Vector2.div is deprecated.",function(t,e,r){"number"==typeof t&&(t=[t,t]),"number"==typeof e&&(e=[e,e]),r||(r=new n);var i=t.data||t,o=e.data||e;return r.data[0]=i[0]/o[0],r.data[1]=i[1]/o[1],r}),n.dot=t.warnOnce("Vector2.dot is deprecated.",function(t,e){"number"==typeof t&&(t=[t,t]),"number"==typeof e&&(e=[e,e]);var r=t.data||t,i=e.data||e;return r[0]*i[0]+r[1]*i[1]}),n.prototype.dotVector=t.warnOnce("Vector2.prototype.dotVector is deprecated.",function(t){var e=this.data,r=t.data;return e[0]*r[0]+e[1]*r[1]}),n.prototype.addVector=t.warnOnce("Vector2.prototype.addVector is deprecated.",function(t){return this.data[0]+=t.data[0],this.data[1]+=t.data[1],this}),n.prototype.mulVector=t.warnOnce("Vector2.prototype.mulVector is deprecated.",function(t){return this.data[0]*=t.data[0],this.data[1]*=t.data[1],this}),n.prototype.subVector=t.warnOnce("Vector2.prototype.subVector is deprecated.",function(t){return this.data[0]-=t.data[0],this.data[1]-=t.data[1],this}),n}(goo.ObjectUtils,goo.MathUtils,goo.Vector,goo.Vector3,goo.Vector4),goo.MeshData=function(t,e,r,i,o,n,a){"use strict";function s(t,e,r){this.attributeMap=t,this.vertexCount=this._vertexCountStore=void 0!==e?e:0,this.indexCount=void 0!==r?r:0,this.primitiveCounts=[0],this.vertexData=null,this.indexData=null,this.dataViews={},this.indexLengths=null,this.indexModes=["Triangles"],this.type=s.MESH,this.paletteMap=void 0,this.weightsPerVertex=void 0,this.boundingBox=void 0,this.store=void 0,this.wireframeData=void 0,this.flatMeshData=void 0,this.__boundingTree=void 0,this._attributeDataNeedsRefresh=!1,this._dirtyAttributeNames=new Set,this.rebuildData(this.vertexCount,this.indexCount)}function h(t){for(var e={},r=0;r<t.length;r++){var i=t[r];if(void 0===f[i])throw new Error("No default attribute named: "+i);e[i]=a.deepClone(f[i])}return e}var u=window.Uint8ClampedArray;s.MESH=0,s.SKINMESH=1,s.prototype.rebuildData=function(t,e,r){var i={},o=null;if(r){for(var n=Object.keys(this.attributeMap),a=0;a<n.length;a++){var s=n[a],h=this.dataViews[s];h&&(i[s]=h)}this.indexData&&(o=this.indexData.data)}if(this.rebuildVertexData(t),this.rebuildIndexData(e),r){for(var n=Object.keys(this.attributeMap),a=0;a<n.length;a++){var s=n[a],u=i[s];u&&this.dataViews[s].set(u)}o&&this.indexData.data.set(o)}},s.prototype.rebuildVertexData=function(r){if(isNaN(r)||(this.vertexCount=r,this._vertexCountStore=this.vertexCount),this.vertexCount>0){for(var i=0,o=Object.keys(this.attributeMap),n=0;n<o.length;n++){var a=this.attributeMap[o[n]];i+=e.getByteSize(a.type)*a.count}this.vertexData=new t(new ArrayBuffer(i*this.vertexCount),"ArrayBuffer"),this.generateAttributeData()}},s.prototype.rebuildIndexData=function(e){if(void 0!==e&&(this.indexCount=e),this.indexCount>0){var i=r.createIndexBuffer(this.indexCount,this.vertexCount);this.indexData=new t(i,"ElementArrayBuffer")}},s.prototype.setVertexDataUpdated=function(){this.vertexData._dataNeedsRefresh=!0},s.prototype.setAttributeDataUpdated=function(t){this._dirtyAttributeNames.add(t),this._attributeDataNeedsRefresh=!0},s.prototype.getSectionCount=function(){return this.indexLengths?this.indexLengths.length:1},s.prototype.getPrimitiveCount=function(t){return t>=0&&t<this.primitiveCounts.length?this.primitiveCounts[t]:0},s.prototype.getPrimitiveVertices=function(t,e,r){var i=this.getPrimitiveCount(e);if(t>=i||0>t)throw new Error("Invalid primitiveIndex '"+t+"'.  Count is "+i);var n=this.indexModes[e],a=s.getVertexCount(n),h=r||[];h.length=a;for(var u=this.getAttributeBuffer(s.POSITION),c=0;a>c;c++)if(h[c]||(h[c]=new o),this.getIndexBuffer()){var l=this.getIndexBuffer()[this.getVertexIndex(t,c,e)];h[c].x=u[3*l+0],h[c].y=u[3*l+1],h[c].z=u[3*l+2]}else{var l=this.getVertexIndex(t,c,e);h[c].x=u[3*l+0],h[c].y=u[3*l+1],h[c].z=u[3*l+2]}return h},s.prototype.getVertexIndex=function(t,e,r){for(var i=0,o=0;r>o;o++)i+=this.indexLengths[o];switch(this.indexModes[r]){case"Triangles":i+=3*t+e;
break;case"TriangleStrip":i+=t+e;break;case"TriangleFan":i+=0===e?0:t+e;break;case"Points":i+=t;break;case"Lines":i+=2*t+e;break;case"LineStrip":case"LineLoop":i+=t+e;break;default:return s.logger.warning("unimplemented index mode: "+this.indexModes[r]),-1}return i},s.prototype.getTotalPrimitiveCount=function(){for(var t=0,e=0,r=this.primitiveCounts.length;r>e;e++)t+=this.primitiveCounts[e];return t},s.prototype.updatePrimitiveCounts=function(){var t=this.indexData?this.indexData.data.length:this.vertexCount,e=this.getSectionCount();this.primitiveCounts.length!==e&&(this.primitiveCounts=[]);for(var r=0;e>r;r++){var i=this.indexLengths?this.indexLengths[r]:t,o=s.getPrimitiveCount(this.indexModes[r],i);this.primitiveCounts[r]=o}},s.getPrimitiveCount=function(t,e){switch(t){case"Triangles":return e/3;case"TriangleFan":case"TriangleStrip":return e-2;case"Lines":return e/2;case"LineStrip":return e-1;case"LineLoop":return e;case"Points":return e;default:throw new Error("unimplemented index mode: "+t)}},s.getVertexCount=function(t){switch(t){case"Triangles":case"TriangleFan":case"TriangleStrip":return 3;case"Lines":case"LineStrip":case"LineLoop":return 2;case"Points":return 1;default:throw new Error("unimplemented index mode: "+t)}};var c={Byte:Int8Array,UnsignedByte:Uint8Array,UnsignedByteClamped:u,Short:Int16Array,UnsignedShort:Uint16Array,Int:Int32Array,UnsignedInt:Uint32Array,Float:Float32Array};s.prototype.generateAttributeData=function(){var t,r=this.vertexData.data,i=0;for(var o in this.attributeMap){var n=this.attributeMap[o];n.offset=i;var a=this.vertexCount*n.count;i+=a*e.getByteSize(n.type);var s=c[n.type];if(!s)throw new Error("Unsupported DataType: "+n.type);t=new s(r,n.offset,a),this.dataViews[o]=t,n.hashKey=n.count+"_"+n.type+"_"+n.stride+"_"+n.offset+"_"+n.normalized}},s.prototype.makeInterleavedData=function(){var r=0,i=0;for(var o in this.attributeMap){var n=this.attributeMap[o];n.offset=r,r+=n.count*e.getByteSize(n.type)}var a=new t(new ArrayBuffer(r*this.vertexCount),this.vertexData.target);a._dataUsage=this.vertexData._dataUsage,a._dataNeedsRefresh=!0;var s=new DataView(a.data);for(var o in this.attributeMap){var h=this.dataViews[o],n=this.attributeMap[o];n.stride=r;for(var i=n.offset,u=n.count,c=e.getByteSize(n.type),l=this.getDataMethod(n.type),d=s[l],p=0;p<this.vertexCount;p++)for(var f=0;u>f;f++)d.apply(s,[i+r*p+f*c,h[p*u+f],!0])}this.vertexData=a},s.prototype.getDataMethod=function(t){switch(t){case"Byte":return"setInt8";case"UnsignedByte":return"setUInt8";case"Short":return"setInt16";case"UnsignedShort":return"setUInt16";case"Int":return"setInt32";case"HalfFloat":return"setInt16";case"Float":return"setFloat32"}},s.prototype.getAttributeBuffer=function(t){return this.dataViews[t]},s.prototype.getIndexData=function(){return this.indexData},s.prototype.getIndexBuffer=function(){return null!==this.indexData?this.indexData.data:null},s.prototype.getIndexLengths=function(){return this.indexLengths},s.prototype.getIndexModes=function(){return this.indexModes},s.prototype.resetVertexCount=function(){this.vertexCount=this._vertexCountStore},s.prototype.applyTransform=function(t,e){var r=new o,i=this.getAttributeBuffer(t),n=i.length;if(t===s.POSITION)for(var a=0;n>a;a+=3)r.setDirect(i[a+0],i[a+1],i[a+2]),r.applyPostPoint(e.matrix),i[a+0]=r.x,i[a+1]=r.y,i[a+2]=r.z;else if(t===s.NORMAL)for(var a=0;n>a;a+=3)r.setDirect(i[a+0],i[a+1],i[a+2]),r.applyPost(e.rotation),i[a+0]=r.x,i[a+1]=r.y,i[a+2]=r.z;else if(t===s.TANGENT)for(var a=0;n>a;a+=3)r.setDirect(i[a+0],i[a+1],i[a+2]),r.applyPost(e.rotation),i[a+0]=r.x,i[a+1]=r.y,i[a+2]=r.z;return this},s.prototype.applyFunction=function(t,e){var r,a,s=this.getAttributeBuffer(t),h=s.length,u=this.attributeMap[t].count;switch(u){case 1:for(var c=0;h>c;c++)s[c]=e(s[c]);break;case 2:r=new i;for(var c=0;h>c;c+=2)r.setDirect(s[c+0],s[c+1]),a=e(r),s[c+0]=a.x,s[c+1]=a.y;break;case 3:r=new o;for(var c=0;h>c;c+=3)r.setDirect(s[c+0],s[c+1],s[c+2]),a=e(r),s[c+0]=a.x,s[c+1]=a.y,s[c+2]=a.z;break;case 4:r=new n;for(var c=0;h>c;c+=4)r.setDirect(s[c+0],s[c+1],s[c+2],s[c+3]),a=e(r),s[c+0]=a.x,s[c+1]=a.y,s[c+2]=a.z,s[c+3]=a.w}return this},s.prototype.getNormalsMeshData=function(t){if(void 0!==this.getAttributeBuffer("POSITION")&&void 0!==this.getAttributeBuffer("NORMAL")){t=void 0!==t?t:1;for(var e=[],r=[],i=this.dataViews.POSITION.length/3,o=0;i>o;o++)e.push(this.dataViews.POSITION[3*o+0],this.dataViews.POSITION[3*o+1],this.dataViews.POSITION[3*o+2],this.dataViews.POSITION[3*o+0]+this.dataViews.NORMAL[3*o+0]*t,this.dataViews.POSITION[3*o+1]+this.dataViews.NORMAL[3*o+1]*t,this.dataViews.POSITION[3*o+2]+this.dataViews.NORMAL[3*o+2]*t);for(var o=0;2*i>o;o+=2)r.push(o,o+1);var n=new s(s.defaultMap([s.POSITION]),e.length,r.length);return n.getAttributeBuffer(s.POSITION).set(e),n.getIndexBuffer().set(r),n.indexModes[0]="Lines",n}},s.prototype.buildWireframeData=function(){var t=a.deepClone(this.attributeMap),e=new s(t,this.vertexCount,0);e.indexModes[0]="Lines";var r,i=this.getIndexBuffer(),o=this;r=i?function(t,e,r){return i[o.getVertexIndex(t,e,r)]}:function(t,e,r){return o.getVertexIndex(t,e,r)};var n=[],h=0;this.updatePrimitiveCounts();for(var u=0;u<this.getSectionCount();u++)for(var c=this.indexModes[u],l=this.getPrimitiveCount(u),d=0;l>d;d++)switch(c){case"Triangles":case"TriangleFan":case"TriangleStrip":var p=r(d,0,u),f=r(d,1,u),m=r(d,2,u);n[h+0]=p,n[h+1]=f,n[h+2]=f,n[h+3]=m,n[h+4]=m,n[h+5]=p,h+=6;break;case"Lines":case"LineStrip":var p=r(d,0,u),f=r(d,1,u);n[h+0]=p,n[h+1]=f,h+=2;break;case"LineLoop":var p=r(d,0,u),f=r(d,1,u);d===l-1&&(f=r(0,0,u)),n[h+0]=p,n[h+1]=f,h+=2;break;case"Points":}if(h>0){e.rebuildIndexData(h);for(var g in t)e.getAttributeBuffer(g).set(this.getAttributeBuffer(g));e.getIndexBuffer().set(n)}return e.paletteMap=this.paletteMap,e.weightsPerVertex=this.weightsPerVertex,e};var l=new o,d=new o,p=new o;s.prototype.buildFlatMeshData=function(){var t=this.getIndexBuffer();if(null===t)return console.debug("No indices, probably a point mesh"),this;var e=a.deepClone(this.attributeMap),r={};for(var i in e)r[i]={oldBuffer:this.getAttributeBuffer(i),values:[]};var o=0;this.updatePrimitiveCounts();for(var n=0;n<this.getSectionCount();n++)for(var h=this.indexModes[n],u=this.getPrimitiveCount(n),c=!1,f=0;u>f;f++)switch(h){case"TriangleStrip":c=f%2===1?!0:!1;case"Triangles":case"TriangleFan":var m=t[this.getVertexIndex(f,0,n)],g=t[this.getVertexIndex(f,1,n)],y=t[this.getVertexIndex(f,2,n)];if(c){var v=y;y=g,g=v}for(var i in r)if(i!==s.NORMAL){for(var x=e[i].count,w=0;x>w;w++)r[i].values[o*x+w]=r[i].oldBuffer[m*x+w],r[i].values[(o+1)*x+w]=r[i].oldBuffer[g*x+w],r[i].values[(o+2)*x+w]=r[i].oldBuffer[y*x+w];i===s.POSITION&&(l.setDirect(r[i].values[3*o],r[i].values[3*o+1],r[i].values[3*o+2]),d.setDirect(r[i].values[3*(o+1)],r[i].values[3*(o+1)+1],r[i].values[3*(o+1)+2]),p.setDirect(r[i].values[3*(o+2)],r[i].values[3*(o+2)+1],r[i].values[3*(o+2)+2]),d.sub(l),p.sub(l),d.cross(p).normalize(),r[s.NORMAL]&&(r[s.NORMAL].values[3*o]=d.x,r[s.NORMAL].values[3*o+1]=d.y,r[s.NORMAL].values[3*o+2]=d.z,r[s.NORMAL].values[3*(o+1)]=d.x,r[s.NORMAL].values[3*(o+1)+1]=d.y,r[s.NORMAL].values[3*(o+1)+2]=d.z,r[s.NORMAL].values[3*(o+2)]=d.x,r[s.NORMAL].values[3*(o+2)+1]=d.y,r[s.NORMAL].values[3*(o+2)+2]=d.z))}o+=3}if(0===o)return console.warn("Could not build flat data"),this;var _=new s(e,o);for(var i in r)_.getAttributeBuffer(i).set(r[i].values);return _.paletteMap=this.paletteMap,_.weightsPerVertex=this.weightsPerVertex,_},s.prototype.destroy=function(t){this.vertexData&&this.vertexData.destroy(t),this.indexData&&this.indexData.destroy(t)},s.prototype.clone=function(){var t=a.deepClone(this.attributeMap),e=new s(t,this.vertexCount,this.indexCount);return e.primitiveCounts=this.primitiveCounts.slice(0),e.vertexData.copy(this.vertexData),e.indexData.copy(this.indexData),e.indexLengths=Array.isArray(this.indexLengths)?this.indexLengths.slice(0):this.indexLengths,e.indexModes=this.indexModes.slice(0),e.type=this.type,this.paletteMap&&(e.paletteMap=this.paletteMap.slice(0)),e.weightsPerVertex=this.weightsPerVertex,e},s.POSITION="POSITION",s.NORMAL="NORMAL",s.COLOR="COLOR",s.TANGENT="TANGENT",s.TEXCOORD0="TEXCOORD0",s.TEXCOORD1="TEXCOORD1",s.TEXCOORD2="TEXCOORD2",s.TEXCOORD3="TEXCOORD3",s.WEIGHTS="WEIGHTS",s.JOINTIDS="JOINTIDS",s.createAttribute=function(t,e,r){return{count:t,type:e,stride:0,offset:0,normalized:void 0!==r?r:!1}};var f={POSITION:s.createAttribute(3,"Float"),NORMAL:s.createAttribute(3,"Float"),COLOR:s.createAttribute(4,"Float"),TANGENT:s.createAttribute(4,"Float"),TEXCOORD0:s.createAttribute(2,"Float"),TEXCOORD1:s.createAttribute(2,"Float"),TEXCOORD2:s.createAttribute(2,"Float"),TEXCOORD3:s.createAttribute(2,"Float"),WEIGHTS:s.createAttribute(4,"Float"),JOINTIDS:s.createAttribute(4,"Float")};return s.defaultMap=function(t){return h(void 0===t?Object.keys(f):t)},s}(goo.BufferData,goo.RendererUtils,goo.BufferUtils,goo.Vector2,goo.Vector3,goo.Vector4,goo.ObjectUtils),goo.BoundingSphere=function(t,e,r,i){"use strict";function o(t,e){r.call(this,t),this.radius=void 0!==e?e:1}var n=new t;o.prototype=Object.create(r.prototype),o.prototype.constructor=o,o.prototype.computeFromPoints=function(t){var e=t.length;if(!(3>e)){var r=this.min,i=this.max,o=n;r.setDirect(t[0],t[1],t[2]),i.setDirect(t[0],t[1],t[2]);for(var a,s,h,u=3;e>u;u+=3)a=t[u+0],s=t[u+1],h=t[u+2],r.x=a<r.x?a:r.x,r.y=s<r.y?s:r.y,r.z=h<r.z?h:r.z,i.x=a>i.x?a:i.x,i.y=s>i.y?s:i.y,i.z=h>i.z?h:i.z;for(var c,l=i.add(r).scale(.5),d=0,u=0;e>u;u+=3)o.setDirect(t[u],t[u+1],t[u+2]),c=o.sub(l).lengthSquared(),c>d&&(d=c);this.radius=Math.sqrt(d),this.center.set(l)}},function(){var e=new t;o.prototype.containsPoint=function(t){return e.set(t).sub(this.center).lengthSquared()<=Math.pow(this.radius,2)}}(),o.prototype.computeFromPrimitives=function(e,r,o,n,a){if(!(0>=a-n)){for(var s=[],h=[],u=i.getVertexCount(e.indexModes[r]),c=0,l=n;a>l;l++){h=e.getPrimitiveVertices(o[l],r,h);for(var d=0;u>d;d++)s[c++]=(new t).set(h[d])}this.averagePoints(s)}},o.prototype.averagePoints=function(t){this.center.set(t[0]);for(var e=1;e<t.length;e++)this.center.add(t[e]);var r=1/t.length;this.center.scale(r);for(var i=0,e=0;e<t.length;e++){var o=n.copy(t[e]).sub(this.center),a=o.lengthSquared();a>i&&(i=a)}this.radius=Math.sqrt(i)+1e-5},o.prototype.transform=function(t,e){null===e&&(e=new o),t.applyForward(this.center,e.center);var r=t.scale;return e.radius=Math.abs(this._maxAxis(r)*this.radius),e},o.prototype.whichSide=function(t){var e=t.normal,i=this.center,o=e.x*i.x+e.y*i.y+e.z*i.z-t.constant;return o<-this.radius?r.Inside:o>this.radius?r.Outside:r.Intersects},o.prototype._pseudoDistance=function(t,e){return t.normal.x*e.x+t.normal.y*e.y+t.normal.z*e.z-t.constant},o.prototype._maxAxis=function(t){return Math.max(Math.abs(t.x),Math.max(Math.abs(t.y),Math.abs(t.z)))},o.prototype.toString=function(){var t=Math.round(10*this.center.x)/10,e=Math.round(10*this.center.y)/10,r=Math.round(10*this.center.z)/10,i=Math.round(10*this.radius)/10;return"["+t+","+e+","+r+"] - "+i},o.prototype.intersects=function(t){return t.intersectsSphere(this)},o.prototype.intersectsBoundingBox=function(t){t.min.x=t.center.x-t.xExtent,t.min.y=t.center.y-t.yExtent,t.min.z=t.center.z-t.zExtent,t.max.x=t.center.x+t.xExtent,t.max.y=t.center.y+t.yExtent,t.max.z=t.center.z+t.zExtent;var e=Math.pow(this.radius,2),r=0;return this.center.x<t.min.x?r+=Math.pow(this.center.x-t.min.x,2):this.center.x>t.max.x&&(r+=Math.pow(this.center.x-t.max.x,2)),this.center.y<t.min.y?r+=Math.pow(this.center.y-t.min.y,2):this.center.y>t.max.y&&(r+=Math.pow(this.center.y-t.max.y,2)),this.center.z<t.min.z?r+=Math.pow(this.center.z-t.min.z,2):this.center.z>t.max.z&&(r+=Math.pow(this.center.z-t.max.z,2)),e>=r},o.prototype.intersectsSphere=function(t){var e=n.set(this.center).sub(t.center),r=this.radius+t.radius;return e.dot(e)<=r*r},o.prototype.intersectsRay=function(t){if(!this.center)return!1;var e=t.origin.clone().sub(this.center),r=e.dot(e)-this.radius*this.radius;if(0>=r)return!0;var i=t.direction.dot(e);return i>=0?!1:i*i>=r},o.prototype.intersectsRayWhere=function(e){var r,i,o,n=(new t).copy(e.origin).sub(this.center),a=n.dot(n)-this.radius*this.radius;if(0>=a){r=e.direction.dot(n),i=r*r-a,o=Math.sqrt(i);var s=[o-r],h=[(new t).copy(e.direction).scale(s[0]).add(e.origin)];return{distances:s,points:h}}if(r=e.direction.dot(n),r>=0)return null;if(i=r*r-a,0>i)return null;if(i>=1e-5){o=Math.sqrt(i);var s=[-r-o,-r+o],h=[(new t).copy(e.direction).scale(s[0]).add(e.origin),(new t).copy(e.direction).scale(s[1]).add(e.origin)];return{distances:s,points:h}}var s=[-r],h=[(new t).copy(e.direction).scale(s[0]).add(e.origin)];return{distances:s,points:h}},o.prototype.merge=function(t){if(t instanceof o)return this.mergeSphere(t.center,t.radius,this);var e=n.setDirect(t.xExtent,t.yExtent,t.zExtent).length();return this.mergeSphere(t.center,e,this)},o.prototype.mergeSphere=function(t,r,i){i||(i=new o);var a=n.set(t).sub(this.center),s=a.lengthSquared(),h=r-this.radius,u=h*h;if(u>=s)return 0>=h?(i.center.set(this.center),i.radius=this.radius,i):(i.center.set(t),i.radius=r,i);var c=Math.sqrt(s),l=i.center;if(c>e.EPSILON){var d=(c+h)/(2*c);l.add(a.scale(d))}return i.radius=.5*(c+this.radius+r),i},o.prototype.copy=function(t){return r.prototype.copy.call(this,t),this.radius=t.radius,this};var a=!1;return o.prototype.clone=function(){return arguments.length>0&&!a&&(a=!0,console.warn('BoundingSphere::clone no longer takes an optional "store" parameter; please use BoundingSphere::copy instead')),new o(this.center,this.radius)},o}(goo.Vector3,goo.MathUtils,goo.BoundingVolume,goo.MeshData),goo.BoundingBox=function(t,e,r,i){"use strict";function o(t,r,i,o){e.call(this,t),this.xExtent=void 0!==r?r:1,this.yExtent=void 0!==i?i:1,this.zExtent=void 0!==o?o:1}for(var n=new t,a=new t,s=new t,h=[],u=0;8>u;u++)h.push(new t);o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype.computeFromPoints=function(t){var e=t.length;if(!(3>e)){var r=this.min,i=this.max,o=s;r.setDirect(t[0],t[1],t[2]),i.setDirect(t[0],t[1],t[2]);for(var n,a,h,u=3;e>u;u+=3)n=t[u+0],a=t[u+1],h=t[u+2],r.x=n<r.x?n:r.x,r.y=a<r.y?a:r.y,r.z=h<r.z?h:r.z,i.x=n>i.x?n:i.x,i.y=a>i.y?a:i.y,i.z=h>i.z?h:i.z;o.set(i).sub(r).scale(.5),this.xExtent=o.x,this.yExtent=o.y,this.zExtent=o.z,this.center.set(i).add(r).scale(.5)}},o.prototype.containsPoint=function(t){var e=this.center,r=t.x-e.x,i=t.y-e.y,o=t.z-e.z;return r>=-this.xExtent&&r<=this.xExtent&&i>=-this.yExtent&&i<=this.yExtent&&o>=-this.zExtent&&o<=this.zExtent};var c=[];o.prototype.computeFromPrimitives=function(t,e,r,i,s){if(!(0>=s-i)){var h=n.setDirect(1/0,1/0,1/0),u=a.setDirect(-(1/0),-(1/0),-(1/0)),l=c;l.length=0;for(var d=i;s>d;d++){l=t.getPrimitiveVertices(r[d],e,l);for(var p=0;p<l.length;p++)o.checkMinMax(h,u,l[p])}this.center.copy(h.add(u)),this.center.scale(.5),this.xExtent=u.x-this.center.x,this.yExtent=u.y-this.center.y,this.zExtent=u.z-this.center.z}},o.checkMinMax=function(t,e,r){r.x<t.x&&(t.x=r.x),r.x>e.x&&(e.x=r.x),r.y<t.y&&(t.y=r.y),r.y>e.y&&(e.y=r.y),r.z<t.z&&(t.z=r.z),r.z>e.z&&(e.z=r.z)},o.prototype.transform=function(t,e){null===e&&(e=new o);var r=h;this.getCorners(r);for(var i=0;8>i;i++)r[i].applyPostPoint(t.matrix);for(var n=r[0].x,a=r[0].y,s=r[0].z,u=n,c=a,l=s,i=1;8>i;i++){var d=r[i].x,p=r[i].y,f=r[i].z;n=Math.min(n,d),a=Math.min(a,p),s=Math.min(s,f),u=Math.max(u,d),c=Math.max(c,p),l=Math.max(l,f)}var m=.5*(u+n),g=.5*(c+a),y=.5*(l+s);return e.center.setDirect(m,g,y),e.xExtent=u-m,e.yExtent=c-g,e.zExtent=l-y,e},o.prototype.getCorners=function(t){var e=this.xExtent,r=this.yExtent,i=this.zExtent,o=this.center;return t[0].setDirect(o.x+e,o.y+r,o.z+i),t[1].setDirect(o.x+e,o.y+r,o.z-i),t[2].setDirect(o.x+e,o.y-r,o.z+i),t[3].setDirect(o.x+e,o.y-r,o.z-i),t[4].setDirect(o.x-e,o.y+r,o.z+i),t[5].setDirect(o.x-e,o.y+r,o.z-i),t[6].setDirect(o.x-e,o.y-r,o.z+i),t[7].setDirect(o.x-e,o.y-r,o.z-i),t},o.prototype.whichSide=function(t){var r=t.normal,i=this.center,o=Math.abs(this.xExtent*r.x)+Math.abs(this.yExtent*r.y)+Math.abs(this.zExtent*r.z),n=r.x*i.x+r.y*i.y+r.z*i.z-t.constant;return-o>n?e.Inside:n>o?e.Outside:e.Intersects},o.prototype._pseudoDistance=function(t,e){var r=t.normal,i=e;return r.x*i.x+r.y*i.y+r.z*i.z-t.constant},o.prototype._maxAxis=function(t){return Math.max(Math.abs(t.x),Math.max(Math.abs(t.y),Math.abs(t.z)))},o.prototype.toString=function(){var t=Math.round(10*this.center.x)/10,e=Math.round(10*this.center.y)/10,r=Math.round(10*this.center.z)/10;return"["+t+","+e+","+r+"] - ["+this.xExtent+","+this.yExtent+","+this.zExtent+"]"},o.prototype.intersects=function(t){return t.intersectsBoundingBox(this)},o.prototype.intersectsBoundingBox=function(t){return this.center.x+this.xExtent<t.center.x-t.xExtent||this.center.x-this.xExtent>t.center.x+t.xExtent?!1:this.center.y+this.yExtent<t.center.y-t.yExtent||this.center.y-this.yExtent>t.center.y+t.yExtent?!1:this.center.z+this.zExtent<t.center.z-t.zExtent||this.center.z-this.zExtent>t.center.z+t.zExtent?!1:!0},o.prototype.intersectsSphere=function(t){this.min.x=this.center.x-this.xExtent,this.min.y=this.center.y-this.yExtent,this.min.z=this.center.z-this.zExtent,this.max.x=this.center.x+this.xExtent,this.max.y=this.center.y+this.yExtent,this.max.z=this.center.z+this.zExtent;var e=Math.pow(t.radius,2),r=0;return t.center.x<this.min.x?r+=Math.pow(t.center.x-this.min.x,2):t.center.x>this.max.x&&(r+=Math.pow(t.center.x-this.max.x,2)),t.center.y<this.min.y?r+=Math.pow(t.center.y-this.min.y,2):t.center.y>this.max.y&&(r+=Math.pow(t.center.y-this.max.y,2)),t.center.z<this.min.z?r+=Math.pow(t.center.z-this.min.z,2):t.center.z>this.max.z&&(r+=Math.pow(t.center.z-this.max.z,2)),e>=r},o.prototype.testStaticAABBAABB=function(e,r){var i=this,o=e,n={mtvDistance:1e10,mtvAxis:new t};return this.testAxisStatic(t.UNIT_X,i.center.x-i.xExtent,i.center.x+i.xExtent,o.center.x-o.xExtent,o.center.x+o.xExtent,n)&&this.testAxisStatic(t.UNIT_Y,i.center.y-i.yExtent,i.center.y+i.yExtent,o.center.y-o.yExtent,o.center.y+o.yExtent,n)&&this.testAxisStatic(t.UNIT_Z,i.center.z-i.zExtent,i.center.z+i.zExtent,o.center.z-o.zExtent,o.center.z+o.zExtent,n)?(r&&(r.isIntersecting=!0,r.normal=n.mtvAxis,r.penetration=1.001*Math.sqrt(n.mtvDistance)),!0):!1},o.prototype.testAxisStatic=function(e,r,i,o,n,a){var s=e.dot(e);if(1e-6>s)return!0;var h=n-r,u=i-o;if(0>=h||0>=u)return!1;var c=u>h?h:-u,l=(new t).copy(e).scale(c/s),d=l.dot(l);return d<a.mtvDistance&&(a.mtvDistance=d,a.mtvAxis=e),!0},o.prototype.intersectsRay=function(t){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return!1;var e=n.set(t.origin).sub(this.center),r=t.direction,a=[0,1/0],s=this.xExtent;s<i.ZERO_TOLERANCE&&s>=0&&(s=i.ZERO_TOLERANCE);var h=this.yExtent;h<i.ZERO_TOLERANCE&&h>=0&&(h=i.ZERO_TOLERANCE);var u=this.zExtent;u<i.ZERO_TOLERANCE&&u>=0&&(u=i.ZERO_TOLERANCE);var c=o.clip(r.x,-e.x-s,a)&&o.clip(-r.x,e.x-s,a)&&o.clip(r.y,-e.y-h,a)&&o.clip(-r.y,e.y-h,a)&&o.clip(r.z,-e.z-u,a)&&o.clip(-r.z,e.z-u,a);return!c||0===a[0]&&a[1]===1/0?!1:!0},o.prototype.intersectsRayWhere=function(e){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return null;var r=n.copy(e.origin).sub(this.center),a=e.direction,s=[0,1/0],h=this.xExtent;h<i.ZERO_TOLERANCE&&h>=0&&(h=i.ZERO_TOLERANCE);var u=this.yExtent;u<i.ZERO_TOLERANCE&&u>=0&&(u=i.ZERO_TOLERANCE);var c=this.zExtent;c<i.ZERO_TOLERANCE&&c>=0&&(c=i.ZERO_TOLERANCE);var l=o.clip(a.x,-r.x-h,s)&&o.clip(-a.x,r.x-h,s)&&o.clip(a.y,-r.y-u,s)&&o.clip(-a.y,r.y-u,s)&&o.clip(a.z,-r.z-c,s)&&o.clip(-a.z,r.z-c,s);if(l&&(0!==s[0]||s[1]!==1/0)){if(s[1]>s[0]){var d=s,p=[new t(e.direction).scale(d[0]).add(e.origin),new t(e.direction).scale(d[1]).add(e.origin)];return{distances:d,points:p}}var d=[s[0]],p=[new t(e.direction).scale(d[0]).add(e.origin)];return{distances:d,points:p}}return null},o.clip=function(t,e,r){return t>0?e>t*r[1]?!1:(e>t*r[0]&&(r[0]=e/t),!0):0>t?e>t*r[0]?!1:(e>t*r[1]&&(r[1]=e/t),!0):0>=e},o.prototype.merge=function(t){return t instanceof o?this.mergeBox(t.center,t.xExtent,t.yExtent,t.zExtent,this):t instanceof r?this.mergeBox(t.center,t.radius,t.radius,t.radius,this):this},o.prototype.mergeBox=function(t,e,r,i,s){s||(s=new o);var h=n,u=a;return h.x=this.center.x-this.xExtent,h.x>t.x-e&&(h.x=t.x-e),h.y=this.center.y-this.yExtent,h.y>t.y-r&&(h.y=t.y-r),h.z=this.center.z-this.zExtent,h.z>t.z-i&&(h.z=t.z-i),u.x=this.center.x+this.xExtent,u.x<t.x+e&&(u.x=t.x+e),u.y=this.center.y+this.yExtent,u.y<t.y+r&&(u.y=t.y+r),u.z=this.center.z+this.zExtent,u.z<t.z+i&&(u.z=t.z+i),s.center.set(u).add(h).scale(.5),s.xExtent=u.x-s.center.x,s.yExtent=u.y-s.center.y,s.zExtent=u.z-s.center.z,s},o.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.xExtent=t.xExtent,this.yExtent=t.yExtent,this.zExtent=t.zExtent,this};var l=!1;return o.prototype.clone=function(){return arguments.length>0&&!l&&(l=!0,console.warn('BoundingBox::clone no longer takes an optional "store" parameter; please use BoundingBox::copy instead')),new o(this.center,this.xExtent,this.yExtent,this.zExtent)},o}(goo.Vector3,goo.BoundingVolume,goo.BoundingSphere,goo.MathUtils),goo.EntityUtils=function(t,e,r){"use strict";function i(){}function o(t,e){e.skeletonMap=e.skeletonMap||{originals:[],clones:[]};var r,i=e.skeletonMap.originals.indexOf(t);return-1===i?(r=t.clone(),e.skeletonMap.originals.push(t),e.skeletonMap.clones.push(r)):r=e.skeletonMap.clones[i],r}function n(e,i,a){var s=e.createEntity(i.name);s._tags=r.cloneSet(i._tags),s._attributes=r.cloneMap(i._attributes),s._hidden=i._hidden,s["static"]=i["static"];for(var h=0;h<i._components.length;h++){var u=i._components[h];if("TransformComponent"===u.type)s.transformComponent.transform.copy(u.transform);else if("MeshDataComponent"===u.type){var c=u.clone(a);u.currentPose&&(c.currentPose=o(u.currentPose,a)),s.setComponent(c)}else if("AnimationComponent"===u.type){var l=u.clone();l._skeletonPose=o(u._skeletonPose,a),s.setComponent(l)}else if("ScriptComponent"===u.type){for(var d=new u.constructor,p=0;p<u.scripts.length;p++){var f,m=u.scripts[p],g=m.externals?m.externals.key||m.externals.name:null;g&&t.getScript(g)?f=t.create(g,m.parameters):(f={externals:m.externals,name:(m.name||"")+"_clone",enabled:!!m.enabled},m.parameters&&(f.parameters=r.deepClone(m.parameters)),m.setup&&(f.setup=m.setup),m.update&&(f.update=m.update),m.cleanup&&(f.cleanup=m.cleanup),d.scripts.push(f))}s.setComponent(d),e.getSystem("ScriptSystem").manualSetup&&u.scripts[0].context&&d.setup(s)}else u.clone?s.setComponent(u.clone(a)):s.setComponent(u)}for(var p=0;p<i.transformComponent.children.length;p++){var y=i.transformComponent.children[p],v=n(e,y.entity,a);s.transformComponent.attachChild(v.transformComponent)}return a.callback&&a.callback(s),s}return i.clone=function(t,e,r){return r=r||{},n(t,e,r)},i.getRoot=function(t){for(;t.transformComponent.parent;)t=t.transformComponent.parent.entity;return t},i.updateWorldTransform=function(t){t.updateWorldTransform();for(var e=0;e<t.children.length;e++)i.updateWorldTransform(t.children[e])},i.getTotalBoundingBox=function(t){var r=new e,i=!0;if(t.traverse(function(t){if(t.meshRendererComponent)if(i){var o=t.meshRendererComponent.worldBound;o instanceof e?r.copy(o):(r.center.set(o.center),r.xExtent=r.yExtent=r.zExtent=o.radius),i=!1}else r.merge(t.meshRendererComponent.worldBound)}),i){var o=t.transformComponent.worldTransform.translation;r=new e(o.clone(),.001,.001,.001)}return r},i}(goo.Scripts,goo.BoundingBox,goo.ObjectUtils),goo.SystemBus=function(t){"use strict";return new t}(goo.Bus),goo.Manager=function(){"use strict";function t(){this.installedAPI={}}return t.prototype.applyAPI=function(t){var e=this.api;for(var r in e)"undefined"==typeof t[r]?(t[r]=e[r],this.installedAPI[r]=!0):console.warn("Could not install method "+r+" of "+this.type+" as it is already taken")},t}(),goo.EntityManager=function(t,e){"use strict";function r(){t.call(this),this.type="EntityManager",this._entitiesById=new Map,this._entitiesByIndex=new Map,this._entityCount=0,this.api={id:function(){var t=r.prototype.getEntityById.apply(this,arguments);return new e(t)}.bind(this),name:function(t){var r=this.getEntities();return new e(r.filter(function(e){return e.name===t}))}.bind(this)}}return r.prototype=Object.create(t.prototype),r.prototype.added=function(t){this.containsEntity(t)||(this._entitiesById.set(t.id,t),this._entitiesByIndex.set(t._index,t),this._entityCount++)},r.prototype.removed=function(t){this.containsEntity(t)&&(this._entitiesById["delete"](t.id),this._entitiesByIndex["delete"](t._index),this._entityCount--)},r.prototype.containsEntity=function(t){return this._entitiesByIndex.has(t._index)},r.prototype.getEntityById=function(t){return this._entitiesById.get(t)},r.prototype.getEntityByIndex=function(t){return this._entitiesByIndex.get(t)},r.prototype.getEntityByName=function(t){if(!(this._entityCount<=0)){var e;return this._entitiesByIndex.forEach(function(r){r.name===t&&(e=r)}),e}},r.prototype.size=function(){return this._entityCount},r.prototype.getEntities=function(){var t=[];return this._entitiesByIndex.forEach(function(e){t.push(e)}),t},r.prototype.getTopEntities=function(){var t=[];return this._entitiesByIndex.forEach(function(e){e.transformComponent&&e.transformComponent.parent||t.push(e)}),t},r.prototype.clear=function(){this._entitiesById.clear(),this._entitiesByIndex.clear(),this._entityCount=0},r}(goo.Manager,goo.EntitySelection),goo.Matrix=function(t,e){"use strict";function r(t,e){this.rows=t||0,this.cols=e||0,this.data=new Float32Array(this.rows*this.cols)}return r.setupAliases=function(t,e){e.forEach(function(e,r){e.forEach(function(e){Object.defineProperty(t,e,{get:function(){return this.data[r]},set:function(t){this.data[r]=t}})}),Object.defineProperty(t,r,{get:function(){return this.data[r]},set:function(t){this.data[r]=t}})})},r.add=e.warnOnce("Matrix.add is deprecated. Use Matrix3.prototype.add, Matrix2.prototype.add or Matrix4.prototype.add instead.",function(t,e,i){var o=t.rows,n=t.cols;if(i||(i=new r(o,n)),e instanceof r)for(var a=0;a<t.data.length;a++)i.data[a]=t.data[a]+e.data[a];else for(var a=0;a<t.data.length;a++)i.data[a]=t.data[a]+e;return i}),r.prototype.add=e.warnOnce("Matrix.prototype.add is deprecated. Use Matrix3.prototype.add, Matrix2.prototype.add or Matrix4.prototype.add instead.",function(t){return r.add(this,t,this)}),r.sub=e.warnOnce("Matrix.sub is deprecated. Use Matrix3.prototype.sub, Matrix2.prototype.sub or Matrix4.prototype.sub instead.",function(t,e,i){var o=t.rows,n=t.cols;if(i||(i=new r(o,n)),e instanceof r)for(var a=0;a<t.data.length;a++)i.data[a]=t.data[a]-e.data[a];else for(var a=0;a<t.data.length;a++)i.data[a]=t.data[a]-e;return i}),r.prototype.sub=e.warnOnce("Matrix.prototype.sub is deprecated. Use Matrix3.prototype.sub, Matrix2.prototype.sub or Matrix4.prototype.sub instead.",function(t){return r.sub(this,t,this)}),r.mul=e.warnOnce("Matrix.mul is deprecated. Use Matrix3.prototype.mul, Matrix2.prototype.mul or Matrix4.prototype.mul instead.",function(t,e,i){var o=t.rows,n=t.cols;if(i||(i=new r(o,n)),e instanceof r)for(var a=0;a<t.data.length;a++)i.data[a]=t.data[a]*e.data[a];else for(var a=0;a<t.data.length;a++)i.data[a]=t.data[a]*e;return i}),r.prototype.mul=e.warnOnce("Matrix.prototype.mul is deprecated. Use Matrix3.prototype.mul, Matrix2.prototype.mul or Matrix4.prototype.mul instead.",function(t){return r.mul(this,t,this)}),r.div=e.warnOnce("Matrix.div is deprecated. Use Matrix3.prototype.div, Matrix2.prototype.div or Matrix4.prototype.div instead.",function(t,e,i){var o=t.rows,n=t.cols;if(i||(i=new r(o,n)),e instanceof r)for(var a=0;a<t.data.length;a++)i.data[a]=t.data[a]/e.data[a];else{e=1/e;for(var a=0;a<t.data.length;a++)i.data[a]=t.data[a]*e}return i}),r.prototype.div=e.warnOnce("Matrix.prototype.div is deprecated. Use Matrix3.prototype.div, Matrix2.prototype.div or Matrix4.prototype.div instead.",function(t){return r.div(this,t,this)}),r.combine=e.warnOnce("Matrix.combine is deprecated. Use Matrix2/3/4.prototype.mul or Matrix2/3/4.prototype.mul2 instead.",function(t,e,i){var o=t.rows,n=e.cols,a=t.cols=e.rows;if(i||(i=new r(o,n)),i===t||i===e)return r.copy(r.combine(t,e),i);for(var s=0;n>s;s++)for(var h=s*o,u=0;o>u;u++){for(var c=0,l=0;a>l;l++)c+=t.data[l*t.rows+u]*e.data[s*e.rows+l];i.data[h+u]=c}return i}),r.prototype.combine=e.warnOnce("Matrix.prototype.combine is deprecated. Use Matrix2/3/4.prototype.mul or Matrix2/3/4.prototype.mul2 instead.",function(t){return r.combine(this,t,this)}),r.transpose=e.warnOnce("Matrix.transpose is deprecated. Use Matrix2/3/4.prototype.transpose instead.",function(t,e){var i=t.cols,o=t.rows;if(e||(e=new r(i,o)),e===t)return r.copy(r.transpose(t),e);for(var n=0;o>n;n++)for(var a=n*i,s=0;i>s;s++)e.data[a+s]=t.data[s*o+n];return e}),r.prototype.transpose=e.warnOnce("Matrix.prototype.transpose is deprecated. Use Matrix2/3/4.prototype.transpose instead.",function(){return r.transpose(this,this)}),r.copy=e.warnOnce("Matrix.copy is deprecated. Use Matrix2/3/4.prototype.copy instead.",function(t,e){var i=t.rows,o=t.cols;return e||(e=new r(i,o)),e.data.set(t.data),e}),r.prototype.copy=e.warnOnce("Matrix.prototype.copy is deprecated. Use Matrix2/3/4.prototype.copy instead.",function(t){return r.copy(t,this)}),r.equals=e.warnOnce("Matrix.equals is deprecated. Use Matrix2/3/4.prototype.equals instead.",function(e,r){if(e.rows!==r.rows||e.cols!==r.cols)return!1;for(var i=0;i<e.data.length;i++)if(!(Math.abs(e.data[i]-r.data[i])<=t.EPSILON))return!1;return!0}),r.prototype.equals=e.warnOnce("Matrix.prototype.equals is deprecated. Use Matrix2/3/4.prototype.equals instead.",function(t){return r.equals(this,t)}),r.prototype.isOrthogonal=e.warnOnce("Matrix.prototype.isOrthogonal is deprecated. Use Matrix2/3/4.prototype.isOrthogonal instead.",function(){for(var e=0;e<this.cols;e++)for(var r=e+1;r<this.cols;r++){for(var i=e*this.rows,o=r*this.rows,n=0,a=0;a<this.rows;a++)n+=this.data[i+a]*this.data[o+a];if(Math.abs(n)>t.EPSILON)return!1}return!0}),r.prototype.isNormal=e.warnOnce("Matrix.prototype.isNormal is deprecated. Use Matrix2/3/4.prototype.isNormal instead.",function(){for(var e=0;e<this.cols;e++){for(var r=e*this.rows,i=0,o=0;o<this.rows;o++)i+=this.data[r+o]*this.data[r+o];if(Math.abs(i-1)>t.EPSILON)return!1}return!0}),r.prototype.isOrthonormal=e.warnOnce("Matrix.prototype.isOrthonormal is deprecated. Use Matrix2/3/4.prototype.isOrthonormal instead.",function(){return this.isOrthogonal()&&this.isNormal()}),r.prototype.clone=e.warnOnce("Matrix.prorotype.clone is deprecated. Use Matrix2/3/4.prototype.clone instead.",function(){return r.copy(this)}),r.prototype.set=e.warnOnce("Matrix.prototype.set is deprecated. Use Matrix2/3/4.prototype.set instead.",function(){if(1===arguments.length&&"object"==typeof arguments[0])if(arguments[0]instanceof r)this.copy(arguments[0]);else for(var t=0;t<arguments[0].length;t++)this.data[t]=arguments[0][t];else for(var t=0;t<arguments.length;t++)this.data[t]=arguments[t];return this}),r.prototype.toString=e.warnOnce("Matrix.prorotype.toString is deprecated.",function(){for(var t="",e=0;e<this.cols;e++){var r=e*this.rows;t+="[";for(var i=0;i<this.rows;i++)t+=this.data[r+i],t+=i!==this.rows-1?", ":"";t+=e!==this.cols-1?"], ":"]"}return t}),r}(goo.MathUtils,goo.ObjectUtils),goo.Matrix3=function(t,e,r,i){"use strict";function o(){if(e.call(this,3,3),0===arguments.length)this.data[0]=1,this.data[4]=1,this.data[8]=1;else if(1===arguments.length&&"object"==typeof arguments[0])arguments[0]instanceof o?this.copy(arguments[0]):this.setArray(arguments[0]);else for(var t=0;t<arguments.length;t++)this.data[t]=arguments[t]}return o._tempX=new r,o._tempY=new r,o._tempZ=new r,o.prototype=Object.create(e.prototype),o.prototype.constructor=o,e.setupAliases(o.prototype,[["e00"],["e10"],["e20"],["e01"],["e11"],["e21"],["e02"],["e12"],["e22"]]),o.IDENTITY=new o(1,0,0,0,1,0,0,0,1),o.prototype.add=function(t){var e=this.data,r=t.data;return e[0]+=r[0],e[1]+=r[1],e[2]+=r[2],e[3]+=r[3],e[4]+=r[4],e[5]+=r[5],e[6]+=r[6],e[7]+=r[7],e[8]+=r[8],this},o.prototype.sub=function(t){
var e=this.data,r=t.data;return e[0]-=r[0],e[1]-=r[1],e[2]-=r[2],e[3]-=r[3],e[4]-=r[4],e[5]-=r[5],e[6]-=r[6],e[7]-=r[7],e[8]-=r[8],this},o.prototype.scale=function(t){var e=this.data;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},o.prototype.mul=function(t){var e=t.data,r=e[0],i=e[3],o=e[6],n=e[1],a=e[4],s=e[7],h=e[2],u=e[5],c=e[8],l=this.data,d=l[0],p=l[3],f=l[6],m=l[1],g=l[4],y=l[7],v=l[2],x=l[5],w=l[8],_=this.data;return _[0]=r*d+i*m+o*v,_[3]=r*p+i*g+o*x,_[6]=r*f+i*y+o*w,_[1]=n*d+a*m+s*v,_[4]=n*p+a*g+s*x,_[7]=n*f+a*y+s*w,_[2]=h*d+u*m+c*v,_[5]=h*p+u*g+c*x,_[8]=h*f+u*y+c*w,this},o.prototype.mul2=function(t,e){var r=t.data,i=r[0],o=r[3],n=r[6],a=r[1],s=r[4],h=r[7],u=r[2],c=r[5],l=r[8],d=e.data,p=d[0],f=d[3],m=d[6],g=d[1],y=d[4],v=d[7],x=d[2],w=d[5],_=d[8],b=this.data;return b[0]=i*p+o*g+n*x,b[3]=i*f+o*y+n*w,b[6]=i*m+o*v+n*_,b[1]=a*p+s*g+h*x,b[4]=a*f+s*y+h*w,b[7]=a*m+s*v+h*_,b[2]=u*p+c*g+l*x,b[5]=u*f+c*y+l*w,b[8]=u*m+c*v+l*_,this},o.prototype.transpose=function(){var t=this.data,e=t[3],r=t[6],i=t[7];return t[3]=t[1],t[6]=t[2],t[7]=t[5],t[1]=e,t[2]=r,t[5]=i,this},o.invert=function(e,r){if(r||(r=new o),r===e)return r.copy(o.invert(e));var i=e.determinant();if(Math.abs(i)<t.EPSILON)return r;i=1/i;var n=r.data,a=e.data;return n[0]=(a[4]*a[8]-a[7]*a[5])*i,n[1]=(a[7]*a[2]-a[1]*a[8])*i,n[2]=(a[1]*a[5]-a[4]*a[2])*i,n[3]=(a[6]*a[5]-a[3]*a[8])*i,n[4]=(a[0]*a[8]-a[6]*a[2])*i,n[5]=(a[3]*a[2]-a[0]*a[5])*i,n[6]=(a[3]*a[7]-a[6]*a[4])*i,n[7]=(a[6]*a[1]-a[0]*a[7])*i,n[8]=(a[0]*a[4]-a[3]*a[1])*i,r},o.prototype.invert=function(){return o.invert(this,this)},o.prototype.isOrthogonal=function(){var e=this.data,r=e[0]*e[3]+e[1]*e[4]+e[2]*e[5];return Math.abs(r)>t.EPSILON?!1:(r=e[0]*e[6]+e[1]*e[7]+e[2]*e[8],Math.abs(r)>t.EPSILON?!1:(r=e[3]*e[6]+e[4]*e[7]+e[5]*e[8],Math.abs(r)>t.EPSILON?!1:!0))},o.prototype.isNormal=function(){var e=this.data,r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return Math.abs(r-1)>t.EPSILON?!1:(r=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],Math.abs(r-1)>t.EPSILON?!1:(r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8],Math.abs(r-1)>t.EPSILON?!1:!0))},o.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},o.prototype.determinant=function(){var t=this.data;return t[0]*(t[4]*t[8]-t[7]*t[5])-t[3]*(t[1]*t[8]-t[7]*t[2])+t[6]*(t[1]*t[5]-t[4]*t[2])},o.prototype.setIdentity=function(){var t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},o.prototype.multiplyDiagonalPost=function(t,e){var r=t.x,i=t.y,o=t.z,n=this.data,a=e.data;return a[0]=r*n[0],a[1]=r*n[1],a[2]=r*n[2],a[3]=i*n[3],a[4]=i*n[4],a[5]=i*n[5],a[6]=o*n[6],a[7]=o*n[7],a[8]=o*n[8],e},o.prototype.fromAngles=function(t,e,r){var i=Math.cos(t),o=Math.sin(t),n=Math.cos(e),a=Math.sin(e),s=Math.cos(r),h=Math.sin(r),u=this.data;return u[0]=n*s,u[3]=a*o-n*h*i,u[6]=n*h*o+a*i,u[1]=h,u[4]=s*i,u[7]=-s*o,u[2]=-a*s,u[5]=a*h*i+n*o,u[8]=-a*h*o+n*i,this},o.prototype.rotateX=function(t,e){e=e||this;var r=this.data,i=e.data,o=Math.sin(t),n=Math.cos(t),a=r[3],s=r[4],h=r[5],u=r[6],c=r[7],l=r[8];return r!==i&&(i[0]=r[0],i[1]=r[1],i[2]=r[2]),i[3]=a*n+u*o,i[4]=s*n+c*o,i[5]=h*n+l*o,i[6]=u*n-a*o,i[7]=c*n-s*o,i[8]=l*n-h*o,e},o.prototype.rotateY=function(t,e){e=e||this;var r=this.data,i=e.data,o=Math.sin(t),n=Math.cos(t),a=r[0],s=r[1],h=r[2],u=r[6],c=r[7],l=r[8];return r!==i&&(i[3]=r[3],i[4]=r[4],i[5]=r[5]),i[0]=a*n-u*o,i[1]=s*n-c*o,i[2]=h*n-l*o,i[6]=a*o+u*n,i[7]=s*o+c*n,i[8]=h*o+l*n,e},o.prototype.rotateZ=function(t,e){e=e||this;var r=this.data,i=e.data,o=Math.sin(t),n=Math.cos(t),a=r[0],s=r[1],h=r[2],u=r[3],c=r[4],l=r[5];return r!==i&&(i[6]=r[6],i[7]=r[7],i[8]=r[8]),i[0]=a*n+u*o,i[1]=s*n+c*o,i[2]=h*n+l*o,i[3]=u*n-a*o,i[4]=c*n-s*o,i[5]=l*n-h*o,e},o.prototype.toAngles=function(e){var i=e;i||(i=new r);var o=this.data;return o[3]>1-t.EPSILON?(i.y=Math.atan2(o[2],o[8]),i.z=Math.PI/2,i.x=0):o[3]<-1+t.EPSILON?(i.y=Math.atan2(o[2],o[8]),i.z=-Math.PI/2,i.x=0):(i.y=Math.atan2(-o[2],o[0]),i.x=Math.atan2(-o[7],o[4]),i.z=Math.asin(o[1])),i},o.prototype.fromAngleNormalAxis=function(t,e,r,i){var o=Math.cos(t),n=Math.sin(t),a=1-o,s=e*e,h=r*r,u=i*i,c=e*r*a,l=e*i*a,d=r*i*a,p=e*n,f=r*n,m=i*n,g=this.data;return g[0]=s*a+o,g[3]=c-m,g[6]=l+f,g[1]=c+m,g[4]=h*a+o,g[7]=d-p,g[2]=l-f,g[5]=d+p,g[8]=u*a+o,this},o.prototype.lookAt=function(t,e){var i=o._tempX,n=o._tempY,a=o._tempZ;a.set(t).normalize().scale(-1),i.set(e).cross(a).normalize(),i.equals(r.ZERO)&&(0!==a.x?i.setDirect(a.y,-a.x,0):i.setDirect(0,a.z,-a.y)),n.set(a).cross(i);var s=this.data;return s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=n.x,s[4]=n.y,s[5]=n.z,s[6]=a.x,s[7]=a.y,s[8]=a.z,this},o.prototype.copyQuaternion=function(t){return t.toRotationMatrix(this)},o.prototype.equals=function(e){var r=this.data,i=e.data;return Math.abs(r[0]-i[0])<=t.EPSILON&&Math.abs(r[1]-i[1])<=t.EPSILON&&Math.abs(r[2]-i[2])<=t.EPSILON&&Math.abs(r[3]-i[3])<=t.EPSILON&&Math.abs(r[4]-i[4])<=t.EPSILON&&Math.abs(r[5]-i[5])<=t.EPSILON&&Math.abs(r[6]-i[6])<=t.EPSILON&&Math.abs(r[7]-i[7])<=t.EPSILON&&Math.abs(r[8]-i[8])<=t.EPSILON},o.prototype.copy=function(t){var e=this.data,r=t.data;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},o.prototype.copyMatrix4=function(t){var e=this.data,r=t.data;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[4],e[4]=r[5],e[5]=r[6],e[6]=r[8],e[7]=r[9],e[8]=r[10],this},o.prototype.setArray=function(t){var e=this.data;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},o.prototype.set=o.prototype.copy,o.prototype.clone=function(){return(new o).copy(this)},o.add=i.warnOnce("Matrix3.add is deprecated - use Matrix3.prototype.add instead.",function(t,e,r){r||(r=new o);var i=r.data,n=t.data;if(e instanceof o){var a=e.data;i[0]=n[0]+a[0],i[1]=n[1]+a[1],i[2]=n[2]+a[2],i[3]=n[3]+a[3],i[4]=n[4]+a[4],i[5]=n[5]+a[5],i[6]=n[6]+a[6],i[7]=n[7]+a[7],i[8]=n[8]+a[8]}else i[0]=n[0]+e,i[1]=n[1]+e,i[2]=n[2]+e,i[3]=n[3]+e,i[4]=n[4]+e,i[5]=n[5]+e,i[6]=n[6]+e,i[7]=n[7]+e,i[8]=n[8]+e;return r}),o.sub=i.warnOnce("Matrix3.sub is deprecated - use Matrix3.prototype.sub instead.",function(t,e,r){r||(r=new o);var i=r.data,n=t.data;if(e instanceof o){var a=e.data;i[0]=n[0]-a[0],i[1]=n[1]-a[1],i[2]=n[2]-a[2],i[3]=n[3]-a[3],i[4]=n[4]-a[4],i[5]=n[5]-a[5],i[6]=n[6]-a[6],i[7]=n[7]-a[7],i[8]=n[8]-a[8]}else i[0]=n[0]-e,i[1]=n[1]-e,i[2]=n[2]-e,i[3]=n[3]-e,i[4]=n[4]-e,i[5]=n[5]-e,i[6]=n[6]-e,i[7]=n[7]-e,i[8]=n[8]-e;return r}),o.mul=i.warnOnce("Matrix3.mul is deprecated - use Matrix3.prototype.mul instead.",function(t,e,r){r||(r=new o);var i=r.data,n=t.data;if(e instanceof o){var a=e.data;i[0]=n[0]*a[0],i[1]=n[1]*a[1],i[2]=n[2]*a[2],i[3]=n[3]*a[3],i[4]=n[4]*a[4],i[5]=n[5]*a[5],i[6]=n[6]*a[6],i[7]=n[7]*a[7],i[8]=n[8]*a[8]}else i[0]=n[0]*e,i[1]=n[1]*e,i[2]=n[2]*e,i[3]=n[3]*e,i[4]=n[4]*e,i[5]=n[5]*e,i[6]=n[6]*e,i[7]=n[7]*e,i[8]=n[8]*e;return r}),o.div=i.warnOnce("Matrix3.div is deprecated - use Matrix3.prototype.div instead.",function(t,e,r){r||(r=new o);var i=r.data,n=t.data;if(e instanceof o){var a=e.data;i[0]=n[0]/a[0],i[1]=n[1]/a[1],i[2]=n[2]/a[2],i[3]=n[3]/a[3],i[4]=n[4]/a[4],i[5]=n[5]/a[5],i[6]=n[6]/a[6],i[7]=n[7]/a[7],i[8]=n[8]/a[8]}else i[0]=n[0]/e,i[1]=n[1]/e,i[2]=n[2]/e,i[3]=n[3]/e,i[4]=n[4]/e,i[5]=n[5]/e,i[6]=n[6]/e,i[7]=n[7]/e,i[8]=n[8]/e;return r}),o.prototype.div=i.warnOnce("Matrix3.prototype.div is deprecated.",function(t){return o.div(this,t,this)}),o.combine=i.warnOnce("Matrix3.combine is deprecated - use Matrix3.prototype.mul or .mul2 instead.",function(t,e,r){r||(r=new o);var i=t.data,n=i[0],a=i[3],s=i[6],h=i[1],u=i[4],c=i[7],l=i[2],d=i[5],p=i[8],f=e.data,m=f[0],g=f[3],y=f[6],v=f[1],x=f[4],w=f[7],_=f[2],b=f[5],S=f[8],M=r.data;return M[0]=n*m+a*v+s*_,M[3]=n*g+a*x+s*b,M[6]=n*y+a*w+s*S,M[1]=h*m+u*v+c*_,M[4]=h*g+u*x+c*b,M[7]=h*y+u*w+c*S,M[2]=l*m+d*v+p*_,M[5]=l*g+d*x+p*b,M[8]=l*y+d*w+p*S,r}),o.prototype.combine=i.warnOnce("Matrix3.prototype.combine is deprecated - use Matrix3.prototype.mul or .mul2 instead.",function(t){return o.combine(this,t,this)}),o.transpose=i.warnOnce("Matrix3.transpose is deprecated - use Matrix3.prototype.transpose instead.",function(t,e){e||(e=new o);var r=t.data,i=e.data;if(e===t){var n=r[3],a=r[6],s=r[7];return i[3]=r[1],i[6]=r[2],i[7]=r[5],i[1]=n,i[2]=a,i[5]=s,e}return i[0]=r[0],i[1]=r[3],i[2]=r[6],i[3]=r[1],i[4]=r[4],i[5]=r[7],i[6]=r[2],i[7]=r[5],i[8]=r[8],e}),o.prototype.applyPost=i.warnOnce("Matrix3.prototype.applyPost is deprecated - use Vector3.prototype.applyPost instead.",function(t){var e=this.data,r=t.x,i=t.y,o=t.z;return t.x=e[0]*r+e[3]*i+e[6]*o,t.y=e[1]*r+e[4]*i+e[7]*o,t.z=e[2]*r+e[5]*i+e[8]*o,t}),o.prototype.applyPre=i.warnOnce("Matrix3.prototype.applyPre is deprecated - use Vector3.prototype.applyPre instead.",function(t){var e=this.data,r=t.x,i=t.y,o=t.z;return t.x=e[0]*r+e[1]*i+e[2]*o,t.y=e[3]*r+e[4]*i+e[5]*o,t.z=e[6]*r+e[7]*i+e[8]*o,t}),o}(goo.MathUtils,goo.Matrix,goo.Vector3,goo.ObjectUtils),goo.Matrix4=function(t,e,r){"use strict";function i(){if(e.call(this,4,4),0===arguments.length)this.data[0]=1,this.data[5]=1,this.data[10]=1,this.data[15]=1;else if(1===arguments.length&&"object"==typeof arguments[0])arguments[0]instanceof i?this.copy(arguments[0]):this.setArray(arguments[0]);else for(var t=0;t<arguments.length;t++)this.data[t]=arguments[t]}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,e.setupAliases(i.prototype,[["e00"],["e10"],["e20"],["e30"],["e01"],["e11"],["e21"],["e31"],["e02"],["e12"],["e22"],["e32"],["e03"],["e13"],["e23"],["e33"]]),i.IDENTITY=new i(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),i.prototype.add=function(t){var e=this.data,r=t.data;return e[0]+=r[0],e[1]+=r[1],e[2]+=r[2],e[3]+=r[3],e[4]+=r[4],e[5]+=r[5],e[6]+=r[6],e[7]+=r[7],e[8]+=r[8],e[9]+=r[9],e[10]+=r[10],e[11]+=r[11],e[12]+=r[12],e[13]+=r[13],e[14]+=r[14],e[15]+=r[15],this},i.prototype.sub=function(t){var e=this.data,r=t.data;return e[0]-=r[0],e[1]-=r[1],e[2]-=r[2],e[3]-=r[3],e[4]-=r[4],e[5]-=r[5],e[6]-=r[6],e[7]-=r[7],e[8]-=r[8],e[9]-=r[9],e[10]-=r[10],e[11]-=r[11],e[12]-=r[12],e[13]-=r[13],e[14]-=r[14],e[15]-=r[15],this},i.prototype.scale=function(t){var e=this.data;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e[12]*=t,e[13]*=t,e[14]*=t,e[15]*=t,this},i.prototype.mul=function(t){var e=this.data,r=e[0],i=e[4],o=e[8],n=e[12],a=e[1],s=e[5],h=e[9],u=e[13],c=e[2],l=e[6],d=e[10],p=e[14],f=e[3],m=e[7],g=e[11],y=e[15],v=t.data,x=v[0],w=v[4],_=v[8],b=v[12],S=v[1],M=v[5],E=v[9],C=v[13],T=v[2],P=v[6],D=v[10],R=v[14],O=v[3],A=v[7],I=v[11],L=v[15],N=this.data;return N[0]=r*x+i*S+o*T+n*O,N[4]=r*w+i*M+o*P+n*A,N[8]=r*_+i*E+o*D+n*I,N[12]=r*b+i*C+o*R+n*L,N[1]=a*x+s*S+h*T+u*O,N[5]=a*w+s*M+h*P+u*A,N[9]=a*_+s*E+h*D+u*I,N[13]=a*b+s*C+h*R+u*L,N[2]=c*x+l*S+d*T+p*O,N[6]=c*w+l*M+d*P+p*A,N[10]=c*_+l*E+d*D+p*I,N[14]=c*b+l*C+d*R+p*L,N[3]=f*x+m*S+g*T+y*O,N[7]=f*w+m*M+g*P+y*A,N[11]=f*_+m*E+g*D+y*I,N[15]=f*b+m*C+g*R+y*L,this},i.prototype.mul2=function(t,e){var r=t.data,i=r[0],o=r[4],n=r[8],a=r[12],s=r[1],h=r[5],u=r[9],c=r[13],l=r[2],d=r[6],p=r[10],f=r[14],m=r[3],g=r[7],y=r[11],v=r[15],x=e.data,w=x[0],_=x[4],b=x[8],S=x[12],M=x[1],E=x[5],C=x[9],T=x[13],P=x[2],D=x[6],R=x[10],O=x[14],A=x[3],I=x[7],L=x[11],N=x[15],B=this.data;return B[0]=i*w+o*M+n*P+a*A,B[4]=i*_+o*E+n*D+a*I,B[8]=i*b+o*C+n*R+a*L,B[12]=i*S+o*T+n*O+a*N,B[1]=s*w+h*M+u*P+c*A,B[5]=s*_+h*E+u*D+c*I,B[9]=s*b+h*C+u*R+c*L,B[13]=s*S+h*T+u*O+c*N,B[2]=l*w+d*M+p*P+f*A,B[6]=l*_+d*E+p*D+f*I,B[10]=l*b+d*C+p*R+f*L,B[14]=l*S+d*T+p*O+f*N,B[3]=m*w+g*M+y*P+v*A,B[7]=m*_+g*E+y*D+v*I,B[11]=m*b+g*C+y*R+v*L,B[15]=m*S+g*T+y*O+v*N,this},i.prototype.transpose=function(){var t=this.data,e=t[4],r=t[8],i=t[12],o=t[9],n=t[13],a=t[14];return t[4]=t[1],t[8]=t[2],t[12]=t[3],t[9]=t[6],t[13]=t[7],t[14]=t[11],t[1]=e,t[2]=r,t[3]=i,t[6]=o,t[7]=n,t[11]=a,this},i.invert=function(t,e){if(e||(e=new i),e===t)return e.copy(i.invert(t));var r=t.determinant();if(!r)return e;var o=t.data,n=e.data;return r=1/r,n[0]=(o[5]*(o[10]*o[15]-o[14]*o[11])-o[9]*(o[6]*o[15]-o[14]*o[7])+o[13]*(o[6]*o[11]-o[10]*o[7]))*r,n[1]=(o[1]*(o[14]*o[11]-o[10]*o[15])-o[9]*(o[14]*o[3]-o[2]*o[15])+o[13]*(o[10]*o[3]-o[2]*o[11]))*r,n[2]=(o[1]*(o[6]*o[15]-o[14]*o[7])-o[5]*(o[2]*o[15]-o[14]*o[3])+o[13]*(o[2]*o[7]-o[6]*o[3]))*r,n[3]=(o[1]*(o[10]*o[7]-o[6]*o[11])-o[5]*(o[10]*o[3]-o[2]*o[11])+o[9]*(o[6]*o[3]-o[2]*o[7]))*r,n[4]=(o[4]*(o[14]*o[11]-o[10]*o[15])-o[8]*(o[14]*o[7]-o[6]*o[15])+o[12]*(o[10]*o[7]-o[6]*o[11]))*r,n[5]=(o[0]*(o[10]*o[15]-o[14]*o[11])-o[8]*(o[2]*o[15]-o[14]*o[3])+o[12]*(o[2]*o[11]-o[10]*o[3]))*r,n[6]=(o[0]*(o[14]*o[7]-o[6]*o[15])-o[4]*(o[14]*o[3]-o[2]*o[15])+o[12]*(o[6]*o[3]-o[2]*o[7]))*r,n[7]=(o[0]*(o[6]*o[11]-o[10]*o[7])-o[4]*(o[2]*o[11]-o[10]*o[3])+o[8]*(o[2]*o[7]-o[6]*o[3]))*r,n[8]=(o[4]*(o[9]*o[15]-o[13]*o[11])-o[8]*(o[5]*o[15]-o[13]*o[7])+o[12]*(o[5]*o[11]-o[9]*o[7]))*r,n[9]=(o[0]*(o[13]*o[11]-o[9]*o[15])-o[8]*(o[13]*o[3]-o[1]*o[15])+o[12]*(o[9]*o[3]-o[1]*o[11]))*r,n[10]=(o[0]*(o[5]*o[15]-o[13]*o[7])-o[4]*(o[1]*o[15]-o[13]*o[3])+o[12]*(o[1]*o[7]-o[5]*o[3]))*r,n[11]=(o[0]*(o[9]*o[7]-o[5]*o[11])-o[4]*(o[9]*o[3]-o[1]*o[11])+o[8]*(o[5]*o[3]-o[1]*o[7]))*r,n[12]=(o[4]*(o[13]*o[10]-o[9]*o[14])-o[8]*(o[13]*o[6]-o[5]*o[14])+o[12]*(o[9]*o[6]-o[5]*o[10]))*r,n[13]=(o[0]*(o[9]*o[14]-o[13]*o[10])-o[8]*(o[1]*o[14]-o[13]*o[2])+o[12]*(o[1]*o[10]-o[9]*o[2]))*r,n[14]=(o[0]*(o[13]*o[6]-o[5]*o[14])-o[4]*(o[13]*o[2]-o[1]*o[14])+o[12]*(o[5]*o[2]-o[1]*o[6]))*r,n[15]=(o[0]*(o[5]*o[10]-o[9]*o[6])-o[4]*(o[1]*o[10]-o[9]*o[2])+o[8]*(o[1]*o[6]-o[5]*o[2]))*r,e},i.prototype.invert=function(){return i.invert(this,this)},i.prototype.isOrthogonal=function(){var e;return e=this.e00*this.e01+this.e10*this.e11+this.e20*this.e21+this.e30*this.e31,Math.abs(e)>t.EPSILON?!1:(e=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22+this.e30*this.e32,Math.abs(e)>t.EPSILON?!1:(e=this.e00*this.e03+this.e10*this.e13+this.e20*this.e23+this.e30*this.e33,Math.abs(e)>t.EPSILON?!1:(e=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22+this.e31*this.e32,Math.abs(e)>t.EPSILON?!1:(e=this.e01*this.e03+this.e11*this.e13+this.e21*this.e23+this.e31*this.e33,Math.abs(e)>t.EPSILON?!1:(e=this.e02*this.e03+this.e12*this.e13+this.e22*this.e23+this.e32*this.e33,Math.abs(e)>t.EPSILON?!1:!0)))))},i.prototype.isNormal=function(){var e;return e=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20+this.e30*this.e30,Math.abs(e-1)>t.EPSILON?!1:(e=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21+this.e31*this.e31,Math.abs(e-1)>t.EPSILON?!1:(e=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22+this.e32*this.e32,Math.abs(e-1)>t.EPSILON?!1:(e=this.e03*this.e03+this.e13*this.e13+this.e23*this.e23+this.e33*this.e33,Math.abs(e-1)>t.EPSILON?!1:!0)))},i.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},i.prototype.determinant=function(){var t=this.data,e=t[5]*t[10]*t[15]+t[9]*t[14]*t[7]+t[13]*t[6]*t[11]-t[13]*t[10]*t[7]-t[9]*t[6]*t[15]-t[5]*t[14]*t[11],r=t[1]*t[10]*t[15]+t[9]*t[14]*t[3]+t[13]*t[2]*t[11]-t[13]*t[10]*t[3]-t[9]*t[2]*t[15]-t[1]*t[14]*t[11],i=t[1]*t[6]*t[15]+t[5]*t[14]*t[3]+t[13]*t[2]*t[7]-t[13]*t[6]*t[3]-t[5]*t[2]*t[15]-t[1]*t[14]*t[7],o=t[1]*t[6]*t[11]+t[5]*t[10]*t[3]+t[9]*t[2]*t[7]-t[9]*t[6]*t[3]-t[5]*t[2]*t[11]-t[1]*t[10]*t[7];return t[0]*e-t[4]*r+t[8]*i-t[12]*o},i.prototype.setIdentity=function(){var t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},i.prototype.setRotationFromVector=function(t){var e=Math.sin(t.x),r=Math.cos(t.x),i=Math.sin(t.y),o=Math.cos(t.y),n=Math.sin(t.z),a=Math.cos(t.z);return this.e00=a*o,this.e10=n*o,this.e20=0-i,this.e01=a*i*e-n*r,this.e11=n*i*e+a*r,this.e21=o*e,this.e02=a*i*r+n*e,this.e12=n*i*r-a*e,this.e22=o*r,this},i.prototype.setRotationFromQuaternion=function(t){var e=t.lengthSquared();e=e>0?2/e:0;var r=t.x*e,i=t.y*e,o=t.z*e,n=t.w*r,a=t.w*i,s=t.w*o,h=t.x*r,u=t.x*i,c=t.x*o,l=t.y*i,d=t.y*o,p=t.z*o;return this.e00=1-l-p,this.e10=u+s,this.e20=c-a,this.e01=u-s,this.e11=1-h-p,this.e21=d+n,this.e02=c+a,this.e12=d-n,this.e22=1-h-l,this},i.prototype.setTranslation=function(t){return this.e03=t.x,this.e13=t.y,this.e23=t.z,this},i.prototype.getTranslation=function(t){return t.x=this.data[12],t.y=this.data[13],t.z=this.data[14],this},i.prototype.getRotation=function(t){var e=this.data,r=t.data;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],this},i.prototype.getScale=function(t){var e=Math.sqrt(t.setDirect(this.data[0],this.data[4],this.data[8]).lengthSquared()),r=Math.sqrt(t.setDirect(this.data[1],this.data[5],this.data[9]).lengthSquared()),i=Math.sqrt(t.setDirect(this.data[2],this.data[6],this.data[10]).lengthSquared());return t.x=e,t.y=r,t.z=i,this},i.prototype.setScale=function(t){return this.e00*=t.x,this.e10*=t.y,this.e20*=t.z,this.e01*=t.x,this.e11*=t.y,this.e21*=t.z,this.e02*=t.x,this.e12*=t.y,this.e22*=t.z,this},i.prototype.equals=function(e){var r=this.data,i=e.data;return Math.abs(r[0]-i[0])<=t.EPSILON&&Math.abs(r[1]-i[1])<=t.EPSILON&&Math.abs(r[2]-i[2])<=t.EPSILON&&Math.abs(r[3]-i[3])<=t.EPSILON&&Math.abs(r[4]-i[4])<=t.EPSILON&&Math.abs(r[5]-i[5])<=t.EPSILON&&Math.abs(r[6]-i[6])<=t.EPSILON&&Math.abs(r[7]-i[7])<=t.EPSILON&&Math.abs(r[8]-i[8])<=t.EPSILON&&Math.abs(r[9]-i[9])<=t.EPSILON&&Math.abs(r[10]-i[10])<=t.EPSILON&&Math.abs(r[11]-i[11])<=t.EPSILON&&Math.abs(r[12]-i[12])<=t.EPSILON&&Math.abs(r[13]-i[13])<=t.EPSILON&&Math.abs(r[14]-i[14])<=t.EPSILON&&Math.abs(r[15]-i[15])<=t.EPSILON},i.prototype.copy=function(t){var e=this.data,r=t.data;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},i.prototype.setArray=function(t){var e=this.data;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this},i.prototype.set=i.prototype.copy,i.prototype.clone=function(){return(new i).copy(this)},i.add=r.warnOnce("Matrix4.add is deprecated, use Matrix4.prototype.add instead",function(t,e,r){return r||(r=new i),e instanceof i?(r.e00=t.e00+e.e00,r.e10=t.e10+e.e10,r.e20=t.e20+e.e20,r.e30=t.e30+e.e30,r.e01=t.e01+e.e01,r.e11=t.e11+e.e11,r.e21=t.e21+e.e21,r.e31=t.e31+e.e31,r.e02=t.e02+e.e02,r.e12=t.e12+e.e12,r.e22=t.e22+e.e22,r.e32=t.e32+e.e32,r.e03=t.e03+e.e03,r.e13=t.e13+e.e13,r.e23=t.e23+e.e23,r.e33=t.e33+e.e33):(r.e00=t.e00+e,r.e10=t.e10+e,r.e20=t.e20+e,r.e30=t.e30+e,r.e01=t.e01+e,r.e11=t.e11+e,r.e21=t.e21+e,r.e31=t.e31+e,r.e02=t.e02+e,r.e12=t.e12+e,r.e22=t.e22+e,r.e32=t.e32+e,r.e03=t.e03+e,r.e13=t.e13+e,r.e23=t.e23+e,r.e33=t.e33+e),r}),i.sub=r.warnOnce("Matrix4.sub is deprecated",function(t,e,r){return r||(r=new i),e instanceof i?(r.e00=t.e00-e.e00,r.e10=t.e10-e.e10,r.e20=t.e20-e.e20,r.e30=t.e30-e.e30,r.e01=t.e01-e.e01,r.e11=t.e11-e.e11,r.e21=t.e21-e.e21,r.e31=t.e31-e.e31,r.e02=t.e02-e.e02,r.e12=t.e12-e.e12,r.e22=t.e22-e.e22,r.e32=t.e32-e.e32,r.e03=t.e03-e.e03,r.e13=t.e13-e.e13,r.e23=t.e23-e.e23,r.e33=t.e33-e.e33):(r.e00=t.e00-e,r.e10=t.e10-e,r.e20=t.e20-e,r.e30=t.e30-e,r.e01=t.e01-e,r.e11=t.e11-e,r.e21=t.e21-e,r.e31=t.e31-e,r.e02=t.e02-e,r.e12=t.e12-e,r.e22=t.e22-e,r.e32=t.e32-e,r.e03=t.e03-e,r.e13=t.e13-e,r.e23=t.e23-e,r.e33=t.e33-e),r}),i.mul=r.warnOnce("Matrix4.mul is deprecated, use Matrix4.prototype.mul instead",function(t,e,r){return r||(r=new i),e instanceof i?(r.e00=t.e00*e.e00,r.e10=t.e10*e.e10,r.e20=t.e20*e.e20,r.e30=t.e30*e.e30,r.e01=t.e01*e.e01,r.e11=t.e11*e.e11,r.e21=t.e21*e.e21,r.e31=t.e31*e.e31,r.e02=t.e02*e.e02,r.e12=t.e12*e.e12,r.e22=t.e22*e.e22,r.e32=t.e32*e.e32,r.e03=t.e03*e.e03,r.e13=t.e13*e.e13,r.e23=t.e23*e.e23,r.e33=t.e33*e.e33):(r.e00=t.e00*e,r.e10=t.e10*e,r.e20=t.e20*e,r.e30=t.e30*e,r.e01=t.e01*e,r.e11=t.e11*e,r.e21=t.e21*e,r.e31=t.e31*e,r.e02=t.e02*e,r.e12=t.e12*e,r.e22=t.e22*e,r.e32=t.e32*e,r.e03=t.e03*e,r.e13=t.e13*e,r.e23=t.e23*e,r.e33=t.e33*e),r}),i.div=r.warnOnce("Matrix4.div is deprecated",function(t,e,r){return r||(r=new i),e instanceof i?(r.e00=t.e00/e.e00,r.e10=t.e10/e.e10,r.e20=t.e20/e.e20,r.e30=t.e30/e.e30,r.e01=t.e01/e.e01,r.e11=t.e11/e.e11,r.e21=t.e21/e.e21,r.e31=t.e31/e.e31,r.e02=t.e02/e.e02,r.e12=t.e12/e.e12,r.e22=t.e22/e.e22,r.e32=t.e32/e.e32,r.e03=t.e03/e.e03,r.e13=t.e13/e.e13,r.e23=t.e23/e.e23,r.e33=t.e33/e.e33):(e=1/e,r.e00=t.e00*e,r.e10=t.e10*e,r.e20=t.e20*e,r.e30=t.e30*e,r.e01=t.e01*e,r.e11=t.e11*e,r.e21=t.e21*e,r.e31=t.e31*e,r.e02=t.e02*e,r.e12=t.e12*e,r.e22=t.e22*e,r.e32=t.e32*e,r.e03=t.e03*e,r.e13=t.e13*e,r.e23=t.e23*e,r.e33=t.e33*e),r}),i.prototype.div=r.warnOnce("Matrix4.prototype.div is deprecated",function(t){return i.div(this,t,this)}),i.combine=r.warnOnce("Matrix4.combine is deprecated, use Matrix4.prototype.mul instead",function(t,e,r){r||(r=new i);var o=t.data,n=o[0],a=o[4],s=o[8],h=o[12],u=o[1],c=o[5],l=o[9],d=o[13],p=o[2],f=o[6],m=o[10],g=o[14],y=o[3],v=o[7],x=o[11],w=o[15],_=e.data,b=_[0],S=_[4],M=_[8],E=_[12],C=_[1],T=_[5],P=_[9],D=_[13],R=_[2],O=_[6],A=_[10],I=_[14],L=_[3],N=_[7],B=_[11],z=_[15],k=r.data;return k[0]=n*b+a*C+s*R+h*L,k[4]=n*S+a*T+s*O+h*N,k[8]=n*M+a*P+s*A+h*B,k[12]=n*E+a*D+s*I+h*z,k[1]=u*b+c*C+l*R+d*L,k[5]=u*S+c*T+l*O+d*N,k[9]=u*M+c*P+l*A+d*B,k[13]=u*E+c*D+l*I+d*z,k[2]=p*b+f*C+m*R+g*L,k[6]=p*S+f*T+m*O+g*N,k[10]=p*M+f*P+m*A+g*B,k[14]=p*E+f*D+m*I+g*z,k[3]=y*b+v*C+x*R+w*L,k[7]=y*S+v*T+x*O+w*N,k[11]=y*M+v*P+x*A+w*B,k[15]=y*E+v*D+x*I+w*z,r}),i.prototype.combine=r.warnOnce("Matrix4.prototype.combine is deprecated, use Matrix4.prototype.mul instead",function(t){return i.combine(this,t,this)}),i.transpose=r.warnOnce("Matrix4.transpose is deprecated, use Matrix4.prototype.transpose instead",function(t,e){e||(e=new i);var r=t.data,o=e.data;if(e===t){var n=r[4],a=r[8],s=r[12],h=r[9],u=r[13],c=r[14];return o[4]=r[1],o[8]=r[2],o[12]=r[3],o[9]=r[6],o[13]=r[7],o[14]=r[11],o[1]=n,o[2]=a,o[3]=s,o[6]=h,o[7]=u,o[11]=c,e}return o[0]=r[0],o[1]=r[4],o[2]=r[8],o[3]=r[12],o[4]=r[1],o[5]=r[5],o[6]=r[9],o[7]=r[13],o[8]=r[2],o[9]=r[6],o[10]=r[10],o[11]=r[14],o[12]=r[3],o[13]=r[7],o[14]=r[11],o[15]=r[15],e}),i.prototype.applyPre=r.warnOnce("Matrix4.prototype.applyPre is deprecated, use Vector4.prototype.applyPre instead",function(t){var e=t.x,r=t.y,i=t.z,o=t.w,n=this.data;return t.x=n[0]*e+n[1]*r+n[2]*i+n[3]*o,t.y=n[4]*e+n[5]*r+n[6]*i+n[7]*o,t.z=n[8]*e+n[9]*r+n[10]*i+n[11]*o,t.w=n[12]*e+n[13]*r+n[14]*i+n[15]*o,t}),i.prototype.applyPost=r.warnOnce("Matrix4.prototype.applyPost is deprecated, use Vector4.prototype.applyPost instead",function(t){var e=t.x,r=t.y,i=t.z,o=t.w,n=this.data;return t.x=n[0]*e+n[4]*r+n[8]*i+n[12]*o,t.y=n[1]*e+n[5]*r+n[9]*i+n[13]*o,t.z=n[2]*e+n[6]*r+n[10]*i+n[14]*o,t.w=n[3]*e+n[7]*r+n[11]*i+n[15]*o,t}),i.prototype.applyPostPoint=r.warnOnce("Matrix4.prototype.applyPostPoint is deprecated, use Vector4.prototype.applyPostPoint instead",function(t){return t.applyPostPoint(this)}),i.prototype.applyPostVector=r.warnOnce("Matrix4.prototype.applyPostVector is deprecated, use Vector4.prototype.applyPostVector instead",function(t){var e=t.x,r=t.y,i=t.z,o=this.data;return t.x=o[0]*e+o[4]*r+o[8]*i,t.y=o[1]*e+o[5]*r+o[9]*i,t.z=o[2]*e+o[6]*r+o[10]*i,t}),i}(goo.MathUtils,goo.Matrix,goo.ObjectUtils),goo.Transform=function(t,e,r,i){"use strict";function o(){this.matrix=new r,this.normalMatrix=new e,this.translation=new t,this.rotation=new e,this.scale=new t(1,1,1)}var n=new t,a=new t,s=new e;return o.combine=function(t,e,r){return r=r||new o,n.set(e.translation),n.applyPost(t.rotation),n.mul(t.scale),n.add(t.translation),a.set(e.scale),a.mul(t.scale),s.mul2(t.rotation,e.rotation),r.rotation.copy(s),r.scale.set(a),r.translation.set(n),r.update(),r},o.prototype.combine=function(t){return o.combine(this,t,this)},o.prototype.multiply=function(t,e){return this.matrix.mul2(t.matrix,e.matrix),s.data.set(t.rotation.data),this.rotation.data.set(e.rotation.data),this.rotation.mul2(s,this.rotation),this.translation.set(e.translation),this.translation.mul(t.scale),this.translation.applyPost(s).add(t.translation),n.set(t.scale).mul(e.scale),this.scale.set(n),this},o.prototype.setIdentity=function(){return this.matrix.setIdentity(),this.translation.set(t.ZERO),this.rotation.setIdentity(),this.scale.set(t.ONE),this},o.prototype.applyForward=function(t,e){return e.set(t),e.applyPostPoint(this.matrix),e},o.prototype.applyForwardVector=function(t,e){return e.copy(t),e.setDirect(e.x*this.scale.x,e.y*this.scale.y,e.z*this.scale.z),e.applyPost(this.rotation),e},o.prototype.update=function(){var t=this.matrix.data,e=this.rotation.data,r=this.scale,i=this.translation;return t[0]=r.x*e[0],t[1]=r.x*e[1],t[2]=r.x*e[2],t[3]=0,t[4]=r.y*e[3],t[5]=r.y*e[4],t[6]=r.y*e[5],t[7]=0,t[8]=r.z*e[6],t[9]=r.z*e[7],t[10]=r.z*e[8],t[11]=0,t[12]=i.x,t[13]=i.y,t[14]=i.z,t[15]=1,this},o.prototype.updateNormalMatrix=function(){var t=this.normalMatrix.data,e=this.matrix.data;t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10];var r=this.scale;return(r.x!==r.y||r.x!==r.z)&&this.normalMatrix.invert().transpose(),this},o.prototype.copy=function(t){return this.matrix.copy(t.matrix),this.translation.set(t.translation),this.rotation.copy(t.rotation),this.scale.set(t.scale),this},o.prototype.setRotationXYZ=function(t,e,r){return this.rotation.fromAngles(t,e,r),this},o.prototype.lookAt=function(e,r){return r||(r=t.UNIT_Y),n.set(e).sub(this.translation),n.lengthSquared()>i.EPSILON&&(n.normalize(),this.rotation.lookAt(n,r)),this},o.prototype.invert=function(e){var r=e;r||(r=new o),r.matrix.copy(this.matrix),r.matrix.invert();var i=r.rotation.copy(this.rotation);return i.transpose(),r.scale.set(t.ONE).div(this.scale),r.translation.copy(this.translation).negate().mul(r.scale),r.translation.applyPost(r.rotation),r},o.prototype.clone=function(){var t=new o;return t.matrix.copy(this.matrix),t.normalMatrix.copy(this.normalMatrix),t.translation.copy(this.translation),t.rotation.copy(this.rotation),t.scale.copy(this.scale),t},o}(goo.Vector3,goo.Matrix3,goo.Matrix4,goo.MathUtils),goo.TransformComponent=function(t,e,r,i){"use strict";function o(){r.apply(this,arguments),this.type="TransformComponent",this.entity=null,this.parent=null,this.children=[],this.transform=new t,this.worldTransform=new t,this._dirty=!0,this._updated=!1}o.type="TransformComponent",o.prototype=Object.create(r.prototype),o.prototype.constructor=o,o.prototype.api={setTranslation:function(){return o.prototype.setTranslation.apply(this.transformComponent,arguments),this},setRotation:function(){return o.prototype.setRotation.apply(this.transformComponent,arguments),this},setScale:function(){return o.prototype.setScale.apply(this.transformComponent,arguments),this},lookAt:function(){return o.prototype.lookAt.apply(this.transformComponent,arguments),this},move:function(){return o.prototype.move.apply(this.transformComponent,arguments),this},getTranslation:function(){return o.prototype.getTranslation.apply(this.transformComponent,arguments)},getRotation:function(){return o.prototype.getRotation.apply(this.transformComponent,arguments)},getScale:function(){return o.prototype.getScale.apply(this.transformComponent,arguments)},addTranslation:function(){return o.prototype.addTranslation.apply(this.transformComponent,arguments),this},addRotation:function(){return o.prototype.addRotation.apply(this.transformComponent,arguments),this},attachChild:function(t,e){return this.transformComponent.attachChild(t.transformComponent,e),this},detachChild:function(t,e){return this.transformComponent.detachChild(t.transformComponent,e),this},children:function(){return new i(this).children()},parent:function(){return new i(this).parent()},traverse:function(t,e){if(e=void 0!==e?e:0,t(this,e)!==!1)for(var r=0;r<this.transformComponent.children.length;r++){var i=this.transformComponent.children[r].entity;i.traverse(t,e+1)}return this},traverseUp:function(t){for(var e=this.transformComponent;t(e.entity)!==!1&&e.parent;)e=e.parent;return this},hide:function(){return this._hidden=!0,this.traverse(function(t){for(var e=0;e<t._components.length;e++){var r=t._components[e];"boolean"==typeof r.hidden&&(r.hidden=!0)}}),this},show:function(){this._hidden=!1;for(var t=this;t.transformComponent.parent;)if(t=t.transformComponent.parent.entity,t._hidden){for(var e=0;e<this._components.length;e++){var r=this._components[e];"boolean"==typeof r.hidden&&(r.hidden=!0)}return this}return this.traverse(function(t){if(t._hidden)return!1;for(var e=0;e<t._components.length;e++){var r=t._components[e];"boolean"==typeof r.hidden&&(r.hidden=t._hidden)}}),this},isVisiblyHidden:function(){var t=this;if(t._hidden)return!0;for(;t.transformComponent.parent;)if(t=t.transformComponent.parent.entity,t._hidden)return!0;return!1},isHidden:function(){return this._hidden}},o.entitySelectionAPI={setTranslation:o.prototype.api.setTranslation,setRotation:o.prototype.api.setRotation,setScale:o.prototype.api.setScale,lookAt:o.prototype.api.lookAt,move:o.prototype.api.move,addTranslation:o.prototype.api.addTranslation,addRotation:o.prototype.api.addRotation,hide:o.prototype.api.hide,show:o.prototype.api.show};var n=new e;return o.prototype.getTranslation=function(){return this.transform.translation},o.prototype.setTranslation=function(){return this.transform.translation.set(e.fromAny.apply(null,arguments)),this._dirty=!0,this},o.prototype.getScale=function(){return this.transform.scale},o.prototype.setScale=function(){return this.transform.scale.set(e.fromAny.apply(null,arguments)),this._dirty=!0,this},o.prototype.addTranslation=function(){return this.transform.translation.add(e.fromAny.apply(null,arguments)),this._dirty=!0,this},o.prototype.getRotation=function(t){return t=t||new e,this.transform.rotation.toAngles(t)},o.prototype.addRotation=function(){if(this.getRotation(n),1===arguments.length&&"object"==typeof arguments[0]){var t=arguments[0];t instanceof e?this.transform.rotation.fromAngles(n.x+t.x,n.y+t.y,n.z+t.z):3===t.length&&this.transform.rotation.fromAngles(n.x+t[0],n.y+t[1],n.z+t[2])}else this.transform.rotation.fromAngles(n.x+arguments[0],n.y+arguments[1],n.z+arguments[2]);return this._dirty=!0,this},o.prototype.setRotation=function(){if(1===arguments.length&&"object"==typeof arguments[0]){var t=arguments[0];t instanceof e?this.transform.rotation.fromAngles(t.x,t.y,t.z):3===t.length&&this.transform.rotation.fromAngles(t[0],t[1],t[2])}else this.transform.rotation.fromAngles(arguments[0],arguments[1],arguments[2]);return this._dirty=!0,this},o.prototype.lookAt=function(t,r){return 3===arguments.length?this.transform.lookAt(new e(arguments[0],arguments[1],arguments[2])):t.transformComponent?(t.transformComponent._dirty&&t.transformComponent.updateWorldTransform(),this.transform.lookAt(t.transformComponent.worldTransform.translation,r)):(Array.isArray(t)&&(t=e.fromArray(t)),Array.isArray(r)&&(r=e.fromArray(r)),this.transform.lookAt(t,r)),this._dirty=!0,this},o.prototype.move=function(){var t=new e;return function(){var r=e.fromAny.apply(null,arguments);return this.transform.applyForwardVector(r,t),this.addTranslation(t),this}}(),o.prototype.setUpdated=function(){this._dirty=!0},o.prototype.attached=function(t){this.entity=t},o.prototype.detached=function(){this.entity=void 0},o.prototype.attachChild=function(t,e){for(var r=this;r;){if(r===t)return void console.warn("attachChild: An object can't be added as a descendant of itself.");r=r.parent}t.parent&&t.parent.detachChild(t),e&&(t.updateTransform(),this.updateTransform(),this.updateWorldTransform(),t.transform.multiply(this.worldTransform.invert(),t.transform)),t.parent=this,this.children.push(t)},o.prototype.detachChild=function(t,e){if(t===this)return void console.warn("detachChild: An object can't be removed from itself.");e&&t.transform.copy(t.worldTransform);var r=this.children.indexOf(t);-1!==r&&(t.parent=null,this.children.splice(r,1))},o.prototype.updateTransform=function(){this.transform.update()},o.prototype.updateWorldTransform=function(){this.parent?this.worldTransform.multiply(this.parent.worldTransform,this.transform):this.worldTransform.copy(this.transform),
this.worldTransform.updateNormalMatrix(),this._dirty=!1,this._updated=!0},o.applyOnEntity=function(r,i){var n=i.transformComponent;n||(n=new o);var a=!1;return Array.isArray(r)&&3===r.length?(n.transform.translation.setDirect(r[0],r[1],r[2]),a=!0):r instanceof e?(n.transform.translation.setDirect(r.x,r.y,r.z),a=!0):"object"==typeof r&&"undefined"!=typeof r.x&&"undefined"!=typeof r.y&&"undefined"!=typeof r.z?(n.transform.translation.setDirect(r.x,r.y,r.z),a=!0):r instanceof t&&(n.transform=r,a=!0),a?(n.setUpdated(),i.setComponent(n),!0):void 0},o}(goo.Transform,goo.Vector3,goo.Component,goo.EntitySelection),goo.System=function(){"use strict";function t(t,e){this.type=t,this.interests=e,this._activeEntities=[],this.passive=!1,this.priority=0}function e(t){return t.charAt(0).toLowerCase()+t.substr(1)}return t.prototype.added=function(t){this._check(t)},t.prototype.changed=function(t){this._check(t)},t.prototype.removed=function(t){var e=this._activeEntities.indexOf(t);-1!==e&&(this._activeEntities.splice(e,1),this.deleted&&this.deleted(t))},t.prototype.setup=function(t){t.entityManager.getEntities().forEach(this._check.bind(this))},t.prototype.cleanup=function(){if(this.deleted)for(var t=0;t<this._activeEntities.length;t++){var e=this._activeEntities[t];this.deleted(e)}},t.prototype._check=function(t){if(!this.interests||0!==this.interests.length){var r=null===this.interests;if(!r&&this.interests.length<=t._components.length){r=!0;for(var i=0;i<this.interests.length;i++){var o=e(this.interests[i]);if(!t[o]){r=!1;break}}}var n=this._activeEntities.indexOf(t);r&&-1===n?(this._activeEntities.push(t),this.inserted&&this.inserted(t)):r||-1===n||(this._activeEntities.splice(n,1),this.deleted&&this.deleted(t))}},t.prototype._process=function(t){this.process&&this.process(this._activeEntities,t)},t.prototype.clear=function(){this._activeEntities=[]},t}(),goo.World=function(t,e,r,i,o,n,a){"use strict";function s(t){this.gooRunner=t,this._managers=[],this._systems=[],this._addedEntities=[],this._changedEntities=[],this._removedEntities=[],this.by={},this._installDefaultSelectors(),this.entityManager=new e,this.setManager(this.entityManager),this.time=0,this.tpf=1,this._components=[]}return s.time=0,s.tpf=1,s.prototype._installDefaultSelectors=function(){this.by.system=function(t){var e=this.getSystem(t);return new a(e._activeEntities)}.bind(this),this.by.component=function(t){var e=this.entityManager.getEntities();return new a(e.filter(function(e){return e.hasComponent(t)}))}.bind(this),this.by.tag=function(t){var e=this.entityManager.getEntities();return new a(e.filter(function(e){return e.hasTag(t)}))}.bind(this),this.by.attribute=function(t){var e=this.entityManager.getEntities();return new a(e.filter(function(e){return e.hasAttribute(t)}))}.bind(this)},s.prototype.add=function(){for(var e=0;e<arguments.length;e++){var r=arguments[e];r instanceof t?this.addEntity(r):r instanceof i?this.setManager(r):r instanceof o?this.setSystem(r):r instanceof n&&this.registerComponent(r)}return this},s.prototype.registerComponent=function(t){return-1===this._components.indexOf(t)&&(this._components.push(t),n.applyEntitySelectionAPI(t.entitySelectionAPI,t.type)),this},s.prototype.setManager=function(t){return this._managers.push(t),t.applyAPI(this.by),this},s.prototype.getManager=function(t){for(var e=0;e<this._managers.length;e++){var r=this._managers[e];if(r.type===t)return r}},s.prototype.setSystem=function(t){if(-1!==this._systems.indexOf(t))return this;for(var e=t.priority,r=0;r<this._systems.length&&!(this._systems[r].priority>e);r++);return this._systems.splice(r,0,t),t.setup&&t.setup(this),this},s.prototype.getSystem=function(t){for(var e=0;e<this._systems.length;e++){var r=this._systems[e];if(r.type===t)return r}},s.prototype.clearSystem=function(t){for(var e=0;e<this._systems.length;e++){var r=this._systems[e];r.type===t&&(r.cleanup&&r.cleanup(),this._systems.splice(e,1))}return this},s.prototype.createEntity=function(){for(var e=new t(this),i=0;i<arguments.length;i++)"string"==typeof arguments[i]?e.name=arguments[i]:e.set(arguments[i]);return e.transformComponent||e.setComponent(new r),e},s.prototype.getEntities=function(){return this.entityManager.getEntities()},s.prototype.addEntity=function(t,e){if(-1===this._addedEntities.indexOf(t)&&this._addedEntities.push(t),t.transformComponent&&(void 0===e||e===!0))for(var r=t.transformComponent.children,i=0;i<r.length;i++)this.addEntity(r[i].entity,e);for(var i=0;i<this._managers.length;i++){var o=this._managers[i];o.added(t)}return this},s.prototype.removeEntity=function(t,e){-1===this._removedEntities.indexOf(t)&&this._removedEntities.push(t);var r=t.transformComponent;if(r.parent&&(r.parent.detachChild(r),r.parent=null),e===!1){for(var i=r.children,o=0;o<i.length;o++)i[o].parent=null;r.children=[]}else for(var i=r.children,o=0;o<i.length;o++)this._recursiveRemoval(i[o].entity,e);for(var o=0;o<this._managers.length;o++){var n=this._managers[o];n.removed(t)}return this},s.prototype._recursiveRemoval=function(t,e){-1===this._removedEntities.indexOf(t)&&this._removedEntities.push(t);for(var r=0;r<this._managers.length;r++){var i=this._managers[r];i.removed(t)}if(t.transformComponent&&(void 0===e||e===!0))for(var o=t.transformComponent.children,r=0;r<o.length;r++)this._recursiveRemoval(o[r].entity,e)},s.prototype.changedEntity=function(t,e,r){var i={entity:t};void 0!==e&&(i.component=e),void 0!==r&&(i.eventType=r),this._changedEntities.push(i)},s.prototype.processEntityChanges=function(){this._check(this._addedEntities,function(t,e){if(t.added&&t.added(e),t.addedComponent)for(var r=0;r<e._components.length;r++)t.addedComponent(e,e._components[r])}),this._check(this._changedEntities,function(t,e){t.changed&&t.changed(e.entity),void 0!==e.eventType&&t[e.eventType]&&t[e.eventType](e.entity,e.component)}),this._check(this._removedEntities,function(t,e){if(t.removed&&t.removed(e),t.removedComponent)for(var r=0;r<e._components.length;r++)t.removedComponent(e,e._components[r])})},s.prototype.process=function(){this.processEntityChanges();for(var t=0;t<this._systems.length;t++){var e=this._systems[t];e.passive||e._process(this.tpf)}},s.prototype._check=function(t,e){for(var r=0;r<t.length;r++)for(var i=t[r],o=0;o<this._systems.length;o++){var n=this._systems[o];e(n,i)}t.length=0},s.prototype.clear=function(){for(var t=0;t<this._systems.length;t++){var e=this._systems[t];e.clear&&e.clear()}this._systems=[];for(var r=this.entityManager.getEntities(),t=0;t<r.length;t++){var i=r[t];i._world=null}this.entityManager.clear(),this._addedEntities=[],this._changedEntities=[],this._removedEntities=[],this.gooRunner=null},s}(goo.Entity,goo.EntityManager,goo.TransformComponent,goo.Manager,goo.System,goo.Component,goo.EntitySelection),goo.RendererRecord=function(){"use strict";function t(){this.currentBuffer={ArrayBuffer:{buffer:null,valid:!1},ElementArrayBuffer:{buffer:null,valid:!1}},this.currentFrameBuffer=null,this.clippingTestValid=!1,this.clippingTestEnabled=!1,this.clips=[],this.enabledTextures=0,this.texturesValid=!1,this.currentTextureArraysUnit=0,this.textureRecord=[],this.usedProgram=null,this.boundAttributes=[],this.enabledAttributes=[],this.newlyEnabledAttributes=[],this.depthRecord={},this.cullRecord={},this.blendRecord={},this.offsetRecord={},this.lineRecord={},this.pointRecord={},this.shaderCache=new Map,this.attributeCache=[]}return t.prototype.invalidateBuffer=function(t){this.currentBuffer[t].buffer=null,this.currentBuffer[t].valid=!1},t}(),goo.rsvp=function(){"use strict";function t(t,e){o.async(function(){t.trigger("promise:resolved",{detail:e}),t.isResolved=!0,t.resolvedValue=e})}function e(t,e){o.async(function(){t.trigger("promise:failed",{detail:e}),t.isRejected=!0,t.rejectedValue=e})}function r(t){var e,r=[],i=new m,o=t.length;0===o&&i.resolve([]);var n=function(t,e){r[t]=e,0===--o&&i.resolve(r)},a=function(t){return function(e){n(t,e)}},s=function(t){i.reject(t)};for(e=0;o>e;e++)t[e].then(a(e),s);return i}function i(t,e){o[t]=e}var o={},n="undefined"!=typeof window?window:{},a=n.MutationObserver||n.WebKitMutationObserver,s=window.process;if("undefined"!=typeof s&&"[object process]"==={}.toString.call(s))o.async=function(t,e){s.nextTick(function(){t.call(e)})};else if(a){var h=[],u=new a(function(){var t=h.slice();h=[],t.forEach(function(t){var e=t[0],r=t[1];e.call(r)})}),c=document.createElement("div");u.observe(c,{attributes:!0}),window.addEventListener("unload",function(){u.disconnect(),u=null}),o.async=function(t,e){h.push([t,e]),c.setAttribute("drainQueue","drainQueue")}}else o.async=function(t,e){setTimeout(function(){t.call(e)},1)};var l=function(t,e){this.type=t;for(var r in e)e.hasOwnProperty(r)&&(this[r]=e[r])},d=function(t,e){for(var r=0,i=t.length;i>r;r++)if(t[r][0]===e)return r;return-1},p=function(t){var e=t._promiseCallbacks;return e||(e=t._promiseCallbacks={}),e},f={mixin:function(t){return t.on=this.on,t.off=this.off,t.trigger=this.trigger,t},on:function(t,e,r){var i,o,n=p(this);for(t=t.split(/\s+/),r=r||this;o=t.shift();)i=n[o],i||(i=n[o]=[]),-1===d(i,e)&&i.push([e,r])},off:function(t,e){var r,i,o,n=p(this);for(t=t.split(/\s+/);i=t.shift();)e?(r=n[i],o=d(r,e),-1!==o&&r.splice(o,1)):n[i]=[]},trigger:function(t,e){var r,i,o,n,a,s=p(this);if(r=s[t])for(var h=0,u=r.length;u>h;h++)i=r[h],o=i[0],n=i[1],"object"!=typeof e&&(e={detail:e}),a=new l(t,e),o.call(n,a)}},m=function(){this.on("promise:resolved",function(t){this.trigger("success",{detail:t.detail})},this),this.on("promise:failed",function(t){this.trigger("error",{detail:t.detail})},this)},g=function(){},y=function(t,e,r,i){var o,n,a,s,h="function"==typeof r;if(h)try{o=r(i.detail),a=!0}catch(u){s=!0,n=u}else o=i.detail,a=!0;o&&"function"==typeof o.then?o.then(function(t){e.resolve(t)},function(t){e.reject(t)}):h&&a?e.resolve(o):s?e.reject(n):e[t](o)};return m.prototype={then:function(t,e){var r=new m;return this.isResolved&&o.async(function(){y("resolve",r,t,{detail:this.resolvedValue})},this),this.isRejected&&o.async(function(){y("reject",r,e,{detail:this.rejectedValue})},this),this.on("promise:resolved",function(e){y("resolve",r,t,e)}),this.on("promise:failed",function(t){y("reject",r,e,t)}),r},resolve:function(e){t(this,e),this.resolve=g,this.reject=g},reject:function(t){e(this,t),this.resolve=g,this.reject=g}},f.mixin(m.prototype),{Promise:m,Event:l,EventTarget:f,all:r,configure:i}}(),goo.PromiseUtils=function(t){"use strict";function e(){}e.createPromise=function(e){var r=new t.Promise;return e(function(t){r.resolve(t)},function(t){r.reject(t)}),r},e.resolve=function(e){var r=new t.Promise;return r.resolve(e),r},e.reject=function(e){var r=new t.Promise;return r.reject(e),r};var r=!1;return e.createDummyPromise=function(e,i){r||(r=!0,console.warn("PromiseUtils.createDummyPromise is deprecated; please consider using PromiseUtils.resolve/reject instead"));var o=new t.Promise;return i?o.reject(i):o.resolve(e),o},e.optimisticAll=function(e){var r=0,i=e.length,o=[],n=new t.Promise;if(i>0)for(var a=0;i>a;a++)!function(t){e[t].then(function(e){o[t]=e,r++,r===i&&n.resolve(o)},function(e){o[t]=e,r++,r===i&&n.resolve(o)})}(a);else n.resolve(o);return n},e.delay=function(e,r){var i=new t.Promise;return setTimeout(function(){i.resolve(e)},r),i},e.defer=function(e,r){var i,o,n;return n=new t.Promise,r.apply?(i=new t.Promise,o=i.then(function(){return r()}),setTimeout(function(){i.resolve()},e),o):(setTimeout(function(){n.resolve(r)},e),n)},e}(goo.rsvp),goo.Texture=function(t,e,r){"use strict";function i(i,o,n,a){this.glTexture=null,o=o||{},r.copyOptions(this,o,{wrapS:"Repeat",wrapT:"Repeat",magFilter:"Bilinear",minFilter:"Trilinear",format:"RGBA",type:"UnsignedByte",generateMipmaps:!0,premultiplyAlpha:!1,unpackAlignment:1,flipY:!0}),this.anisotropy=void 0!==o.anisotropy?o.anisotropy:1,this.variant="2D",this.offset=o.offset?t.fromAny(o.offset):new t(0,0),this.repeat=o.repeat?t.fromAny(o.repeat):new t(1,1),this.lodBias=0,this.hasBorder=!1,this.needsUpdate=!1,this.updateCallback=null,this.readyCallback=null,this._originalImage=null,this._originalWidth=0,this._originalHeight=0,this.image=null,i&&this.setImage(i,n,a,o),this.loadImage=e.resolve.bind(null,this),this.textureRecord={}}return i.prototype.checkDataReady=function(){return this.image&&(this.image.dataReady||this.image instanceof HTMLImageElement)||null!==this.readyCallback&&this.readyCallback()},i.prototype.checkNeedsUpdate=function(){return this.needsUpdate||null!==this.updateCallback&&this.updateCallback()},i.prototype.setNeedsUpdate=function(){this.needsUpdate=!0},i.prototype.setImage=function(t,e,r,i){this._originalImage=t,this.image=t;var o=t instanceof Array?t[0]:t;if(o instanceof Uint8Array||o instanceof Uint8ClampedArray||o instanceof Uint16Array||o instanceof Float32Array){if(e=e||t.width,r=r||t.height,void 0===e||void 0===r)throw new Error("Data textures need width and height");this.image={data:t,width:e,height:r,isData:!0,dataReady:!0},o instanceof Uint8Array||o instanceof Uint8ClampedArray?this.type="UnsignedByte":o instanceof Uint16Array?(this.type="UnsignedShort565",this.format=i.format||"RGB"):o instanceof Float32Array&&(this.type="Float",this.format=i.format||"RGBA")}else t instanceof Array&&(this.image={data:t}),o instanceof HTMLCanvasElement&&(this.image.dataReady=!0);this.setNeedsUpdate(),this._originalWidth=e,this._originalHeight=r},i.prototype.destroy=function(t){t.deleteTexture(this.glTexture),this.glTexture=null},i.prototype.getSizeInMemory=function(){var t;if(!this.image)return 0;var e=this.image.width||this.image.length,r=this.image.height||1;return t=e*r,"Luminance"===this.format||"Alpha"===this.format?t*=1:"Lumin`anceAlpha"===this.format?t*=2:"RGB"===this.format?t*=3:"RGBA"===this.format?t*=4:"PrecompressedDXT1"===this.format?t*=.5:"PrecompressedDXT1A"===this.format?t*=4/6:("PrecompressedDXT3"===this.format||"PrecompressedDXT5"===this.format)&&(t*=1),this.generateMipmaps&&(t=Math.ceil(4*t/3)),t},i.prototype.clone=function(){var t={wrapS:this.wrapS,wrapT:this.wrapT,magFilter:this.magFilter,minFilter:this.minFilter,anisotropy:this.anisotropy,format:this.format,type:this.type,offset:this.offset,repeat:this.repeat,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment,flipY:this.flipY},e=new i(this._originalImage,t,this._originalWidth,this._originalHeight);return e.variant=this.variant,e.lodBias=this.lodBias,e.hasBorder=this.hasBorder,e},i.CUBE_FACES=["PositiveX","NegativeX","PositiveY","NegativeY","PositiveZ","NegativeZ"],i}(goo.Vector2,goo.PromiseUtils,goo.ObjectUtils),goo.ConfigHandler=function(t,e){"use strict";function r(t,e,r,i){this.world=t,this.getConfig=e,this.updateObject=r,this.loadObject=i,this._objects=new Map,this._loading=new Map}return r.prototype._create=function(){return{}},r.prototype._remove=function(t){this._objects["delete"](t)},r.prototype._prepare=function(t){},r.prototype._load=function(t,e){return this.loadObject(t,e)},r.prototype.load=function(t,i){var o=t.substr(t.lastIndexOf(".")+1);if(o!==this.constructor._type)throw new Error("Trying to load type"+o+" with handler for "+this._type);if(i||(i={}),!this._loading.has(t)||i.instantiate&&"machine"===r.getTypeForRef(t)){if(this._objects.has(t)&&!i.reload)return e.resolve(this._objects.get(t));var n=this.getConfig(t,i).then(function(e){return this.update(t,e,i)}.bind(this)).then(function(e){return this._loading["delete"](t),e}.bind(this)).then(null,function(e){throw this._loading["delete"](t),e}.bind(this));return n}return this._loading.get(t)},r.prototype.clear=function(){var e=[];return this._objects.forEach(function(t,r){e.push(this.update(r,null,{}))}.bind(this)),this._objects.clear(),this._loading.clear(),t.all(e)},r.prototype.update=function(t,e,r){var i=this._update(t,e,r).then(function(e){return this._loading["delete"](t),e}.bind(this));return this._loading.set(t,i),i},r.getTypeForRef=function(t){return t.substr(t.lastIndexOf(".")+1).toLowerCase()},r.prototype._update=function(t,i,o){return i?(o||(o={}),(!this._objects.has(t)||o.instantiate&&"machine"===r.getTypeForRef(t))&&this._objects.set(t,this._create()),this._prepare(i),e.resolve(this._objects.get(t))):(this._remove(t,o),e.resolve())},r.handlerClasses={},r.getHandler=function(t){return r.handlerClasses[t]},r._registerClass=function(t,e){return e._type=t,r.handlerClasses[t]=e},r}(goo.rsvp,goo.PromiseUtils),goo.DdsUtils=function(t){"use strict";function e(){}return e.isSupported=function(){return!!t.CompressedTextureS3TC},e.shiftCount=function(t){if(0===t)return 0;for(var e=0;0===(1&t);)if(t>>=1,e++,e>32)throw new Error("invalid mask!");return e},e.isSet=function(t,e){return(t&e)===e},e.getIntFromString=function(t){for(var r=[],i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return e.getIntFromBytes(r)},e.getIntFromBytes=function(t){var e=0;return e|=(255&t[0])<<0,t.length>1&&(e|=(255&t[1])<<8),t.length>2&&(e|=(255&t[2])<<16),t.length>3&&(e|=(255&t[3])<<24),e},e.getComponents=function(t){switch(t){case"Alpha":return 1;case"RGB":return 3;case"RGBA":return 4;case"Luminance":return 1;case"LuminanceAlpha":return 2;case"PrecompressedDXT1":return 1;case"PrecompressedDXT1A":return 1;case"PrecompressedDXT3":return 2;case"PrecompressedDXT5":return 2}return 0},e.flipDXT=function(t,r,i,o){for(var n=new Uint8Array(t.length),a=r+3>>2,s=i+3>>2,h=8*e.getComponents(o),u=0;s>u;u++)for(var c=s-u-1,l=0;a>l;l++){var d=(c*a+l)*h,p=(u*a+l)*h;switch(o){case"PrecompressedDXT1":case"PrecompressedDXT1A":n[d+0]=t[p+0],n[d+1]=t[p+1],n[d+2]=t[p+2],n[d+3]=t[p+3],n[d+4]=t[p+7],n[d+5]=t[p+6],n[d+6]=t[p+5],n[d+7]=t[p+4];break;case"PrecompressedDXT3":n[d+0]=t[p+6],n[d+1]=t[p+7],n[d+2]=t[p+4],n[d+3]=t[p+5],n[d+4]=t[p+2],n[d+5]=t[p+3],n[d+6]=t[p+0],n[d+7]=t[p+1],n[d+8]=t[p+8],n[d+9]=t[p+9],n[d+10]=t[p+10],n[d+11]=t[p+11],n[d+12]=t[p+15],n[d+13]=t[p+14],n[d+14]=t[p+13],n[d+15]=t[p+12];break;case"PrecompressedDXT5":n[d+0]=t[p+0],n[d+1]=t[p+1],e.getBytesFromUInt24(n,d+5,e.flipUInt24(e.getUInt24(t,p+2))),e.getBytesFromUInt24(n,d+2,e.flipUInt24(e.getUInt24(t,p+5))),n[d+8]=t[p+8],n[d+9]=t[p+9],n[d+10]=t[p+10],n[d+11]=t[p+11],n[d+12]=t[p+15],n[d+13]=t[p+14],n[d+14]=t[p+13],n[d+15]=t[p+12]}}return n},e.getUInt24=function(t,e){var r=0;return r|=(255&t[e+0])<<0,r|=(255&t[e+1])<<8,r|=(255&t[e+2])<<16},e.getBytesFromUInt24=function(t,e,r){t[e+0]=255&r,t[e+1]=(65280&r)>>8,t[e+2]=(16711680&r)>>16},e.ThreeBitMask=7,e.flipUInt24=function(t){for(var r=[],i=0;2>i;i++)r.push([0,0,0,0]);r[0][0]=t&e.ThreeBitMask,t>>=3,r[0][1]=t&e.ThreeBitMask,t>>=3,r[0][2]=t&e.ThreeBitMask,t>>=3,r[0][3]=t&e.ThreeBitMask,t>>=3,r[1][0]=t&e.ThreeBitMask,t>>=3,r[1][1]=t&e.ThreeBitMask,t>>=3,r[1][2]=t&e.ThreeBitMask,t>>=3,r[1][3]=t&e.ThreeBitMask;var o=0;return o|=r[1][0]<<0,o|=r[1][1]<<3,o|=r[1][2]<<6,o|=r[1][3]<<9,o|=r[0][0]<<12,o|=r[0][1]<<15,o|=r[0][2]<<18,o|=r[0][3]<<21},e}(goo.Capabilities),goo.DdsLoader=function(t,e){"use strict";function r(){this.dwSize=0,this.dwFlags=0,this.dwFourCC=0,this.dwRGBBitCount=0,this.dwRBitMask=0,this.dwGBitMask=0,this.dwBBitMask=0,this.dwABitMask=0}function i(){this.dwSize=0,this.dwFlags=0,this.dwHeight=0,this.dwWidth=0,this.dwLinearSize=0,this.dwDepth=0,this.dwMipMapCount=0,this.dwAlphaBitDepth=0,this.dwReserved1=[],this.ddpf=null,this.dwCaps=0,this.dwCaps2=0,this.dwCaps3=0,this.dwCaps4=0,this.dwTextureStage=0}function o(){this.flipVertically=!1,this.bpp=0,this.header=null,this.headerDX10=null,this.mipmapByteSizes=[]}function n(){}return r.HEADER_OFFSET=19,r.DDPF_ALPHAPIXELS=1,r.DDPF_ALPHA=2,r.DDPF_FOURCC=4,r.DDPF_RGB=64,r.DDPF_YUV=512,r.DDPF_LUMINANCE=131072,r.read=function(t){var e=new r;if(e.dwSize=t[r.HEADER_OFFSET+0],32!==e.dwSize)throw"invalid pixel format size: "+e.dwSize;return e.dwFlags=t[r.HEADER_OFFSET+1],e.dwFourCC=t[r.HEADER_OFFSET+2],e.dwRGBBitCount=t[r.HEADER_OFFSET+3],e.dwRBitMask=t[r.HEADER_OFFSET+4],e.dwGBitMask=t[r.HEADER_OFFSET+5],e.dwBBitMask=t[r.HEADER_OFFSET+6],e.dwABitMask=t[r.HEADER_OFFSET+7],e},i.DDSD_CAPS=1,i.DDSD_HEIGHT=2,i.DDSD_WIDTH=4,i.DDSD_PITCH=8,i.DDSD_PIXELFORMAT=4096,i.DDSD_MIPMAPCOUNT=131072,i.DDSD_LINEARSIZE=524288,i.DDSD_DEPTH=8388608,i.DDSCAPS_COMPLEX=8,i.DDSCAPS_MIPMAP=4194304,i.DDSCAPS_TEXTURE=4096,i.DDSCAPS2_CUBEMAP=512,i.DDSCAPS2_CUBEMAP_POSITIVEX=1024,i.DDSCAPS2_CUBEMAP_NEGATIVEX=2048,i.DDSCAPS2_CUBEMAP_POSITIVEY=4096,i.DDSCAPS2_CUBEMAP_NEGATIVEY=8192,i.DDSCAPS2_CUBEMAP_POSITIVEZ=16384,i.DDSCAPS2_CUBEMAP_NEGATIVEZ=32768,i.DDSCAPS2_VOLUME=2097152,i.read=function(e){var o=new i;if(o.dwSize=e[1],124!==o.dwSize)throw"invalid dds header size: "+o.dwSize;o.dwFlags=e[2],o.dwHeight=e[3],o.dwWidth=e[4],o.dwLinearSize=e[5],o.dwDepth=e[6],o.dwMipMapCount=e[7],o.dwAlphaBitDepth=e[8];for(var n=0;n<o.dwReserved1.length;n++)o.dwReserved1[n]=e[9+n];o.ddpf=r.read(e),o.dwCaps=e[27],o.dwCaps2=e[28],o.dwCaps3=e[29],o.dwCaps4=e[30],o.dwTextureStage=e[31];var a=1+Math.ceil(Math.log(Math.max(o.dwHeight,o.dwWidth))/Math.log(2));return t.isSet(o.dwCaps,i.DDSCAPS_MIPMAP)?t.isSet(o.dwFlags,i.DDSD_MIPMAPCOUNT)?o.dwMipMapCount!==a&&console.warn("Got "+o.dwMipMapCount+" mipmaps, expected "+a):o.dwMipMapCount=a:o.dwMipMapCount=1,o},o.prototype.calcMipmapSizes=function(t){for(var e=this.header.dwWidth,r=this.header.dwHeight,i=0,o=0;o<this.header.dwMipMapCount;o++)i=t?~~((e+3)/4)*~~((r+3)/4)*this.bpp*2:~~(e*r*this.bpp/8),this.mipmapByteSizes.push(4*~~((i+3)/4)),e=~~(e/2)>1?~~(e/2):1,r=~~(r/2)>1?~~(r/2):1},n.updateDepth=function(e,r){if(t.isSet(r.header.dwCaps2,i.DDSCAPS2_CUBEMAP)){var o=0;if(t.isSet(r.header.dwCaps2,i.DDSCAPS2_CUBEMAP_POSITIVEX)&&o++,t.isSet(r.header.dwCaps2,i.DDSCAPS2_CUBEMAP_NEGATIVEX)&&o++,t.isSet(r.header.dwCaps2,i.DDSCAPS2_CUBEMAP_POSITIVEY)&&o++,t.isSet(r.header.dwCaps2,i.DDSCAPS2_CUBEMAP_NEGATIVEY)&&o++,t.isSet(r.header.dwCaps2,i.DDSCAPS2_CUBEMAP_POSITIVEZ)&&o++,t.isSet(r.header.dwCaps2,i.DDSCAPS2_CUBEMAP_NEGATIVEZ)&&o++,6!==o)throw new Error("Cubemaps without all faces defined are not currently supported.");e.depth=o}else e.depth=r.header.dwDepth>0?r.header.dwDepth:1},n.readDXT=function(e,r,i,o){if(o.image.isCompressed=!0,!i.flipVertically)return new Uint8Array(e.buffer,e.byteOffset+0,r);for(var n=i.header.dwWidth,a=i.header.dwHeight,s=new Uint8Array(r),h=0,u=0;u<i.header.dwMipMapCount;u++){var c=e.subarray(h,h+i.mipmapByteSizes[u]),l=t.flipDXT(c,n,a,o.format);s.set(l,h),h+=l.length,n=~~(n/2)>1?~~(n/2):1,a=~~(a/2)>1?~~(a/2):1}return s},n.readUncompressed=function(e,r,i,o,n,a,s,h){var u=t.shiftCount(s.header.ddpf.dwRBitMask),c=t.shiftCount(s.header.ddpf.dwGBitMask),l=t.shiftCount(s.header.ddpf.dwBBitMask),d=t.shiftCount(s.header.ddpf.dwABitMask),p=~~(s.header.ddpf.dwRGBBitCount/8),f=1*t.getComponents(h.format),m=new Uint8Array(r),g=s.header.dwWidth,y=s.header.dwHeight,v=0,x=0,w=0,_=[];for(w=0;p>w;w++)_.push(0);for(var b=0;b<s.header.dwMipMapCount;b++){for(var S=0;y>S;S++)for(var M=0;g>M;M++){for(w=0;p>w;w++)_[w]=e[x++];w=t.getIntFromBytes(_);var E=(w&s.header.ddpf.dwRBitMask)>>u,C=(w&s.header.ddpf.dwGBitMask)>>c,T=(w&s.header.ddpf.dwBBitMask)>>l,P=(w&s.header.ddpf.dwABitMask)>>d;n?m[v++]=P:o?(m[v++]=E,a&&(m[v++]=P)):i&&(m[v++]=E,m[v++]=C,m[v++]=T,a&&(m[v++]=P))}v+=g*y*f,g=~~(g/2)>1?~~(g/2):1,y=~~(y/2)>1?~~(y/2):1}return m},n.populate=function(e,i,o){var a=i.header.ddpf.dwFlags,s=t.isSet(a,r.DDPF_FOURCC),h=t.isSet(a,r.DDPF_RGB),u=t.isSet(a,r.DDPF_ALPHAPIXELS),c=t.isSet(a,r.DDPF_LUMINANCE),l=t.isSet(a,r.DDPF_ALPHA);if(e.type="UnsignedByte",s){var d=i.header.ddpf.dwFourCC;if(d===t.getIntFromString("DXT1"))i.bpp=4,e.format="PrecompressedDXT1A";else if(d===t.getIntFromString("DXT3"))i.bpp=8,e.format="PrecompressedDXT3";else{if(d!==t.getIntFromString("DXT5"))throw d===t.getIntFromString("DX10")?new Error("dxt10 LATC formats not supported currently: "+i.headerDX10.dxgiFormat):d===t.getIntFromString("DXT2")?"DXT2 is not supported.":d===t.getIntFromString("DXT4")?"DXT4 is not supported.":"unsupported compressed dds format found ("+d+")";i.bpp=8,e.format="PrecompressedDXT5"}}else if(i.bpp=i.header.ddpf.dwRGBBitCount,h)u?e.format="RGBA":e.format="RGB";else{if(!c&&!u)throw new Error("unsupported uncompressed dds format found.");c&&u?e.format="LuminanceAlpha":c?e.format="Luminance":l&&(e.format="Alpha")}i.calcMipmapSizes(s),e.image.mipmapSizes=i.mipmapByteSizes;for(var p=0,f=0;f<i.mipmapByteSizes.length;f++)p+=i.mipmapByteSizes[f];for(var m=[],f=0;f<e.image.depth;f++)s?m.push(n.readDXT(o,p,i,e)):(h||c||l)&&m.push(n.readUncompressed(o,p,h,c,l,u,i,e));e.image.data=1===e.image.depth?m[0]:m,e.image.useArrays=!0},n.prototype.load=function(e,r,a,s,h){var u=new Int32Array(e,s+0,32),c=u[0];if(c!==t.getIntFromString("DDS "))throw"Not a dds file.";var l=new o;l.flipVertically=a,l.header=i.read(u),l.headerDX10=l.header.ddpf.dwFourCC===t.getIntFromString("DX10")?i.read(Int32Array.create(e,s+128,5)):null;var d=r.image;("undefined"==typeof d||null===d)&&(d={},r.image=d),d.width=l.header.dwWidth,d.height=l.header.dwHeight,n.updateDepth(d,l);var p=128+(l.headerDX10?20:0);n.populate(r,l,new Uint8Array(e,s+p,h-p)),(!l.mipmapByteSizes||l.mipmapByteSizes.length<2)&&(r.minFilter="BilinearNoMipMaps"),d.bpp=l.bpp,d.dataReady=!0,d.isData=!0,r.needsUpdate=!0},n.prototype.isSupported=function(){return!!e.CompressedTextureS3TC},n.prototype.toString=function(){return"DdsLoader"},n}(goo.DdsUtils,goo.Capabilities),goo.CrunchLoader=function(t,e,r){"use strict";function i(){}return i.cCRNFmtDXT1=0,i.cCRNFmtDXT3=1,i.cCRNFmtDXT5=2,i.prototype.arrayBufferCopy=function(t,e,r,i){var o,n=r/4,a=i%4,s=new Uint32Array(t.buffer,0,(i-a)/4),h=new Uint32Array(e.buffer);for(o=0;o<s.length;o++)h[n+o]=s[o];for(o=i-a;i>o;o++)e[r+o]=t[o]},i.prototype.load=function(t,r,o){if("undefined"==typeof window.CrunchModule)return void console.warn("Crunch library not loaded! Include a script tag pointing to lib/crunch/crunch.js in your html-file.");var n,a,s,h,u,c,l,d,p=window.CrunchModule,f=new Uint8Array(t),m=t.byteLength,g=p._malloc(m);this.arrayBufferCopy(f,p.HEAPU8,g,m),n=p._crn_get_dxt_format(g,m);var y;switch(n){case i.cCRNFmtDXT1:r.format="PrecompressedDXT1A",y=4;break;case i.cCRNFmtDXT3:r.format="PrecompressedDXT3",y=8;break;case i.cCRNFmtDXT5:r.format="PrecompressedDXT5",y=8;break;default:return console.error("Unsupported image format"),0}h=p._crn_get_width(g,m),u=p._crn_get_height(g,m),c=p._crn_get_levels(g,m),s=p._crn_get_uncompressed_size(g,m,0),a=p._malloc(s);var v=r.image;("undefined"==typeof v||null===v)&&(v={},r.image=v),v.width=h,v.height=u,v.depth=1;var x=[];for(r.image.mipmapSizes=[],d=0;c>d;++d)d&&(s=p._crn_get_uncompressed_size(g,m,d)),p._crn_decompress(g,m,a,s,d),l=new Uint8Array(p.HEAPU8.buffer,a,s),o&&(l=e.flipDXT(l,h,u,r.format)),x.push(l),r.image.mipmapSizes.push(s),h*=.5,u*=.5;r.image.data=x,r.image.useArrays=!0,r.type="UnsignedByte",r.image.isCompressed=!0,1>=c&&(r.minFilter="BilinearNoMipMaps"),v.bpp=y,v.dataReady=!0,v.isData=!0,r.needsUpdate=!0,p._free(g),p._free(a)},i.prototype.dxtToRgb565=function(t,e,r,i){for(var o=new Uint16Array(4),n=new Uint16Array(r*i),a=0,s=0,h=0,u=0,c=0,l=0,d=0,p=0,f=0,m=r/4,g=i/4,y=0;g>y;y++)for(var v=0;m>v;v++)h=e+4*(y*m+v),o[0]=t[h],o[1]=t[h+1],u=31&o[0],c=2016&o[0],l=63488&o[0],d=31&o[1],p=2016&o[1],f=63488&o[1],o[2]=5*u+3*d>>3|5*c+3*p>>3&2016|5*l+3*f>>3&63488,o[3]=5*d+3*u>>3|5*p+3*c>>3&2016|5*f+3*l>>3&63488,a=t[h+2],s=4*y*r+4*v,n[s]=o[3&a],n[s+1]=o[a>>2&3],n[s+2]=o[a>>4&3],n[s+3]=o[a>>6&3],s+=r,n[s]=o[a>>8&3],n[s+1]=o[a>>10&3],n[s+2]=o[a>>12&3],n[s+3]=o[a>>14],a=t[h+3],s+=r,n[s]=o[3&a],n[s+1]=o[a>>2&3],n[s+2]=o[a>>4&3],n[s+3]=o[a>>6&3],s+=r,n[s]=o[a>>8&3],n[s+1]=o[a>>10&3],n[s+2]=o[a>>12&3],n[s+3]=o[a>>14];return n},i.prototype.isSupported=function(){return!!r.CompressedTextureS3TC},i.prototype.toString=function(){return"CrunchLoader"},i}(goo.DdsLoader,goo.DdsUtils,goo.Capabilities),goo.TgaLoader=function(){"use strict";function t(){this.header=null,this.offset=0,this.use_rle=!1,this.use_pal=!1,this.use_rgb=!1,this.use_grey=!1}return t.TYPE_NO_DATA=0,t.TYPE_INDEXED=1,t.TYPE_RGB=2,t.TYPE_GREY=3,t.TYPE_RLE_INDEXED=9,t.TYPE_RLE_RGB=10,t.TYPE_RLE_GREY=11,t.ORIGIN_MASK=48,t.ORIGIN_SHIFT=4,t.ORIGIN_BL=0,t.ORIGIN_BR=1,t.ORIGIN_UL=2,t.ORIGIN_UR=3,t.prototype.load=function(t,e){this.loadData(new Uint8Array(t));var r=this.getCanvas();e.setImage(r,r.width,r.height),r.dataReady=!0,e.needsUpdate=!0},t.prototype.loadData=function(e){if(e.length<19)throw new Error("Targa::load() - Not enough data to contain header.");if(this.offset=0,this.header={id_length:e[this.offset++],colormap_type:e[this.offset++],image_type:e[this.offset++],colormap_index:e[this.offset++]|e[this.offset++]<<8,colormap_length:e[this.offset++]|e[this.offset++]<<8,colormap_size:e[this.offset++],origin:[e[this.offset++]|e[this.offset++]<<8,e[this.offset++]|e[this.offset++]<<8],width:e[this.offset++]|e[this.offset++]<<8,height:e[this.offset++]|e[this.offset++]<<8,pixel_size:e[this.offset++],flags:e[this.offset++]},this.checkHeader(),this.header.id_length+this.offset>e.length)throw new Error("Targa::load() - No data ?");switch(this.offset+=this.header.id_length,this.header.image_type){case t.TYPE_RLE_INDEXED:this.use_rle=!0;break;case t.TYPE_INDEXED:this.use_pal=!0;break;case t.TYPE_RLE_RGB:this.use_rle=!0;break;case t.TYPE_RGB:this.use_rgb=!0;break;case t.TYPE_RLE_GREY:this.use_rle=!0;break;case t.TYPE_GREY:this.use_grey=!0}this.parse(e)},t.prototype.checkHeader=function(){switch(this.header.image_type){case t.TYPE_INDEXED:case t.TYPE_RLE_INDEXED:if(this.header.colormap_length>256||24!==this.header.colormap_size||1!==this.header.colormap_type)throw new Error("Targa::checkHeader() - Invalid type colormap data for indexed type");break;case t.TYPE_RGB:case t.TYPE_GREY:case t.TYPE_RLE_RGB:case t.TYPE_RLE_GREY:if(this.header.colormap_type)throw new Error("Targa::checkHeader() - Invalid type colormap data for colormap type");break;case t.TYPE_NO_DATA:throw new Error("Targa::checkHeader() - No data on this TGA file");default:throw new Error("Targa::checkHeader() - Invalid type '"+this.header.image_type+"'")}if(this.header.width<=0||this.header.height<=0)throw new Error("Targa::checkHeader() - Invalid image size");if(8!==this.header.pixel_size&&16!==this.header.pixel_size&&24!==this.header.pixel_size&&32!==this.header.pixel_size)throw new Error("Targa::checkHeader() - Invalid pixel size '"+this.header.pixel_size+"'")},t.prototype.parse=function(t){var e,r,i,o,n;if(e=this.header,r=15&e.flags,o=e.pixel_size>>3,n=e.width*e.height*o,this.use_pal&&(this.palettes=t.subarray(this.offset,this.offset+=e.colormap_length*o)),this.use_rle){i=new Uint8Array(n);for(var a,s,h,u=0,c=new Uint8Array(o);n>u;)if(a=t[this.offset++],s=(127&a)+1,128&a){for(h=0;o>h;++h)c[h]=t[this.offset++];for(h=0;s>h;++h)i.set(c,u+h*o);u+=o*s}else{for(s*=o,h=0;s>h;++h)i[u+h]=t[this.offset++];u+=s}}else i=t.subarray(this.offset,this.offset+=this.use_pal?e.width*e.height:n);this.image=i},t.prototype.getImageData=function(e){var r,i,o,n,a,s,h,u,c=this.header.width,l=this.header.height;switch(u=e||{width:c,height:l,data:new Uint8Array(c*l*4)},(this.header.flags&t.ORIGIN_MASK)>>t.ORIGIN_SHIFT){default:case t.ORIGIN_UL:r=0,o=1,s=c,i=0,n=1,a=l;break;case t.ORIGIN_BL:r=0,o=1,s=c,i=l-1,n=-1,a=-1;break;case t.ORIGIN_UR:r=c-1,o=-1,s=-1,i=0,n=1,a=l;break;case t.ORIGIN_BR:r=c-1,o=-1,s=-1,i=l-1,n=-1,a=-1}return h="getImageData"+(this.use_grey?"Grey":"")+this.header.pixel_size+"bits",this[h](u.data,i,n,a,r,o,s),u},t.prototype.getCanvas=function(){var t=document.createElement("canvas"),e=t.getContext("2d"),r=e.createImageData(this.header.width,this.header.height);return t.width=this.header.width,t.height=this.header.height,e.putImageData(this.getImageData(r),0,0),t},t.prototype.getDataURL=function(t){return this.getCanvas().toDataURL(t||"image/png")},t.prototype.getImageData8bits=function(t,e,r,i,o,n,a){var s,h,u,c=this.image,l=this.palettes,d=this.header.width,p=0;for(u=e;u!==i;u+=r)for(h=o;h!==a;h+=n,p++)s=c[p],t[4*(h+d*u)+3]=255,t[4*(h+d*u)+2]=l[3*s+0],t[4*(h+d*u)+1]=l[3*s+1],t[4*(h+d*u)+0]=l[3*s+2];return t},t.prototype.getImageData16bits=function(t,e,r,i,o,n,a){var s,h,u,c=this.image,l=this.header.width,d=0;for(u=e;u!==i;u+=r)for(h=o;h!==a;h+=n,d+=2)s=c[d+0]+(c[d+1]<<8),
t[4*(h+l*u)+0]=(31744&s)>>7,t[4*(h+l*u)+1]=(992&s)>>2,t[4*(h+l*u)+2]=(31&s)>>3,t[4*(h+l*u)+3]=32768&s?0:255;return t},t.prototype.getImageData24bits=function(t,e,r,i,o,n,a){var s,h,u=this.image,c=this.header.width,l=0;for(h=e;h!==i;h+=r)for(s=o;s!==a;s+=n,l+=3)t[4*(s+c*h)+3]=255,t[4*(s+c*h)+2]=u[l+0],t[4*(s+c*h)+1]=u[l+1],t[4*(s+c*h)+0]=u[l+2];return t},t.prototype.getImageData32bits=function(t,e,r,i,o,n,a){var s,h,u=this.image,c=this.header.width,l=0;for(h=e;h!==i;h+=r)for(s=o;s!==a;s+=n,l+=4)t[4*(s+c*h)+2]=u[l+0],t[4*(s+c*h)+1]=u[l+1],t[4*(s+c*h)+0]=u[l+2],t[4*(s+c*h)+3]=u[l+3];return t},t.prototype.getImageDataGrey8bits=function(t,e,r,i,o,n,a){var s,h,u,c=this.image,l=this.header.width,d=0;for(u=e;u!==i;u+=r)for(h=o;h!==a;h+=n,d++)s=c[d],t[4*(h+l*u)+0]=s,t[4*(h+l*u)+1]=s,t[4*(h+l*u)+2]=s,t[4*(h+l*u)+3]=255;return t},t.prototype.getImageDataGrey16bits=function(t,e,r,i,o,n,a){var s,h,u=this.image,c=this.header.width,l=0;for(h=e;h!==i;h+=r)for(s=o;s!==a;s+=n,l+=2)t[4*(s+c*h)+0]=u[l+0],t[4*(s+c*h)+1]=u[l+0],t[4*(s+c*h)+2]=u[l+0],t[4*(s+c*h)+3]=u[l+1];return t},t.prototype.isSupported=function(){return!0},t.prototype.toString=function(){return"TgaLoader"},t}(),goo.CanvasUtils=function(t,e){"use strict";function r(){}return r.loadCanvasFromPath=function(t,r){var i={};3===arguments.length&&(i=arguments[1],r=arguments[2]);var o=new Image;o.onerror=function(){console.error("Failed to load svg!"),r()},o.src=t;var n=document.createElement("canvas"),a=n.getContext("2d");o.onload=function(){if(0===o.width&&0===o.height)return r();if(e.defaults(i,{width:o.width,height:o.height,sourceX:0,sourceY:0,sourceWidth:o.width,sourceHeight:o.height,destX:0,destY:0}),e.defaults(i,{destWidth:i.width,destHeight:i.height}),i.resizeToFit){var t=i.sourceWidth/i.sourceHeight;t>1?(i.destHeight=i.destWidth/t,i.destY=.5*(i.height-i.destHeight)):1>t&&(i.destWidth=i.destHeight*t,i.destX=.5*(i.width-i.destWidth))}n.width=i.width,n.height=i.height,a.drawImage(o,i.sourceX,i.sourceY,i.sourceWidth,i.sourceHeight,i.destX,i.destY,i.destWidth,i.destHeight),r(n)}},r.renderSvgToCanvas=function(t,e,i){var o="data:image/svg+xml;base64,"+btoa(t);r.loadCanvasFromPath(o,e,i)},r.getMatrixFromCanvas=function(t){for(var e=t.getContext("2d"),r=function(r,i){return 0>r||r>t.width||0>i||i>t.height?0:e.getImageData(r,i,1,1).data[0]/255},i=[],o=0;o<t.width;o++){i.push([]);for(var n=0;n<t.height;n++)i[o].push(r(o,t.height-(n+1)))}return i},r.svgDataToImage=function(e){var r=window.URL||window.webkitURL||window,i=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),o=new Image;return o.src=r.createObjectURL(i),t.createPromise(function(t,e){o.onload=function(){t(o)},o.onerror=function(){e("Could not load SVG image.")}})},r}(goo.PromiseUtils,goo.ObjectUtils),goo.TextureHandler=function(t,e,r,i,o,n,a,s,h,u,c,l,d){"use strict";function p(){t.apply(this,arguments),l.addListener("playStateChanged",function(t){this._objects.forEach(function(e){if(e.image&&e.image.play&&e.image.pause){var r=e.image;"play"===t?r.play():"stop"===t?(r.pause(),r.currentTime=0):"pause"===t&&r.pause()}})}.bind(this))}return p.prototype=Object.create(t.prototype),p.prototype.constructor=p,t._registerClass("texture",p),p.minFilters=["NearestNeighborNoMipMaps","NearestNeighborNearestMipMap","NearestNeighborLinearMipMap","BilinearNoMipMaps","BilinearNearestMipMap","Trilinear"],p.magFilters=["NearestNeighbor","Bilinear"],p.noMipMapAlternatives={NearestNeighborNoMipMaps:"NearestNeighborNoMipMaps",NearestNeighborNearestMipMap:"NearestNeighborNoMipMaps",NearestNeighborLinearMipMap:"NearestNeighborNoMipMaps",BilinearNoMipMaps:"BilinearNoMipMaps",BilinearNearestMipMap:"BilinearNoMipMaps",Trilinear:"BilinearNoMipMaps"},p.loaders={dds:r,crn:i,tga:o},p.WHITE=new Uint8Array([255,255,255,255]),p.BLACK=new Uint8Array([0,0,0,255]),p.prototype._prepare=function(t){h.defaults(t,{wrapS:"Repeat",wrapT:"Repeat",magFilter:"Bilinear",minFilter:"Trilinear",anisotropy:1,offset:[0,0],repeat:[1,1],flipY:!0,lodBias:0,loop:!0})},p.prototype._remove=function(t){var e=this._objects.get(t);e&&this.world.gooRunner&&e.destroy(this.world.gooRunner.renderer.context),this._objects["delete"](t)},p.prototype._create=function(){return new e},p.prototype._loadWebSupportedImage=function(t,e,r){return this.loadObject(e.imageRef,r).then(function(e){return t.image!==e&&t.setImage(e),t})},p.prototype._loadSpecialImage=function(t,e,r,i){var o=p.loaders[r],n=e.imageRef;return this.loadObject(n).then(function(r){if(r&&r.preloaded)return h.extend(t.image,r.image),t.format=r.format,t.setNeedsUpdate(),t;var i=new o;return i.load(r,t,e.flipY,0,r.byteLength),t})},p.prototype._loadVideo=function(t,e,r){return this.loadObject(e.imageRef,r).then(function(i){return i.width=i.videoWidth,i.height=i.videoHeight,i.loop=void 0!==e.loop?e.loop:!0,d.isPowerOfTwo(i.width)&&d.isPowerOfTwo(i.height)||(t.generateMipmaps=!1,t.minFilter="BilinearNoMipMaps"),t.setImage(i),t.updateCallback=function(){return!i.paused},e.autoPlay===!1||r.editMode?(i.pause(),i.currentTime=0):i.play(),t})},p.prototype._loadImage=function(t,e,r){var i=e.imageRef,o=c.parseURL(i).path,n=o.substr(o.lastIndexOf(".")+1).toLowerCase();return p.loaders[n]?this._loadSpecialImage(t,e,n,r):-1!==["jpg","jpeg","png","gif"].indexOf(n)?this._loadWebSupportedImage(t,e,r):-1!==["mp4","ogv","webm"].indexOf(n)?this._loadVideo(t,e,r):a.reject(new Error("Unknown image type: "+n))},p.prototype._update=function(e,r,i){var o=this;return t.prototype._update.call(this,e,r,i).then(function(t){if(t){var e;return t.wrapS=r.wrapS,t.wrapT=r.wrapT,-1!==p.magFilters.indexOf(r.magFilter)&&(t.magFilter=r.magFilter),-1!==p.minFilters.indexOf(r.minFilter)&&(t.minFilter=r.generateMipmaps!==!1?r.minFilter:p.noMipMapAlternatives[r.minFilter]),t.anisotropy=Math.max(r.anisotropy,1),t.offset.setDirect(r.offset[0],r.offset[1]),t.repeat.setDirect(r.repeat[0],r.repeat[1]),t.lodBias=r.lodBias,t.flipY!==r.flipY&&(t.flipY=r.flipY,t.setNeedsUpdate()),t.generateMipmaps!==r.generateMipmaps&&(t.generateMipmaps=r.generateMipmaps!==!1,t.setNeedsUpdate()),t.updateCallback=null,r.imageRef?r.lazy?(t.loadImage=function(){return o._loadImage(t,r,i)},e=t):e=o._loadImage(t,r,i):e=r.svgData?a.createPromise(function(e,i){u.renderSvgToCanvas(r.svgData,{},function(r){r?(t.setImage(r),e(t)):i("could not render svg to canvas")})}):t,i&&i.texture&&i.texture.dontwait?t:e}})},p}(goo.ConfigHandler,goo.Texture,goo.DdsLoader,goo.CrunchLoader,goo.TgaLoader,goo.rsvp,goo.PromiseUtils,goo.RendererUtils,goo.ObjectUtils,goo.CanvasUtils,goo.StringUtils,goo.SystemBus,goo.MathUtils),goo.Ajax=function(t,e,r,i,o){"use strict";function n(t,e){t&&(this._rootPath=t,"/"!==t.slice(-1)&&(this._rootPath+="/")),this.options=e||{},this._cache={}}function a(t,e){for(var r=0;r<e.length;r++)t[e[r]]=!0;return t}n.prototype.prefill=function(t,e){e?this._cache=t:r.extend(this._cache,t)},n.prototype.clear=function(){this._cache={}},n.prototype.get=function(t){t=t||{};var r=t.url||"",i="GET",o=new XMLHttpRequest;return o.open(i,r,!0),t.responseType&&(o.responseType=t.responseType),e.createPromise(function(t,e){var r=function(){4===o.readyState&&(o.status>=200&&o.status<=299?(o.removeEventListener("readystatechange",r),t(o)):(o.removeEventListener("readystatechange",r),e(o.statusText)))};o.addEventListener("readystatechange",r),o.send()})},n.ARRAY_BUFFER="arraybuffer",n.crossOrigin=!1;var s={mp4:"video/mp4",ogv:"video/ogg",webm:"video/webm"};return n.prototype.load=function(t,r){function a(t,e){return t&&n.types[e]&&n.types[e][t]}var h=this,u=i.parseURL(t).path,c=u.substr(u.lastIndexOf(".")+1).toLowerCase();if(t||e.reject("Path was undefined"),0===t.indexOf(n.ENGINE_SHADER_PREFIX))return e.resolve();if(this._cache[t]&&!r)return a(c,"bundle")&&this.prefill(this._cache[t],r),this._cache[t]instanceof o.Promise?this._cache[t]:e.resolve(this._cache[t]);var l=this._rootPath?this._rootPath+t:t;if(a(c,"image"))return this._cache[t]=this._loadImage(l),this._cache[t];if(a(c,"video"))return this._cache[t]=this._loadVideo(l,s[c]),this._cache[t];if(a(c,"audio"))return this._cache[t]=this._loadAudio(l),this._cache[t];var d={url:l};return a(c,"binary")&&(d.responseType=n.ARRAY_BUFFER),this._cache[t]=this.get(d).then(function(t){if(a(c,"bundle")){var e=JSON.parse(t.response);return h.prefill(e,r),e}return a(c,"json")?JSON.parse(t.response):t.response}).then(null,function(e){throw new Error("Could not load data from "+t+", "+e)})},n.prototype.update=function(t,r){return this._cache[t]=r,e.resolve(r)},n.prototype._loadImage=function(t){window.URL=window.URL||window.webkitURL;var r=new Image;return n.crossOrigin&&(r.crossOrigin="anonymous"),e.createPromise(function(e,i){var o=function(){r.dataReady=!0,window.URL&&void 0!==window.URL.revokeObjectURL&&window.URL.revokeObjectURL(r.src),r.removeEventListener("load",o),r.removeEventListener("error",n),e(r)},n=function(e){r.removeEventListener("load",o),r.removeEventListener("error",n),i("Could not load image from "+t+", "+e)};r.addEventListener("load",o,!1),r.addEventListener("error",n,!1),r.src=t})},n.prototype._loadVideo=function(t,r){var i=1e3,o=document.createElement("video"),a=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);n.crossOrigin&&(o.crossOrigin="anonymous");var s=e.createPromise(function(e,r){var n,s=function(){o.dataReady||console.warn("Video is not ready"),o.removeEventListener("canplay",h),o.removeEventListener("loadstart",u),clearTimeout(n),e(o)},h=function(){o.dataReady=!0,s()},u=function(){a?s():n=setTimeout(s,i)};o.addEventListener("canplay",h,!1),o.addEventListener("loadstart",u,!1),o.addEventListener("error",function(e){r("Could not load video from "+t+", "+e)},!1)}),h={url:t,responseType:n.ARRAY_BUFFER};return this.get(h).then(function(t){var e=new Blob([t.response],{type:r}),i=window.URL.createObjectURL(e);o.src=i}),s},n.prototype._loadAudio=function(t){var e={url:t,responseType:n.ARRAY_BUFFER};return this.get(e).then(function(t){return t.response}).then(null,function(e){throw new Error("Could not load data from "+t+", "+e)})},n.ENGINE_SHADER_PREFIX="GOO_ENGINE_SHADERS/",n.types={text:{vert:!0,frag:!0},json:{shader:!0,script:!0,entity:!0,material:!0,scene:!0,mesh:!0,texture:!0,skeleton:!0,animation:!0,clip:!0,bundle:!0,project:!0,machine:!0,posteffects:!0,animstate:!0,sound:!0,environment:!0,skybox:!0},image:{jpg:!0,jpeg:!0,png:!0,gif:!0},video:{mp4:!0,ogv:!0,webm:!0},binary:a({dat:!0,bin:!0},Object.keys(t.loaders)),audio:{mp3:!0,wav:!0,ogg:!0},bundle:{bundle:!0}},n.types.asset=a({},Object.keys(n.types.image).concat(Object.keys(n.types.binary))),n}(goo.TextureHandler,goo.PromiseUtils,goo.ObjectUtils,goo.StringUtils,goo.rsvp),goo.TextureCreator=function(t,e,r,i,o,n,a){"use strict";function s(){var t=this.ajax=new i;this.textureHandler=new r({},function(e,r){return t.load(e,r?r.noCache:!1)},function(){},function(e,r){return t.load(e,r?r.noCache:!1)})}s.UNSUPPORTED_FALLBACK=".png",s.clearCache=function(){},s.prototype.clear=function(){this.ajax.clear(),this.textureHandler.clear()},s.prototype.loadTexture2D=function(t,e){var r=o.createUniqueId("texture");e=e||{},e.imageRef=t;var i=this.textureHandler._create();return this.textureHandler._objects.set(r,i),this.textureHandler.update(r,e)},s.prototype.loadTextureVideo=function(t,e){var r=o.createUniqueId("texture");e=e||{},e.imageRef=t,e.loop=void 0!==e.loop?e.loop:!0,e.wrapS=void 0!==e.wrapS?e.wrapS:"EdgeClamp",e.wrapT=void 0!==e.wrapT?e.wrapT:"EdgeClamp",e.autoPlay=void 0!==e.autoPlay?e.autoPlay:!0,e.texture=void 0!==e.texture?e.texture:{dontwait:!0};var i=this.textureHandler._create();return this.textureHandler._objects.set(r,i),this.textureHandler.update(r,e,e)},s.prototype.loadTextureWebCam=function(){return n.createPromise(function(r,i){var o=document.createElement("video");o.autoplay=!0,o.loop=!0;var n=new t(o,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});n.readyCallback=function(){return o.readyState>=3?(o.width=o.videoWidth,o.height=o.videoHeight,e.isPowerOfTwo(o.width)&&e.isPowerOfTwo(o.height)||(n.generateMipmaps=!1,n.minFilter="BilinearNoMipMaps"),o.dataReady=!0,!0):!1},n.updateCallback=function(){return!o.paused},window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({video:!0},function(t){o.src=window.URL.createObjectURL(t),r(n)},i):i(new Error("No support for WebCam getUserMedia found!"))})},s.prototype.loadTextureCube=function(e,r){var i=new t(null,r);i.variant="CUBE";var o=e.map(function(t){return n.createPromise(function(e,r){"string"==typeof t?this.ajax._loadImage(t).then(e,r):e(t)}.bind(this))}.bind(this));return a.all(o).then(function(t){return n.createPromise(function(e,r){for(var o=t[0].width,n=t[0].height,a=0;6>a;a++){var s=t[a];if(o!==s.width||n!==s.height)return i.generateMipmaps=!1,i.minFilter="BilinearNoMipMaps",void r(new Error("The images passed to loadTextureCube() must be of the same size!"))}i.setImage(t),i.image.dataReady=!0,i.image.width=o,i.image.height=n,e(i)})})},s._globalCallback=null,s._finishedLoading=function(t){if(s._globalCallback)try{s._globalCallback(t)}catch(e){console.error("Error in texture callback:",e)}};var h=new Uint8Array([255,255,255,255]);return s.DEFAULT_TEXTURE_2D=new t(h,null,1,1),s.DEFAULT_TEXTURE_CUBE=new t([h,h,h,h,h,h],null,1,1),s.DEFAULT_TEXTURE_CUBE.variant="CUBE",s}(goo.Texture,goo.MathUtils,goo.TextureHandler,goo.Ajax,goo.StringUtils,goo.PromiseUtils,goo.rsvp),goo.ObjectUtil=function(t){return t}(goo.ObjectUtils),goo.RenderTarget=function(t,e){"use strict";function r(r,i,o){this.glTexture=null,this._glRenderBuffer=null,this._glFrameBuffer=null,this.width=Math.max(Math.floor(r),1),this.height=Math.max(Math.floor(i),1),e.copyOptions(this,o,{wrapS:"EdgeClamp",wrapT:"EdgeClamp",magFilter:"Bilinear",minFilter:"BilinearNoMipMaps",anisotropy:1,format:"RGBA",type:"UnsignedByte",generateMipmaps:!1,premultiplyAlpha:!1,unpackAlignment:1,flipY:!0,depthBuffer:!0,stencilBuffer:!0}),this.variant="2D",this.offset=new t(0,0),this.repeat=new t(1,1),this.textureRecord={}}return r.prototype.clone=function(){var t=new r(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.variant=this.variant,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.unpackAlignment=this.unpackAlignment,t.flipY=this.flipY,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t},r.prototype.getSizeInMemory=function(){var t=this.width*this.height*4;return this.generateMipmaps&&(t=Math.ceil(4*t/3)),t},r.prototype.destroy=function(t){this.glTexture&&(t.deleteTexture(this.glTexture),this.glTexture=null),this._glRenderBuffer&&(t.deleteRenderbuffer(this._glRenderBuffer),this._glRenderBuffer=null),this._glFrameBuffer&&(t.deleteFramebuffer(this._glFrameBuffer),this._glFrameBuffer=null)},r}(goo.Vector2,goo.ObjectUtil),goo.ShaderCall=function(){"use strict";function t(t,e,r){if(this.context=t,this.location=e,this.location.value=void 0,r)switch(r){case"float":this.call=this.uniform1f;break;case"bool":case"int":case"integer":case"sampler2D":case"sampler3D":case"samplerCube":this.call=this.uniform1i;break;case"floatarray":this.call=this.uniform1fv;break;case"intarray":case"samplerArray":this.call=this.uniform1iv;break;case"ivec2":this.call=this.uniform2iv;break;case"ivec3":this.call=this.uniform3iv;break;case"ivec4":this.call=this.uniform4iv;break;case"vec2":this.call=this.uniform2fv;break;case"vec3":this.call=this.uniform3fv;break;case"vec4":this.call=this.uniform4fv;break;case"mat2":this.call=this.uniformMatrix2fv;break;case"mat3":this.call=this.uniformMatrix3fv;break;case"mat4":this.call=this.uniformMatrix4fv;break;default:throw new Error("Uniform type not handled: "+r)}}function e(t,e){for(var r=t.length;r--;)if(t[r]!==e[r])return!1;return!0}return t.prototype.uniform1f=function(t){var e=this.location.value;e!==t&&(this.context.uniform1f(this.location,t),this.location.value=t)},t.prototype.uniform1fv=function(t){var r=this.location.value;void 0!==r&&e(t,r)||(this.context.uniform1fv(this.location,t),this.location.value=t.slice())},t.prototype.uniform1i=function(t){var e=this.location.value;e!==t&&(this.context.uniform1i(this.location,t),this.location.value=t)},t.prototype.uniform1iv=function(t){var r=this.location.value;void 0!==r&&e(t,r)||(this.context.uniform1iv(this.location,t),this.location.value=t.slice())},t.prototype.uniform2f=function(t,e){var r=this.location.value;(void 0===r||r[0]!==t||r[1]!==e)&&(this.context.uniform2f(this.location,t,e),this.location.value=[t,e])},t.prototype.uniform2fv=function(t){var r=this.location.value;if(void 0!==r){if(e(t,r))return}else r=this.location.value=new Float64Array(t.length);this.context.uniform2fv(this.location,t);for(var i=t.length;i--;)r[i]=t[i]},t.prototype.uniform2i=function(t,e){var r=this.location.value;(void 0===r||r[0]!==t||r[1]!==e)&&(this.context.uniform2i(this.location,t,e),this.location.value=[t,e])},t.prototype.uniform2iv=function(t){var r=this.location.value;void 0!==r&&e(t,r)||(this.context.uniform2iv(this.location,t),this.location.value=t.slice())},t.prototype.uniform3f=function(t,e,r){var i=this.location.value;if(void 0!==i){if(i[0]===t&&i[1]===e&&i[2]===r)return}else i=this.location.value=[];this.context.uniform3f(this.location,t,e,r),i[0]=t,i[1]=e,i[2]=r},t.prototype.uniform3fv=function(t){var r=this.location.value;if(void 0!==r){if(e(t,r))return}else r=this.location.value=new Float64Array(t.length);this.context.uniform3fv(this.location,t);for(var i=t.length;i--;)r[i]=t[i]},t.prototype.uniform3i=function(t,e,r){var i=this.location.value;(void 0===i||i[0]!==t||i[1]!==e||i[2]!==r)&&(this.context.uniform3i(this.location,t,e,r),this.location.value=[t,e,r])},t.prototype.uniform3iv=function(t){var r=this.location.value;void 0!==r&&e(t,r)||(this.context.uniform3iv(this.location,t),this.location.value=t.slice())},t.prototype.uniform4f=function(t,e,r,i){var o=this.location.value;(void 0===o||o[0]!==t||o[1]!==e||o[2]!==r||o[3]!==i)&&(this.context.uniform4f(this.location,t,e,r,i),this.location.value=[t,e,r,i])},t.prototype.uniform4fv=function(t){var r=this.location.value;if(void 0!==r){if(e(t,r))return}else r=this.location.value=new Float64Array(t.length);this.context.uniform4fv(this.location,t);for(var i=t.length;i--;)r[i]=t[i]},t.prototype.uniform4i=function(t,e,r,i){var o=this.location.value;(void 0===o||o[0]!==t||o[1]!==e||o[2]!==r||o[3]!==i)&&(this.context.uniform4i(this.location,t,e,r,i),this.location.value=[t,e,r,i])},t.prototype.uniform4iv=function(t){var r=this.location.value;void 0!==r&&e(t,r)||(this.context.uniform4iv(this.location,t),this.location.value=t.slice())},t.prototype.uniformMatrix2fv=function(t,r){if(r=r===!0,t.data){var i=this.location.value;if(void 0!==i){var o=e(i.data,t.data);if(o)return;i.copy(t)}else this.location.value=t.clone();this.context.uniformMatrix2fv(this.location,r,t.data)}else{var n=t,i=this.location.value;if(void 0!==i){if(e(n,i))return}else i=this.location.value=new Float64Array(n.length);this.context.uniformMatrix2fv(this.location,r,n);for(var a=n.length;a--;)i[a]=n[a]}},t.prototype.uniformMatrix3fv=function(t,r){if(r=r===!0,t.data){var i=this.location.value;if(void 0!==i){var o=e(i.data,t.data);if(o)return;i.copy(t)}else this.location.value=t.clone();this.context.uniformMatrix3fv(this.location,r,t.data)}else{var n=t,i=this.location.value;if(void 0!==i){if(e(n,i))return}else i=this.location.value=new Float64Array(n.length);this.context.uniformMatrix3fv(this.location,r,n);for(var a=n.length;a--;)i[a]=n[a]}},t.prototype.uniformMatrix4fv=function(t,r){if(r=r===!0,t.data){var i=this.location.value;if(void 0!==i){var o=e(i.data,t.data);if(o)return;i.copy(t)}else this.location.value=t.clone();this.context.uniformMatrix4fv(this.location,r,t.data)}else{var n=t,i=this.location.value;if(void 0!==i){if(e(n,i))return}else i=this.location.value=new Float64Array(n.length);this.context.uniformMatrix4fv(this.location,r,n);for(var a=n.length;a--;)i[a]=n[a]}},t}(),goo.RenderQueue=function(t){"use strict";function e(){this.opaqueSorter=function(t,e){var r=t.meshRendererComponent.materials[0].shader,i=e.meshRendererComponent.materials[0].shader;return null===r||null===i?0:r.defineKey===i.defineKey?t.meshRendererComponent._renderDistance-e.meshRendererComponent._renderDistance:i.defineKey<r.defineKey?-1:i.defineKey>r.defineKey?1:0},this.transparentSorter=function(t,e){return e.meshRendererComponent._renderDistance-t.meshRendererComponent._renderDistance},this.bucketSorter=function(t,e){return t-e}}var r=[],i=new t;return e.prototype.sort=function(t,o){var n=0,a={};r.length=0;for(var s=0,h=t.length;h>s;s++){var u=t[s],c=u.meshRendererComponent;if(c&&0!==c.materials.length){var l=c.materials[0].getRenderQueue(),d=0,p=c.worldBound;null!==p?d=i.set(o.translation).sub(p.center).lengthSquared():u.transformComponent&&(d=i.set(o.translation).sub(u.transformComponent.worldTransform.translation).lengthSquared()),c._renderDistance=d;var f=a[l];f||(f=[],a[l]=f,r.push(l)),f.push(u)}else t[n]=u,n++}r.length>1&&r.sort(this.bucketSorter);for(var m=0,h=r.length;h>m;m++){var g=r[m],f=a[g],y=f.length;y>1&&g>=0&&(g<e.TRANSPARENT?f.sort(this.opaqueSorter):f.sort(this.transparentSorter));for(var s=0;y>s;s++)t[n]=f[s],n++}},e.BACKGROUND=0,e.OPAQUE=1e3,e.TRANSPARENT=2e3,e.OVERLAY=3e3,e}(goo.Vector3),goo.Shader=function(t,e,r,i,o,n,a){"use strict";function s(t,e){if(!e.vshader||!e.fshader)throw new Error("Missing shader sources for shader: "+t);this.originalShaderDefinition=e,this.shaderDefinition=e,this.origVertexSource=e.vshader,this.origFragmentSource=e.fshader,this.name=t,this.shaderProgram=null,this.vertexShader=null,this.fragmentShader=null,this.renderer=null,this.attributeMapping={},this.attributeIndexMapping={},this.uniformMapping={},this.uniformCallMapping={},this.textureSlots=[],this.textureSlotsNaming={},this.textureIndex=0,this.currentCallbacks={},this.overridePrecision=e.precision||null,this.processors=e.processors,this.builder=e.builder,this.defines=e.defines||{},this.attributes=e.attributes||{},this.uniforms=e.uniforms||{},this.defineKey=e.defineKey||"",this.defineKeyDirty=!0,this.frameStart=!0,this.attributeKeys=null,this.matchedUniforms=[],this.renderQueue=o.OPAQUE,s.cache.has(e)?this._id=s.cache.get(e):(this._id=s.cache.size,s.cache.set(e,this._id)),this.errorOnce=!1,this.vertexSource="function"==typeof this.origVertexSource?this.origVertexSource():this.origVertexSource,this.fragmentSource="function"==typeof this.origFragmentSource?this.origFragmentSource():this.origFragmentSource}function h(t){t[s.PROJECTION_MATRIX]=function(t,e){var r=e.camera.getProjectionMatrix();t.uniformMatrix4fv(r)},t[s.VIEW_MATRIX]=function(t,e){var r=e.camera.getViewMatrix();t.uniformMatrix4fv(r)},t[s.WORLD_MATRIX]=function(t,e){var i=void 0!==e.transform?e.transform.matrix:r.IDENTITY;t.uniformMatrix4fv(i)},t[s.NORMAL_MATRIX]=function(t,r){var i=void 0!==r.transform?r.transform.normalMatrix:e.IDENTITY;t.uniformMatrix3fv(i)},t[s.VIEW_INVERSE_MATRIX]=function(t,e){var r=e.camera.getViewInverseMatrix();t.uniformMatrix4fv(r)},t[s.VIEW_PROJECTION_MATRIX]=function(t,e){var r=e.camera.getViewProjectionMatrix();t.uniformMatrix4fv(r)},t[s.VIEW_PROJECTION_INVERSE_MATRIX]=function(t,e){var r=e.camera.getViewProjectionInverseMatrix();t.uniformMatrix4fv(r)};for(var o=0;16>o;o++)t[s["TEXTURE"+o]]=function(t){return function(e){e.uniform1i(t)}}(o);for(var o=0;8>o;o++)t[s["LIGHT"+o]]=function(t){return function(e,r){var i=r.lights[t];void 0!==i?e.uniform3f(i.translation.x,i.translation.y,i.translation.z):e.uniform3f(-20,20,20)}}(o);t[s.LIGHTCOUNT]=function(t,e){t.uniform1i(e.lights.length)},t[s.CAMERA]=function(t,e){var r=e.camera.translation;t.uniform3f(r.x,r.y,r.z)},t[s.NEAR_PLANE]=function(t,e){t.uniform1f(e.camera.near)},t[s.FAR_PLANE]=function(t,e){t.uniform1f(e.camera.far)},t[s.MAIN_NEAR_PLANE]=function(t,e){t.uniform1f(e.mainCamera.near)},t[s.MAIN_FAR_PLANE]=function(t,e){t.uniform1f(e.mainCamera.far)},t[s.MAIN_DEPTH_SCALE]=function(t,e){t.uniform1f(1/(e.mainCamera.far-e.mainCamera.near))},t[s.AMBIENT]=function(t,e){var r=void 0!==e.material.materialState?e.material.materialState.ambient:s.DEFAULT_AMBIENT;t.uniform4fv(r)},t[s.EMISSIVE]=function(t,e){var r=void 0!==e.material.materialState?e.material.materialState.emissive:s.DEFAULT_EMISSIVE;t.uniform4fv(r)},t[s.DIFFUSE]=function(t,e){var r=void 0!==e.material.materialState?e.material.materialState.diffuse:s.DEFAULT_DIFFUSE;t.uniform4fv(r)},t[s.SPECULAR]=function(t,e){var r=s.DEFAULT_SPECULAR;void 0!==e.material.materialState&&(r=e.material.materialState.specular,r[3]=Math.max(e.material.materialState.shininess,1)),t.uniform4fv(r)},t[s.SPECULAR_POWER]=function(t,e){var r=void 0!==e.material.materialState?e.material.materialState.shininess:s.DEFAULT_SHININESS;r=Math.max(r,1),t.uniform1f(r)},t[s.TIME]=function(t){t.uniform1f(i.time)},t[s.TPF]=function(t){t.uniform1f(i.tpf)},t[s.RESOLUTION]=function(t,e){t.uniform2f(e.renderer.viewportWidth,e.renderer.viewportHeight)}}s.cache=new Map,s.prototype.clone=function(){return new s(this.name,n.deepClone({precision:this.precision,processors:this.processors,builder:this.builder,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms,vshader:this.origVertexSource,fshader:this.origFragmentSource,defineKey:this.defineKey}))},s.prototype.cloneOriginal=function(){return new s(this.name,this.originalShaderDefinition)},s.prototype.precompile=function(t){null===this.shaderProgram&&(this._investigateShaders(),this.addDefines(this.defines),this.addPrecision(this.overridePrecision||t.shaderPrecision),this.compile(t))};var u=/\b(attribute|uniform)\s+(float|int|bool|vec2|vec3|vec4|mat2|mat3|mat4|sampler2D|sampler3D|samplerCube)\s+(\w+)(\s*\[\s*\w+\s*\])*;/g;s.prototype.compileProgram=function(t){null===this.shaderProgram&&(this._investigateShaders(),this.addDefines(this.defines),this.addPrecision(this.overridePrecision||t.shaderPrecision),this.compile(t))},s.prototype.activateProgram=function(t,e){return t.usedProgram!==this.shaderProgram?(e.useProgram(this.shaderProgram),t.usedProgram=this.shaderProgram,!0):void 0},s.prototype.bindAttributeKey=function(t,e,r,i){var o=r[this.attributes[i]];if(o){var n=this.attributeIndexMapping[i];void 0!==n&&(t.newlyEnabledAttributes[n]=!0,e.bindVertexAttribute(n,o))}},s.prototype.bindAttributes=function(t,e,r){if(this.attributes)for(var i=0,o=this.attributeKeys.length;o>i;i++)this.bindAttributeKey(t,e,r,this.attributeKeys[i])},s.prototype.disableAttributes=function(t,e){for(var r=0,i=t.enabledAttributes.length;i>r;r++){var o=t.enabledAttributes[r],n=t.newlyEnabledAttributes[r];!n&&o&&(e.disableVertexAttribArray(r),t.enabledAttributes[r]=!1)}},s.prototype.enableAttributes=function(t,e){for(var r=0,i=t.newlyEnabledAttributes.length;i>r;r++){var o=t.enabledAttributes[r],n=t.newlyEnabledAttributes[r];n&&!o&&(e.enableVertexAttribArray(r),t.enabledAttributes[r]=!0)}},s.prototype.matchUniforms=function(t){var e=this.matchedUniforms;if(e){this.textureIndex=0;for(var r=0,i=e.length;i>r;r++)this._bindUniform(e[r],t)}},s.prototype.apply=function(t,e){var r=e.context,i=e.rendererRecord;this.compileProgram(e),this.activateProgram(i,r),i.newlyEnabledAttributes.length=0,this.bindAttributes(i,e,t.meshData.attributeMap),this.disableAttributes(i,r),this.enableAttributes(i,r),this.matchUniforms(t)},s.prototype.defineValue=function(t,e){var r=t.material.uniforms[e];return void 0===r&&(r=this.uniforms[e]),r},s.prototype.mapSlot=function(t,e,r){var i=t.material.getTexture(r.mapping);i instanceof Array?this.arrayType(e,r,i):(r.index=this.textureIndex,e.call(this.textureIndex++))},s.prototype.arrayType=function(t,e,r){var i=[];e.index=[];for(var o=0;o<r.length;o++)e.index.push(this.textureIndex),i.push(this.textureIndex++);t.call(i)},s.prototype.stringType=function(t,e,r){var i=this.currentCallbacks[e];if(i)i(r,t);else{var o=this.textureSlotsNaming[e];void 0!==o&&this.mapSlot(t,r,o)}},s.prototype.callMapping=function(t,e,r){var i=this.defineValue(t,e),o=typeof i;if("string"===o)this.stringType(t,e,r,i);else{var n="function"===o?i(t):i;r.call(n)}},s.prototype._bindUniform=function(t,e){var r=this.uniformCallMapping[t];void 0!==r&&this.callMapping(e,t,r)},s.prototype.setDefine=function(t,e){this.defineKeyDirty=this.defineKeyDirty||this.defines[t]!==e,this.defines[t]=e},s.prototype.removeDefine=function(t){this.defineKeyDirty=this.defineKeyDirty||void 0!==this.defines[t],this.defines[t]=void 0},s.prototype.hasDefine=function(t){return this.defines[t]!==!1&&void 0!==this.defines[t]},s.prototype.startFrame=function(){this.frameStart=!0},s.prototype.endFrame=function(){this.frameStart=!1},s.prototype.updateProcessors=function(t){if(this.processors)for(var e=0;e<this.processors.length;e++)this.processors[e](this,t)},s.prototype.getDefineKey=function(t){if(this.defineKeyDirty){for(var e="Key:"+this.name,r=Object.keys(this.defines),i=0;i<r.length;i++){var o=r[i],n=this.defines[o];void 0!==n&&n!==!1&&-1===t.indexOf(o)&&t.push(o)}for(var i=0,a=t.length;a>i;i++){var o=t[i],n=this.defines[o];void 0!==n&&n!==!1&&(e+="_"+i+":"+n)}this.defineKey=e,this.defineKeyDirty=!1}return this.defineKey},s.prototype.rebuild=function(){this.shaderProgram=null,this.attributeMapping={},this.attributeIndexMapping={},this.uniformMapping={},this.uniformCallMapping={},this.currentCallbacks={},this.attributeKeys=null,this.vertexSource="function"==typeof this.origVertexSource?this.origVertexSource():this.origVertexSource,this.fragmentSource="function"==typeof this.origFragmentSource?this.origFragmentSource():this.origFragmentSource,this.defineKeyDirty=!0},s.prototype._investigateShaders=function(){this.textureSlots=[],this.textureSlotsNaming={},s.investigateShader(this.vertexSource,this),s.investigateShader(this.fragmentSource,this)},s.investigateShader=function(t,e){u.lastIndex=0;for(var r=u.exec(t);null!==r;){var i={format:r[2]},o=r[1],n=r[3],a=r[4];if(a&&("float"===i.format?i.format="floatarray":"int"===i.format?i.format="intarray":0===i.format.indexOf("sampler")&&(i.format="samplerArray")),"attribute"===o)e.attributeMapping[n]=i;else{if(0===i.format.indexOf("sampler")){var s={format:i.format,name:n,mapping:e.uniforms[n],index:e.textureSlots.length};e.textureSlots.push(s),e.textureSlotsNaming[s.name]=s}e.uniformMapping[n]=i}r=u.exec(t)}},s.prototype.compile=function(e){var r=e.context;this.renderer=e,this.vertexShader=this._getShader(r,void 0!==r.VERTEX_SHADER?r.VERTEX_SHADER:WebGLRenderingContext.VERTEX_SHADER,this.vertexSource),this.fragmentShader=this._getShader(r,void 0!==r.FRAGMENT_SHADER?r.FRAGMENT_SHADER:WebGLRenderingContext.FRAGMENT_SHADER,this.fragmentSource),(null===this.vertexShader||null===this.fragmentShader)&&console.error("Shader error - no shaders"),this.shaderProgram=r.createProgram();var i=r.getError();if((null===this.shaderProgram||0!==i)&&(console.error("Shader error: "+i+" [shader: "+this.name+"]"),a.emit("goo.shader.error")),r.attachShader(this.shaderProgram,this.vertexShader),r.attachShader(this.shaderProgram,this.fragmentShader),r.linkProgram(this.shaderProgram),!r.getProgramParameter(this.shaderProgram,void 0!==r.LINK_STATUS?r.LINK_STATUS:WebGLRenderingContext.LINK_STATUS)){var o=r.getProgramInfoLog(this.shaderProgram);console.error("Could not initialise shaders: "+o),a.emit("goo.shader.error",o)}for(var n in this.attributeMapping){var s=r.getAttribLocation(this.shaderProgram,n);-1!==s&&(this.attributeIndexMapping[n]=s)}for(var n in this.uniformMapping){var h=r.getUniformLocation(this.shaderProgram,n);if(null!==h)this.uniformCallMapping[n]=new t(r,h,this.uniformMapping[n].format);else for(var u=this.textureSlots.length,c=0;u>c;c++){var l=this.textureSlots[c];if(l.name===n){for(this.textureSlots.splice(c,1),delete this.textureSlotsNaming[l.name];u-1>c;c++)this.textureSlots[c].index--;break}}}if(this.attributes&&(this.attributeKeys=Object.keys(this.attributes)),
this.uniforms){if(this.uniforms.$link){for(var d=this.uniforms.$link instanceof Array?this.uniforms.$link:[this.uniforms.$link],c=0;c<d.length;c++){var p=d[c];for(var n in p)this.uniforms[n]=p[n]}delete this.uniforms.$link}this.matchedUniforms=[];for(var f in this.uniforms){var m=this.uniformCallMapping[f];void 0!==m&&this.matchedUniforms.push(f);var g=this.uniforms[f];this.defaultCallbacks[g]&&(this.currentCallbacks[f]=this.defaultCallbacks[g])}}};var c=/\b\d+:(\d+):\s(.+)\b/g,l=/\((\d+),\s*\d+\):\s(.+)/g;s.prototype._getShader=function(t,e,r){var i=t.createShader(e);if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,void 0!==t.COMPILE_STATUS?t.COMPILE_STATUS:WebGLRenderingContext.COMPILE_STATUS)){var o=t.getShaderInfoLog(i),n=e===(void 0!==t.VERTEX_SHADER?t.VERTEX_SHADER:WebGLRenderingContext.VERTEX_SHADER)?"VertexShader":"FragmentShader";c.lastIndex=0;var a=c.exec(o);if(null===a&&(a=l.exec(o)),null!==a)for(;null!==a;){var s=r.split("\n"),h=a[1],u=a[2];console.error("Error in "+n+" - ["+this.name+"]["+this._id+"] at line "+h+":"),console.error("	Error: "+u),console.error("	Source: "+s[h-1]),a=c.exec(o)}else console.error("Error in "+n+" - ["+this.name+"]["+this._id+"] "+o);return null}return i};var d=/\bprecision\s+(lowp|mediump|highp)\s+(float|int);/g;s.prototype.addPrecision=function(t){d.lastIndex=0;var e=d.exec(this.vertexSource);null===e&&(this.vertexSource="precision "+t+" float;\n"+this.vertexSource),d.lastIndex=0;var r=d.exec(this.fragmentSource);null===r&&(this.fragmentSource="precision "+t+" float;\n"+this.fragmentSource)},s.prototype.addDefines=function(t){if(t){var e=this.generateDefines(t);this.vertexSource=e+"\n"+this.vertexSource,this.fragmentSource=e+"\n"+this.fragmentSource}},s.prototype.generateDefines=function(t){var e=[];for(var r in t){var i=t[r];if(i!==!1&&void 0!==i){var o="#define "+r+" "+i;e.push(o)}}return e.join("\n")},s.prototype.getShaderDefinition=function(){return{vshader:this.vertexSource,fshader:this.fragmentSource,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms}},s.prototype.destroy=function(){this.shaderProgram&&(this.renderer.context.deleteProgram(this.shaderProgram),this.shaderProgram=null),this.vertexShader&&(this.renderer.context.deleteShader(this.vertexShader),this.vertexShader=null),this.fragmentShader&&(this.renderer.context.deleteShader(this.fragmentShader),this.fragmentShader=null),this.renderer=null},s.prototype.toString=function(){return this.name},s.PROJECTION_MATRIX="PROJECTION_MATRIX",s.VIEW_MATRIX="VIEW_MATRIX",s.VIEW_INVERSE_MATRIX="VIEW_INVERSE_MATRIX",s.VIEW_PROJECTION_MATRIX="VIEW_PROJECTION_MATRIX",s.VIEW_PROJECTION_INVERSE_MATRIX="VIEW_PROJECTION_INVERSE_MATRIX",s.WORLD_MATRIX="WORLD_MATRIX",s.NORMAL_MATRIX="NORMAL_MATRIX";for(var p=0;8>p;p++)s["LIGHT"+p]="LIGHT"+p;return s.CAMERA="CAMERA",s.AMBIENT="AMBIENT",s.EMISSIVE="EMISSIVE",s.DIFFUSE="DIFFUSE",s.SPECULAR="SPECULAR",s.SPECULAR_POWER="SPECULAR_POWER",s.NEAR_PLANE="NEAR_PLANE",s.FAR_PLANE="FAR_PLANE",s.MAIN_NEAR_PLANE="NEAR_PLANE",s.MAIN_FAR_PLANE="FAR_PLANE",s.MAIN_DEPTH_SCALE="DEPTH_SCALE",s.TIME="TIME",s.TPF="TPF",s.RESOLUTION="RESOLUTION",s.DIFFUSE_MAP="DIFFUSE_MAP",s.NORMAL_MAP="NORMAL_MAP",s.SPECULAR_MAP="SPECULAR_MAP",s.LIGHT_MAP="LIGHT_MAP",s.SHADOW_MAP="SHADOW_MAP",s.AO_MAP="AO_MAP",s.EMISSIVE_MAP="EMISSIVE_MAP",s.DEPTH_MAP="DEPTH_MAP",s.DEFAULT_AMBIENT=[.1,.1,.1,1],s.DEFAULT_EMISSIVE=[0,0,0,0],s.DEFAULT_DIFFUSE=[.8,.8,.8,1],s.DEFAULT_SPECULAR=[.6,.6,.6,64],s.DEFAULT_SHININESS=64,s.prototype.defaultCallbacks={},h(s.prototype.defaultCallbacks),s}(goo.ShaderCall,goo.Matrix3,goo.Matrix4,goo.World,goo.RenderQueue,goo.ObjectUtils,goo.SystemBus),goo.Material=function(t,e){"use strict";function r(t,e){this.id=null,this.name="Default Material",this.shader=null,"string"==typeof arguments[0]?this.name=arguments[0]:arguments[0]&&arguments[0].vshader&&arguments[0].fshader&&(this.shader=r.createShader(arguments[0])),arguments[1]&&arguments[1].vshader&&arguments[1].fshader?this.shader=r.createShader(arguments[1]):"string"==typeof arguments[1]&&(this.name=arguments[1]),this.uniforms={},this._textureMaps={},this.cullState={enabled:!0,cullFace:"Back",frontFace:"CCW"},this.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this.depthState={enabled:!0,write:!0},this.offsetState={enabled:!1,factor:1,units:1},this.dualTransparency=!1,this.wireframe=!1,this.flat=!1,this.renderQueue=null,this.fullOverride=!1,this.errorOnce=!1}return r.prototype.setTexture=function(t,e){this._textureMaps[t]=e},r.prototype.getTexture=function(t){return this._textureMaps[t]},r.prototype.removeTexture=function(t){delete this._textureMaps[t]},r.prototype.getTextures=function(){var t=[];for(var e in this._textureMaps)t.push(this._textureMaps[e]);return t},r.prototype.getTextureEntries=function(){return this._textureMaps},r.prototype.getRenderQueue=function(){return null!==this.renderQueue?this.renderQueue:null!==this.shader?this.shader.renderQueue:1e3},r.prototype.setRenderQueue=function(t){this.renderQueue=t},r.prototype.clone=function(t){t=t||{};var i=new r(this.name);if(i.id=this.id,i.name=this.name,i.shader=this.shader.clone(),t.shareUniforms?i.uniforms=this.uniforms:i.uniforms=e.deepClone(this.uniforms),t.shareTextures)for(var o=Object.keys(this._textureMaps),n=0;n<o.length;n++){var a=o[n];i._textureMaps[a]=this._textureMaps[a]}else for(var o=Object.keys(this._textureMaps),n=0;n<o.length;n++){var a=o[n];i._textureMaps[a]=this._textureMaps[a].clone()}return i.cullState.enabled=this.cullState.enabled,i.cullState.cullFace=this.cullState.cullFace,i.cullState.frontFace=this.cullState.frontFace,i.blendState.blending=this.blendState.blending,i.blendState.blendEquation=this.blendState.blendEquation,i.blendState.blendSrc=this.blendState.blendSrc,i.blendState.blendDst=this.blendState.blendDst,i.depthState.enabled=this.depthState.enabled,i.depthState.write=this.depthState.write,i.offsetState.enabled=this.offsetState.enabled,i.offsetState.factor=this.offsetState.factor,i.offsetState.units=this.offsetState.units,i.dualTransparency=this.dualTransparency,i.wireframe=this.wireframe,i.flat=this.flat,i.renderQueue=this.renderQueue,i.fullOverride=this.fullOverride,i.errorOnce=this.errorOnce,i},r.createShader=function(e,r){var i=new t(r||null,e);return null===i.name&&(i.name="DefaultShader"+i._id),i},r.clearShaderCache=function(){},r.createEmptyMaterial=function(t,e){var i=new r(e||"Empty Material");return i.empty(),t?i.shader=r.createShader(t):i.shader=void 0,i},r.prototype.empty=function(){this.cullState={},this.blendState={},this.depthState={},this.offsetState={},this.wireframe=void 0,this.renderQueue=void 0,this.flat=void 0,this._textureMaps={},this.shader=void 0,this.uniforms={}},r}(goo.Shader,goo.ObjectUtils),goo.ShaderFragment=function(){"use strict";function t(){}t.noisecommon=["vec4 mod289(vec4 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 mod289(vec3 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec2 mod289(vec2 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 permute(vec3 x) {","return mod289(((x*34.0)+1.0)*x);","}","vec4 permute(vec4 x) {","return mod289(((x*34.0)+1.0)*x);","}"].join("\n"),t.noise2d=[t.noisecommon,"float snoise(vec2 v) {","const vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0","0.366025403784439, // 0.5*(sqrt(3.0)-1.0)","-0.577350269189626, // -1.0 + 2.0 * C.x","0.024390243902439); // 1.0 / 41.0","vec2 i  = floor(v + dot(v, C.yy) );","vec2 x0 = v - i + dot(i, C.xx);","vec2 i1;","//i1.x = step( x0.y, x0.x ); x0.x > x0.y ? 1.0 : 0.0","//i1.y = 1.0 - i1.x;","i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);","// x0 = x0 - 0.0 + 0.0 * C.xx ;","// x1 = x0 - i1 + 1.0 * C.xx ;","// x2 = x0 - 1.0 + 2.0 * C.xx ;","vec4 x12 = x0.xyxy + C.xxzz;","x12.xy -= i1;","i = mod289(i); // Avoid truncation effects in permutation","vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))","+ i.x + vec3(0.0, i1.x, 1.0 ));","vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);","m = m*m ;","m = m*m ;","vec3 x = 2.0 * fract(p * C.www) - 1.0;","vec3 h = abs(x) - 0.5;","vec3 ox = floor(x + 0.5);","vec3 a0 = x - ox;","m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );","vec3 g;","g.x  = a0.x  * x0.x  + h.x  * x0.y;","g.yz = a0.yz * x12.xz + h.yz * x12.yw;","return 130.0 * dot(m, g);","}"].join("\n"),t.noise3d=[t.noisecommon,"vec4 taylorInvSqrt(vec4 r) {","return 1.79284291400159 - 0.85373472095314 * r;","}","float snoise(vec3 v) {","const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;","const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);","vec3 i  = floor(v + dot(v, C.yyy) );","vec3 x0 = v - i + dot(i, C.xxx);","vec3 g = step(x0.yzx, x0.xyz);","vec3 l = 1.0 - g;","vec3 i1 = min( g.xyz, l.zxy );","vec3 i2 = max( g.xyz, l.zxy );","vec3 x1 = x0 - i1 + C.xxx;","vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y","vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y","i = mod289(i); ","vec4 p = permute( permute( permute( ","i.z + vec4(0.0, i1.z, i2.z, 1.0 ))","+ i.y + vec4(0.0, i1.y, i2.y, 1.0 )) ","+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));","float n_ = 0.142857142857; // 1.0/7.0","vec3 ns = n_ * D.wyz - D.xzx;","vec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p,7*7)","vec4 x_ = floor(j * ns.z);","vec4 y_ = floor(j - 7.0 * x_ ); // mod(j,N)","vec4 x = x_ *ns.x + ns.yyyy;","vec4 y = y_ *ns.x + ns.yyyy;","vec4 h = 1.0 - abs(x) - abs(y);","vec4 b0 = vec4( x.xy, y.xy );","vec4 b1 = vec4( x.zw, y.zw );","vec4 s0 = floor(b0)*2.0 + 1.0;","vec4 s1 = floor(b1)*2.0 + 1.0;","vec4 sh = -step(h, vec4(0.0));","vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;","vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;","vec3 p0 = vec3(a0.xy,h.x);","vec3 p1 = vec3(a0.zw,h.y);","vec3 p2 = vec3(a1.xy,h.z);","vec3 p3 = vec3(a1.zw,h.w);","vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));","p0 *= norm.x;","p1 *= norm.y;","p2 *= norm.z;","p3 *= norm.w;","vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);","m = m * m;","return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );","}"].join("\n");var e=["float shift_right (float v, float amt) {","v = floor(v) + 0.5;","return floor(v / exp2(amt));","}","float shift_left (float v, float amt) {","return floor(v * exp2(amt) + 0.5);","}","float mask_last (float v, float bits) {","return mod(v, shift_left(1.0, bits));","}","float extract_bits (float num, float from, float to) {","from = floor(from + 0.5); to = floor(to + 0.5);","return mask_last(shift_right(num, from), to - from);","}"].join("\n");return t.methods={packDepth:["vec4 packDepth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}"].join("\n"),unpackDepth:["float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}"].join("\n"),packFloat:[e,"vec4 packFloat (float val) {","if (val == 0.0) return vec4(0, 0, 0, 0);","float sign = val > 0.0 ? 0.0 : 1.0;","val = abs(val);","float exponent = floor(log2(val));","float biased_exponent = exponent + 127.0;","float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;","float t = biased_exponent / 2.0;","float last_bit_of_biased_exponent = fract(t) * 2.0;","float remaining_bits_of_biased_exponent = floor(t);","float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;","float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;","float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;","float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;","return vec4(byte4, byte3, byte2, byte1);","}"].join("\n"),unpackFloat:[e,"float unpackFloat (vec4 val) {","val = val * vec4(255.0);","float sign = - shift_right(val.w, 7.0) * 2.0 + 1.0;","float mantissa = ","val.x +","shift_left(val.y, 8.0) +","shift_left(extract_bits(val.z, 0.0, 7.0), 16.0);"," mantissa = mantissa / 8388608.0 + 1.0;","float exponent = ","shift_left(extract_bits(val.w, 0.0, 7.0), 1.0) +","shift_right(val.z, 7.0) - 127.0;","return sign * mantissa * exp2(exponent);","}"].join("\n"),packDepth16:["vec2 packDepth16( const in float depth ) {","const vec2 bias = vec2(1.0 / 255.0, 0.0);","vec2 res = vec2(depth, fract(depth * 255.0));","return res - (res.yy * bias);","}"].join("\n"),unpackDepth16:["float unpackDepth16( const in vec2 rg_depth ) {","return rg_depth.x + (rg_depth.y / 255.0);","}"].join("\n"),hsv:["vec3 rgb2hsv(vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}"].join("\n")},t.blendmodes=["#define BlendLinearDodgef				BlendAddf","#define BlendLinearBurnf				BlendSubstractf","#define BlendAddf(base, blend)			min(base + blend, 1.0)","#define BlendSubstractf(base, blend)	max(base + blend - 1.0, 0.0)","#define BlendLightenf(base, blend)		max(blend, base)","#define BlendDarkenf(base, blend)		min(blend, base)","#define BlendLinearLightf(base, blend)	(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))","#define BlendScreenf(base, blend)		(1.0 - ((1.0 - base) * (1.0 - blend)))","#define BlendOverlayf(base, blend)		(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))","#define BlendSoftLightf(base, blend)	((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))","#define BlendColorDodgef(base, blend)	((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))","#define BlendColorBurnf(base, blend)	((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))","#define BlendVividLightf(base, blend)	((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))","#define BlendPinLightf(base, blend)	((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))","#define BlendHardMixf(base, blend)		((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)","#define BlendReflectf(base, blend)		((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))","#define Blend(base, blend, funcf)		vec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))","#define BlendNormal(base, blend)		(blend)","#define BlendLighten					BlendLightenf","#define BlendDarken					BlendDarkenf","#define BlendMultiply(base, blend)		(base * blend)","#define BlendAverage(base, blend)		((base + blend) / 2.0)","#define BlendAdd(base, blend)			min(base + blend, vec3(1.0))","#define BlendSubstract(base, blend)	max(base + blend - vec3(1.0), vec3(0.0))","#define BlendDifference(base, blend)	abs(base - blend)","#define BlendNegation(base, blend)		(vec3(1.0) - abs(vec3(1.0) - base - blend))","#define BlendExclusion(base, blend)	(base + blend - 2.0 * base * blend)","#define BlendScreen(base, blend)		Blend(base, blend, BlendScreenf)","#define BlendOverlay(base, blend)		Blend(base, blend, BlendOverlayf)","#define BlendSoftLight(base, blend)	Blend(base, blend, BlendSoftLightf)","#define BlendHardLight(base, blend)	BlendOverlay(blend, base)","#define BlendColorDodge(base, blend)	Blend(base, blend, BlendColorDodgef)","#define BlendColorBurn(base, blend)	Blend(base, blend, BlendColorBurnf)","#define BlendLinearDodge				BlendAdd","#define BlendLinearBurn				BlendSubstract","#define BlendLinearLight(base, blend)	Blend(base, blend, BlendLinearLightf)","#define BlendVividLight(base, blend)	Blend(base, blend, BlendVividLightf)","#define BlendPinLight(base, blend)		Blend(base, blend, BlendPinLightf)","#define BlendHardMix(base, blend)		Blend(base, blend, BlendHardMixf)","#define BlendReflect(base, blend)		Blend(base, blend, BlendReflectf)","#define BlendGlow(base, blend)			BlendReflect(blend, base)","#define BlendPhoenix(base, blend)		(min(base, blend) - max(base, blend) + vec3(1.0))","#define GammaCorrection(color, gamma)											pow(color, vec3(1.0 / gamma))","#define LevelsControlInputRange(color, minInput, maxInput)						min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0))","#define LevelsControlInput(color, minInput, gamma, maxInput)					GammaCorrection(LevelsControlInputRange(color, minInput, maxInput), gamma)","#define LevelsControlOutputRange(color, minOutput, maxOutput)					mix(vec3(minOutput), vec3(maxOutput), color)","#define LevelsControl(color, minInput, gamma, maxInput, minOutput, maxOutput)	LevelsControlOutputRange(LevelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput)"].join("\n"),t}(),goo.Light=function(t){"use strict";function e(e){this.translation=new t,this.color=e?e.clone():new t(1,1,1),this.intensity=1,this.specularIntensity=1,this.shadowCaster=!1,this.lightCookie=null,this.shadowSettings={size:100,near:1,far:1e3,resolution:[512,512],upVector:t.UNIT_Y.clone(),darkness:1,shadowType:"VSM"},this.changedProperties=!1,this.changedColor=!1}return e.prototype.destroy=function(t){var e=this.shadowSettings;e.shadowData&&(e.shadowData.shadowTarget&&e.shadowData.shadowTarget.destroy(t.context),e.shadowData.shadowTargetDown&&e.shadowData.shadowTargetDown.destroy(t.context),e.shadowData.shadowBlurred&&e.shadowData.shadowBlurred.destroy(t.context)),delete e.shadowData},e.prototype.invalidateHandles=function(t){var e=this.shadowSettings;e.shadowData&&(e.shadowData.shadowTarget&&t.invalidateRenderTarget(e.shadowData.shadowTarget),e.shadowData.shadowTargetDown&&t.invalidateRenderTarget(e.shadowData.shadowTargetDown),e.shadowData.shadowBlurred&&t.invalidateRenderTarget(e.shadowData.shadowBlurred))},e.prototype.copy=function(t){return this.translation.copy(t.translation),this.color.copy(t.color),this.intensity=t.intensity,this.specularIntensity=t.specularIntensity,this.shadowCaster=t.shadowCaster,t.lightCookie&&(this.lightCookie=t.lightCookie.clone()),this.shadowSettings.size=t.shadowSettings.size,this.shadowSettings.near=t.shadowSettings.near,this.shadowSettings.far=t.shadowSettings.far,this.shadowSettings.resolution[0]=t.shadowSettings.resolution[0],this.shadowSettings.resolution[1]=t.shadowSettings.resolution[1],this.shadowSettings.upVector.copy(t.shadowSettings.upVector),this.shadowSettings.darkness=t.shadowSettings.darkness,this.shadowSettings.shadowType=t.shadowSettings.shadowType,this.changedProperties=t.changedProperties,this.changedColor=t.changedColor,this},e}(goo.Vector3),goo.PointLight=function(t){"use strict";function e(e){t.call(this,e),this.range=1e3}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.update=function(t){t.matrix.getTranslation(this.translation)},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.range=e.range,this},e.prototype.clone=function(){var t=new e(this.color.clone());return t.copy(this),t},e}(goo.Light),goo.DirectionalLight=function(t,e){"use strict";function r(r){e.call(this,r),this.direction=new t}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.update=function(t){t.matrix.getTranslation(this.translation),this.direction.setDirect(0,0,-1),this.direction.applyPostVector(t.matrix)},r.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.direction.copy(t.direction),this},r.prototype.clone=function(){var t=new r(this.color.clone());return t.copy(this),t},r}(goo.Vector3,goo.Light),goo.SpotLight=function(t,e){"use strict";function r(r){e.call(this,r),this.direction=new t,this.range=1e3,this.angle=45,this.penumbra=null,this.exponent=16}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.update=function(t){t.matrix.getTranslation(this.translation),this.direction.setDirect(0,0,-1),this.direction.applyPostVector(t.matrix)},r.prototype.copy=function(t){return e.prototype.copy.call(this,t),t.direction.copy(this.direction),this.range=t.range,this.angle=t.angle,this.penumbra=t.penumbra,this.exponent=t.exponent,this},r.prototype.clone=function(){var t=new r(this.color.clone());return t.copy(this),t},r}(goo.Vector3,goo.Light),goo.TangentGenerator=function(t,e,r){"use strict";function i(){}return i.addTangentBuffer=function(i,o){function n(e){for(var r=[],i=0;i<e.length;i+=2)r.push(new t(e[i+0],e[i+1]));return r}function a(t){for(var r=[],i=0;i<t.length;i+=3)r.push(new e(t[i+0],t[i+1],t[i+2]));return r}o=o||0;var s=i.getAttributeBuffer(r.POSITION);if(s){var h=i.getAttributeBuffer(r.NORMAL);if(h){var u=i.getAttributeBuffer("TEXCOORD"+o);if(u||0===o||(u=i.getAttributeBuffer(r.TEXCOORD0)),u){var c=i.getIndexBuffer();if(c){for(var l=i.vertexCount,d=i.indexCount/3,p=[],f=[],m=0;l>m;m++)p[m]=new e,f[m]=new e;for(var g=a(s),y=a(h),v=n(u),x=0;d>x;x++){var w=c[3*x],_=c[3*x+1],b=c[3*x+2],S=g[w],M=g[_],E=g[b],C=v[w],T=v[_],P=v[b],D=M.x-S.x,R=E.x-S.x,O=M.y-S.y,A=E.y-S.y,I=M.z-S.z,L=E.z-S.z,N=T.x-C.x,B=P.x-C.x,z=T.y-C.y,k=P.y-C.y,U=1/(N*k-B*z);if(isFinite(U)!==!1){var F=new e((k*D-z*R)*U,(k*O-z*A)*U,(k*I-z*L)*U),V=new e((N*R-B*D)*U,(N*A-B*O)*U,(N*L-B*I)*U);p[w].add(F),p[_].add(F),p[b].add(F),f[w].add(V),f[_].add(V),f[b].add(V)}}i.attributeMap[r.TANGENT]=r.createAttribute(4,"Float"),i.rebuildData(i.vertexCount,i.indexCount,!0);for(var j=i.getAttributeBuffer(r.TANGENT),H=new e,G=new e,x=0;l>x;x++){var X=y[x],W=p[x],Y=X.dot(W);H.copy(W).sub(G.copy(X).scale(Y)).normalize(),j[4*x+0]=H.x,j[4*x+1]=H.y,j[4*x+2]=H.z,Y=H.copy(X).cross(W).dot(f[x]);var q=0>Y?-1:1;j[4*x+3]=q}return j}}}}},i}(goo.Vector2,goo.Vector3,goo.MeshData),goo.ShaderBuilder=function(t,e,r,i,o,n,a,s){"use strict";function h(){}var u=new i;u.translation.setDirect(10,10,10),u.direction.setDirect(1,1,1).normalize(),h.defaultLight=u,h.SKYBOX=null,h.SKYSPHERE=null,h.ENVIRONMENT_TYPE=0,h.GLOBAL_AMBIENT=[0,0,0],h.CLEAR_COLOR=[.3,.3,.3,1],h.USE_FOG=!1,h.FOG_SETTINGS=[0,1e4],h.FOG_COLOR=[1,1,1],h.uber={defines:function(t,e){for(var r=Object.keys(e),i=0,o=r.length;o>i;i++)t.setDefine(r[i],!0)},txMaps:function(t,e){for(var r=Object.keys(e),i=0,o=r.length;o>i;i++){var n=r[i];void 0!==e[n]&&null!==e[n]&&"SHADOW_MAP"!==n&&t.setDefine(n,!0)}},reflectivity:function(t,e){e.uniforms.reflectivity||e.uniforms.refractivity?t.setDefine("REFLECTIVE",!0):t.removeDefine("REFLECTIVE"),t.setDefine("REFLECTION_TYPE",void 0!==e.uniforms.reflectionType?e.uniforms.reflectionType:0)},sky:function(t,e){e.getTexture("LOCAL_ENVIRONMENT")?(e.setTexture("ENVIRONMENT_SPHERE",e.getTexture("LOCAL_ENVIRONMENT")),t.setDefine("ENVIRONMENT_TYPE",0),e.getTexture("ENVIRONMENT_CUBE")&&e.removeTexture("ENVIRONMENT_CUBE")):(h.SKYBOX&&(e.uniforms.reflectivity||e.uniforms.refractivity)?e.setTexture("ENVIRONMENT_CUBE",h.SKYBOX):e.getTexture("ENVIRONMENT_CUBE")&&e.removeTexture("ENVIRONMENT_CUBE"),h.SKYSPHERE&&(e.uniforms.reflectivity||e.uniforms.refractivity)?(e.setTexture("ENVIRONMENT_SPHERE",h.SKYSPHERE),t.setDefine("ENVIRONMENT_TYPE",h.ENVIRONMENT_TYPE)):e.getTexture("ENVIRONMENT_SPHERE")&&e.removeTexture("ENVIRONMENT_SPHERE"))},uniforms:function(t,e){if(e.DIFFUSE_MAP){var r=e.DIFFUSE_MAP.offset,i=e.DIFFUSE_MAP.repeat;t.uniforms.offsetRepeat[0]=r.x,t.uniforms.offsetRepeat[1]=r.y,t.uniforms.offsetRepeat[2]=i.x,t.uniforms.offsetRepeat[3]=i.y,t.uniforms.lodBias=e.DIFFUSE_MAP.lodBias}else t.uniforms.offsetRepeat[0]=0,t.uniforms.offsetRepeat[1]=0,t.uniforms.offsetRepeat[2]=1,t.uniforms.offsetRepeat[3]=1,t.uniforms.lodBias=0},attributes:function(t,e,r){for(var i=Object.keys(t.defines),o=0,n=i.length;n>o;o++){var a=i[o];"SHADOW_TYPE"!==a&&"JOINT_COUNT"!==a&&"WEIGHTS"!==a&&"PHYSICALLY_BASED_SHADING"!==a&&"ENVIRONMENT_TYPE"!==a&&"REFLECTIVE"!==a&&"DISCARD"!==a&&"OPACITY"!==a&&"FOG"!==a&&"REFLECTION_TYPE"!==a&&"SKIP_SPECULAR"!==a&&"LIGHT"!==a&&"COOKIE"!==a&&"TRANSPARENCY_BW"!==a&&"WRAP_AROUND"!==a&&(e[a]||r[a]||t.removeDefine(a))}},discard:function(t,e){e.uniforms.discardThreshold>=0?t.setDefine("DISCARD",!0):t.removeDefine("DISCARD")},opacity:function(t,e){var r=e.uniforms.opacity;void 0!==r&&1>r?t.setDefine("OPACITY",!0):t.removeDefine("OPACITY"),e.uniforms.useBWTransparency===!0?t.setDefine("TRANSPARENCY_BW",!0):t.removeDefine("TRANSPARENCY_BW")},fog:function(t){h.USE_FOG?(t.setDefine("FOG",!0),t.uniforms.fogSettings=h.FOG_SETTINGS,t.uniforms.fogColor=h.FOG_COLOR):t.removeDefine("FOG")},normalTangents:function(t,r){t.hasDefine("NORMAL")&&t.hasDefine("NORMAL_MAP")&&!r.meshData.getAttributeBuffer(e.TANGENT)&&s.addTangentBuffer(r.meshData)},processor:function(t,e){var r=e.meshData.attributeMap,i=e.material,o=i._textureMaps;t.uniforms.clearColor=h.CLEAR_COLOR,h.uber.reflectivity(t,i),h.uber.sky(t,i),h.uber.defines(t,r),h.uber.txMaps(t,o),h.uber.uniforms(t,o),h.uber.attributes(t,r,o),h.uber.discard(t,i),h.uber.opacity(t,i),h.uber.fog(t),t.setDefine("SKIP_SPECULAR",!0),h.uber.normalTangents(t,e)}};var c=[];return h.light={pointLight:function(t,e,r){var i=e.pointLights=e.pointLights||[],o=8*r,n=t.translation;i[o+0]=n.x,i[o+1]=n.y,i[o+2]=n.z,i[o+3]=t.range;var a=t.color;i[o+4]=a.x*t.intensity,i[o+5]=a.y*t.intensity,i[o+6]=a.z*t.intensity,i[o+7]=t.specularIntensity,c.push("P")},directionalLight:function(t,e,r){var i=e.directionalLights=e.directionalLights||[],o=8*r,n=t.direction;i[o+0]=n.x,i[o+1]=n.y,i[o+2]=n.z,i[o+3]=0;var a=t.color;i[o+4]=a.x*t.intensity,i[o+5]=a.y*t.intensity,i[o+6]=a.z*t.intensity,i[o+7]=t.specularIntensity,c.push("D")},spotLight:function(t,e,r){var i=e.spotLights=e.spotLights||[],o=16*r;i[o+0]=t.translation.x,i[o+1]=t.translation.y,i[o+2]=t.translation.z,i[o+3]=t.range,i[o+4]=t.color.x*t.intensity,i[o+5]=t.color.y*t.intensity,i[o+6]=t.color.z*t.intensity,i[o+7]=t.specularIntensity,i[o+8]=t.direction.x,i[o+9]=t.direction.y,i[o+10]=t.direction.z,i[o+11]=0,i[o+12]=Math.cos(t.angle*a.DEG_TO_RAD/2),i[o+13]=void 0!==t.penumbra?Math.sin(t.penumbra*a.DEG_TO_RAD/4):0,i[o+14]=0,i[o+15]=0,c.push("S")},shadows:function(t,e,r,i,o,a){var s=t.lightCookie instanceof n;if((s||t.shadowCaster&&o.renderable.meshRendererComponent&&o.renderable.meshRendererComponent.receiveShadows)&&t.shadowSettings.shadowData){var h=t.shadowSettings.shadowData;if(t.shadowCaster){e["shadowMaps"+r]="SHADOW_MAP"+r,o.material.setTexture("SHADOW_MAP"+r,h.shadowResult);var u=e.shadowData=e.shadowData||[],l=8*a,d=h.lightCamera.translation;u[l+0]=d.x,u[l+1]=d.y,u[l+2]=d.z,u[l+3]=0,u[l+4]=h.cameraScale,u[l+5]=t.shadowSettings.darkness,"PCF"===t.shadowSettings.shadowType?(u[l+6]=t.shadowSettings.resolution[0],u[l+7]=t.shadowSettings.resolution[1]):(u[l+6]=0,u[l+7]=0),a++,c.push("H","PCF"===t.shadowSettings.shadowType?1:"VSM"===t.shadowSettings.shadowType?2:0)}s?(e["lightCookie"+r]="LIGHT_COOKIE"+r,o.material.setTexture("LIGHT_COOKIE"+r,t.lightCookie),c.push("C"),i.setDefine("COOKIE",!0)):i.removeDefine("COOKIE"),e["shadowLightMatrices"+r]=h.vpm}return a},processor:function(t,e){var a=t.uniforms;a.totalAmbient=a.totalAmbient||[.1,.1,.1],e.material.uniforms.totalAmbient=e.material.uniforms.totalAmbient||[.1,.1,.1];var s=e.material.uniforms.materialAmbient||a.materialAmbient||[.1,.1,.1,1],u=e.material.uniforms.totalAmbient;if(e.material.multiplyAmbient?(u[0]=s[0]*h.GLOBAL_AMBIENT[0],u[1]=s[1]*h.GLOBAL_AMBIENT[1],u[2]=s[2]*h.GLOBAL_AMBIENT[2]):(u[0]=s[0]+h.GLOBAL_AMBIENT[0],u[1]=s[1]+h.GLOBAL_AMBIENT[1],u[2]=s[2]+h.GLOBAL_AMBIENT[2]),t.frameStart){a.materialEmissive=a.materialEmissive||"EMISSIVE",a.materialDiffuse=a.materialDiffuse||"DIFFUSE",a.materialSpecular=a.materialSpecular||"SPECULAR";var l=0,d=0,p=0,f=0,m=e.lights;if(m.length>0){for(var g=0;g<m.length;g++){var y=m[g];y instanceof r?(h.light.pointLight(y,a,l),l++):y instanceof i?(h.light.directionalLight(y,a,d),d++):y instanceof o&&(h.light.spotLight(y,a,p),p++),f=h.light.shadows(y,a,g,t,e,f)}var v=c.join("");t.setDefine("LIGHT",v),c.length=0}else t.removeDefine("LIGHT")}else for(var m=e.lights,g=0;g<m.length;g++){var y=m[g],x=y.lightCookie instanceof n;if((x||y.shadowCaster&&e.renderable.meshRendererComponent&&e.renderable.meshRendererComponent.receiveShadows)&&y.shadowSettings.shadowData){var w=y.shadowSettings.shadowData;y.shadowCaster&&e.material.setTexture("SHADOW_MAP"+g,w.shadowResult),x&&e.material.setTexture("LIGHT_COOKIE"+g,y.lightCookie)}else e.material.removeTexture("SHADOW_MAP"+g)}},builder:function(t,e){var a=[],s=[],u=[],c=[];a.push("const mat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"),u.push("uniform vec3 totalAmbient;","uniform vec4 materialEmissive;","uniform vec4 materialDiffuse;","uniform vec4 materialSpecular;","uniform vec2 wrapSettings;","float ChebychevInequality(in vec2 moments, in float t) {","if ( t <= moments.x ) return 1.0;","float variance = moments.y - (moments.x * moments.x);","variance = max(variance, 0.02);","float d = t - moments.x;","return variance / (variance + d * d);","}"),c.push("#if defined(SPECULAR_MAP) && defined(TEXCOORD0)","float specularStrength = texture2D(specularMap, texCoord0).x;","#else","float specularStrength = 1.0;","#endif","vec3 totalDiffuse = vec3(0.0);","vec3 totalSpecular = vec3(0.0);");var l=e.lights;if(l.length>0){c.push("vec3 normalizedViewPosition = normalize(viewPosition);");for(var d=0,p=0,f=0,m=0,g=0;g<l.length;g++){var y=l[g];y instanceof r?d++:y instanceof i?p++:y instanceof o&&f++;var v=y.lightCookie instanceof n;(v||y.shadowCaster&&e.renderable.meshRendererComponent&&e.renderable.meshRendererComponent.receiveShadows)&&m++}d>0&&u.push("uniform vec4 pointLights["+2*d+"];"),p>0&&u.push("uniform vec4 directionalLights["+2*p+"];"),f>0&&u.push("uniform vec4 spotLights["+4*f+"];"),m>0&&u.push("uniform vec4 shadowData["+2*m+"];"),d=0,p=0,f=0,m=0;for(var g=0;g<l.length;g++){var y=l[g];c.push("{","float shadow = 1.0;");var v=y.lightCookie instanceof n;(v||y.shadowCaster&&e.renderable.meshRendererComponent&&e.renderable.meshRendererComponent.receiveShadows)&&(a.push("uniform mat4 shadowLightMatrices"+g+";","varying vec4 shadowLightDepths"+g+";"),s.push("shadowLightDepths"+g+" = ScaleMatrix * shadowLightMatrices"+g+" * worldPos;"),y.shadowCaster&&(u.push("uniform sampler2D shadowMaps"+g+";"),c.push("vec3 shadowLightPositions"+g+" = shadowData["+(2*m+0)+"].xyz;","float cameraScales"+g+" = shadowData["+(2*m+1)+"].x;","float shadowDarkness"+g+" = shadowData["+(2*m+1)+"].y;")),v&&u.push("uniform sampler2D lightCookie"+g+";"),u.push("varying vec4 shadowLightDepths"+g+";"),y.shadowCaster&&"PCF"===y.shadowSettings.shadowType&&c.push("vec2 shadowMapSizes"+g+" = shadowData["+(2*m+1)+"].zw;"),c.push("vec3 depth = shadowLightDepths"+g+".xyz / shadowLightDepths"+g+".w;"),y.shadowCaster&&(m++,c.push("depth.z = length(vWorldPos.xyz - shadowLightPositions"+g+") * cameraScales"+g+";","if (depth.x >= 0.0 && depth.x <= 1.0 && depth.y >= 0.0 && depth.y <= 1.0 && shadowLightDepths"+g+".z >= 0.0 && depth.z <= 1.0) {"),"PCF"===y.shadowSettings.shadowType?c.push("depth.z *= 0.96;","float shadowPcf = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSizes"+g+".x;","float yPixelOffset = 1.0 / shadowMapSizes"+g+".y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","float fDepth = 0.0;","fDepth = texture2D(shadowMaps"+g+", depth.xy + vec2(dx0, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+g+", depth.xy + vec2(0.0, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+g+", depth.xy + vec2(dx1, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+g+", depth.xy + vec2(dx0, 0.0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth =  texture2D(shadowMaps"+g+", depth.xy).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+g+", depth.xy + vec2(dx1, 0.0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+g+", depth.xy + vec2(dx0, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+g+", depth.xy + vec2(0.0, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+g+", depth.xy + vec2(dx1, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","shadow = mix(1.0, 1.0 - shadowPcf, shadowDarkness"+g+");"):"VSM"===y.shadowSettings.shadowType?c.push("vec4 texel = texture2D(shadowMaps"+g+", depth.xy);","vec2 moments = vec2(texel.x, texel.y);","shadow = ChebychevInequality(moments, depth.z);","shadow = pow(shadow, shadowDarkness"+g+" * 8.0);"):c.push("depth.z *= 0.96;","float shadowDepth = texture2D(shadowMaps"+g+", depth.xy).x;","if ( depth.z > shadowDepth ) shadow = 1.0 - shadowDarkness"+g+";"),
c.push("}","shadow = clamp(shadow, 0.0, 1.0);"))),y instanceof r?(c.push("vec4 pointLight"+g+" = pointLights["+(2*d+0)+"];","vec4 pointLightColor"+g+" = pointLights["+(2*d+1)+"];"),c.push("vec3 lVector = normalize(pointLight"+g+".xyz - vWorldPos.xyz);","float lDistance = 1.0 - min((length(pointLight"+g+".xyz - vWorldPos.xyz) / pointLight"+g+".w), 1.0);","float dotProduct = dot(N, lVector);","float pointDiffuseWeightFull = max(dotProduct, 0.0);","float pointDiffuseWeightHalf = max(mix(dotProduct, 1.0, wrapSettings.x), 0.0);","vec3 pointDiffuseWeight = mix(vec3(pointDiffuseWeightFull), vec3(pointDiffuseWeightHalf), wrapSettings.y);","totalDiffuse += materialDiffuse.rgb * pointLightColor"+g+".rgb * pointDiffuseWeight * lDistance * shadow;","vec3 pointHalfVector = normalize(lVector + normalizedViewPosition);","float pointDotNormalHalf = max(dot(N, pointHalfVector), 0.0);","float pointSpecularWeight = pointLightColor"+g+".a * specularStrength * max(pow(pointDotNormalHalf, materialSpecular.a), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecular.a + 2.0001 ) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, pointHalfVector), 5.0);","totalSpecular += schlick * pointLightColor"+g+".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization * shadow;","#else","totalSpecular += materialSpecular.rgb * pointLightColor"+g+".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * shadow;","#endif"),d++):y instanceof i?(c.push("vec3 directionalLightDirection"+g+" = directionalLights["+(2*p+0)+"].xyz;","vec4 directionalLightColor"+g+" = directionalLights["+(2*p+1)+"];"),c.push("vec3 dirVector = normalize(-directionalLightDirection"+g+");","float dotProduct = dot(N, dirVector);","float dirDiffuseWeightFull = max(dotProduct, 0.0);","float dirDiffuseWeightHalf = max(mix(dotProduct, 1.0, wrapSettings.x), 0.0);","vec3 dirDiffuseWeight = mix(vec3(dirDiffuseWeightFull), vec3(dirDiffuseWeightHalf), wrapSettings.y);","vec3 cookie = vec3(1.0);"),v&&c.push("vec4 cookieTex = texture2D(lightCookie"+g+", depth.xy);","cookie = cookieTex.rgb * cookieTex.a;"),c.push("totalDiffuse += materialDiffuse.rgb * directionalLightColor"+g+".rgb * dirDiffuseWeight * shadow * cookie;","vec3 dirHalfVector = normalize(dirVector + normalizedViewPosition);","float dirDotNormalHalf = max(dot(N, dirHalfVector), 0.0);","float dirSpecularWeight = directionalLightColor"+g+".a * specularStrength * max(pow(dirDotNormalHalf, materialSpecular.a), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecular.a + 2.0001) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(dirVector, dirHalfVector), 5.0);","totalSpecular += schlick * directionalLightColor"+g+".rgb * dirSpecularWeight * dirDiffuseWeight * specularNormalization * shadow * cookie;","#else","totalSpecular += materialSpecular.rgb * directionalLightColor"+g+".rgb * dirSpecularWeight * dirDiffuseWeight * shadow * cookie;","#endif"),p++):y instanceof o&&(c.push("vec4 spotLight"+g+" = spotLights["+(4*f+0)+"];","vec4 spotLightColor"+g+" = spotLights["+(4*f+1)+"];","vec3 spotLightDirection"+g+" = spotLights["+(4*f+2)+"].xyz;","float spotLightAngle"+g+" = spotLights["+(4*f+3)+"].x;","float spotLightPenumbra"+g+" = spotLights["+(4*f+3)+"].y;"),c.push("vec3 lVector = normalize(spotLight"+g+".xyz - vWorldPos.xyz);","float lDistance = 1.0 - min((length(spotLight"+g+".xyz - vWorldPos.xyz) / spotLight"+g+".w), 1.0);","float spotEffect = dot(normalize(-spotLightDirection"+g+"), lVector);","if (spotEffect > spotLightAngle"+g+") {","if (spotLightPenumbra"+g+" > 0.0) {","spotEffect = (spotEffect - spotLightAngle"+g+") / spotLightPenumbra"+g+";","spotEffect = clamp(spotEffect, 0.0, 1.0);","} else {","spotEffect = 1.0;","}","float dotProduct = dot(N, lVector);","float spotDiffuseWeightFull = max(dotProduct, 0.0);","float spotDiffuseWeightHalf = max(mix(dotProduct, 1.0, wrapSettings.x), 0.0);","vec3 spotDiffuseWeight = mix(vec3(spotDiffuseWeightFull), vec3(spotDiffuseWeightHalf), wrapSettings.y);","vec3 cookie = vec3(1.0);"),v&&c.push("cookie = texture2D(lightCookie"+g+", depth.xy).rgb;"),c.push("totalDiffuse += materialDiffuse.rgb * spotLightColor"+g+".rgb * spotDiffuseWeight * lDistance * spotEffect * shadow * cookie;","vec3 spotHalfVector = normalize(lVector + normalizedViewPosition);","float spotDotNormalHalf = max(dot(N, spotHalfVector), 0.0);","float spotSpecularWeight = spotLightColor"+g+".a * specularStrength * max(pow(spotDotNormalHalf, materialSpecular.a), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecular.a + 2.0001) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, spotHalfVector), 5.0);","totalSpecular += schlick * spotLightColor"+g+".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect * shadow * cookie;","#else","totalSpecular += materialSpecular.rgb * spotLightColor"+g+".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect * shadow * cookie;","#endif","}"),f++),c.push("}")}}c.push("#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)","vec3 emissive = vec3(0.0);","#else","vec3 emissive = materialEmissive.rgb;","#endif","#ifdef SKIP_SPECULAR","final_color.xyz = final_color.xyz * (emissive + totalDiffuse + totalAmbient);","#else","final_color.xyz = final_color.xyz * (emissive + totalDiffuse + totalAmbient) + totalSpecular;","#endif","#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)","final_color.rgb += texture2D(emissiveMap, texCoord0).rgb * materialEmissive.rgb;","#endif"),h.light.prevertex=a.join("\n"),h.light.vertex=s.join("\n"),h.light.prefragment=u.join("\n"),h.light.fragment=c.join("\n")}},h.animation={processor:function(t,e){var r=e.currentPose;r?(t.uniforms.jointPalette||(t.uniforms.jointPalette=h.animation.jointPalette),t.setDefine("JOINT_COUNT",3*e.meshData.paletteMap.length)):t.removeDefine("JOINT_COUNT")},jointPalette:function(t){var e=t.meshData,r=t.currentPose;if(r){var i=r._matrixPalette,o=e.store;o||(o=new Float32Array(12*e.paletteMap.length),e.store=o);for(var n,a=0;a<e.paletteMap.length;a++){n=i[e.paletteMap[a]];for(var s=0;12>s;s++)o[12*a+s]=n.data[h.animation.order[s]]}return o}},order:[0,4,8,12,1,5,9,13,2,6,10,14],prevertex:["#ifdef JOINTIDS","attribute vec4 vertexJointIDs;","#endif","#ifdef WEIGHTS","attribute vec4 vertexWeights;","#endif","#ifdef JOINT_COUNT","uniform vec4 jointPalette[JOINT_COUNT];","#endif"].join("\n"),vertex:["#if defined(JOINT_COUNT) && defined(WEIGHTS) && defined(JOINTIDS)","int x = 3*int(vertexJointIDs.x);","int y = 3*int(vertexJointIDs.y);","int z = 3*int(vertexJointIDs.z);","int w = 3*int(vertexJointIDs.w);","mat4 mat = mat4(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);","mat += mat4(","	jointPalette[x+0].x, jointPalette[x+1].x, jointPalette[x+2].x, 0,","	jointPalette[x+0].y, jointPalette[x+1].y, jointPalette[x+2].y, 0,","	jointPalette[x+0].z, jointPalette[x+1].z, jointPalette[x+2].z, 0,","	jointPalette[x+0].w, jointPalette[x+1].w, jointPalette[x+2].w, 1",") * vertexWeights.x;","mat += mat4(","	jointPalette[y+0].x, jointPalette[y+1].x, jointPalette[y+2].x, 0,","	jointPalette[y+0].y, jointPalette[y+1].y, jointPalette[y+2].y, 0,","	jointPalette[y+0].z, jointPalette[y+1].z, jointPalette[y+2].z, 0,","	jointPalette[y+0].w, jointPalette[y+1].w, jointPalette[y+2].w, 1",") * vertexWeights.y;","mat += mat4(","	jointPalette[z+0].x, jointPalette[z+1].x, jointPalette[z+2].x, 0,","	jointPalette[z+0].y, jointPalette[z+1].y, jointPalette[z+2].y, 0,","	jointPalette[z+0].z, jointPalette[z+1].z, jointPalette[z+2].z, 0,","	jointPalette[z+0].w, jointPalette[z+1].w, jointPalette[z+2].w, 1",") * vertexWeights.z;","mat += mat4(","	jointPalette[w+0].x, jointPalette[w+1].x, jointPalette[w+2].x, 0,","	jointPalette[w+0].y, jointPalette[w+1].y, jointPalette[w+2].y, 0,","	jointPalette[w+0].z, jointPalette[w+1].z, jointPalette[w+2].z, 0,","	jointPalette[w+0].w, jointPalette[w+1].w, jointPalette[w+2].w, 1",") * vertexWeights.w;","wMatrix = wMatrix * mat / mat[3][3];","#ifdef NORMAL","nMatrix = nMatrix * mat3(mat) / mat[3][3];","#endif","#endif"].join("\n")},h}(goo.Capabilities,goo.MeshData,goo.PointLight,goo.DirectionalLight,goo.SpotLight,goo.Texture,goo.MathUtils,goo.TangentGenerator),goo.ShaderLib=function(t,e,r,i){"use strict";function o(){}return o.uber={processors:[i.uber.processor,i.light.processor,i.animation.processor],attributes:{vertexPosition:t.POSITION,vertexNormal:t.NORMAL,vertexTangent:t.TANGENT,vertexColor:t.COLOR,vertexUV0:t.TEXCOORD0,vertexUV1:t.TEXCOORD1,vertexJointIDs:t.JOINTIDS,vertexWeights:t.WEIGHTS},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,normalMatrix:e.NORMAL_MATRIX,cameraPosition:e.CAMERA,diffuseMap:e.DIFFUSE_MAP,offsetRepeat:[0,0,1,1],normalMap:e.NORMAL_MAP,normalMultiplier:1,specularMap:e.SPECULAR_MAP,emissiveMap:e.EMISSIVE_MAP,aoMap:e.AO_MAP,lightMap:e.LIGHT_MAP,environmentCube:"ENVIRONMENT_CUBE",environmentSphere:"ENVIRONMENT_SPHERE",reflectionMap:"REFLECTION_MAP",transparencyMap:"TRANSPARENCY_MAP",opacity:1,reflectivity:0,refractivity:0,etaRatio:-.5,fresnel:0,discardThreshold:-.01,fogSettings:[0,1e4],fogColor:[1,1,1],shadowDarkness:.5,vertexColorAmount:1,lodBias:0,wrapSettings:[.5,0]},builder:function(t,e){i.light.builder(t,e)},vshader:function(){return["attribute vec3 vertexPosition;","#ifdef NORMAL","attribute vec3 vertexNormal;","#endif","#ifdef TANGENT","attribute vec4 vertexTangent;","#endif","#ifdef COLOR","attribute vec4 vertexColor;","#endif","#ifdef TEXCOORD0","attribute vec2 vertexUV0;","uniform vec4 offsetRepeat;","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","attribute vec2 vertexUV1;","varying vec2 texCoord1;","#endif","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef COLOR","varying vec4 color;","#endif",i.light.prevertex,i.animation.prevertex,"void main(void) {","mat4 wMatrix = worldMatrix;","#ifdef NORMAL","mat3 nMatrix = normalMatrix;","#endif",i.animation.vertex,"vec4 worldPos = wMatrix * vec4(vertexPosition, 1.0);","vWorldPos = worldPos.xyz;","gl_Position = viewProjectionMatrix * worldPos;","viewPosition = cameraPosition - worldPos.xyz;","#ifdef NORMAL","	normal = normalize(nMatrix * vertexNormal);","#endif","#ifdef TANGENT","	tangent = normalize(nMatrix * vertexTangent.xyz);","	binormal = cross(normal, tangent) * vec3(vertexTangent.w);","#endif","#ifdef COLOR","	color = vertexColor;","#endif","#ifdef TEXCOORD0","	texCoord0 = vertexUV0 * offsetRepeat.zw + offsetRepeat.xy;","#endif","#ifdef TEXCOORD1","	texCoord1 = vertexUV1;","#endif",i.light.vertex,"}"].join("\n")},fshader:function(){return["uniform float lodBias;","#ifdef DIFFUSE_MAP","uniform sampler2D diffuseMap;","#endif","#ifdef NORMAL_MAP","uniform sampler2D normalMap;","uniform float normalMultiplier;","#endif","#ifdef SPECULAR_MAP","uniform sampler2D specularMap;","#endif","#ifdef EMISSIVE_MAP","uniform sampler2D emissiveMap;","#endif","#ifdef AO_MAP","uniform sampler2D aoMap;","#endif","#ifdef LIGHT_MAP","uniform sampler2D lightMap;","#endif","#ifdef TRANSPARENCY_MAP","uniform sampler2D transparencyMap;","#endif","#ifdef REFLECTIVE","#ifdef ENVIRONMENT_CUBE","uniform samplerCube environmentCube;","#elif defined(ENVIRONMENT_SPHERE)","uniform sampler2D environmentSphere;","#endif","uniform vec4 clearColor;","uniform float reflectivity;","uniform float fresnel;","uniform float refractivity;","uniform float etaRatio;","#ifdef REFLECTION_MAP","uniform sampler2D reflectionMap;","#endif","#endif","#ifdef OPACITY","uniform float opacity;","#endif","#ifdef DISCARD","uniform float discardThreshold;","#endif","#ifdef FOG","uniform vec2 fogSettings;","uniform vec3 fogColor;","#endif","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef COLOR","varying vec4 color;","uniform float vertexColorAmount;","#endif","#ifdef TEXCOORD0","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","varying vec2 texCoord1;","#endif","#define M_PI 3.14159265358979323846264338328",i.light.prefragment,"void main(void)","{","vec4 final_color = vec4(1.0);","#if defined(DIFFUSE_MAP) && defined(TEXCOORD0)","final_color *= texture2D(diffuseMap, texCoord0, lodBias);","#endif","#ifdef COLOR","final_color *= mix(vec4(1.0), color, vertexColorAmount);","#endif","#if defined(TRANSPARENCY_MAP) && defined(TEXCOORD0)","#ifdef TRANSPARENCY_BW","final_color.a = texture2D(transparencyMap, texCoord0).r;","#else","final_color.a = texture2D(transparencyMap, texCoord0).a;","#endif","#endif","#ifdef OPACITY","final_color.a *= opacity;","#endif","#ifdef DISCARD","if (final_color.a < discardThreshold) discard;","#endif","#ifdef AO_MAP","#ifdef TEXCOORD1","final_color.rgb *= texture2D(aoMap, texCoord1).rgb;","#elif defined(TEXCOORD0)","final_color.rgb *= texture2D(aoMap, texCoord0).rgb;","#endif","#endif","#ifdef LIGHT_MAP","#ifdef TEXCOORD1","final_color.rgb *= texture2D(lightMap, texCoord1).rgb * 2.0;","#elif defined(TEXCOORD0)","final_color.rgb *= texture2D(lightMap, texCoord0).rgb * 2.0;","#endif","#else","vec3 N = vec3(0.0, 1.0, 0.0);","#if defined(NORMAL)","N = normalize(normal);","#endif","#if defined(TANGENT) && defined(NORMAL_MAP) && defined(TEXCOORD0)","mat3 tangentToWorld = mat3(tangent, binormal, normal);","vec3 tangentNormal = texture2D(normalMap, texCoord0, lodBias).xyz * vec3(2.0) - vec3(1.0);","tangentNormal.xy *= normalMultiplier;","vec3 worldNormal = (tangentToWorld * tangentNormal);","N = normalize(worldNormal);","#endif",i.light.fragment,"#endif","#ifdef REFLECTIVE","if (refractivity > 0.0) {","vec4 environment = vec4(0.0);","#ifdef ENVIRONMENT_CUBE","vec3 refractionVector = refract(normalize(viewPosition), N, etaRatio);","refractionVector.x = -refractionVector.x;","environment = textureCube(environmentCube, refractionVector);","#elif defined(ENVIRONMENT_SPHERE)","vec3 refractionVector = refract(normalize(viewPosition), N, etaRatio);","refractionVector = -refractionVector;","float xx = (atan(refractionVector.z, refractionVector.x) + M_PI) / (2.0 * M_PI);","float yy = refractionVector.y * 0.5 + 0.5;","environment = texture2D(environmentSphere, vec2(xx, yy));","#endif","environment.rgb = mix(clearColor.rgb, environment.rgb, environment.a);","final_color.rgb = mix(final_color.rgb, environment.rgb, refractivity);","}","if (reflectivity > 0.0) {","vec4 environment = vec4(0.0);","#ifdef ENVIRONMENT_CUBE","vec3 reflectionVector = reflect(normalize(viewPosition), N);","reflectionVector.yz = -reflectionVector.yz;","environment = textureCube(environmentCube, reflectionVector);","#elif defined(ENVIRONMENT_SPHERE)","vec3 reflectionVector = reflect(normalize(viewPosition), N);","float xx = (atan(reflectionVector.z, reflectionVector.x) + M_PI) / (2.0 * M_PI);","float yy = reflectionVector.y * 0.5 + 0.5;","environment = texture2D(environmentSphere, vec2(xx, yy));","#endif","environment.rgb = mix(clearColor.rgb, environment.rgb, environment.a);","float reflectionAmount = reflectivity;","#if defined(REFLECTION_MAP) && defined(TEXCOORD0)","reflectionAmount *= texture2D(reflectionMap, texCoord0).r;","#endif","float fresnelVal = pow(1.0 - abs(dot(normalize(viewPosition), N)), fresnel * 4.0);","reflectionAmount *= fresnelVal;","#if REFLECTION_TYPE == 0","final_color.rgb = mix(final_color.rgb, environment.rgb, reflectionAmount);","#elif REFLECTION_TYPE == 1","final_color.rgb += environment.rgb * reflectionAmount;","#endif","final_color.a = min(final_color.a + reflectionAmount, 1.0);","}","#endif","#ifndef LIGHT_MAP","final_color.rgb += totalSpecular;","final_color.a = min(final_color.a + length(totalSpecular) / 3.0, 1.0);","#endif","#ifdef FOG","float d = pow(smoothstep(fogSettings.x, fogSettings.y, length(viewPosition)), 1.0);","final_color.rgb = mix(final_color.rgb, fogColor, d);","#endif","gl_FragColor = final_color;","}"].join("\n")}},o.screenCopy={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","varying vec2 texCoord0;","void main(void) {","texCoord0 = vertexUV0;","gl_Position = vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},o.copy={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,opacity:1,diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","texCoord0 = vertexUV0;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","uniform float opacity;","varying vec2 texCoord0;","void main(void)","{","gl_FragColor = vec4(texture2D(diffuseMap, texCoord0).rgb, opacity);","}"].join("\n")},o.copyPure={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,opacity:1,diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","texCoord0 = vertexUV0;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","uniform float opacity;","varying vec2 texCoord0;","void main(void)","{","vec4 col = texture2D(diffuseMap, texCoord0);","gl_FragColor = vec4(col.rgb, col.a * opacity);","}"].join("\n")},o.simple={attributes:{vertexPosition:t.POSITION},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["void main(void)","{","gl_FragColor = vec4(1.0);","}"].join("\n")},o.simpleColored={attributes:{vertexPosition:t.POSITION},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,color:[1,1,1],opacity:1},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["uniform vec3 color;","uniform float opacity;","void main(void)","{","if (opacity == 0.0) {","discard;","}","gl_FragColor = vec4(color, opacity);","}"].join("\n")},o.simpleLit={processors:[i.light.processor],defines:{NORMAL:!0},attributes:{vertexPosition:t.POSITION,vertexNormal:t.NORMAL},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraPosition:e.CAMERA,opacity:1},builder:function(t,e){i.light.builder(t,e)},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;",i.light.prevertex,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","void main(void) {","vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","vWorldPos = worldPos.xyz;","gl_Position = viewProjectionMatrix * worldPos;",i.light.vertex,"normal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["#ifdef SPECULAR_MAP","uniform sampler2D specularMap;","#ifdef TEXCOORD0","varying vec2 texCoord0;","#endif","#endif","uniform float opacity;",i.light.prefragment,"#ifdef NORMAL","varying vec3 normal;","#endif","varying vec3 vWorldPos;","varying vec3 viewPosition;","void main(void)","{","if (opacity == 0.0) {","discard;","}","#ifdef NORMAL","vec3 N = normalize(normal);","#else","vec3 N = vec3(0,0,1);","#endif","vec4 final_color = vec4(1.0);",i.light.fragment,"final_color.a = opacity;","gl_FragColor = final_color;","}"].join("\n")}},o.textured={defines:{TEXCOORD0:!0,DIFFUSE_MAP:!0},attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","texCoord0 = vertexUV0;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["#if defined(TEXCOORD0) && defined(DIFFUSE_MAP)","uniform sampler2D diffuseMap;","varying vec2 texCoord0;","#endif","void main(void)","{","#if defined(TEXCOORD0) && defined(DIFFUSE_MAP)","gl_FragColor = texture2D(diffuseMap, texCoord0);","#else","gl_FragColor = vec4(1.0);","#endif","}"].join("\n")},o.texturedLit={processors:[i.light.processor],attributes:{vertexPosition:t.POSITION,vertexNormal:t.NORMAL,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraPosition:e.CAMERA,diffuseMap:e.DIFFUSE_MAP},builder:function(t,e){i.light.builder(t,e)},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;",i.light.prevertex,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void) {","vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","vWorldPos = worldPos.xyz;","gl_Position = viewProjectionMatrix * worldPos;",i.light.vertex,"normal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","texCoord0 = vertexUV0;","viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["uniform sampler2D diffuseMap;",i.light.prefragment,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void)","{","vec3 N = normalize(normal);","vec4 final_color = texture2D(diffuseMap, texCoord0);",i.light.fragment,"gl_FragColor = final_color;","}"].join("\n")}},o.convolution={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},attributes:{position:t.POSITION,uv:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,uImageIncrement:[.001953125,0],cKernel:[],size:1},vshader:["attribute vec3 position;","attribute vec2 uv;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float size;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * size * uImageIncrement;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );","}"].join("\n"),fshader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","uniform float size;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0 );","for(float i = 0.0; i < KERNEL_SIZE_FLOAT; i++) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[int(i)];","imageCoord += uImageIncrement * size;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(t){function e(t,e){return Math.exp(-(t*t)/(2*e*e))}t=Math.abs(t);var r,i,o,n,a=25,s=2*Math.ceil(3*t)+1;for(s>a&&(s=a),n=.5*(s-1),i=new Array(s),o=0,r=0;s>r;++r)i[r]=e(r-n,t),o+=i[r];for(r=0;s>r;++r)i[r]/=o;return i}},o.showNormals={defines:{NORMAL:!0},attributes:{vertexPosition:t.POSITION,vertexNormal:t.NORMAL},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,opacity:1},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec3 normal;","void main() {","normal = vec3(worldMatrix * vec4(vertexNormal, 0.0));","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["uniform float opacity;","#ifdef NORMAL","varying vec3 normal;","#else","vec3 normal = vec3(0,0,1);","#endif","void main() {","gl_FragColor = vec4( 0.5 * normalize( normal ) + 0.5, opacity );","}"].join("\n")},o.particles={attributes:{vertexPosition:t.POSITION,vertexColor:t.COLOR,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec4 vertexColor;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","varying vec4 color;","void main(void) {","texCoord0 = vertexUV0;","color = vertexColor;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","varying vec4 color;","void main(void)","{","vec4 texCol = texture2D(diffuseMap, texCoord0);","if (color.a == 0.0 || texCol.a == 0.0) discard;","else gl_FragColor = texCol * color;","}"].join("\n")},o.normalmap={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,heightMap:e.DIFFUSE_MAP,resolution:[512,512],height:.05},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4( vertexPosition, 1.0 ));","}"].join("\n"),fshader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},o.point={attributes:{vertexPosition:t.POSITION,vertexColor:t.COLOR},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,pointSize:2},vshader:["attribute vec3 vertexPosition;","attribute vec4 vertexColor;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform float pointSize;","varying vec4 color;","void main(void) {","color = vertexColor;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","gl_PointSize = pointSize;","}"].join("\n"),fshader:["varying vec4 color;","void main(void)","{","gl_FragColor = color;","}"].join("\n")},o.downsample={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","}"].join("\n")},o.lightDepth={processors:[i.animation.processor],defines:{SHADOW_TYPE:0,WEIGHTS:!0,JOINTIDS:!0},attributes:{vertexPosition:t.POSITION,vertexJointIDs:t.JOINTIDS,vertexWeights:t.WEIGHTS},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraScale:e.MAIN_DEPTH_SCALE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 worldPosition;",i.animation.prevertex,"void main(void) {","mat4 wMatrix = worldMatrix;",i.animation.vertex,"worldPosition = viewMatrix * (wMatrix * vec4(vertexPosition, 1.0));","gl_Position = projectionMatrix * worldPosition;","}"].join("\n"),fshader:["uniform float cameraScale;","varying vec4 worldPosition;","void main(void)","{","float linearDepth = length(worldPosition) * cameraScale;","#if SHADOW_TYPE == 0","gl_FragColor = vec4(linearDepth);","#elif SHADOW_TYPE == 1","gl_FragColor = vec4(linearDepth);","#elif SHADOW_TYPE == 2","gl_FragColor = vec4(linearDepth, linearDepth * linearDepth, 0.0, 0.0);","#endif","}"].join("\n")},o.pickingShader={defines:{WEIGHTS:!0,JOINTIDS:!0},attributes:{vertexPosition:t.POSITION,vertexJointIDs:t.JOINTIDS,vertexWeights:t.WEIGHTS,vertexNormal:t.NORMAL},uniforms:{normalMatrix:e.NORMAL_MATRIX,viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraFar:e.FAR_PLANE,thickness:0,id:function(t){return null!=t.renderable._index?t.renderable._index+1:t.renderable.id+1}},processors:[i.animation.processor,function(t){t.setDefine("NORMAL",!0)}],vshader:["attribute vec3 vertexPosition;","#ifdef NORMAL","attribute vec3 vertexNormal;","#endif","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float cameraFar;","uniform float thickness;","uniform mat3 normalMatrix;",i.animation.prevertex,"varying float depth;","void main() {","#ifdef NORMAL","mat3 nMatrix = normalMatrix;","#endif","mat4 wMatrix = worldMatrix;",i.animation.vertex,"#ifdef NORMAL","vec4 mvPosition = viewMatrix * (wMatrix * vec4( vertexPosition + vertexNormal * thickness, 1.0 ));","#else","vec4 mvPosition = viewMatrix * (wMatrix * vec4( vertexPosition, 1.0 ));","#endif","depth = -mvPosition.z / cameraFar;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fshader:["uniform float id;","varying float depth;",r.methods.packDepth16,"void main() {","vec2 packedId = vec2(floor(id/255.0), mod(id, 255.0)) * vec2(1.0/255.0);","vec2 packedDepth = packDepth16(depth);","gl_FragColor = vec4(packedId, packedDepth);","}"].join("\n")},o}(goo.MeshData,goo.Shader,goo.ShaderFragment,goo.ShaderBuilder),goo.Quad=function(t,e){"use strict";function r(e,r,i,o){if(1===arguments.length&&arguments[0]instanceof Object){var n=arguments[0];e=n.width,r=n.height,i=n.tileX,o=n.tileY}this.xExtent=void 0!==e?.5*e:.5,this.yExtent=void 0!==r?.5*r:.5,this.tileX=i||1,this.tileY=o||1;var a=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]);t.call(this,a,4,6),this.rebuild()}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.rebuild=function(){var e=this.xExtent,r=this.yExtent,i=this.tileX,o=this.tileY;return this.getAttributeBuffer(t.POSITION).set([-e,-r,0,-e,r,0,e,r,0,e,-r,0]),this.getAttributeBuffer(t.NORMAL).set([0,0,1,0,0,1,0,0,1,0,0,1]),this.getAttributeBuffer(t.TEXCOORD0).set([0,0,0,o,i,o,i,0]),this.getIndexBuffer().set([0,3,1,1,3,2]),this},r.prototype.clone=function(){var t=e.shallowSelectiveClone(this,["xExtent","yExtent","tileX","tileY"]);return new r(t)},r}(goo.MeshData,goo.ObjectUtils),goo.Plane=function(t){"use strict";function e(e,r){this.normal=e?e.clone():t.UNIT_Y.clone(),this.constant=isNaN(r)?0:r}e.XZ=new e(t.UNIT_Y,0),e.XY=new e(t.UNIT_Z,0),e.YZ=new e(t.UNIT_X,0),e.prototype.pseudoDistance=function(t){return this.normal.dot(t)-this.constant},e.prototype.setPlanePoints=function(e,r,i){return this.normal.set(r).sub(e),this.normal.cross(new t(i.x-e.x,i.y-e.y,i.z-e.z)).normalize(),this.constant=this.normal.dot(e),
this},e.prototype.reflectVector=function(e,r){var i=r;"undefined"==typeof i&&(i=new t);var o=2*this.normal.dot(e);return i.set(e).sub(new t(this.normal.x*o,this.normal.y*o,this.normal.z*o)),i};var r=new t;return e.prototype.rayIntersect=function(e,i,o,n){n="undefined"==typeof n?1e-7:n,i=i||new t;var a=e.direction.dot(this.normal);if(Math.abs(a)<n)return o||console.warn("Ray parallel with plane"),null;var s=r.set(this.normal).scale(this.constant).sub(e.origin).dot(this.normal);return i.set(e.direction).scale(s/a).add(e.origin)},e.prototype.copy=function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},e.prototype.clone=function(){return new e(this.normal.clone(),this.constant)},e}(goo.Vector3),goo.Ray=function(t,e){"use strict";function r(e,r){this.origin=e?e.clone():new t,this.direction=r?r.clone():t.UNIT_Z.clone()}var i=new t,o=new t,n=new t,a=new t,s=new t;return r.prototype.intersects=function(t,e,r,i){return 3===t.length?this.intersectsTriangle(t[0],t[1],t[2],e,r,i):4===t.length?this.intersectsTriangle(t[0],t[1],t[2],e,r,i)||this.intersectsTriangle(t[0],t[2],t[3],e,r,i):!1},r.prototype.intersectsTriangle=function(t,r,h,u,c,l){var d,p=o.set(r).sub(t),f=n.set(h).sub(t),m=a.set(p).cross(f),g=this.direction.dot(m);if(g>e.EPSILON)d=1;else{if(!(g<-e.EPSILON))return!1;if(l)return!1;d=-1,g=-g}var y=i.set(this.origin).sub(t),v=d*this.direction.dot(s.copy(y).cross(f)),x=!1;if(v>=0){var w=d*this.direction.dot(p.cross(y));if(w>=0&&g>=v+w){var _=-d*y.dot(m);if(_>=0){if(!c)return!0;var b=1/g,S=_*b;if(u){var M=v*b,E=w*b;c.setDirect(S,M,E)}else c.set(this.origin).addDirect(this.direction.x*S,this.direction.y*S,this.direction.z*S);x=!0}}}return x},r.prototype.getDistanceToPrimitive=function(t){var e=i;return this.intersects(t,!1,e)?this.origin.distance(e.x,e.y,e.z):1/0},r.prototype.intersectsPlane=function(t,e){var r=t.normal,i=r.dot(this.direction);if(Math.abs(i)<1e-5)return!1;var o=-r.dot(this.origin)+t.constant,n=o/i;return 1e-5>n?!1:(e&&e.set(this.direction).scale(n).add(this.origin),!0)},r.prototype.distanceSquared=function(t,e){var r=i;r.set(t).sub(this.origin);var o=this.direction.dot(r);return o>0?(r.set(this.direction).scale(o),r.add(this.origin)):r.set(this.origin),e&&e.set(r),r.sub(t),r.lengthSquared()},r.prototype.copy=function(t){this.origin.copy(t.origin),this.direction.copy(t.direction)},r.prototype.clone=function(){return new r(this.origin.clone(),this.direction.clone())},r}(goo.Vector3,goo.MathUtils),goo.Camera=function(t,e,r,i,o,n,a,s,h,u){"use strict";function c(n,a,s,h){n="undefined"!=typeof n?n:45,a="undefined"!=typeof a?a:1,s="undefined"!=typeof s?s:1,h="undefined"!=typeof h?h:1e3,this.translation=new e(0,0,0),this._left=new e(-1,0,0),this._up=new e(0,1,0),this._direction=new e(0,0,-1),this._frustumNear=this.near=1,this._frustumFar=this.far=2,this._frustumLeft=this.left=-.5,this._frustumRight=this.right=.5,this._frustumTop=this.top=.5,this._frustumBottom=this.bottom=-.5,this._coeffLeft=new t,this._coeffRight=new t,this._coeffBottom=new t,this._coeffTop=new t,this._viewPortLeft=0,this._viewPortRight=1,this._viewPortTop=1,this._viewPortBottom=0,this._worldPlane=[];for(var u=0;u<c.FRUSTUM_PLANES;u++)this._worldPlane[u]=new o;this.projectionMode=c.Perspective,this.lockedRatio=!1,this.aspect=a,this._updateMVMatrix=!0,this._updateInverseMVMatrix=!0,this._updatePMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVPMatrix=!0,this.modelView=new i,this.modelViewInverse=new i,this.projection=new i,this.modelViewProjection=new i,this.modelViewProjectionInverse=new i,this._planeState=0,this._clipPlane=new r,this._qCalc=new r,this._corners=[];for(var u=0;8>u;u++)this._corners.push(new e);this._extents=new e,this.vNearPlaneCenter=new e,this.vFarPlaneCenter=new e,this.calcLeft=new e,this.calcUp=new e,this.changedProperties=!0,this.setFrustumPerspective(n,a,s,h),this.onFrameChange()}var l=new e;return c.LEFT_PLANE=0,c.RIGHT_PLANE=1,c.BOTTOM_PLANE=2,c.TOP_PLANE=3,c.FAR_PLANE=4,c.NEAR_PLANE=5,c.FRUSTUM_PLANES=6,c.Perspective=0,c.Parallel=1,c.Custom=2,c.Outside=0,c.Inside=1,c.Intersects=2,c.prototype.normalize=function(){this._left.normalize(),this._up.normalize(),this._direction.normalize(),this.onFrameChange()},c.prototype.setProjectionMode=function(t){this.projectionMode=t,this.update()},c.prototype.setFrustumPerspective=function(t,e,r,i){if(void 0!==t&&null!==t&&(this.fov=t),void 0!==e&&null!==e&&(this.aspect=e),void 0!==r&&null!==r&&(this.near=r),void 0!==i&&null!==i&&(this.far=i),void 0!==this.fov){var o=Math.tan(this.fov*n.DEG_TO_RAD*.5)*this.near,a=o*this.aspect;this._frustumLeft=-a,this._frustumRight=a,this._frustumBottom=-o,this._frustumTop=o,this._frustumNear=this.near,this._frustumFar=this.far,this._frustumFar-this._frustumNear<n.EPSILON&&(this._frustumFar=this._frustumNear+n.EPSILON),this.onFrustumChange()}},c.prototype.setFrustum=function(t,e,r,i,o,a,s){void 0!==t&&null!==t&&(this.near=t),void 0!==e&&null!==e&&(this.far=e),void 0!==r&&null!==r&&(this.left=r),void 0!==i&&null!==i&&(this.right=i),void 0!==o&&null!==o&&(this.top=o),void 0!==a&&null!==a&&(this.bottom=a),void 0!==s&&null!==s&&(this.aspect=s),this._frustumNear=this.near,this._frustumFar=this.far,this._frustumLeft=this.left*this.aspect,this._frustumRight=this.right*this.aspect,this._frustumTop=this.top,this._frustumBottom=this.bottom,this._frustumFar-this._frustumNear<n.EPSILON&&(this._frustumFar=this._frustumNear+n.EPSILON),this.onFrustumChange()},c.prototype.copy=function(t){return this.translation.set(t.translation),this._left.set(t._left),this._up.set(t._up),this._direction.set(t._direction),this.fov=t.fov,this.aspect=t.aspect,this.near=t.near,this.far=t.far,this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this._frustumLeft=t._frustumLeft,this._frustumRight=t._frustumRight,this._frustumBottom=t._frustumBottom,this._frustumTop=t._frustumTop,this._frustumNear=t._frustumNear,this._frustumFar=t._frustumFar,this.projectionMode=t.projectionMode,this.onFrustumChange(),this.onFrameChange(),this},c.prototype.setFrame=function(t,e,r,i){this._left.set(e),this._up.set(r),this._direction.set(i),this.translation.set(t),this.onFrameChange()},c.prototype.lookAt=function(t,r){l.set(t).sub(this.translation).normalize(),l.equals(this._direction)||(this._direction.set(l),this._up.set(r).normalize(),this._up.equals(e.ZERO)&&this._up.set(e.UNIT_Y),this._left.set(this._up).cross(this._direction).normalize(),this._left.equals(e.ZERO)&&(0!==this._direction.x?this._left.setDirect(this._direction.y,-this._direction.x,0):this._left.setDirect(0,this._direction.z,-this._direction.y)),this._up.set(this._direction).cross(this._left).normalize(),this.onFrameChange())},c.prototype.update=function(){this.onFrustumChange(),this.onFrameChange()},c.prototype.contains=function(t){if(!t)return c.Inside;for(var e=c.Inside,r=c.FRUSTUM_PLANES-1;r>=0;r--)switch(t.whichSide(this._worldPlane[r])){case u.Inside:return c.Outside;case u.Outside:break;case u.Intersects:e=c.Intersects}return e},c.prototype.onFrustumChange=function(){this.projectionMode===c.Perspective?(this._coeffLeft.setDirect(-this._frustumNear,-this._frustumLeft).normalize(),this._coeffRight.setDirect(this._frustumNear,this._frustumRight).normalize(),this._coeffBottom.setDirect(this._frustumNear,-this._frustumBottom).normalize(),this._coeffTop.setDirect(-this._frustumNear,this._frustumTop).normalize()):this.projectionMode===c.Parallel&&(this._frustumRight>this._frustumLeft?(this._coeffLeft.setDirect(-1,0),this._coeffRight.setDirect(1,0)):(this._coeffLeft.setDirect(1,0),this._coeffRight.setDirect(-1,0)),this._frustumTop>this._frustumBottom?(this._coeffBottom.setDirect(-1,0),this._coeffTop.setDirect(1,0)):(this._coeffBottom.setDirect(1,0),this._coeffTop.setDirect(-1,0))),this._updatePMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVMatrix=!0,this._updateInverseMVPMatrix=!0,this.changedProperties=!0},c.prototype.onFrameChange=function(){var t;t=this._worldPlane[c.LEFT_PLANE],t.normal.x=this._left.x*this._coeffLeft.x+this._direction.x*this._coeffLeft.y,t.normal.y=this._left.y*this._coeffLeft.x+this._direction.y*this._coeffLeft.y,t.normal.z=this._left.z*this._coeffLeft.x+this._direction.z*this._coeffLeft.y,t.constant=this.translation.dot(t.normal),t=this._worldPlane[c.RIGHT_PLANE],t.normal.x=this._left.x*this._coeffRight.x+this._direction.x*this._coeffRight.y,t.normal.y=this._left.y*this._coeffRight.x+this._direction.y*this._coeffRight.y,t.normal.z=this._left.z*this._coeffRight.x+this._direction.z*this._coeffRight.y,t.constant=this.translation.dot(t.normal),t=this._worldPlane[c.BOTTOM_PLANE],t.normal.x=this._up.x*this._coeffBottom.x+this._direction.x*this._coeffBottom.y,t.normal.y=this._up.y*this._coeffBottom.x+this._direction.y*this._coeffBottom.y,t.normal.z=this._up.z*this._coeffBottom.x+this._direction.z*this._coeffBottom.y,t.constant=this.translation.dot(t.normal),t=this._worldPlane[c.TOP_PLANE],t.normal.x=this._up.x*this._coeffTop.x+this._direction.x*this._coeffTop.y,t.normal.y=this._up.y*this._coeffTop.x+this._direction.y*this._coeffTop.y,t.normal.z=this._up.z*this._coeffTop.x+this._direction.z*this._coeffTop.y,t.constant=this.translation.dot(t.normal),this.projectionMode===c.Parallel&&(this._frustumRight>this._frustumLeft?(this._worldPlane[c.LEFT_PLANE].constant+=this._frustumLeft,this._worldPlane[c.RIGHT_PLANE].constant-=this._frustumRight):(this._worldPlane[c.LEFT_PLANE].constant-=this._frustumLeft,this._worldPlane[c.RIGHT_PLANE].constant+=this._frustumRight),this._frustumBottom>this._frustumTop?(this._worldPlane[c.TOP_PLANE].constant+=this._frustumTop,this._worldPlane[c.BOTTOM_PLANE].constant-=this._frustumBottom):(this._worldPlane[c.TOP_PLANE].constant-=this._frustumTop,this._worldPlane[c.BOTTOM_PLANE].constant+=this._frustumBottom));var e=this._direction.dot(this.translation);t=this._worldPlane[c.FAR_PLANE],t.normal.x=-this._direction.x,t.normal.y=-this._direction.y,t.normal.z=-this._direction.z,t.constant=-(e+this._frustumFar),t=this._worldPlane[c.NEAR_PLANE],t.normal.x=this._direction.x,t.normal.y=this._direction.y,t.normal.z=this._direction.z,t.constant=e+this._frustumNear,this._updateMVMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVMatrix=!0,this._updateInverseMVPMatrix=!0},c.prototype.updateProjectionMatrix=function(){if(this.projectionMode===c.Parallel){this.projection.setIdentity();var t=this.projection.data;t[0]=2/(this._frustumRight-this._frustumLeft),t[5]=2/(this._frustumTop-this._frustumBottom),t[10]=-2/(this._frustumFar-this._frustumNear),t[12]=-(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),t[13]=-(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom),t[14]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear)}else if(this.projectionMode===c.Perspective){this.projection.setIdentity();var t=this.projection.data;t[0]=2*this._frustumNear/(this._frustumRight-this._frustumLeft),t[5]=2*this._frustumNear/(this._frustumTop-this._frustumBottom),t[8]=(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),t[9]=(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom),t[10]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear),t[11]=-1,t[14]=-(2*this._frustumFar*this._frustumNear)/(this._frustumFar-this._frustumNear),t[15]=-0}},c.prototype.updateModelViewMatrix=function(){this.modelView.setIdentity();var t=this.modelView.data;t[0]=-this._left.x,t[4]=-this._left.y,t[8]=-this._left.z,t[1]=this._up.x,t[5]=this._up.y,t[9]=this._up.z,t[2]=-this._direction.x,t[6]=-this._direction.y,t[10]=-this._direction.z,t[12]=this._left.dot(this.translation),t[13]=-this._up.dot(this.translation),t[14]=this._direction.dot(this.translation)},c.prototype.getPickRay=function(t,e,r,i,o){return o||(o=new a),this.getWorldCoordinates(t,e,r,i,0,o.origin),this.getWorldCoordinates(t,e,r,i,.3,o.direction).sub(o.origin).normalize(),o},c.prototype.getWorldPosition=function(t,e,r,i,o,n){return o=this.projectionMode===c.Parallel?(o-this.near)/(this.far-this.near):this.far/(this.far-this.near)+this.far*this.near/(this.near-this.far)/o,this.getWorldCoordinates(t,e,r,i,o,n)},c.prototype.getWorldCoordinates=function(t,i,o,n,a,s){s||(s=new e),this.checkInverseModelViewProjection();var h=new r,u=(t/o-this._viewPortLeft)/(this._viewPortRight-this._viewPortLeft)*2-1,c=((n-i)/n-this._viewPortBottom)/(this._viewPortTop-this._viewPortBottom)*2-1;return h.setDirect(u,c,2*a-1,1),h.applyPost(this.modelViewProjectionInverse),0!==h.w&&h.scale(1/h.w),s.x=h.x,s.y=h.y,s.z=h.z,s},c.prototype.getScreenCoordinates=function(t,e,r,i){return i=this.getNormalizedDeviceCoordinates(t,i),i.x=(i.x+1)*(this._viewPortRight-this._viewPortLeft)/2*e,i.y=(1-i.y)*(this._viewPortTop-this._viewPortBottom)/2*r,i.z=(i.z+1)/2,i},c.prototype.getFrustumCoordinates=function(t,e){return e=this.getNormalizedDeviceCoordinates(t,e),e.x=(e.x+1)*(this._frustumRight-this._frustumLeft)/2+this._frustumLeft,e.y=(e.y+1)*(this._frustumTop-this._frustumBottom)/2+this._frustumBottom,e.z=(e.z+1)*(this._frustumFar-this._frustumNear)/2+this._frustumNear,e},c.prototype.getNormalizedDeviceCoordinates=function(t,i){i||(i=new e),this.checkModelViewProjection();var o=new r;return o.setDirect(t.x,t.y,t.z,1),o.applyPost(this.modelViewProjection),0!==o.w&&o.scale(1/o.w),i.x=o.x,i.y=o.y,i.z=o.z,i},c.prototype.checkModelView=function(){this._updateMVMatrix&&(this.updateModelViewMatrix(),this._updateMVMatrix=!1)},c.prototype.checkProjection=function(){this._updatePMatrix&&(this.updateProjectionMatrix(),this._updatePMatrix=!1)},c.prototype.checkModelViewProjection=function(){this._updateMVPMatrix&&(this.checkModelView(),this.checkProjection(),this.modelViewProjection.mul2(this.getProjectionMatrix(),this.getViewMatrix()),this._updateMVPMatrix=!1)},c.prototype.checkInverseModelView=function(){this._updateInverseMVMatrix&&(this.checkModelView(),this.modelViewInverse.copy(this.modelView).invert(),this._updateInverseMVMatrix=!1)},c.prototype.checkInverseModelViewProjection=function(){this._updateInverseMVPMatrix&&(this.checkModelViewProjection(),this.modelViewProjectionInverse.copy(this.modelViewProjection).invert(),this._updateInverseMVPMatrix=!1)},c.prototype.getViewMatrix=function(){return this.checkModelView(),this.modelView},c.prototype.getProjectionMatrix=function(){return this.checkProjection(),this.projection},c.prototype.getViewProjectionMatrix=function(){return this.checkModelViewProjection(),this.modelViewProjection},c.prototype.getViewInverseMatrix=function(){return this.checkInverseModelView(),this.modelViewInverse},c.prototype.getViewProjectionInverseMatrix=function(){return this.checkInverseModelViewProjection(),this.modelViewProjectionInverse},c.prototype.pack=function(t){for(var e=t.center,i=this._corners,o=this._extents,n=0;n<i.length;n++)i[n].set(e);t instanceof s?o.setDirect(t.xExtent,t.yExtent,t.zExtent):t instanceof h&&o.setDirect(t.radius,t.radius,t.radius),i[0].addDirect(o.x,o.y,o.z),i[1].addDirect(o.x,-o.y,o.z),i[2].addDirect(o.x,o.y,-o.z),i[3].addDirect(o.x,-o.y,-o.z),i[4].addDirect(-o.x,o.y,o.z),i[5].addDirect(-o.x,-o.y,o.z),i[6].addDirect(-o.x,o.y,-o.z),i[7].addDirect(-o.x,-o.y,-o.z);for(var a=this.getViewMatrix(),u=Number.MAX_VALUE,c=-Number.MAX_VALUE,l=new r,n=0;n<i.length;n++)l.setDirect(i[n].x,i[n].y,i[n].z,1),l.applyPre(a),u=Math.min(-l.z,u),c=Math.max(-l.z,c);u=Math.min(Math.max(this._frustumNear,u),this._frustumFar),c=Math.max(u,Math.min(this._frustumFar,c));var d=u/this._frustumNear;this._frustumLeft=this._frustumLeft*d,this._frustumRight=this._frustumRight*d,this._frustumTop=this._frustumTop*d,this._frustumBottom=this._frustumBottom*d,this._frustumNear=u,this._frustumFar=c},c.prototype.calculateFrustumCorners=function(t,e){t=void 0!==t?t:this._frustumNear,e=void 0!==e?e:this._frustumFar;var r=(this._frustumTop-this._frustumBottom)*t*.5/this._frustumNear,i=(this._frustumRight-this._frustumLeft)*t*.5/this._frustumNear,o=(this._frustumTop-this._frustumBottom)*e*.5/this._frustumNear,n=(this._frustumRight-this._frustumLeft)*e*.5/this._frustumNear;this.projectionMode===c.Parallel&&(r=.5*(this._frustumTop-this._frustumBottom),i=.5*(this._frustumRight-this._frustumLeft),o=.5*(this._frustumTop-this._frustumBottom),n=.5*(this._frustumRight-this._frustumLeft));var a=this.vNearPlaneCenter,s=this.vFarPlaneCenter,h=this.calcLeft;h.set(this._direction).scale(t),a.set(this.translation).add(h),h.set(this._direction).scale(e),s.set(this.translation).add(h);var u=this.calcLeft,l=this.calcUp;return u.set(this._left).scale(i),l.set(this._up).scale(r),this._corners[0].set(a).sub(u).sub(l),this._corners[1].set(a).add(u).sub(l),this._corners[2].set(a).add(u).add(l),this._corners[3].set(a).sub(u).add(l),u.set(this._left).scale(n),l.set(this._up).scale(o),this._corners[4].set(s).sub(u).sub(l),this._corners[5].set(s).add(u).sub(l),this._corners[6].set(s).add(u).add(l),this._corners[7].set(s).sub(u).add(l),this._corners},c.prototype.setToObliqueMatrix=function(t){var e=this._clipPlane.set(t);e.w=0,e.applyPost(this.getViewMatrix()),e.w=this.translation.y*t.y-t.w,this._updatePMatrix=!0;var r=this.getProjectionMatrix();this._qCalc.setDirect((n.sign(e.x)+r[8])/r[0],(n.sign(e.y)+r[9])/r[5],-1,(1+r[10])/r[14]),e.scale(2/e.dot(this._qCalc)),r[2]=e.x,r[6]=e.y,r[10]=e.z+1,r[14]=e.w,this._updateMVPMatrix=!0,this._updateInverseMVPMatrix=!0},c.prototype.clone=function(){var t=new c(this.fov,this.aspect,this.near,this.far);return t.copy(this),t},c}(goo.Vector2,goo.Vector3,goo.Vector4,goo.Matrix4,goo.Plane,goo.MathUtils,goo.Ray,goo.BoundingBox,goo.BoundingSphere,goo.BoundingVolume),goo.FullscreenUtils=function(t,e,r){"use strict";function i(){}var o=new e;return o.projectionMode=e.Parallel,o.setFrustum(0,1,-1,1,1,-1),o._left.copy(r.UNIT_X).negate(),o._up.copy(r.UNIT_Y),o._direction.copy(r.UNIT_Z),o.onFrameChange(),i.camera=o,i.quad=new t(2,2),i}(goo.Quad,goo.Camera,goo.Vector3),goo.Pass=function(){"use strict";function t(){}return t.prototype.destroy=function(){},t.prototype.render=function(){},t.prototype.updateSize=function(){},t.prototype.invalidateHandles=function(){},t}(),goo.FullscreenPass=function(t,e,r,i){"use strict";function o(i){this.material=new t(i||r.simple),this.useReadBuffer=!0,this.renderToScreen=!1,this.renderable={meshData:e.quad,materials:[this.material]},this.enabled=!0,this.clear=!1,this.needsSwap=!0,this.viewportSize=void 0}return o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype.render=function(t,r,i){this.useReadBuffer&&this.material.setTexture("DIFFUSE_MAP",i),this.renderToScreen?t.render(this.renderable,e.camera,[],null,this.clear):t.render(this.renderable,e.camera,[],r,this.clear)},o.prototype.destroy=function(){this.material.shader.destroy()},o.prototype.invalidateHandles=function(t){t.invalidateMaterial(this.renderable.materials[0]),t.invalidateMeshData(this.renderable.meshData)},o}(goo.Material,goo.FullscreenUtils,goo.ShaderLib,goo.Pass),goo.ShadowHandler=function(t,e,r,i,o,n,a,s,h,u,c){"use strict";function l(){this.depthMaterial=new o(n.lightDepth,"depthMaterial"),this.depthMaterial.cullState.cullFace="Back",this.depthMaterial.fullOverride=!0,this.fullscreenPass=new r,this.downsample=o.createShader(n.downsample,"downsample");var t=2;this.blurfilter=o.createShader(n.convolution,"blurfilter");var e=2*Math.ceil(3*t)+1;this.blurfilter.defines={KERNEL_SIZE_FLOAT:e.toFixed(1),KERNEL_SIZE_INT:e.toFixed(0)},this.blurfilter.uniforms.cKernel=n.convolution.buildKernel(t),this.oldClearColor=new s(0,0,0,0),this.shadowClearColor=new s(1,1,1,1),this.renderList=[],this.shadowList=[],this.first=!0}var d=new e;return l.prototype._createShadowData=function(e,r){var i=e.resolution[0],o=e.resolution[1],n=!!t.TextureFloatLinear;if(e.shadowData.shadowTarget&&r._deallocateRenderTarget(e.shadowData.shadowTarget),e.shadowData.shadowTarget=new a(i,o,{type:"Float",magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"}),e.shadowData.shadowResult=null,"VSM"===e.shadowType){var s={type:"Float"};n||(s.magFilter="NearestNeighbor",s.minFilter="NearestNeighborNoMipMaps"),e.shadowData.shadowTargetDown&&r._deallocateRenderTarget(e.shadowData.shadowTargetDown),e.shadowData.shadowTargetDown=new a(i/2,o/2,s),e.shadowData.shadowBlurred&&r._deallocateRenderTarget(e.shadowData.shadowBlurred),e.shadowData.shadowBlurred=new a(i/2,o/2,s)}e.shadowRecord.resolution=e.shadowRecord.resolution||[],e.shadowRecord.resolution[0]=i,e.shadowRecord.shadowType=e.shadowType},l.prototype.checkShadowRendering=function(t,r,o,n){if(this.first===!0)return void(this.first=!1);for(var a=0;a<n.length;a++){var s=n[a];if(s.shadowCaster||s.lightCookie){var u=s.shadowSettings;u.shadowData||(u.shadowData={},u.shadowRecord={},u.shadowData.lightCamera=new i(55,1,1,1e3));var l=u.shadowRecord,p=u.shadowData.lightCamera;if(p.translation.copy(s.translation),s.direction?(d.set(s.translation).add(s.direction),p.lookAt(d,u.upVector)):p.lookAt(e.ZERO,u.upVector),!u.shadowData.shadowTarget||l.angle!==s.angle||!l.resolution||l.resolution[0]!==u.resolution[0]||l.resolution[1]!==u.resolution[1]||l.near!==u.near||l.far!==u.far||l.size!==u.size){if(l.resolution&&l.resolution[0]===u.resolution[0]&&l.resolution[1]===u.resolution[1]||this._createShadowData(u,t),s instanceof c)p.setFrustumPerspective(s.angle,u.resolution[0]/u.resolution[1],u.near,u.far);else if(s instanceof h)p.setFrustumPerspective(90,u.resolution[0]/u.resolution[1],u.near,u.far);else{var f=u.size;p.setFrustum(u.near,u.far,-f,f,f,-f),p.projectionMode=i.Parallel}p.update(),l.resolution=l.resolution||[],l.resolution[0]=u.resolution[0],l.resolution[1]=u.resolution[1],l.angle=s.angle,l.near=u.near,l.far=u.far,l.size=u.size}"VSM"===u.shadowType&&l.shadowType!==u.shadowType&&(this._createShadowData(u,t),l.shadowType=u.shadowType),p.onFrameChange();for(var m=p.getViewProjectionMatrix().data,g=u.shadowData.vpm=u.shadowData.vpm||[],y=0;16>y;y++)g[y]=m[y];if(s.shadowCaster){this.depthMaterial.shader.setDefine("SHADOW_TYPE","VSM"===u.shadowType?2:0),this.depthMaterial.uniforms.cameraScale=1/(p.far-p.near),u.shadowData.cameraScale=this.depthMaterial.uniforms.cameraScale,this.oldClearColor.copy(t.clearColor),t.setClearColor(this.shadowClearColor.r,this.shadowClearColor.g,this.shadowClearColor.b,this.shadowClearColor.a),this.shadowList.length=0;for(var y=0;y<o.length;y++){var v=o[y];v.meshRendererComponent&&v.meshRendererComponent.castShadows&&!v.isSkybox&&this.shadowList.push(v)}switch(r.process(p,this.shadowList,this.renderList),t.render(this.renderList,p,[],u.shadowData.shadowTarget,!0,this.depthMaterial),u.shadowType){case"VSM":this.fullscreenPass.material.shader=this.downsample,this.fullscreenPass.render(t,u.shadowData.shadowTargetDown,u.shadowData.shadowTarget),this.fullscreenPass.material.shader=this.blurfilter,this.fullscreenPass.material.uniforms.uImageIncrement=[2/u.resolution[0],0],this.fullscreenPass.render(t,u.shadowData.shadowBlurred,u.shadowData.shadowTargetDown),this.fullscreenPass.material.uniforms.uImageIncrement=[0,2/u.resolution[1]],this.fullscreenPass.render(t,u.shadowData.shadowTargetDown,u.shadowData.shadowBlurred),u.shadowData.shadowResult=u.shadowData.shadowTargetDown;break;case"PCF":u.shadowData.shadowResult=u.shadowData.shadowTarget;break;case"Basic":u.shadowData.shadowResult=u.shadowData.shadowTarget;break;default:u.shadowData.shadowResult=u.shadowData.shadowTarget}t.setClearColor(this.oldClearColor.r,this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a)}}}},l.prototype.invalidateHandles=function(t){this.fullscreenPass.invalidateHandles(t),t.invalidateMaterial(this.depthMaterial),t.invalidateShader(this.downsample),t.invalidateShader(this.blurfilter)},l}(goo.Capabilities,goo.Vector3,goo.FullscreenPass,goo.Camera,goo.Material,goo.ShaderLib,goo.RenderTarget,goo.Vector4,goo.PointLight,goo.DirectionalLight,goo.SpotLight),goo.RenderStats=function(){"use strict";function t(){this.reset()}return t.prototype.reset=function(){this.calls=0,this.vertices=0,this.indices=0},t.prototype.toString=function(){return"Calls: "+this.calls+"<br/>Vertices: "+this.vertices+"<br/>Indices: "+this.indices},t}(),goo.TaskScheduler=function(t){"use strict";function e(){}return function(){window.performance=window.performance||{},performance.now=function(){return performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return Date.now()}}()}(),e.maxTimePerFrame=50,e.each=function(r){return t.createPromise(function(t,i){function o(){for(var i=performance.now();n<r.length&&performance.now()-i<e.maxTimePerFrame;)r[n](),n++;n<r.length?setTimeout(o,4):t()}var n=0;o()})},e}(goo.PromiseUtils),goo.RenderInfo=function(t,e){"use strict";function r(){this.reset()}return r.prototype.reset=function(){this.renderable=null,this.lights=null,this.materials=null,this.meshData=null,this.camera=null,this.mainCamera=null,this.lights=null,this.shadowHandler=null,this.renderer=null,this.material=null,this.transform=null,this.currentPose=null},r.prototype.fill=function(r){r instanceof t?(this.meshData=r.meshDataComponent.meshData,this.materials=r.meshRendererComponent.materials,this.transform=r.particleComponent?e.IDENTITY:r.transformComponent.worldTransform,r.meshDataComponent.currentPose?this.currentPose=r.meshDataComponent.currentPose:this.currentPose=null):(this.meshData=r.meshData,this.materials=r.materials,this.transform=r.transform,r.currentPose?this.currentPose=r.currentPose:this.currentPose=null),this.renderable=r},r}(goo.Entity,goo.Transform),goo.Renderer=function(t,e,r,i,o,n,a,s,h,u,c,l,d,p,f,m,g,y,v,x){"use strict";function w(r){r=r||{};var i=r.canvas;void 0===i&&(i=document.createElement("canvas"),i.width=500,i.height=500),i.screencanvas=!0,this.domElement=i,this._alpha=void 0!==r.alpha?r.alpha:!1,this._premultipliedAlpha=void 0!==r.premultipliedAlpha?r.premultipliedAlpha:!0,this._antialias=void 0!==r.antialias?r.antialias:!0,this._stencil=void 0!==r.stencil?r.stencil:!1,this._preserveDrawingBuffer=void 0!==r.preserveDrawingBuffer?r.preserveDrawingBuffer:!1,this._useDevicePixelRatio=void 0!==r.useDevicePixelRatio?r.useDevicePixelRatio:!1,this._onError=r.onError,this._contextSettings={alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer},this.context=null,this.establishContext(),this._setupContextLost(),r.debug&&this.setupDebugging(r),this.rendererRecord=new e,this.maxTextureSize=isNaN(r.maxTextureSize)?t.maxTexureSize:Math.min(r.maxTextureSize,t.maxTexureSize),this.maxCubemapSize=isNaN(r.maxTextureSize)?t.maxCubemapSize:Math.min(r.maxTextureSize,t.maxCubemapSize),this.shaderPrecision=r.shaderPrecision||"highp","highp"===this.shaderPrecision&&t.vertexShaderHighpFloat.precision>0&&t.fragmentShaderHighpFloat.precision>0?this.shaderPrecision="highp":"lowp"!==this.shaderPrecision&&t.vertexShaderMediumpFloat.precision>0&&t.fragmentShaderMediumpFloat.precision>0?this.shaderPrecision="mediump":this.shaderPrecision="lowp",this.downScale=r.downScale||1,this.clearColor=new n,this._clearColor=new n,this.setClearColor(.3,.3,.3,1),this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentWidth=0,this.currentHeight=0,this.devicePixelRatio=1,this._overrideMaterials=[],this._mergedMaterial=new c("Merged Material"),this.renderQueue=new d,this.info=new m,this.shadowHandler=new f,this.hardwarePicking=null,g.addListener("goo.setClearColor",function(t){this.setClearColor.apply(this,t)}.bind(this)),document.createElementNS?(this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svg.setAttribute("version","1.1"),this.svg.style.position="absolute",this.svg.style.display="none",document.body.appendChild(this.svg)):this.svg={currentScale:1},g.addListener("goo.setCurrentCamera",function(t){w.mainCamera=t.camera,this.checkResize(w.mainCamera)}.bind(this)),this._definesIndices=[]}function _(t,e){for(var r=0;r<e.length;++r)void 0===e[r]&&console.error("undefined passed to gl."+t+"("+window.WebGLDebugUtils.glFunctionArgsToString(t,e)+")")}var b=function(){};w.prototype.setupDebugging=function(t){var e=new XMLHttpRequest;e.open("GET","/js/goo/lib/webgl-debug.js",!1),e.onreadystatechange=function(){4===e.readyState&&e.status>=200&&e.status<=299&&window.eval.call(window,e.responseText)},e.send(null),"undefined"==typeof window.WebGLDebugUtils?console.warn("You need to include webgl-debug.js in your script definition to run in debug mode."):(console.log("Running in webgl debug mode."),t.validate?(console.log('Running with "undefined arguments" validation.'),this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this),_)):this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this)))},w.prototype.establishContext=function(){if(window.WebGLRenderingContext){for(var e=["experimental-webgl","webgl","moz-webgl","webkit-3d"],r=0;r<e.length;r++)try{if(this.context=this.domElement.getContext(e[r],this._contextSettings),this.context&&"function"==typeof this.context.getParameter)break}catch(i){}if(!this.context)throw{name:"GooWebGLError",message:"WebGL is supported but disabled",supported:!0,enabled:!1}}var o=this.context;o.clearDepth(1),o.clearStencil(0),o.stencilMask(0),o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL),void 0===o.getShaderPrecisionFormat&&(this.context.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),t.init(this.context)},w.prototype._setupContextLost=function(){this.domElement.addEventListener("webglcontextlost",function(t){t.preventDefault(),g.emit("goo.contextLost")},!1),this.domElement.addEventListener("webglcontextrestored",function(){this._restoreContext(),g.emit("goo.contextRestored")}.bind(this),!1)},w.prototype._restoreContext=b,w.prototype.onDebugError=function(t,e,r){for(var i="WebGL error "+window.WebGLDebugUtils.glEnumToString(t)+" in "+e+"(",o=0;o<r.length;++o)i+=(0===o?"":", ")+window.WebGLDebugUtils.glFunctionArgToString(e,o,r[o]);i+=")",console.error(i),this._onError&&this._onError(i)},w.mainCamera=null,w.prototype.checkResize=function(t){var e,r,i=this.devicePixelRatio=this._useDevicePixelRatio&&window.devicePixelRatio?window.devicePixelRatio/this.svg.currentScale:1;navigator.isCocoonJS?(e=window.innerWidth,r=window.innerHeight):(e=this.domElement.offsetWidth,r=this.domElement.offsetHeight),e=Math.max(e*i/this.downScale,1),r=Math.max(r*i/this.downScale,1);var o=e,n=r;t&&t.lockedRatio===!0&&t.aspect&&(e=r*t.aspect);var a=e/r;this.setSize(e,r,o,n),t&&t.lockedRatio===!1&&t.aspect!==a&&(t.aspect=a,0===t.projectionMode?t.setFrustumPerspective():t.setFrustum(),t.onFrameChange())},w.prototype.setSize=function(t,e,r,i){if(void 0===r&&(r=t),void 0===i&&(i=e),this.domElement.width=r,this.domElement.height=i,t>r){var o=r/t;t=r,e=i*o}var n=.5*(r-t),a=.5*(i-e);(n!==this.viewportX||a!==this.viewportY||t!==this.viewportWidth||e!==this.viewportHeight)&&(this.setViewport(n,a,t,e),null!==this.hardwarePicking&&(this.hardwarePicking.pickingTarget=null))},w.prototype.setViewport=function(t,e,r,i){this.viewportX=void 0!==t?t:0,this.viewportY=void 0!==e?e:0,this.viewportWidth=void 0!==r?r:this.domElement.width,this.viewportHeight=void 0!==i?i:this.domElement.height,this.context.viewport(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight),g.emit("goo.viewportResize",{x:this.viewportX,y:this.viewportY,width:this.viewportWidth,height:this.viewportHeight},!0)},w.prototype.setClearColor=function(t,e,r,i){(this._clearColor.r!==t||this._clearColor.g!==e||this._clearColor.b!==r||this._clearColor.a!==i)&&(this._clearColor.r=t,this._clearColor.g=e,this._clearColor.b=r,this._clearColor.a=i,this.clearColor.copy(this._clearColor),this.context.clearColor(t,e,r,i))},w.prototype.bindData=function(t){var e=t.glBuffer,i=this.context;null!==e?(this.setBoundBuffer(e,t.target),t._dataNeedsRefresh&&(i.bufferSubData(r.getGLBufferTarget(i,t.target),0,t.data),
t._dataNeedsRefresh=!1)):(e=i.createBuffer(),t.glBuffer=e,this.rendererRecord.invalidateBuffer(t.target),this.setBoundBuffer(e,t.target),i.bufferData(r.getGLBufferTarget(i,t.target),t.data,r.getGLBufferUsage(i,t._dataUsage)))},w.prototype.updateAttributeData=function(t,e){this.context.bufferSubData(this.context.ARRAY_BUFFER,e,t)},w.prototype.setShadowType=function(t){this.shadowHandler.shadowType=t},w.prototype.updateShadows=function(t,e,r){this.shadowHandler.checkShadowRendering(this,t,e,r)},w.prototype.preloadTexture=function(t,e){t.bindTexture(r.getGLType(t,e.variant),e.glTexture),t.pixelStorei(t.UNPACK_ALIGNMENT,e.unpackAlignment),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);var i=e.image;if("2D"===e.variant)i?(!i.isCompressed&&(e.generateMipmaps||i.width>this.maxTextureSize||i.height>this.maxTextureSize)&&(this.checkRescale(e,i,i.width,i.height,this.maxTextureSize),i=e.image),i.isData===!0?i.isCompressed?this.loadCompressedTexture(t,t.TEXTURE_2D,e,i.data):t.texImage2D(t.TEXTURE_2D,0,r.getGLInternalFormat(t,e.format),i.width,i.height,e.hasBorder?1:0,r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),i.data):t.texImage2D(t.TEXTURE_2D,0,r.getGLInternalFormat(t,e.format),r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),i),e.generateMipmaps&&!i.isCompressed&&t.generateMipmap(t.TEXTURE_2D)):t.texImage2D(t.TEXTURE_2D,0,r.getGLInternalFormat(t,e.format),e.width,e.height,0,r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),null);else if("CUBE"===e.variant){if(i&&!i.isData&&(e.generateMipmaps||i.width>this.maxCubemapSize||i.height>this.maxCubemapSize)){for(var o=0;o<s.CUBE_FACES.length;o++)i.data[o]&&!i.data[o].buffer?r.scaleImage(e,i.data[o],i.width,i.height,this.maxCubemapSize,o):r.getBlankImage(e,[.3,.3,.3,0],i.width,i.height,this.maxCubemapSize,o);e.image.width=Math.min(this.maxCubemapSize,x.nearestPowerOfTwo(e.image.width)),e.image.height=Math.min(this.maxCubemapSize,x.nearestPowerOfTwo(e.image.height)),i=e.image}for(var n=0;n<s.CUBE_FACES.length;n++){var a=s.CUBE_FACES[n];i?i.isData===!0?i.isCompressed?this.loadCompressedTexture(t,r.getGLCubeMapFace(t,a),e,i.data[n]):t.texImage2D(r.getGLCubeMapFace(t,a),0,r.getGLInternalFormat(t,e.format),i.width,i.height,e.hasBorder?1:0,r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),i.data[n]):t.texImage2D(r.getGLCubeMapFace(t,a),0,r.getGLInternalFormat(t,e.format),r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),i.data[n]):t.texImage2D(r.getGLCubeMapFace(t,a),0,r.getGLInternalFormat(t,e.format),e.width,e.height,0,r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),null)}i&&e.generateMipmaps&&!i.isCompressed&&t.generateMipmap(t.TEXTURE_CUBE_MAP)}},w.prototype.preloadTextures=function(t,e){var r=this.context,n=Object.keys(t._textureMaps);n.forEach(function(n){var a=t.getTexture(n);if(void 0!==a){var h=a;a instanceof Array==!1&&(h=[a]),h.forEach(function(t){t&&e.push(function(){t instanceof o!=!1||void 0!==t.image&&t.checkDataReady()!==!1||("2D"===t.variant?t=i.DEFAULT_TEXTURE_2D:"CUBE"===t.variant&&(t=i.DEFAULT_TEXTURE_CUBE)),null===t.glTexture?(t.glTexture=r.createTexture(),this.preloadTexture(r,t),t.needsUpdate=!1):t instanceof s&&t.checkNeedsUpdate()&&(this.preloadTexture(r,t),t.needsUpdate=!1)}.bind(this))},this)}},this)};var S=new v;w.prototype.preloadMaterials=function(t){var e=[],r=S;if(r.reset(),Array.isArray(t))for(var i=0;i<t.length;i++){var o=t[i];if(!(o.isSkybox&&this._overrideMaterials.length>0)){r.fill(o);for(var n=0;n<r.materials.length;n++)this.preloadTextures(r.materials[n],e)}}else{r.fill(t);for(var n=0;n<r.materials.length;n++)this.preloadTextures(r.materials[n],e)}return y.each(e)},w.prototype.precompileShader=function(t,e){var r=t.shader;r.updateProcessors(e),this.findOrCacheMaterialShader(t,e),r=t.shader,r.precompile(this)},w.prototype.clearShaderCache=function(){this.rendererRecord.shaderCache.clear()},w.prototype.precompileShaders=function(t,e){var r=new v;e&&(r.lights=e);var i=[];if(Array.isArray(t))for(var o=0;o<t.length;o++){var n=t[o];if(!(n.isSkybox&&this._overrideMaterials.length>0)){r.fill(n);for(var a=0;a<r.materials.length;a++)r.material=r.materials[a],this.precompileShader(r.materials[a],r,i)}}else{r.fill(t);for(var a=0;a<r.materials.length;a++)r.material=r.materials[a],this.precompileShader(r.materials[a],r,i)}return y.each(i)},w.prototype.preloadBuffers=function(t){var e=new v;if(Array.isArray(t))for(var r=0;r<t.length;r++){var i=t[r];if(!(i.isSkybox&&this._overrideMaterials.length>0)){e.fill(i);for(var o=0;o<e.materials.length;o++)e.material=e.materials[o],this.preloadBuffer(i,e.materials[o],e)}}else{e.fill(t);for(var o=0;o<e.materials.length;o++)e.material=e.materials[o],this.preloadBuffer(t,e.materials[o],e)}},w.prototype.preloadBuffer=function(t,e,r){var i=r.meshData;if(!(null===i.vertexData||null!==i.vertexData&&0===i.vertexData.data.byteLength||null!==i.indexData&&0===i.indexData.data.byteLength)){this.bindData(i.vertexData),null!==i.getIndexBuffer()&&this.bindData(i.getIndexData());var o,n=r.materials,a=null,s=i;o=0===this._overrideMaterials.length?n.length:this._overrideMaterials.length;for(var h=0;o>h;h++){var e=null,u=null;h<n.length&&(e=n[h]),h<this._overrideMaterials.length&&(u=this._overrideMaterials[h]),e&&u?(this._override(u,e,this._mergedMaterial),e=this._mergedMaterial):u&&(e=u),e.shader?(e.errorOnce=!1,e.wireframe&&"wire"!==a?(i.wireframeData||(i.wireframeData=i.buildWireframeData()),i=i.wireframeData,this.bindData(i.vertexData),a="wire"):e.flat&&"flat"!==a?(i.flatMeshData||(i.flatMeshData=i.buildFlatMeshData()),i=i.flatMeshData,this.bindData(i.vertexData),a="flat"):e.wireframe||e.flat||null===a||(i=s,this.bindData(i.vertexData),a=null)):e.errorOnce||(console.warn("No shader set on material: "+e.name),e.errorOnce=!0)}}};var M=new v,E=function(t){t.startFrame()};return w.prototype.render=function(t,e,r,i,o,n){if(n?this._overrideMaterials=n instanceof Array?n:[n]:this._overrideMaterials=[],e){null!==w.mainCamera||i||(w.mainCamera=e),this.setRenderTarget(i),void 0===o||null===o||o===!0?this.clear():"object"==typeof o&&this.clear(o.color,o.depth,o.stencil),this.rendererRecord.shaderCache.forEach(E);var a=M;if(a.reset(),a.camera=e,a.mainCamera=w.mainCamera,a.lights=r,a.shadowHandler=this.shadowHandler,a.renderer=this,Array.isArray(t)){this.renderQueue.sort(t,e);for(var s=0;s<t.length;s++){var h=t[s];h.isSkybox&&this._overrideMaterials.length>0||(a.fill(h),this.renderMesh(a))}}else a.fill(t),this.renderMesh(a);i&&i.generateMipmaps&&x.isPowerOfTwo(i.width)&&x.isPowerOfTwo(i.height)&&this.updateRenderTargetMipmap(i)}},w.prototype._override=function(t,e,r){r.empty();for(var i=Object.keys(r),o=0,n=i.length;n>o;o++){var a=i[o],s=r[a],h=t[a],u=e[a];if(s instanceof Object&&"shader"!==a){for(var c=Object.keys(h),l=0,d=c.length;d>l;l++){var p=c[l];s[p]=h[p]}for(var c=Object.keys(u),l=0,d=c.length;d>l;l++){var p=c[l];void 0===s[p]&&(s[p]=u[p])}}else void 0!==h?r[a]=h:r[a]=u}},w.prototype.renderMesh=function(t){var e=t.meshData;if(!(!e||null===e.vertexData||null!==e.vertexData&&0===e.vertexData.data.byteLength||null!==e.indexData&&0===e.indexData.data.byteLength)){this.bindData(e.vertexData),e._attributeDataNeedsRefresh&&(e._dirtyAttributeNames.forEach(function(t){this.updateAttributeData(e.dataViews[t],e.attributeMap[t].offset)},this),e._attributeDataNeedsRefresh=!1,e._dirtyAttributeNames.clear());var r=t.materials,i=null,o=e,n=0;n=0===this._overrideMaterials.length?r.length:this._overrideMaterials.length;for(var a=0;n>a;a++)this.renderMeshMaterial(a,r,i,o,t)}},w.prototype.callShaderProcessors=function(t,e){t.shader.updateProcessors(e),this.findOrCacheMaterialShader(t,e)},w.prototype.renderMeshMaterial=function(t,e,r,i,o){var n=null,a=null;t<e.length&&(n=e[t]),t<this._overrideMaterials.length&&(a=this._overrideMaterials[t]),n=this.configureRenderInfo(o,t,n,a,i,r);var s=o.meshData;this.callShaderProcessors(n,o),n.shader.apply(o,this),this.updateDepthTest(n),this.updateCulling(n),this.updateBlending(n),this.updateOffset(n),this.updateTextures(n),this.updateLineAndPointSettings(n),this._checkDualTransparency(n,s),this.updateCulling(n),this._drawBuffers(s),this.info.calls++,this.info.vertices+=s.vertexCount,this.info.indices+=s.indexCount},w.prototype._drawBuffers=function(t){null!==t.getIndexBuffer()?(this.bindData(t.getIndexData()),null!==t.getIndexLengths()?this.drawElementsVBO(t.getIndexBuffer(),t.getIndexModes(),t.getIndexLengths()):this.drawElementsVBO(t.getIndexBuffer(),t.getIndexModes(),[t.getIndexBuffer().length])):null!==t.getIndexLengths()?this.drawArraysVBO(t.getIndexModes(),t.getIndexLengths()):this.drawArraysVBO(t.getIndexModes(),[t.vertexCount])},w.prototype.configureRenderInfo=function(t,e,r,i,o,n){var a=t.meshData;return e<this._overrideMaterials.length&&(i=this._overrideMaterials[e]),r&&i&&i.fullOverride!==!0?(this._override(i,r,this._mergedMaterial),r=this._mergedMaterial):i&&(r=i),r.shader?(r.errorOnce=!1,r.wireframe&&"wire"!==n?(a.wireframeData||(a.wireframeData=a.buildWireframeData()),a=a.wireframeData,this.bindData(a.vertexData),n="wire"):r.flat&&"flat"!==n?(a.flatMeshData||(a.flatMeshData=a.buildFlatMeshData()),a=a.flatMeshData,this.bindData(a.vertexData),n="flat"):r.wireframe||r.flat||null===n||(a=o,this.bindData(a.vertexData),n=null),t.material=r,t.meshData=a,r):void(r.errorOnce||(console.warn("No shader set on material: "+r.name),r.errorOnce=!0))},w.prototype.findOrCacheMaterialShader=function(t,e){var r=t.shader,i=r.getDefineKey(this._definesIndices);r.endFrame();var o=this.rendererRecord.shaderCache,n=o.get(i);if(n){if(n!==t.shader)for(var a=t.shader.uniforms,s=Object.keys(a),h=0,u=s.length;u>h;h++){var c=s[h],l=n.uniforms[c]=a[c];l instanceof Array&&(n.uniforms[c]=l.slice(0))}t.shader=n}else r.builder&&r.builder(r,e),r=r.clone(),o.set(i,r),t.shader=r},w.prototype._checkDualTransparency=function(t,e){if(t.dualTransparency){var r=t.cullState.cullFace,i="Front"===r?"Back":"Front";t.cullState.cullFace=i,this.updateCulling(t),this._drawBuffers(e),t.cullState.cullFace=r}},w.prototype.readPixels=function(t,e,r,i,o){o=o||new Uint8Array(r*i*4);var n=this.context;return n.readPixels(t,e,r,i,n.RGBA,n.UNSIGNED_BYTE,o),o},w.prototype.readTexturePixels=function(t,e,r,i,o,n){n=n||new Uint8Array(i*o*4);var a=this.context,s=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,s),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t.glTexture,0),a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE&&a.readPixels(e,r,i,o,a.RGBA,a.UNSIGNED_BYTE,n),n},w.prototype.drawElementsVBO=function(t,e,i){for(var o=0,n=0,a=t.type=t.type||r.getGLArrayType(this.context,t),s=r.getGLByteSize(t),h=0;h<i.length;h++){var u=i[h],c=r.getGLIndexMode(this.context,e[n]);this.context.drawElements(c,u,a,o*s),o+=u,n<e.length-1&&n++}},w.prototype.drawArraysVBO=function(t,e){for(var i=0,o=0,n=0;n<e.length;n++){var a=e[n],s=r.getGLIndexMode(this.context,t[o]);this.context.drawArrays(s,i,a),i+=a,o<t.length-1&&o++}},w.prototype.renderToPick=function(t,e,r,i,a,s,h,u,l){if(this.viewportWidth*this.viewportHeight!==0){var d=4;if(null===this.hardwarePicking){var f=c.createEmptyMaterial(p.pickingShader,"pickingMaterial");f.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},f.wireframe=!1,this.hardwarePicking={pickingTarget:new o(this.viewportWidth/d,this.viewportHeight/d,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),pickingMaterial:f,pickingBuffer:new Uint8Array(4),clearColorStore:new n},i=!1}else null===this.hardwarePicking.pickingTarget&&(this.hardwarePicking.pickingTarget=new o(this.viewportWidth/d,this.viewportHeight/d,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),i=!1);if(i)this.setRenderTarget(this.hardwarePicking.pickingTarget);else{if(this.hardwarePicking.clearColorStore.set(this.clearColor),a&&void 0!==s&&void 0!==h){var m=this._useDevicePixelRatio&&window.devicePixelRatio?window.devicePixelRatio/this.svg.currentScale:1,g=Math.floor((s*m-this.viewportX)/d),y=Math.floor((this.viewportHeight-(h*m-this.viewportY))/d);this.context.enable(this.context.SCISSOR_TEST),this.context.scissor(g,y,1,1)}for(var v=[],x=0,w=t.length;w>x;x++){var _=t[x];(!_.meshRendererComponent||_.meshRendererComponent.isPickable)&&v.push(_)}l?this.render(v,e,[],this.hardwarePicking.pickingTarget,r):this.render(v,e,[],this.hardwarePicking.pickingTarget,r,u||this.hardwarePicking.pickingMaterial),a&&this.context.disable(this.context.SCISSOR_TEST)}}},w.prototype.pick=function(t,e,r,i){if(this.viewportWidth*this.viewportHeight===0)return r.id=-1,void(r.depth=0);var o=this._useDevicePixelRatio&&window.devicePixelRatio?window.devicePixelRatio/this.svg.currentScale:1,n=4,a=Math.floor((t*o-this.viewportX)/n),s=Math.floor((this.viewportHeight-(e*o-this.viewportY))/n);this.readPixels(a,s,1,1,this.hardwarePicking.pickingBuffer);var h=255*this.hardwarePicking.pickingBuffer[0]+this.hardwarePicking.pickingBuffer[1]-1,u=(this.hardwarePicking.pickingBuffer[2]/255+this.hardwarePicking.pickingBuffer[3]/65025)*i.far;r.id=h,r.depth=u},w.prototype.updateLineAndPointSettings=function(t){var e=this.rendererRecord.lineRecord,r=t.lineWidth||1;e.lineWidth!==r&&(this.context.lineWidth(r),e.lineWidth=r)},w.prototype.updateDepthTest=function(t){var e=this.rendererRecord.depthRecord,r=t.depthState;e.enabled!==r.enabled&&(r.enabled?this.context.enable(this.context.DEPTH_TEST):this.context.disable(this.context.DEPTH_TEST),e.enabled=r.enabled),e.write!==r.write&&(r.write?this.context.depthMask(!0):this.context.depthMask(!1),e.write=r.write)},w.prototype.updateCulling=function(t){var e=this.rendererRecord.cullRecord,r=t.cullState.cullFace,i=t.cullState.frontFace,o=t.cullState.enabled;if(e.enabled!==o&&(o?this.context.enable(this.context.CULL_FACE):this.context.disable(this.context.CULL_FACE),e.enabled=o),e.cullFace!==r){var n="Front"===r?this.context.FRONT:"Back"===r?this.context.BACK:this.context.FRONT_AND_BACK;this.context.cullFace(n),e.cullFace=r}if(e.frontFace!==i){switch(i){case"CCW":this.context.frontFace(this.context.CCW);break;case"CW":this.context.frontFace(this.context.CW)}e.frontFace=i}},w.prototype.updateTextures=function(t){for(var e=this.context,r=t.shader.textureSlots,n=0;n<r.length;n++){var a=r[n],s=t.getTexture(a.mapping);if(void 0!==s){var h=s;s instanceof Array==!1&&(h=[s]);for(var u=0;u<h.length;u++){s=h[u];var c=a.index instanceof Array?a.index[u]:a.index;(null===s||s instanceof o&&null===s.glTexture||s instanceof o==!1&&(void 0===s.image||s.checkDataReady()===!1))&&("sampler2D"===a.format?s=i.DEFAULT_TEXTURE_2D:"samplerCube"===a.format&&(s=i.DEFAULT_TEXTURE_CUBE));var l=this.rendererRecord.textureRecord[c];void 0===l&&(l=this.rendererRecord.textureRecord[c]={}),null===s.glTexture?(s.glTexture=e.createTexture(),this.updateTexture(e,s,c,l),s.needsUpdate=!1):s instanceof o==!1&&s.checkNeedsUpdate()?(this.updateTexture(e,s,c,l),s.needsUpdate=!1):this.bindTexture(e,s,c,l);var d=void 0!==s.image?s.image:s,p=x.isPowerOfTwo(d.width)&&x.isPowerOfTwo(d.height);this.updateTextureParameters(s,p)}}}},w.prototype.updateTextureParameters=function(e,i){var o=this.context,n=e.textureRecord,a=r.getGLType(o,e.variant);n.magFilter!==e.magFilter&&(o.texParameteri(a,o.TEXTURE_MAG_FILTER,r.getGLMagFilter(o,e.magFilter)),n.magFilter=e.magFilter);var s=i?e.minFilter:r.getFilterFallback(e.minFilter);n.minFilter!==s&&(o.texParameteri(a,o.TEXTURE_MIN_FILTER,r.getGLMinFilter(o,s)),n.minFilter=s);var h=i?e.wrapS:"EdgeClamp";if(n.wrapS!==h){var u=r.getGLWrap(o,h);o.texParameteri(a,o.TEXTURE_WRAP_S,u),n.wrapS=h}var c=i?e.wrapT:"EdgeClamp";if(n.wrapT!==c){var l=r.getGLWrap(o,c);o.texParameteri(a,o.TEXTURE_WRAP_T,l),n.wrapT=c}if(t.TextureFilterAnisotropic&&"Float"!==e.type){var d=e.anisotropy;n.anisotropy!==d&&(o.texParameterf(a,t.TextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(d,t.maxAnisotropy)),n.anisotropy=d)}},w.prototype.bindTexture=function(t,e,i,o){(void 0===o.boundTexture||void 0!==e.glTexture&&o.boundTexture!==e.glTexture)&&(t.activeTexture(t.TEXTURE0+i),t.bindTexture(r.getGLType(t,e.variant),e.glTexture),o.boundTexture=e.glTexture)},w.prototype.unbindTexture=function(t,e,i,o){t.activeTexture(t.TEXTURE0+i),t.bindTexture(r.getGLType(t,e.variant),null),o.boundTexture=void 0},w.prototype.loadCompressedTexture=function(e,r,i,o){var n=i.image.mipmapSizes,a=0,s=0,h=i.image.width,u=i.image.height,c=t.CompressedTextureS3TC;if(!c)return i.image=void 0,i.needsUpdate=!0,void console.warn("Tried to load unsupported compressed texture.");var l=c.COMPRESSED_RGBA_S3TC_DXT5_EXT;if("PrecompressedDXT1"===i.format)l=c.COMPRESSED_RGB_S3TC_DXT1_EXT;else if("PrecompressedDXT1A"===i.format)l=c.COMPRESSED_RGBA_S3TC_DXT1_EXT;else if("PrecompressedDXT3"===i.format)l=c.COMPRESSED_RGBA_S3TC_DXT3_EXT;else{if("PrecompressedDXT5"!==i.format)throw new Error("Unhandled compression format: "+o.getDataFormat().name());l=c.COMPRESSED_RGBA_S3TC_DXT5_EXT}if("undefined"==typeof n||null===n)o instanceof Uint8Array?e.compressedTexImage2D(r,0,l,h,u,0,o):e.compressedTexImage2D(r,0,l,h,u,0,new Uint8Array(o.buffer,o.byteOffset,o.byteLength));else{if(i.generateMipmaps=!1,o instanceof Array)for(var d=0;d<o.length;d++)e.compressedTexImage2D(r,d,l,h,u,0,o[d]),h=~~(h/2)>1?~~(h/2):1,u=~~(u/2)>1?~~(u/2):1;else for(var d=0;d<n.length;d++)s=n[d],e.compressedTexImage2D(r,d,l,h,u,0,new Uint8Array(o.buffer,o.byteOffset+a,s)),h=~~(h/2)>1?~~(h/2):1,u=~~(u/2)>1?~~(u/2):1,a+=s;var p=1+Math.ceil(Math.log(Math.max(i.image.height,i.image.width))/Math.log(2)),f=n[n.length-1];if(n.length<p)for(var d=n.length;p>d;d++)f=~~((h+3)/4)*~~((u+3)/4)*i.image.bpp*2,e.compressedTexImage2D(r,d,l,h,u,0,new Uint8Array(f)),h=~~(h/2)>1?~~(h/2):1,u=~~(u/2)>1?~~(u/2):1}},w.prototype.updateTexture=function(t,e,i,o){t.activeTexture(t.TEXTURE0+i),t.bindTexture(r.getGLType(t,e.variant),e.glTexture),o.boundTexture=e.glTexture,t.pixelStorei(t.UNPACK_ALIGNMENT,e.unpackAlignment),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);var n=e.image;if("2D"===e.variant)n?(!n.isCompressed&&(e.generateMipmaps||n.width>this.maxTextureSize||n.height>this.maxTextureSize)&&(this.checkRescale(e,n,n.width,n.height,this.maxTextureSize),n=e.image),n.isData===!0?n.isCompressed?this.loadCompressedTexture(t,t.TEXTURE_2D,e,n.data):t.texImage2D(t.TEXTURE_2D,0,r.getGLInternalFormat(t,e.format),n.width,n.height,e.hasBorder?1:0,r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),n.data):t.texImage2D(t.TEXTURE_2D,0,r.getGLInternalFormat(t,e.format),r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),n),e.generateMipmaps&&!n.isCompressed&&t.generateMipmap(t.TEXTURE_2D)):t.texImage2D(t.TEXTURE_2D,0,r.getGLInternalFormat(t,e.format),e.width,e.height,0,r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),null);else if("CUBE"===e.variant){if(n&&!n.isData&&(e.generateMipmaps||n.width>this.maxCubemapSize||n.height>this.maxCubemapSize)){for(var a=0;a<s.CUBE_FACES.length;a++)n.data[a]&&!n.data[a].buffer?r.scaleImage(e,n.data[a],n.width,n.height,this.maxCubemapSize,a):r.getBlankImage(e,[.3,.3,.3,0],n.width,n.height,this.maxCubemapSize,a);e.image.width=Math.min(this.maxCubemapSize,x.nearestPowerOfTwo(e.image.width)),e.image.height=Math.min(this.maxCubemapSize,x.nearestPowerOfTwo(e.image.height)),n=e.image}for(var h=0;h<s.CUBE_FACES.length;h++){var u=s.CUBE_FACES[h];n?n.isData===!0?n.isCompressed?this.loadCompressedTexture(t,r.getGLCubeMapFace(t,u),e,n.data[h]):t.texImage2D(r.getGLCubeMapFace(t,u),0,r.getGLInternalFormat(t,e.format),n.width,n.height,e.hasBorder?1:0,r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),n.data[h]):t.texImage2D(r.getGLCubeMapFace(t,u),0,r.getGLInternalFormat(t,e.format),r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),n.data[h]):t.texImage2D(r.getGLCubeMapFace(t,u),0,r.getGLInternalFormat(t,e.format),e.width,e.height,0,r.getGLInternalFormat(t,e.format),r.getGLPixelDataType(t,e.type),null)}n&&e.generateMipmaps&&!n.isCompressed&&t.generateMipmap(t.TEXTURE_CUBE_MAP)}},w.prototype.checkRescale=function(t,e,i,o,n,a){r.scaleImage(t,e,i,o,n,a)},w.prototype.updateBlending=function(t){var e=this.rendererRecord.blendRecord,i=this.context,o=t.blendState.blending;if(o!==e.blending&&("NoBlending"===o?i.disable(i.BLEND):"AdditiveBlending"===o?(i.enable(i.BLEND),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE)):"SubtractiveBlending"===o?(i.enable(i.BLEND),i.blendEquation(i.FUNC_REVERSE_SUBTRACT),i.blendFunc(i.SRC_ALPHA,i.ONE)):"MultiplyBlending"===o?(i.enable(i.BLEND),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA)):"AlphaBlending"===o?(i.enable(i.BLEND),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA)):"TransparencyBlending"===o?(i.enable(i.BLEND),i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)):"CustomBlending"===o?i.enable(i.BLEND):"SeparateBlending"===o?(i.enable(i.BLEND),i.blendEquationSeparate(r.getGLBlendParam(i,t.blendState.blendEquationColor),r.getGLBlendParam(i,t.blendState.blendEquationAlpha)),i.blendFuncSeparate(r.getGLBlendParam(i,t.blendState.blendSrcColor),r.getGLBlendParam(i,t.blendState.blendDstColor),r.getGLBlendParam(i,t.blendState.blendSrcAlpha),r.getGLBlendParam(i,t.blendState.blendDstAlpha))):(i.enable(i.BLEND),i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)),e.blending=o),"CustomBlending"===o){var n=t.blendState.blendEquation,a=t.blendState.blendSrc,s=t.blendState.blendDst;n!==e.blendEquation&&(i.blendEquation(r.getGLBlendParam(i,n)),e.blendEquation=n),(a!==e.blendSrc||s!==e.blendDst)&&(i.blendFunc(r.getGLBlendParam(i,a),r.getGLBlendParam(i,s)),e.blendSrc=a,e.blendDst=s)}else e.blendEquation=null,e.blendSrc=null,e.blendDst=null},w.prototype.updateOffset=function(t){var e=this.rendererRecord.offsetRecord,r=this.context,i=t.offsetState.enabled,o=t.offsetState.factor,n=t.offsetState.units;e.enabled!==i&&(i?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),e.enabled=i),!i||e.factor===o&&e.units===n||(r.polygonOffset(o,n),e.factor=o,e.units=n)},w.prototype.setBoundBuffer=function(t,e){var i=this.rendererRecord.currentBuffer[e];i.valid&&i.buffer===t||(this.context.bindBuffer(r.getGLBufferTarget(this.context,e),t),i.buffer=t,i.valid=!0,"ArrayBuffer"===e&&(this.rendererRecord.attributeCache.length=0))},w.prototype.bindVertexAttribute=function(t,e){var i=this.rendererRecord.attributeCache[t];i!==e.hashKey&&(this.context.vertexAttribPointer(t,e.count,r.getGLDataType(this.context,e.type),e.normalized,e.stride,e.offset),this.rendererRecord.attributeCache[t]=e.hashKey)},w.prototype.clear=function(t,e,r){var i=0;(void 0===t||t)&&(i|=this.context.COLOR_BUFFER_BIT),(void 0===e||e)&&(i|=this.context.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=this.context.STENCIL_BUFFER_BIT);var o=this.rendererRecord.depthRecord;o.write!==!0&&(this.context.depthMask(!0),o.write=!0),i&&this.context.clear(i)},w.prototype.flush=function(){this.context.flush()},w.prototype.finish=function(){this.context.finish()},w.prototype.setupFrameBuffer=function(t,e,r){this.context.bindFramebuffer(this.context.FRAMEBUFFER,t),this.context.framebufferTexture2D(this.context.FRAMEBUFFER,this.context.COLOR_ATTACHMENT0,r,e.glTexture,0)},w.prototype.setupRenderBuffer=function(t,e){var r=this.context;r.bindRenderbuffer(r.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t)):this.context.renderbufferStorage(r.RENDERBUFFER,r.RGBA4,e.width,e.height)},w.prototype.setRenderTarget=function(t){var e=this.context;if(t&&!t._glFrameBuffer){void 0===t.depthBuffer&&(t.depthBuffer=!0),void 0===t.stencilBuffer&&(t.stencilBuffer=!0),null===t.glTexture&&(t.glTexture=this.context.createTexture());var i=x.isPowerOfTwo(t.width)&&x.isPowerOfTwo(t.height),o=r.getGLInternalFormat(e,t.format),n=r.getGLDataType(e,t.type);t._glFrameBuffer=this.context.createFramebuffer(),t._glRenderBuffer=this.context.createRenderbuffer(),this.context.bindTexture(e.TEXTURE_2D,t.glTexture),this.updateTextureParameters(t,i),this.context.texImage2D(e.TEXTURE_2D,0,o,t.width,t.height,0,o,n,null),this.setupFrameBuffer(t._glFrameBuffer,t,e.TEXTURE_2D),this.setupRenderBuffer(t._glRenderBuffer,t),t.generateMipmaps&&i&&this.context.generateMipmap(e.TEXTURE_2D),this.context.bindTexture(e.TEXTURE_2D,null),this.context.bindRenderbuffer(e.RENDERBUFFER,null),this.context.bindFramebuffer(e.FRAMEBUFFER,null)}var a,s,h,u,c;t?(a=t._glFrameBuffer,u=0,c=0,s=t.width,h=t.height):(a=null,u=this.viewportX,c=this.viewportY,s=this.viewportWidth,h=this.viewportHeight),a!==this.rendererRecord.currentFrameBuffer&&(e.bindFramebuffer(e.FRAMEBUFFER,a),e.viewport(u,c,s,h),this.rendererRecord.currentFrameBuffer=a,this.rendererRecord.textureRecord=[]),this.currentWidth=s,this.currentHeight=h},w.prototype.updateRenderTargetMipmap=function(t){var e=this.context;e.bindTexture(e.TEXTURE_2D,t.glTexture),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)},w.prototype._deallocateMeshData=function(t){t.destroy(this.context)},w.prototype._deallocateTexture=function(t){t.destroy(this.context)},w.prototype._deallocateRenderTarget=function(t){t.destroy(this.context)},w.prototype._deallocateShader=function(t){t.destroy()},w}(goo.Capabilities,goo.RendererRecord,goo.RendererUtils,goo.TextureCreator,goo.RenderTarget,goo.Vector4,goo.Entity,goo.Texture,goo.DdsLoader,goo.DdsUtils,goo.Material,goo.Transform,goo.RenderQueue,goo.ShaderLib,goo.ShadowHandler,goo.RenderStats,goo.SystemBus,goo.TaskScheduler,goo.RenderInfo,goo.MathUtils),goo.TransformSystem=function(t){"use strict";function e(){t.call(this,"TransformSystem",["TransformComponent"]),this.numUpdates=0}function r(t){if(t.transformComponent._dirty){t.transformComponent.updateWorldTransform(),i++;for(var e=t.transformComponent.children,r=0;r<e.length;r++)e[r]._dirty=!0}}var i;return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.process=function(t){i=0;var e,o,n=t.length;for(e=0;n>e;e++)o=t[e].transformComponent,o._updated=!1,o._dirty&&o.updateTransform();for(e=0;n>e;e++){var a=t[e];o=a.transformComponent,null===o.parent&&a.traverse(r)}this.numUpdates=i},e}(goo.System),goo.SimplePartitioner=function(t){"use strict";function e(){}return e.prototype.added=function(){},e.prototype.removed=function(){},e.prototype.process=function(e,r,i){for(var o=0,n=0;n<r.length;n++){var a=r[n];if(a.skip||a.meshRendererComponent.hidden)a.isVisible=!1;else if("Never"===a.meshRendererComponent.cullMode)i[o++]=a,a.isVisible=!0;else{var s=a.meshRendererComponent.worldBound,h=e.contains(s);h!==t.Outside?(i[o++]=a,a.isVisible=!0):a.isVisible=!1}}i.length=o},e}(goo.Camera),goo.RenderSystem=function(t,e,r,i,o,n){"use strict";function a(){t.call(this,"RenderSystem",["MeshRendererComponent","MeshDataComponent"]),this.entities=[],this.renderList=[],this.postRenderables=[],this.partitioner=new r,this.preRenderers=[],this.composers=[],this._composersActive=!0,this.doRender=!0,this._debugMaterials={},this.overrideMaterials=[],this.partitioningCamera=null,this.camera=null,this.lights=[],this.currentTpf=0,e.addListener("goo.setCurrentCamera",function(t){this.camera=t.camera}.bind(this)),e.addListener("goo.setLights",function(t){this.lights=t}.bind(this)),this.picking={doPick:!1,x:0,y:0,pickingStore:{},pickingCallback:function(t,e){console.log(t,e)},skipUpdateBuffer:!1}}return a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a.prototype.pick=function(t,e,r,i){this.picking.x=t,this.picking.y=e,this.picking.skipUpdateBuffer=void 0===i?!1:i,r&&(this.picking.pickingCallback=r),this.picking.doPick=!0},a.prototype.inserted=function(t){this.partitioner&&this.partitioner.added(t)},a.prototype.deleted=function(t){this.partitioner&&this.partitioner.removed(t)},a.prototype.process=function(t,e){this.entities=t,this.currentTpf=e},a.prototype.render=function(t){if(this.doRender&&this.camera){t.updateShadows(this.partitioner,this.entities,this.lights);for(var e=0;e<this.preRenderers.length;e++){var r=this.preRenderers[e];r.process(t,this.entities,this.partitioner,this.camera,this.lights)}if(this.partitioningCamera?this.partitioner.process(this.partitioningCamera,this.entities,this.renderList):this.partitioner.process(this.camera,this.entities,this.renderList),this.composers.length>0&&this._composersActive)for(var e=0;e<this.composers.length;e++){var i=this.composers[e];i.render(t,this.currentTpf,this.camera,this.lights,null,!0,this.overrideMaterials)}else t.render(this.renderList,this.camera,this.lights,null,!0,this.overrideMaterials)}},a.prototype.renderToPick=function(t,e){t.renderToPick(this.renderList,this.camera,!0,e)},a.prototype.enableComposers=function(t){this._composersActive=!!t},a.prototype._createDebugMaterial=function(t){if(""!==t){var e;switch(t){case"wireframe":case"color":e=n.deepClone(o.simpleColored.fshader);break;case"lit":e=n.deepClone(o.simpleLit.fshader);break;case"texture":e=n.deepClone(o.textured.fshader);break;case"normals":e=n.deepClone(o.showNormals.fshader);break;case"simple":e=n.deepClone(o.simple.fshader)}var r=n.deepClone(o.uber);r.fshader=e,"flat"!==t?(this._debugMaterials[t]=new i(r,t),"wireframe"===t&&(this._debugMaterials[t].wireframe=!0),"lit"===t&&(this._debugMaterials[t]._textureMaps={EMISSIVE_MAP:null,DIFFUSE_MAP:null,SPECULAR_MAP:null,NORMAL_MAP:null,AO_MAP:null,LIGHT_MAP:null,TRANSPARENCY_MAP:null})):(this._debugMaterials[t]=i.createEmptyMaterial(null,t),this._debugMaterials[t].flat=!0)}},a.prototype.setDebugMaterial=function(t){if(!t||""===t)return void(this.overrideMaterials=[]);var e=t.split("+");this.overrideMaterials=[];for(var r=0;r<e.length;r++){var t=e[r];this._debugMaterials[t]||this._createDebugMaterial(t),""===t?this.overrideMaterials.push(null):this.overrideMaterials.push(this._debugMaterials[t])}},a.prototype.invalidateHandles=function(t){for(var e=0;e<this.entities.length;e++){for(var r=this.entities[e],i=r.meshRendererComponent.materials,o=0;o<i.length;o++)t.invalidateMaterial(i[o]);t.invalidateMeshData(r.meshDataComponent.meshData)}for(var e=0;e<this.composers.length;e++){var n=this.composers[e];t.invalidateComposer(n)}t.rendererRecord=null},a}(goo.System,goo.SystemBus,goo.SimplePartitioner,goo.Material,goo.ShaderLib,goo.ObjectUtils),goo.BoundingUpdateSystem=function(t,e){"use strict";function r(){t.call(this,"BoundingUpdateSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent"]),this._worldBound=new e,this._computeWorldBound=null}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.process=function(t){var e=t.length;if(0===e)return void(this._computeWorldBound=null);for(var r=0;e>r;r++){var i=t[r],o=i.meshDataComponent,n=i.transformComponent,a=i.meshRendererComponent;o.autoCompute?(o.computeBoundFromPoints(),a.updateBounds(o.modelBound,n.worldTransform)):n._updated&&a.updateBounds(o.modelBound,n.worldTransform)}if(this._computeWorldBound&&this._computeWorldBound instanceof Function){for(var r=0;e>r;r++)if(!t[r].particleComponent){this._worldBound=t[r].meshRendererComponent.worldBound.clone();break}for(;e>r;r++)if(!t[r].particleComponent){var s=t[r].meshRendererComponent;this._worldBound=this._worldBound.merge(s.worldBound)}this._computeWorldBound(this._worldBound),this._computeWorldBound=null}},r.prototype.getWorldBound=function(t){this._computeWorldBound=t},r.prototype.deleted=function(t){t.meshRendererComponent&&(t.meshRendererComponent.worldBound=new e)},r}(goo.System,goo.BoundingBox),
goo.ScriptSystem=function(t,e){"use strict";function r(r){t.call(this,"ScriptSystem",["ScriptComponent"]),this._world=r;var i=this._world.gooRunner.renderer;this.context={domElement:i.domElement,viewportWidth:i.viewportWidth,viewportHeight:i.viewportHeight,world:r,activeCameraEntity:null,worldData:{},playTime:0},this._playing=!0,e.addListener("goo.setCurrentCamera",function(t){this.context.activeCameraEntity=t.entity}.bind(this)),e.addListener("goo.viewportResize",function(t){this.context.viewportWidth=t.width,this.context.viewportHeight=t.height}.bind(this)),this.manualSetup=!1,this.priority=500}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.play=function(){this.context.playTime=0,this._playing=!0},r.prototype.resume=function(){this._playing=!0},r.prototype.pause=function(){this._playing=!1},r.prototype.stop=r.prototype.pause,r.prototype.process=function(t,e){for(var r=0;r<t.length;r++){var i=t[r].scriptComponent;i.run(t[r],e)}this._playing&&(this.context.playTime+=e)},r.prototype.addedComponent=function(t,e){"ScriptComponent"!==e.type||this.manualSetup||e.setup(t)},r.prototype.removedComponent=function(t,e){"ScriptComponent"!==e.type||this.manualSetup||e.cleanup()},r.prototype.clear=function(){for(var e=0;e<this._activeEntities.length;e++){var r=this._activeEntities[e];r.scriptComponent.cleanup()}this._world=null,this.context=null,t.prototype.clear.call(this)},r}(goo.System,goo.SystemBus),goo.LightingSystem=function(t,e,r){"use strict";function i(){e.call(this,"LightingSystem",["LightComponent","TransformComponent"]),this.overrideLights=null,this._needsUpdate=!0,this.lights=[]}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.setOverrideLights=function(t){this.overrideLights=t,r.emit("goo.setLights",this.overrideLights),this._needsUpdate=!0},i.prototype.clearOverrideLights=function(){this.overrideLights=void 0,this._needsUpdate=!0},i.prototype.inserted=function(t){t.lightComponent.updateLight(t.transformComponent.worldTransform)},i.prototype.process=function(e){if(!this.overrideLights){this.lights.length=0;for(var i=0;i<e.length;i++){var o=e[i],n=o.transformComponent,a=o.lightComponent;if((n._updated||this._needsUpdate)&&a.updateLight(n.worldTransform),!a.hidden){var s=a.light;s.shadowCaster=s.shadowCaster&&t.TextureFloat,this.lights.push(s)}}this._needsUpdate=!1,r.emit("goo.setLights",this.lights)}},i.prototype.invalidateHandles=function(t){this._activeEntities.forEach(function(e){e.lightComponent.light.invalidateHandles(t)})},i}(goo.Capabilities,goo.System,goo.SystemBus),goo.CameraSystem=function(t,e,r){"use strict";function i(){t.call(this,"CameraSystem",["TransformComponent","CameraComponent"]),this.mainCamera=null}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.findMainCamera=function(){if(this._activeEntities.length){var t=this._activeEntities[0];e.emit("goo.setCurrentCamera",{camera:t.cameraComponent.camera,entity:t})}},i.prototype.inserted=function(t){r.mainCamera||e.emit("goo.setCurrentCamera",{camera:t.cameraComponent.camera,entity:t})},i.prototype.deleted=function(){},i.prototype.process=function(){for(var t=0;t<this._activeEntities.length;t++){var e=this._activeEntities[t],r=e.transformComponent,i=e.cameraComponent;r._updated&&i.updateCamera(r.worldTransform)}},i}(goo.System,goo.SystemBus,goo.Renderer),goo.ParticlesSystem=function(t){"use strict";function e(){t.call(this,"ParticlesSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent","ParticleComponent"]),this.passive=!1}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.process=function(t,e){if(!(e>1))for(var r=0,i=t.length;i>r;r++){var o=t[r],n=o.particleComponent;n.enabled&&this.updateParticles(o,n,e)}},e.prototype.updateParticles=function(t,e,r){for(var i,o=0,n=-1,a=!1;o<e.particleCount;){for(;void 0===i;)if(n++,e.emitters.length>n){if(i=e.emitters[n],i.influences.length)for(var s=0,h=i.influences.length;h>s;s++)i.influences[s].prepare(t,i);if(!i.enabled){i=void 0;continue}if(0!==i.totalParticlesToSpawn&&(i.particlesWaitingToRelease+=i.releaseRatePerSecond*r,i.particlesWaitingToRelease=Math.max(i.particlesWaitingToRelease,0)),i.particlesWaitingToRelease<1){i=void 0;continue}}else i=null;var u=e.particles[o];if(u.alive&&u.emitter&&u.emitter.influences.length)for(var s=0,h=u.emitter.influences.length;h>s;s++)u.emitter.influences[s].enabled&&u.emitter.influences[s].apply(r,u,o);u.alive&&(u.update(r,t),a=!0),!u.alive&&i&&(i.particlesWaitingToRelease--,i.totalParticlesToSpawn>=1&&i.totalParticlesToSpawn--,u.respawnParticle(i),i.getEmissionPoint(u,t),i.getEmissionVelocity(u,t),(i.particlesWaitingToRelease<1||0===i.totalParticlesToSpawn)&&(i=void 0)),o++}a&&(e.meshData.vertexData._dataNeedsRefresh=!0,t.meshDataComponent.autoCompute=!0)},e.prototype.play=function(){this.passive=!1},e.prototype.pause=function(){this.passive=!0},e.prototype.resume=e.prototype.play,e.prototype.stop=e.prototype.pause,e}(goo.System),goo.Stats=function(){"use strict";function t(){var t=Date.now(),e=t,r=t,i=0,o=1/0,n=0,a=0,s=1/0,h=0,u=0,c=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(t){t.preventDefault(),_(++c%2)},!1),l.style.cssText="width:80px;cursor:pointer;z-index:1000;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;";var d=document.createElement("div");d.id="fps",d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(d);var p=document.createElement("div");p.id="fpsText",p.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",p.innerHTML="FPS",d.appendChild(p);var f=document.createElement("div");for(f.id="fpsGraph",f.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",d.appendChild(f);f.children.length<74;){var m=document.createElement("span");m.style.cssText="width:1px;height:30px;float:left;background-color:#113",f.appendChild(m)}var g=document.createElement("div");g.id="ms",g.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(g);var y=document.createElement("div");y.id="msText",y.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",y.innerHTML="MS",g.appendChild(y);var v=document.createElement("div");for(v.id="msGraph",v.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",g.appendChild(v);v.children.length<74;){var m=document.createElement("span");m.style.cssText="width:1px;height:30px;float:left;background-color:#131",v.appendChild(m)}var x=document.createElement("div");x.id="info",x.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200",l.appendChild(x);var w=document.createElement("div");w.id="infoText",w.style.cssText="color:#f66;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",w.innerHTML="INFO",x.appendChild(w);var _=function(t){switch(c=t){case 0:d.style.display="block",g.style.display="none";break;case 1:d.style.display="none",g.style.display="block"}},b=function(t,e){var r=t.appendChild(t.firstChild);r.style.height=e+"px"};this.domElement=l,this.setMode=_,this.begin=function(){t=Date.now()},this.end=function(c){var l=Date.now();return l>r+100&&(i=l-t,o=Math.min(o,i),n=Math.max(n,i),y.textContent=i+" MS ("+o+"-"+n+")",b(v,Math.min(30,30-i/200*30)),r=l,c&&(w.innerHTML=c)),u++,l>e+1e3&&(a=Math.round(1e3*u/(l-e)),s=Math.min(s,a),h=Math.max(h,a),p.textContent=a+" FPS ("+s+"-"+h+")",b(f,Math.min(30,30-a/(Math.min(500,h)+10)*30)),e=l,u=0),l},this.update=function(e){t=this.end(e)}}return t}(),goo.AudioContext=function(){"use strict";var t=!0,e=window.AudioContext||window.webkitAudioContext;e||(console.warn("WebAudio not supported"),t=!1);var r;return{getContext:function(){if(!r&&t)try{r=new e}catch(i){console.warn(i.message),t=!1}return r},isSupported:function(){return t}}}(),goo.SoundSystem=function(t,e,r,i,o,n,a){"use strict";function s(){if(!e.isSupported())return void console.warn("Cannot create SoundSystem, WebAudio not supported");t.call(this,"SoundSystem",["SoundComponent","TransformComponent"]),this.entities=[],this._relativeTransform=new a,this._camera=null,this._settings={rolloffFactor:.4,maxDistance:100},this._pausedSounds={},this.initialized=!1;var r=this;o.addListener("goo.setCurrentCamera",function(t){r._camera=t.camera}),this._scheduledUpdates=[]}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype._initializeAudioNodes=function(){this._outNode=e.getContext().createGain(),this._outNode.connect(e.getContext().destination),this._wetNode=e.getContext().createGain(),this._wetNode.connect(this._outNode),this._wetNode.gain.value=.2,this._convolver=e.getContext().createConvolver(),this._convolver.connect(this._wetNode),this._listener=e.getContext().listener,this._listener.dopplerFactor=0,this._listener.setPosition(0,0,0),this._listener.setVelocity(0,0,0),this._listener.setOrientation(0,0,-1,0,1,0),this.initialized=!0},s.prototype.inserted=function(t){this.initialized||this._initializeAudioNodes(),t.soundComponent.connectTo({dry:this._outNode,wet:this._convolver})},s.prototype.deleted=function(t){if(t.soundComponent){for(var e=t.soundComponent.sounds,r=0;r<e.length;r++)e[r].stop();t.soundComponent.connectTo()}},s.prototype.updateConfig=function(t){return e.isSupported()?void this._scheduledUpdates.push(function(){n.extend(this._settings,t),this.initialized||this._initializeAudioNodes(),void 0!==t.dopplerFactor&&(this._listener.dopplerFactor=.05*t.dopplerFactor),void 0!==t.volume&&(this._outNode.gain.value=i.clamp(t.volume,0,1)),void 0!==t.reverb&&(this._wetNode.gain.value=i.clamp(t.reverb,0,1))}):void console.warn("WebAudio not supported")},s.prototype.setReverb=function(t){return e.isSupported()?void this._scheduledUpdates.push(function(){this.initialized||this._initializeAudioNodes(),this._wetNode.disconnect(),!t&&this._wetNode?this._convolver.buffer=null:(this._convolver.buffer=t,this._wetNode.connect(this._outNode))}):void console.warn("WebAudio not supported")},s.prototype.pause=function(){if(!this._pausedSounds){this._pausedSounds={};for(var t=0;t<this.entities.length;t++)for(var e=this.entities[t].soundComponent.sounds,r=0;r<e.length;r++){var i=e[r];i.isPlaying()&&(i.pause(),this._pausedSounds[i.id]=!0)}}},s.prototype.resume=function(){if(this._pausedSounds){for(var t=0;t<this.entities.length;t++)for(var e=this.entities[t].soundComponent.sounds,r=0;r<e.length;r++){var i=e[r];this._pausedSounds[i.id]&&i.play()}this._pausedSounds=null}},s.prototype.play=s.prototype.resume,s.prototype.stop=function(){for(var t=0;t<this.entities.length;t++)for(var e=this.entities[t].soundComponent.sounds,r=0;r<e.length;r++){var i=e[r];i.stop()}this._pausedSounds=null},s.prototype.process=function(t,r){if(e.isSupported()&&0!==t.length){for(;this._scheduledUpdates.length;){var i=this._scheduledUpdates.pop();i.call(this)}this.initialized||this._initializeAudioNodes(),this.entities=t;var o,n=this._relativeTransform;this._camera&&(o=this._camera.getViewMatrix());for(var a=0;a<t.length;a++){var s=t[a],h=s.soundComponent;h._attachedToCamera=!(!s.cameraComponent||s.cameraComponent.camera!==this._camera),this._camera&&!h._attachedToCamera?(n.mul2(o,s.transformComponent.worldTransform.matrix),h.process(this._settings,n,r)):h.process(this._settings,null,r)}}},s}(goo.System,goo.AudioContext,goo.Vector3,goo.MathUtils,goo.SystemBus,goo.ObjectUtils,goo.Matrix4),goo.MeshDataComponent=function(t,e,r){"use strict";function i(r){e.apply(this,arguments),this.type="MeshDataComponent",this.meshData=r,this.modelBound=new t,this.autoCompute=!0,this.currentPose=null}return i.type="MeshDataComponent",i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.setModelBound=function(t,e){this.modelBound=t,this.autoCompute=e},i.prototype.computeBoundFromPoints=function(){if(this.autoCompute&&null!==this.modelBound&&this.meshData){var t=this.meshData.getAttributeBuffer("POSITION");void 0!==t&&(this.modelBound.computeFromPoints(t),this.autoCompute=!1)}},i.prototype.clone=function(t){t=t||{};var e=new i;return t.shareMeshData?(e.meshData=this.meshData,e.modelBound=this.modelBound):(e.meshData=this.meshData.clone(),e.modelBound=this.modelBound.clone()),e.autoCompute=this.autoCompute,e},i.applyOnEntity=function(t,e){if(t instanceof r){var o=new i(t);return e.setComponent(o),!0}},i}(goo.BoundingBox,goo.Component,goo.MeshData),goo.MeshRendererComponent=function(t,e){"use strict";function r(e){t.apply(this,arguments),this.type="MeshRendererComponent",this.materials=Array.isArray(e)?e:e?[e]:[],this.worldBound=null,this.cullMode="Dynamic",this.castShadows=!0,this.receiveShadows=!0,this.isPickable=!0,this.isReflectable=!0,this.hidden=!1,this._renderDistance=0}return r.type="MeshRendererComponent",r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.api={setDiffuse:function(){var t=this.meshRendererComponent.materials[0];t.uniforms.materialDiffuse||(t.uniforms.materialDiffuse=[0,0,0,1]);var e=t.uniforms.materialDiffuse;if(arguments.length>=3)e[0]=arguments[0],e[1]=arguments[1],e[2]=arguments[2],e[3]=3===arguments.length?1:arguments[3];else{var r=arguments[0];r instanceof Array?(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=3===r.length?1:r[3]):void 0!==r.r&&void 0!==r.g&&void 0!==typeof r.b&&(e[0]=r.r,e[1]=r.g,e[2]=r.b,e[3]=void 0===r.a?1:r.a)}},getDiffuse:function(){return this.meshRendererComponent.materials[0].uniforms.materialDiffuse}},r.entitySelectionAPI={setDiffuse:r.prototype.api.setDiffuse},r.prototype.updateBounds=function(t,e){this.worldBound=t.transform(e,this.worldBound)},r.prototype.clone=function(t){t=t||{};var e;e=t.shareMaterials?this.materials:this.materials.map(function(e){return e.clone(t)});var i=new r(e);return i.cullMode=this.cullMode,i.castShadows=this.castShadows,i.receiveShadows=this.receiveShadows,i.isPickable=this.isPickable,i.isReflectable=this.isReflectable,i},r.applyOnEntity=function(t,i){var o=i.meshRendererComponent;o||(o=new r);var n=!1;return t instanceof e&&(o.materials.push(t),n=!0),n?(i.setComponent(o),!0):void 0},r}(goo.Component,goo.Material),goo.CameraComponent=function(t,e,r,i){"use strict";function o(r){t.apply(this,arguments),this.type="CameraComponent",this.camera=r,this.leftVec=new e(-1,0,0),this.upVec=new e(0,1,0),this.dirVec=new e(0,0,-1)}return o.type="CameraComponent",o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.api={setAsMainCamera:function(){return i.emit("goo.setCurrentCamera",{camera:this.cameraComponent.camera,entity:this}),this}},o.prototype.setUpVector=function(t){0===t?(this.leftVec.setDirect(0,-1,0),this.upVec.setDirect(1,0,0),this.dirVec.setDirect(0,0,-1)):2===t?(this.leftVec.setDirect(-1,0,0),this.upVec.setDirect(0,0,1),this.dirVec.setDirect(0,-1,0)):(this.leftVec.setDirect(-1,0,0),this.upVec.setDirect(0,1,0),this.dirVec.setDirect(0,0,-1))},o.prototype.updateCamera=function(t){this.camera._left.set(this.leftVec),this.camera._left.applyPost(t.rotation),this.camera._up.set(this.upVec),this.camera._up.applyPost(t.rotation),this.camera._direction.set(this.dirVec),this.camera._direction.applyPost(t.rotation),t.matrix.getTranslation(this.camera.translation),this.camera.onFrameChange()},o.prototype.copy=function(t){return this.camera.copy(t.camera),this.leftVec.copy(t.leftVec),this.upVec.copy(t.upVec),this.dirVec.copy(t.dirVec),this},o.prototype.clone=function(){var t=new o(this.camera.clone());return t.leftVec.copy(this.leftVec),t.upVec.copy(this.upVec),t.dirVec.copy(this.dirVec),t},o.applyOnEntity=function(t,e){if(t instanceof r){var i=new o(t);return e.setComponent(i),!0}},o}(goo.Component,goo.Vector3,goo.Camera,goo.SystemBus),goo.LightComponent=function(t,e){"use strict";function r(e){t.apply(this,arguments),this.type="LightComponent",this.light=e,this.hidden=!1}return r.type="LightComponent",r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.updateLight=function(t){this.light.update(t)},r.prototype.copy=function(t){return this.light.copy(t),this.hidden=t.hidden,this},r.prototype.clone=function(){var t=new r(this.light.clone());return t.hidden=this.hidden,t},r.applyOnEntity=function(t,i){if(t instanceof e){var o=new r(t);return i.setComponent(o),!0}},r}(goo.Component,goo.Light),goo.ScriptComponent=function(t,e,r,i){"use strict";function o(e){t.apply(this,arguments),this.type="ScriptComponent",e instanceof Array?this.scripts=e:e?this.scripts=[e]:this.scripts=[]}return o.type="ScriptComponent",o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.setup=function(t){var e=t._world.getSystem("ScriptSystem").context,r=Object.create(e);i.extend(r,{entity:t,entityData:{}});for(var o=0;o<this.scripts.length;o++){var n=this.scripts[o];if(!n.context&&(n.context=Object.create(r),n.parameters&&void 0!==n.parameters.enabled?n.enabled=n.parameters.enabled:n.enabled=!0,n.setup&&n.enabled))try{n.setup(n.parameters,n.context,window.goo)}catch(a){this._handleError(n,a,"setup")}}},o.prototype.run=function(t){for(var e=0;e<this.scripts.length;e++){var r=this.scripts[e];if(r&&r.run&&(void 0===r.enabled||r.enabled))try{r.run(t,t._world.tpf,r.context,r.parameters)}catch(i){this._handleError(r,i,"run")}else if(r.update&&(void 0===r.enabled||r.enabled))try{r.update(r.parameters,r.context,window.goo)}catch(i){this._handleError(r,i,"update")}}},o.prototype.cleanup=function(){for(var t=0;t<this.scripts.length;t++){var e=this.scripts[t];if(e.context){if(e.cleanup&&(e.parameters&&void 0!==e.parameters.enabled?e.parameters.enabled:e.enabled))try{e.cleanup(e.parameters,e.context,window.goo)}catch(r){this._handleError(e,r,"cleanup")}e.enabled=!1,e.context=null}}},o.prototype.startScripts=function(){this.scripts.forEach(function(t){t.parameters&&t.parameters.enabled===!1?t.enabled=!1:t.enabled=!0})},o.prototype.stopScripts=function(){this.scripts.forEach(function(t){t.enabled=!1})},o.prototype._handleError=function(t,r,i){t.enabled=!1;var o={id:t.id,errors:[{message:r.message||r,phase:i}]};if(r instanceof Error){var n=r.stack.split("\n")[1].match(/(\d+):\d+\)$/);n&&(o.line=parseInt(n[1],10)-1)}console.error(o.errors[0].message,o),e.emit("goo.scriptError",o)},o.applyOnEntity=function(t,e){if(t instanceof Function||t&&t.run instanceof Function||t&&t.update instanceof Function){var r;return e.scriptComponent?r=e.scriptComponent:(r=new o,e.setComponent(r)),r.scripts.push(t.run instanceof Function||t.update instanceof Function?t:{run:t}),!0}},o}(goo.Component,goo.SystemBus,goo.Scripts,goo.ObjectUtils),goo.SoundComponent=function(t,e,r,i){"use strict";function o(){t.apply(this,arguments),this.type="SoundComponent",this.sounds=[],this._isPanned=!0,this._outDryNode=e.getContext().createGain(),this._outWetNode=e.getContext().createGain(),this.connectTo(),this._pannerNode=e.getContext().createPanner(),this._pannerNode.connect(this._outDryNode),this._inNode=e.getContext().createGain(),this._inNode.connect(this._pannerNode),this._oldPosition=new r,this._position=new r,this._orientation=new r,this._velocity=new r,this._attachedToCamera=!1}return o.type="SoundComponent",o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.addSound=function(t){-1===this.sounds.indexOf(t)&&(t.connectTo([this._inNode,this._outWetNode]),this.sounds.push(t))},o.prototype.removeSound=function(t){var e=this.sounds.indexOf(t);e>-1&&(t.stop(),this.sounds.splice(e,1),t.disconnectFrom([this._inNode,this._outWetNode]))},o.prototype.getSoundById=function(t){for(var e=0;e<this.sounds.length;e++)if(this.sounds[e].id===t)return this.sounds[e]},o.prototype.connectTo=function(t){this._outDryNode.disconnect(),this._outWetNode.disconnect(),t&&t.dry&&this._outDryNode.connect(t.dry),t&&t.wet&&this._outWetNode.connect(t.wet)},o.prototype.updateConfig=function(t){void 0!==t.volume&&(this._outDryNode.gain.value=i.clamp(t.volume,0,1)),void 0!==t.reverb&&(this._outWetNode.gain.value=i.clamp(t.reverb,0,1))},o.prototype.process=function(t,e,r){return this._pannerNode.rolloffFactor=t.rolloffFactor,this._pannerNode.maxDistance=t.maxDistance,this._attachedToCamera||!e?(this._isPanned&&(this._inNode.disconnect(),this._inNode.connect(this._outDryNode),this._isPanned=!1),this._pannerNode.setPosition(0,0,0),this._pannerNode.setVelocity(0,0,0),void this._pannerNode.setOrientation(0,0,0)):(this._isPanned||(this._inNode.disconnect(),this._inNode.connect(this._pannerNode),this._isPanned=!0),e.getTranslation(this._position),r>0?this._velocity.set(this._position).sub(this._oldPosition).scale(1/r):this._velocity.setDirect(0,0,0),this._oldPosition.set(this._position),this._orientation.setDirect(0,0,-1),this._orientation.applyPostVector(e),this._pannerNode.setPosition(this._position.x,this._position.y,this._position.z),this._pannerNode.setVelocity(this._velocity.x,this._velocity.y,this._velocity.z),void this._pannerNode.setOrientation(this._orientation.x,this._orientation.y,this._orientation.z))},o}(goo.Component,goo.AudioContext,goo.Vector3,goo.MathUtils),goo.GameUtils=function(){"use strict";function t(){}t.supported={fullscreen:!0,pointerLock:!0},t.requestFullScreen=function(){!document.fullscreenElement&&document.documentElement.requestFullScreen&&document.documentElement.requestFullScreen()},t.exitFullScreen=function(){document.fullscreenElement&&document.cancelFullScreen&&document.cancelFullScreen()},t.toggleFullScreen=function(){document.fullscreenElement?document.cancelFullScreen&&document.cancelFullScreen():document.documentElement.requestFullScreen&&document.documentElement.requestFullScreen()},t.requestPointerLock=function(t){var e=t||document.documentElement;e.requestPointerLock&&e.requestPointerLock()},t.exitPointerLock=function(){document.exitPointerLock&&document.exitPointerLock()},t.togglePointerLock=function(e){document.pointerLockElement?t.exitPointerLock():t.requestPointerLock(e)};var e=[];return t.addVisibilityChangeListener=function(t){if("function"==typeof t){for(var r,i,o=["","ms","moz","webkit"],n=0;n<o.length;++n){var a=o[n]+(0===o[n].length?"hidden":"Hidden"),s=o[n]+"visibilitychange";if("undefined"!=typeof document[a]){r=a,i=s;break}}if("undefined"!=typeof document.addEventListener&&"undefined"!=typeof r){var h=function(){t(document[r]?!0:!1)};e.push({eventName:i,eventListener:h}),document.addEventListener(i,h)}}},t.clearVisibilityChangeListeners=function(){e.forEach(function(t){document.removeEventListener(t.eventName,t.eventListener)}),e=[]},t.initAllShims=function(e){t.initWebGLShims(),t.initAnimationShims(),t.initFullscreenShims(e),t.initPointerLockShims(e)},t.initWebGLShims=function(){window.Uint8ClampedArray=window.Uint8ClampedArray||window.Uint8Array},t.initAnimationShims=function(){for(var t=0,e=["ms","moz","webkit","o"],r=0;r<e.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[e[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[r]+"CancelAnimationFrame"]||window[e[r]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(e){var r=Date.now(),i=Math.max(0,16-(r-t)),o=window.setTimeout(function(){e(r+i)},i);return t=r+i,o}),void 0===window.cancelAnimationFrame&&(window.cancelAnimationFrame=function(t){clearTimeout(t)})},t.initFullscreenShims=function(e){function r(){var t=document.createEvent("CustomEvent");t.initCustomEvent("fullscreenchange",!0,!1,null),document.dispatchEvent(t)}function i(){var t=document.createEvent("CustomEvent");t.initCustomEvent("fullscreenerror",!0,!1,null),document.dispatchEvent(t)}e=e||window;var o=(e.HTMLElement||e.Element).prototype;if(!document.hasOwnProperty("fullscreenEnabled")){var n=function(){return"webkitIsFullScreen"in document?function(){return document.webkitFullscreenEnabled}:"mozFullScreenEnabled"in document?function(){return document.mozFullScreenEnabled}:(t.supported.fullscreen=!1,function(){return!1})}();Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,writeable:!1,get:n})}if(!document.hasOwnProperty("fullscreenElement")){var n=function(){for(var t=["webkitCurrentFullScreenElement","webkitFullscreenElement","mozFullScreenElement"],e=function(e){return function(){return document[t[e]]}},r=0;r<t.length;r++)if(t[r]in document)return e(r);return function(){return null}}();Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:n})}document.addEventListener("webkitfullscreenchange",r,!1),document.addEventListener("mozfullscreenchange",r,!1),document.addEventListener("webkitfullscreenerror",i,!1),document.addEventListener("mozfullscreenerror",i,!1),o.requestFullScreen||(o.requestFullScreen=function(){return o.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(e.Element.ALLOW_KEYBOARD_INPUT)}:o.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}}()),document.cancelFullScreen||(document.cancelFullScreen=function(){return document.webkitCancelFullScreen||document.mozCancelFullScreen||function(){}}())},t.initPointerLockShims=function(e){function r(){var t=document.createEvent("CustomEvent");t.initCustomEvent("pointerlockchange",!0,!1,null),document.dispatchEvent(t)}function i(){var t=document.createEvent("CustomEvent");t.initCustomEvent("pointerlockerror",!0,!1,null),document.dispatchEvent(t)}e=e||window;var o=(e.HTMLElement||e.Element).prototype;if(e.MouseEvent){var n=e.MouseEvent.prototype;if("movementX"in n||Object.defineProperty(n,"movementX",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementX||this.mozMovementX||0}}),"movementY"in n||Object.defineProperty(n,"movementY",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementY||this.mozMovementY||0}}),navigator.pointer||(navigator.pointer=navigator.webkitPointer||navigator.mozPointer),document.addEventListener("webkitpointerlockchange",r,!1),document.addEventListener("webkitpointerlocklost",r,!1),document.addEventListener("mozpointerlockchange",r,!1),document.addEventListener("mozpointerlocklost",r,!1),document.addEventListener("webkitpointerlockerror",i,!1),document.addEventListener("mozpointerlockerror",i,!1),!("pointerLockElement"in document)){var a=function(){return"webkitPointerLockElement"in document?function(){return document.webkitPointerLockElement}:"mozPointerLockElement"in document?function(){return document.mozPointerLockElement}:function(){return null}}();Object.defineProperty(document,"pointerLockElement",{enumerable:!0,configurable:!1,writeable:!1,get:a})}o.requestPointerLock||(o.requestPointerLock=function(){return o.webkitRequestPointerLock?function(){this.webkitRequestPointerLock()}:o.mozRequestPointerLock?function(){this.mozRequestPointerLock()}:navigator.pointer?function(){navigator.pointer.lock(this,r,i)}:(t.supported.pointerLock=!1,function(){})}()),document.exitPointerLock||(document.exitPointerLock=function(){return document.webkitExitPointerLock||document.mozExitPointerLock||function(){navigator.pointer&&navigator.pointer.unlock()}}())}},t}(),goo.Logo=function(){"use strict";function t(){}t.blue="#2A3276",t.white="#FFFFFF";var e={color:t.white,shadow:!1};return t.getLogo=function(t){t=t||{};for(var r in e)void 0===t[r]&&(t[r]=e[r]);if(!document.createElementNS)return"";var i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"svg");o.setAttribute("version","1.1"),o.setAttribute("xmlns",i),o.setAttribute("x","0px"),o.setAttribute("y","0px"),o.setAttribute("viewBox","0 0 396.603 277.343"),o.setAttribute("enable-background","new 0 0 396.603 277.343"),o.setAttribute("xml:space","preserve"),t.width&&o.setAttribute("width",t.width),t.height&&o.setAttribute("height",t.height);var n=document.createElementNS(i,"g");o.appendChild(n);var a=document.createElementNS(i,"filter");a.setAttribute("id","insetShadow");var s=document.createElementNS(i,"feGaussianBlur");s.setAttribute("in","SourceAlpha"),s.setAttribute("stdDeviation","0");var h=document.createElementNS(i,"feOffset");h.setAttribute("dx","0"),h.setAttribute("dy","-5"),h.setAttribute("result","offsetblur");var u=document.createElementNS(i,"feComponentTransfer"),c=document.createElementNS(i,"feFuncA");c.setAttribute("type","linear"),c.setAttribute("slope","0.5"),u.appendChild(c);var l=document.createElementNS(i,"feMerge"),d=document.createElementNS(i,"feMergeNode"),p=document.createElementNS(i,"feMergeNode");p.setAttribute("in","SourceGraphic"),l.appendChild(d),l.appendChild(p),a.appendChild(s),a.appendChild(h),a.appendChild(u),a.appendChild(l),n.appendChild(a);var f=document.createElementNS(i,"path");f.setAttribute("d","M303.337,46.286c-13.578,0-25.784,5.744-34.396,14.998c-9.86,10.59-26.319,10.59-36.172,0c-8.605-9.254-20.818-14.998-34.402-14.998c-25.936,0-46.971,21.034-46.971,46.978c0,25.936,21.035,46.972,46.971,46.972c13.584,0,25.797-5.744,34.402-14.998c9.853-10.598,26.325-10.598,36.172,0c8.612,9.254,20.818,14.998,34.396,14.998c25.941,0,46.977-21.036,46.977-46.972C350.313,67.32,329.278,46.286,303.337,46.286z M198.296,116.39c-12.785,0-23.146-10.359-23.146-23.144s10.361-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151S211.091,116.39,198.296,116.39z M303.337,116.407c-12.785,0-23.146-10.36-23.146-23.144c0-12.784,10.36-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151C326.493,106.047,316.132,116.407,303.337,116.407z M156.18,138.347c-14.087-3.23-22.316-17.482-18.068-31.305c3.704-12.072,2.568-25.511-4.22-37.256C120.927,47.323,92.22,39.63,69.766,52.587C47.317,65.552,39.624,94.26,52.581,116.713c6.795,11.761,17.853,19.462,30.17,22.282c14.084,3.235,22.314,17.497,18.074,31.317c-3.711,12.08-2.582,25.504,4.213,37.264c12.965,22.455,41.666,30.148,64.127,17.178c22.447-12.945,30.148-41.658,17.185-64.111C179.554,148.881,168.497,141.181,156.18,138.347z M104.802,113.287c-11.064,6.387-25.219,2.599-31.604-8.474c-6.397-11.07-2.604-25.225,8.474-31.609c11.057-6.398,25.22-2.598,31.611,8.46C119.673,92.741,115.872,106.897,104.802,113.287z M145.687,207.256c-12.785,0-23.145-10.361-23.145-23.145s10.359-23.15,23.145-23.15c12.797,0,23.156,10.367,23.156,23.15S158.483,207.256,145.687,207.256z"),f.setAttribute("fill",t.color),t.shadow&&(n.appendChild(a),f.setAttribute("style","filter:url(#insetShadow)")),n.appendChild(f);var m=new XMLSerializer,g=m.serializeToString(o);return g},t}(),goo.GooRunner=function(t,e,r,i,o,n,a,s,h,u,c,l,d,p,f,m,g,y,v,x,w,_,b){"use strict";function S(r){if(r=r||{},x.initAllShims(),this.world=new t(this),this.renderer=new e(r),this.useTryCatch=void 0!==r.useTryCatch?r.useTryCatch:!0,this._setBaseSystems(),this._registerBaseComponents(),this.doProcess=!0,this.doRender=!0,this.tpfSmoothingCount=void 0!==r.tpfSmoothingCount?r.tpfSmoothingCount:10,r.showStats&&(this.stats=new u,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="10px",this.stats.domElement.style.top="10px",document.body.appendChild(this.stats.domElement)),void 0===r.logo||r.logo){var i=this._buildLogo(r.logo);i&&document.body.appendChild(i)}this.callbacksPreProcess=[],this.callbacksPreRender=[],this.callbacks=[],this.callbacksNextFrame=[],this._takeSnapshots=[],this.start=-1,this.animationId=0,r.manuallyStartGameLoop||this.startGameLoop(),r.debugKeys&&this._addDebugKeys(),this._events={click:null,mousedown:null,mouseup:null,mousemove:null,touchstart:null,touchend:null,touchmove:null},this._eventListeners={click:[],mousedown:[],mouseup:[],mousemove:[],touchstart:[],touchend:[],touchmove:[]},this._eventTriggered={click:null,mousedown:null,mouseup:null,mousemove:null,touchstart:null,touchend:null,touchmove:null},x.addVisibilityChangeListener(function(t){t?this._stopGameLoop():this.manuallyPaused||this._startGameLoop()}.bind(this)),this._picking={x:0,y:0,skipUpdateBuffer:!1,doPick:!1,pickingCallback:null,pickingStore:{},clearColorStore:[]},this.manuallyPaused=!!r.manuallyStartGameLoop,this._setupContextLost()}S.prototype._setupContextLost=function(){
_.addListener("goo.contextLost",function(){for(var t=0;t<this.renderSystems.length;t++){var e=this.renderSystems[t];e.invalidateHandles&&e.invalidateHandles(this.renderer)}var r=this.world.getSystem("LightingSystem");r&&r.invalidateHandles(this.renderer),this.renderer.shadowHandler&&this.renderer.shadowHandler.invalidateHandles(this.renderer),this.renderer.invalidatePicking(),this.stopGameLoop()}.bind(this)),_.addListener("goo.contextRestored",function(){this.startGameLoop()}.bind(this))},S.prototype._setBaseSystems=function(){this.world.setSystem(new n(this.world)),this.world.setSystem(new r),this.world.setSystem(new s),this.world.setSystem(new h),this.world.setSystem(new o),this.world.setSystem(new a),c.isSupported()&&this.world.setSystem(new l),this.renderSystem=new i,this.renderSystems=[this.renderSystem],this.world.setSystem(this.renderSystem)},S.prototype._registerBaseComponents=function(){this.world.registerComponent(d),this.world.registerComponent(p),this.world.registerComponent(f),this.world.registerComponent(m),this.world.registerComponent(g),this.world.registerComponent(y)},S.prototype.run=function(t){this.useTryCatch?this._callSafe(this._updateFrame,t):this._updateFrame(t)},S.prototype._callSafe=function(t){try{t.apply(this,Array.prototype.slice.call(arguments,1))}catch(e){e instanceof Error?console.error(e.stack):console.log(e)}},S.prototype.setRenderSystem=function(t,e){this.world.setSystem(t),void 0!==e?this.renderSystems.splice(e,0,t):this.renderSystems.push(t)};var M=[],E=0;return S.prototype._updateFrame=function(r){this.start<0&&(this.start=r);var i=(r-this.start)/1e3;if(0>i||i>1)return this.start=r,void(this.animationId=window.requestAnimationFrame(this.run.bind(this)));M[E]=i,E=(E+1)%this.tpfSmoothingCount;for(var o=0,n=0;n<M.length;n++)o+=M[n];if(o/=M.length,this.world.smoothedTpf=o,this.world.tpf=i,this.world.time+=this.world.tpf,t.time=this.world.time,t.tpf=this.world.tpf,this.start=r,this.callbacksNextFrame.length>0){var a=this.callbacksNextFrame;if(this.callbacksNextFrame=[],this.useTryCatch)for(var n=0;n<a.length;n++){var s=a[n];this._callSafe(s,this.world.tpf)}else for(var n=0;n<a.length;n++){var s=a[n];s(this.world.tpf)}}if(this.useTryCatch)for(var n=0;n<this.callbacksPreProcess.length;n++){var s=this.callbacksPreProcess[n];this._callSafe(s,this.world.tpf)}else for(var n=0;n<this.callbacksPreProcess.length;n++){var s=this.callbacksPreProcess[n];s(this.world.tpf)}if(this.doProcess&&this.world.process(),this.renderer.info.reset(),this.doRender){this.renderer.checkResize(e.mainCamera),this.renderer.setRenderTarget();for(var n=0;n<this.callbacksPreRender.length;n++)this.callbacksPreRender[n](this.world.tpf);for(var n=0;n<this.renderSystems.length;n++)this.renderSystems[n].passive||this.renderSystems[n].render(this.renderer);if(this._picking.doPick&&e.mainCamera){var h=this.renderer.clearColor;this._picking.clearColorStore[0]=h.r,this._picking.clearColorStore[1]=h.g,this._picking.clearColorStore[2]=h.b,this._picking.clearColorStore[3]=h.a,this.renderer.setClearColor(0,0,0,1);for(var n=0;n<this.renderSystems.length;n++)this.renderSystems[n].renderToPick&&!this.renderSystems[n].passive&&this.renderSystems[n].renderToPick(this.renderer,this._picking.skipUpdateBuffer);this.renderer.pick(this._picking.x,this._picking.y,this._picking.pickingStore,e.mainCamera),this.useTryCatch?this._callSafe(this._picking.pickingCallback,this._picking.pickingStore.id,this._picking.pickingStore.depth):this._picking.pickingCallback(this._picking.pickingStore.id,this._picking.pickingStore.depth),this._picking.doPick=!1,this.renderer.setClearColor.apply(this.renderer,this._picking.clearColorStore)}}if(this.useTryCatch)for(var n=0;n<this.callbacks.length;n++){var s=this.callbacks[n];this._callSafe(s,this.world.tpf)}else for(var n=0;n<this.callbacks.length;n++){var s=this.callbacks[n];s(this.world.tpf)}if(this.stats&&this.stats.update(this.renderer.info.toString()+"<br>Transform updates: "+this.world.getSystem("TransformSystem").numUpdates+"<br>Cached shaders: "+Object.keys(this.renderer.rendererRecord.shaderCache).length),this._takeSnapshots.length){var u=this.renderer.domElement.toDataURL();if(this.useTryCatch)for(var n=this._takeSnapshots.length-1;n>=0;n--){var s=this._takeSnapshots[n];this._callSafe(s,u)}else for(var n=this._takeSnapshots.length-1;n>=0;n--){var s=this._takeSnapshots[n];s(u)}this._takeSnapshots=[]}this.animationId&&(this.animationId=window.requestAnimationFrame(this.run.bind(this)))},S.prototype._buildLogo=function(t){var e=document.createElement("div"),r=t&&t.color?t.color:w.white,i=w.getLogo({width:"70px",height:"50px",color:r});return""!==i?(e.innerHTML='<a style="text-decoration: none;" href="http://www.goocreate.com" target="_blank">'+i+"</a>",e.style.position="absolute",e.style.zIndex="2000",t?"topright"===t||"topright"===t.position?(e.style.top="10px",e.style.right="10px"):"topleft"===t||"topleft"===t.position?(e.style.top="10px",e.style.left="10px"):"bottomright"===t||"bottomright"===t.position?(e.style.bottom="10px",e.style.right="10px"):(e.style.bottom="10px",e.style.left="10px"):(e.style.top="10px",e.style.right="10px"),e.id="goologo",e.style.webkitTouchCallout="none",e.style.webkitUserSelect="none",e.style.khtmlUserSelect="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.userSelect="none",e.ondragstart=function(){return!1},e):void 0},S.prototype._addDebugKeys=function(){var t="shiftKey",e={50:"normals",222:"normals",51:"lit",52:"color",53:"wireframe",54:"flat",55:"texture",191:"texture",56:"+wireframe"};document.addEventListener("keydown",function(r){if(r[t])switch(r.which){case 32:x.toggleFullScreen();break;case 13:x.togglePointerLock();break;case 49:this.renderSystem.setDebugMaterial();break;default:e[r.which]&&this.renderSystem.setDebugMaterial(e[r.which])}}.bind(this),!1),document.addEventListener("mousedown",function(e){if(e[t]){var r=e.clientX,i=e.clientY;this.pick(r,i,function(t,e){var r=this.world.entityManager.getEntityById(t);console.log("Picked entity:",r,"At depth:",e)}.bind(this))}}.bind(this),!1)},S.prototype.addEventListener=function(t,e){!this._eventListeners[t]||this._eventListeners[t].indexOf(e)>-1||"function"==typeof e&&(this._eventListeners[t].push(e),1===this._eventListeners[t].length&&this._enableEvent(t))},S.prototype.removeEventListener=function(t,e){if(this._eventListeners[t]){var r=this._eventListeners[t].indexOf(e);r>-1&&this._eventListeners[t].splice(r,1),0===this._eventListeners[t].length&&this._disableEvent(t)}},S.prototype.triggerEvent=function(t,e){e.type=t,this._eventTriggered[t]=e.domEvent,this._dispatchEvent(e)},S.prototype._dispatchEvent=function(t){for(var e=Object.keys(this._eventTriggered),r=0;r<e.length;r++){var i=e[r];if(this._eventTriggered[i]&&this._eventListeners[i]){var o={entity:t.entity,depth:t.depth,x:t.x,y:t.y,type:i,domEvent:this._eventTriggered[i],id:t.id,intersection:t.intersection};try{for(var n=0;n<this._eventListeners[i].length&&this._eventListeners[i][n](o)!==!1;n++);}catch(a){console.error(a)}this._eventTriggered[i]=null}}},S.prototype._enableEvent=function(t){if(!this._events[t]){var r=function(r){var i,o;if("touchstart"===r.type||"touchend"===r.type||"touchmove"===r.type)i=r.changedTouches[0].pageX-r.changedTouches[0].target.getBoundingClientRect().left,o=r.changedTouches[0].pageY-r.changedTouches[0].target.getBoundingClientRect().top;else{var n=r.target||r.srcElement,a=n.getBoundingClientRect();i=r.clientX-a.left,o=r.clientY-a.top}this._eventTriggered[t]=r,this.pick(i,o,function(t,r){var n=this.renderer.devicePixelRatio,a=this.world.entityManager.getEntityByIndex(t),s=e.mainCamera.getWorldPosition(i*n,o*n,this.renderer.viewportWidth,this.renderer.viewportHeight,r);this._dispatchEvent({entity:a,depth:r,x:i,y:o,id:t,intersection:s})}.bind(this))}.bind(this);this.renderer.domElement.addEventListener(t,r),this._events[t]=r}},S.prototype._disableEvent=function(t){this._events[t]&&this.renderer.domElement.removeEventListener(t,this._events[t]),this._events[t]=null},S.prototype._startGameLoop=function(){this.animationId||(this.start=-1,this.animationId=window.requestAnimationFrame(this.run.bind(this)))},S.prototype.startGameLoop=function(){this.manuallyPaused=!1,this._startGameLoop()},S.prototype._stopGameLoop=function(){window.cancelAnimationFrame(this.animationId),this.animationId=0},S.prototype.stopGameLoop=function(){this.manuallyPaused=!0,this._stopGameLoop()},S.prototype.takeSnapshot=function(t){this._takeSnapshots.push(t)},S.prototype.pick=function(t,e,r,i){this._picking.x=t,this._picking.y=e,this._picking.skipUpdateBuffer=void 0===i?!1:i,r&&(this._picking.pickingCallback=r),this._picking.doPick=!0},S.prototype.pickSync=function(t,r,i){var o=this.renderer.clearColor;this._picking.skipUpdateBuffer=void 0===i?!1:i;var n=o.clone();this.renderer.setClearColor(0,0,0,1),this.renderSystem.renderToPick(this.renderer,!1),this.renderer.setClearColor(n.r,n.g,n.b,n.a);var a={};return this.renderer.pick(t,r,a,e.mainCamera),a},S.prototype.clear=function(){this.stopGameLoop(),this.world.clear();var t=this.renderer.domElement;t.parentNode&&t.parentNode.removeChild(t),_.clear(),b.store=[],b.hash=[],e.mainCamera=null,x.clearVisibilityChangeListeners(),this.world=null,this.renderer=null,this.renderSystem=null,this.renderSystems=null,this.callbacks=null,this.callbacksPreProcess=null,this.callbacksPreRender=null,this.callbacksNextFrame=null,this._takeSnapshots=null,this._events=null},S}(goo.World,goo.Renderer,goo.TransformSystem,goo.RenderSystem,goo.BoundingUpdateSystem,goo.ScriptSystem,goo.LightingSystem,goo.CameraSystem,goo.ParticlesSystem,goo.Stats,goo.AudioContext,goo.SoundSystem,goo.TransformComponent,goo.MeshDataComponent,goo.MeshRendererComponent,goo.CameraComponent,goo.LightComponent,goo.ScriptComponent,goo.SoundComponent,goo.GameUtils,goo.Logo,goo.SystemBus,goo.Material),goo.ComponentHandler=function(t){"use strict";function e(t,e,r,i){this.world=t,this.getConfig=e,this.updateObject=r,this.loadObject=i}return e.prototype._prepare=function(){},e.prototype._create=function(){throw new Error("ComponentHandler._create is abstract, use ComponentHandler.getHandler(type)")},e.prototype._remove=function(t){t.clearComponent(this._type)},e.prototype._load=function(t,e){return this.loadObject(t,e)},e.prototype.update=function(e,r){if(!e)return t.reject("Entity is missing");if(!r)return this._remove(e),t.resolve();var i=e.getComponent(this._type);return i||(i=this._create(),e.setComponent(i)),this._prepare(r),t.resolve(i)},e.handlerClasses={},e.getHandler=function(t){return e.handlerClasses[t]},e._registerClass=function(t,r){e.handlerClasses[t]=r},e}(goo.PromiseUtils),goo.ArrayUtils=function(){"use strict";function t(){}return t.getTypedArray=function(t,e){var r=e[0],i=e[1],o=e[2];if("float32"===o)return new Float32Array(t,r,i);if("uint8"===o)return new Uint8Array(t,r,i);if("uint16"===o)return new Uint16Array(t,r,i);if("uint32"===o)return new Uint32Array(t,r,i);throw new Error("Binary format "+o+" is not supported")},t.remove=function(t,e,r){var i=-1;if("function"==typeof r){for(var o=0;o<t.length;o++)if(r(t[o],e)){i=o;break}}else i=t.indexOf(e);i>-1&&t.splice(i,1)},t.find=function(t,e){for(var r=0;r<t.length;r++)if(e(t[r]))return t[r];return null},t.fromKeys=function(t){var e=[];return t.forEach(function(t,r){e.push(r)}),e},t.fromValues=function(t){var e=[];return t.forEach(function(t){e.push(t)}),e},t}(),goo.Box=function(t,e){"use strict";function r(e,i,o,n,a,s){if(1===arguments.length&&arguments[0]instanceof Object){var h=arguments[0];e=h.width,i=h.height,o=h.length,n=h.tileX,a=h.tileY,s=h.textureMode}this.xExtent=void 0!==e?.5*e:.5,this.yExtent=void 0!==i?.5*i:.5,this.zExtent=void 0!==o?.5*o:.5,this.tileX=n||1,this.tileY=a||1,this.textureMode=void 0!==s?s:r.TextureModes.Uniform;var u=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]);t.call(this,u,24,36),this.rebuild()}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.rebuild=function(){function e(t){for(var e=0;e<t.length;e++){var r=3*t[e];c.push(u[r]),c.push(u[r+1]),c.push(u[r+2])}}function i(){for(var t=0;t<l.length/3;t++)for(var e=0;4>e;e++){var r=3*t;d.push(l[r]),d.push(l[r+1]),d.push(l[r+2])}}var o=this.xExtent,n=this.yExtent,a=this.zExtent,s=this.tileX,h=this.tileY,u=[-o,-n,-a,o,-n,-a,o,n,-a,-o,n,-a,o,-n,a,-o,-n,a,o,n,a,-o,n,a],c=[];e([0,1,2,3,1,4,6,2,4,5,7,6,5,0,3,7,2,6,7,3,0,5,4,1]),this.getAttributeBuffer(t.POSITION).set(c);var l=[0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,0,-1,0],d=[];i(),this.getAttributeBuffer(t.NORMAL).set(d);var p=[];if(this.textureMode===r.TextureModes.Uniform)for(var f=0;6>f;f++)p.push(s),p.push(0),p.push(0),p.push(0),p.push(0),p.push(h),p.push(s),p.push(h);else p.push(1,1/3,.75,1/3,.75,2/3,1,2/3),p.push(.75,1/3,.5,1/3,.5,2/3,.75,2/3),p.push(.5,1/3,.25,1/3,.25,2/3,.5,2/3),p.push(.25,1/3,0,1/3,0,2/3,.25,2/3),p.push(.5,1,.5,2/3,.25,2/3,.25,1),p.push(.25,0,.25,1/3,.5,1/3,.5,0);return this.getAttributeBuffer(t.TEXCOORD0).set(p),this.getIndexBuffer().set([2,1,0,3,2,0,6,5,4,7,6,4,10,9,8,11,10,8,14,13,12,15,14,12,18,17,16,19,18,16,22,21,20,23,22,20]),this},r.prototype.clone=function(){var t=e.shallowSelectiveClone(this,["tileX","tileY","textureMode"]);return t.width=2*this.xExtent,t.height=2*this.yExtent,t.length=2*this.zExtent,new r(t)},r.TextureModes={Uniform:"Uniform",Unfolded:"Unfolded"},r}(goo.MeshData,goo.ObjectUtils),goo.Sphere=function(t,e,r,i){"use strict";function o(e,r,i,n){if(1===arguments.length&&arguments[0]instanceof Object){var a=arguments[0];e=a.zSamples,r=a.radialSamples,i=a.radius,n=a.textureMode}this.zSamples=(void 0!==e?e:8)+1,this.radialSamples=void 0!==r?r:8,this.radius=void 0!==i?i:.5,"string"==typeof n&&(n=o.TextureModes[n]),this.textureMode=void 0!==n?n:o.TextureModes.Polar,this.viewInside=!1;var s=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]),h=this.textureMode===o.TextureModes.Chromeball?this.zSamples+1:this.zSamples;this._useSharedPoleVertices=this.textureMode!==o.TextureModes.Projected&&this.textureMode!==o.TextureModes.Linear;var u=this._useSharedPoleVertices?2:0,c=(h-u)*(this.radialSamples+1)+u,l=6*(h-2)*this.radialSamples;t.call(this,s,c,l),this.rebuild()}function n(t,e,r){t[3*r+0]=t[3*e+0],t[3*r+1]=t[3*e+1],t[3*r+2]=t[3*e+2]}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.rebuild=function(){for(var i=this.getAttributeBuffer(t.POSITION),a=this.getAttributeBuffer(t.NORMAL),s=this.getAttributeBuffer(t.TEXCOORD0),h=this.getIndexBuffer(),u=1/this.radialSamples,c=2/(this.zSamples-1),l=[],d=[],p=0;p<this.radialSamples;p++){var f=r.TWO_PI*u*p;d[p]=Math.cos(f),l[p]=Math.sin(f)}l[this.radialSamples]=l[0],d[this.radialSamples]=d[0];var m=0,g=this.zSamples;this._useSharedPoleVertices&&(m=1,g=this.zSamples-1);for(var y=0,v=new e,x=new e,w=new e,_=m;g>_;_++){var b=r.HALF_PI*(-1+c*_),S=Math.sin(b),M=this.radius*S,E=x.setDirect(0,0,0);E.z+=M;for(var C,T=Math.sqrt(Math.abs(this.radius*this.radius-M*M)),P=y,p=0;p<this.radialSamples;p++){var D=p*u,R=w.setDirect(d[p],l[p],0);v.copy(R).scale(T),i[3*y+0]=E.x+v.x,i[3*y+1]=E.y+v.y,i[3*y+2]=E.z+v.z,C=v.setDirect(i[3*y+0],i[3*y+1],i[3*y+2]),C.normalize(),this.viewInside?(a[3*y+0]=-C.x,a[3*y+1]=-C.y,a[3*y+2]=-C.z):(a[3*y+0]=C.x,a[3*y+1]=C.y,a[3*y+2]=C.z);var O=0;if(this._useSharedPoleVertices||_!==m&&_!==g-1||(O=.5*u),this.textureMode===o.TextureModes.Linear)s[2*y+0]=D+O,s[2*y+1]=.5*(S+1);else if(this.textureMode===o.TextureModes.Projected)s[2*y+0]=D+O,s[2*y+1]=(r.HALF_PI+Math.asin(S))/Math.PI;else if(this.textureMode===o.TextureModes.Polar){var A=(r.HALF_PI-Math.abs(b))/Math.PI,I=A*d[p]+.5,L=A*l[p]+.5;s[2*y+0]=I,s[2*y+1]=L}else if(this.textureMode===o.TextureModes.Chromeball){var A=Math.sin((r.HALF_PI+b)/2);A/=2;var I=A*d[p]+.5,L=A*l[p]+.5;s[2*y+0]=I,s[2*y+1]=L}y++}if(n(i,P,y),n(a,P,y),this.textureMode===o.TextureModes.Linear)s[2*y+0]=1,s[2*y+1]=.5*(S+1);else if(this.textureMode===o.TextureModes.Projected)s[2*y+0]=1,s[2*y+1]=(r.HALF_PI+Math.asin(S))/Math.PI;else if(this.textureMode===o.TextureModes.Polar){var A=(r.HALF_PI-Math.abs(b))/Math.PI;s[2*y+0]=A+.5,s[2*y+1]=.5}else if(this.textureMode===o.TextureModes.Chromeball){var A=Math.sin((r.HALF_PI+b)/2);A/=2,s[2*y+0]=A+.5,s[2*y+1]=.5}y++}if(this.textureMode===o.TextureModes.Chromeball){for(var N=r.HALF_PI-.001,B=this.radius*Math.sin(N),z=Math.sqrt(Math.abs(this.radius*this.radius-B*B)),P=y,p=0;p<this.radialSamples;p++){i[3*y+0]=z*d[p],i[3*y+1]=z*l[p],i[3*y+2]=B;var C=v.setDirect(i[3*y+0],i[3*y+1],i[3*y+2]);C.normalize(),this.viewInside?(a[3*y+0]=-C.x,a[3*y+1]=-C.y,a[3*y+2]=-C.z):(a[3*y+0]=C.x,a[3*y+1]=C.y,a[3*y+2]=C.z);var A=Math.sin((r.HALF_PI+N)/2);A/=2;var I=A*d[p]+.5,L=A*l[p]+.5;s[2*y+0]=I,s[2*y+1]=L,y++}n(i,P,y),n(a,P,y);var A=Math.sin((r.HALF_PI+N)/2);A/=2,s[2*y+0]=A+.5,s[2*y+1]=.5,y++}this._useSharedPoleVertices&&(i[3*y+0]=0,i[3*y+1]=0,i[3*y+2]=-this.radius,this.viewInside?(a[3*y+0]=0,a[3*y+1]=0,a[3*y+2]=1):(a[3*y+0]=0,a[3*y+1]=0,a[3*y+2]=-1),this.textureMode===o.TextureModes.Polar||this.textureMode===o.TextureModes.Chromeball?(s[2*y+0]=.5,s[2*y+1]=.5):(s[2*y+0]=.5,s[2*y+1]=0),y++,i[3*y+0]=0,i[3*y+1]=0,i[3*y+2]=this.radius,this.viewInside?(a[3*y+0]=0,a[3*y+1]=0,a[3*y+2]=-1):(a[3*y+0]=0,a[3*y+1]=0,a[3*y+2]=1),this.textureMode===o.TextureModes.Polar?(s[2*y+0]=.5,s[2*y+1]=.5):this.textureMode===o.TextureModes.Chromeball?(s[2*y+0]=1,s[2*y+1]=-.5):(s[2*y+0]=.5,s[2*y+1]=1));var k=0,U=this.textureMode===o.TextureModes.Chromeball?this.zSamples+1:this.zSamples,F=0;this._useSharedPoleVertices||(F=this.radialSamples+1);for(var _=0;U-3>_;_++){var V=F,j=V+1;F+=this.radialSamples+1;for(var H=F,G=H+1,y=0;y<this.radialSamples;y++)this.viewInside?(h[k++]=V++,h[k++]=H,h[k++]=j,h[k++]=j++,h[k++]=H++,h[k++]=G++):(h[k++]=V++,h[k++]=j,h[k++]=H,h[k++]=j++,h[k++]=G++,h[k++]=H++)}for(var y=0;y<this.radialSamples;y++){var V,j,H;this._useSharedPoleVertices?(V=y,j=this.vertexCount-2,H=y+1):(V=y,j=y+this.radialSamples+2,H=y+this.radialSamples+1),this.viewInside?(h[k++]=V,h[k++]=H,h[k++]=j):(h[k++]=V,h[k++]=j,h[k++]=H)}for(var X=(g-m-1)*(this.radialSamples+1),y=0;y<this.radialSamples;y++){var V,j,H;this._useSharedPoleVertices?(V=y+X,j=y+1+X,H=this.vertexCount-1):(V=y+X-this.radialSamples-1,j=y+X-this.radialSamples,H=y+X),this.viewInside?(h[k++]=V,h[k++]=H,h[k++]=j):(h[k++]=V,h[k++]=j,h[k++]=H)}return this},o.prototype.clone=function(){var t=i.shallowSelectiveClone(this,["zSamples","radialSamples","radius","textureMode"]);return new o(t)},o.TextureModes={Linear:"Linear",Projected:"Projected",Polar:"Polar",Chromeball:"Chromeball"},o}(goo.MeshData,goo.Vector3,goo.MathUtils,goo.ObjectUtils),goo.Cylinder=function(t,e,r){"use strict";function i(e,r,i,o){if(1===arguments.length&&arguments[0]instanceof Object){var n=arguments[0];e=n.radialSamples,r=n.radiusTop,i=n.radiusBottom,o=n.height}this.radialSamples=e||8,this.radiusTop="undefined"==typeof r?.5:r,this.radiusBottom="undefined"==typeof i?this.radiusTop:i,this.height="undefined"==typeof o?1:o;var a=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]);t.call(this,a,4*this.radialSamples+2+2,3*this.radialSamples*4),this.indexModes=["Triangles"],this.rebuild()}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.rebuild=function(){var r=[],i=[],o=[],n=[],a=this.height,s=a/2,h=this.radiusTop,u=this.radiusBottom,c=this.radialSamples,l=2*Math.PI/c,d=1/c,p=4*c+2+2-1,f=new e,m=0;a&&(m=Math.tan((u-h)/a));for(var g=0,y=0,v=0;c>g;g++,y+=l,v+=d){var x=Math.cos(y),w=Math.sin(y),_=x*h,b=w*h,S=x*u,M=w*u;r.push(_,b,s,S,M,-s,_,b,s,S,M,-s),f.setDirect(x,w,m),f.normalize(),i.push(0,0,1,0,0,-1,f.x,f.y,f.z,f.x,f.y,f.z),o.push(x/4+.25,w/4+.75,x/4+.25,w/4+.25,.5,v,1,v)}r.push(h,0,s,u,0,-s),i.push(1,0,0,1,0,0),o.push(.5,1,1,1);for(var g=0;c-1>g;g++)n.push(p,4*g+0,4*g+4,4*g+1,p-1,4*g+5,4*g+4+2,4*g+2,4*g+4+3,4*g+2,4*g+3,4*g+4+3);return n.push(p,4*g+0,0,4*g+1,p-1,1,4*g+4,4*g+2,4*g+5,4*g+2,4*g+3,4*g+5),r.push(0,0,-s,0,0,s),i.push(0,0,-.5,0,0,.5),o.push(.25,.25,.25,.75),this.getAttributeBuffer(t.POSITION).set(r),this.getAttributeBuffer(t.NORMAL).set(i),this.getAttributeBuffer(t.TEXCOORD0).set(o),this.getIndexBuffer().set(n),this},i.prototype.clone=function(){var t=r.shallowSelectiveClone(this,["radialSamples","radiusTop","radiusBottom","height"]);return new i(t)},i}(goo.MeshData,goo.Vector3,goo.ObjectUtils),goo.Torus=function(t,e,r,i){"use strict";function o(e,r,i,o){if(1===arguments.length&&arguments[0]instanceof Object){var n=arguments[0];e=n.circleSamples,r=n.radialSamples,i=n.tubeRadius,o=n.centerRadius}this.circleSamples=void 0!==e?e:8,this.radialSamples=void 0!==r?r:8,this.tubeRadius=void 0!==i?i:1,this.centerRadius=void 0!==o?o:2,this.viewInside=!1;var a=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]),s=(this.circleSamples+1)*(this.radialSamples+1),h=6*this.circleSamples*this.radialSamples;t.call(this,a,s,h),this.rebuild()}function n(t,e,r){t[3*r+0]=t[3*e+0],t[3*r+1]=t[3*e+1],t[3*r+2]=t[3*e+2]}function a(t,e,r){t[2*r+0]=t[2*e+0],t[2*r+1]=t[2*e+1]}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.rebuild=function(){for(var i=this.getAttributeBuffer(t.POSITION),o=this.getAttributeBuffer(t.NORMAL),s=this.getAttributeBuffer(t.TEXCOORD0),h=this.getIndexBuffer(),u=1/this.circleSamples,c=1/this.radialSamples,l=0,d=new e,p=new e,f=new e,m=0;m<this.circleSamples;m++){var g=m*u,y=r.TWO_PI*g,v=Math.cos(y),x=Math.sin(y);d.setDirect(v,x,0),p.copy(d).scale(this.centerRadius);for(var w=l,_=0;_<this.radialSamples;_++){var b=_*c,S=r.TWO_PI*b,M=Math.cos(S),E=Math.sin(S);f.copy(d).scale(M),f.z+=E,f.normalize(),this.viewInside?(o[3*l+0]=-f.x,o[3*l+1]=-f.y,o[3*l+2]=-f.z):(o[3*l+0]=f.x,o[3*l+1]=f.y,o[3*l+2]=f.z),f.scale(this.tubeRadius).add(p),i[3*l+0]=f.x,i[3*l+1]=f.y,i[3*l+2]=f.z,s[2*l+0]=b,s[2*l+1]=g,l++}n(i,w,l),n(o,w,l),s[2*l+0]=1,s[2*l+1]=g,l++}for(var C=0;C<=this.radialSamples;C++,l++)n(i,C,l),n(o,C,l),a(s,C,l),s[2*l+1]=1;for(var T=0,P=0,m=0;m<this.circleSamples;m++){var D=P,R=D+1;P+=this.radialSamples+1;var O=P,A=O+1;for(l=0;l<this.radialSamples;l++)this.viewInside?(h[T++]=D++,h[T++]=R,h[T++]=O,h[T++]=R++,h[T++]=A++,h[T++]=O++):(h[T++]=D++,h[T++]=O,h[T++]=R,h[T++]=R++,h[T++]=O++,h[T++]=A++)}return this},o.prototype.clone=function(){var t=i.shallowSelectiveClone(this,["circleSamples","radialSamples","tubeRadius","centerRadius"]);return new o(t)},o}(goo.MeshData,goo.Vector3,goo.MathUtils,goo.ObjectUtils),goo.Disk=function(t,e){"use strict";function r(e,r,i){if(1===arguments.length&&arguments[0]instanceof Object){var o=arguments[0];e=o.nSegments,r=o.radius,i=o.pointiness}this.nSegments=e||8,this.radius=r||1,this.pointiness=i||0;var n=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]);t.call(this,n,this.nSegments+1,3*this.nSegments),this.indexModes=["Triangles"],this.rebuild()}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.rebuild=function(){for(var e=[],r=[],i=[],o=[],n=Math.atan2(this.radius,this.pointiness),a=2*Math.PI/this.nSegments,s=0,h=0;s<this.nSegments;s++,h+=a)e.push(Math.cos(h)*this.radius,Math.sin(h)*this.radius,0),r.push(Math.cos(h)*Math.cos(n),Math.sin(h)*Math.cos(n),Math.sin(n)),i.push(.5*Math.cos(h)+.5,.5*Math.sin(h)+.5),o.push(this.nSegments,s,(s+1)%this.nSegments);return e.push(0,0,this.pointiness),r.push(0,0,1),i.push(.5,.5),this.getAttributeBuffer(t.POSITION).set(e),this.getAttributeBuffer(t.NORMAL).set(r),this.getAttributeBuffer(t.TEXCOORD0).set(i),this.getIndexBuffer().set(o),this},r.prototype.clone=function(){var t=e.shallowSelectiveClone(this,["nSegments","radius","pointiness"]);return new r(t)},r}(goo.MeshData,goo.ObjectUtils),goo.Cone=function(t,e){"use strict";function r(e,r,i){if(1===arguments.length&&arguments[0]instanceof Object){var o=arguments[0];e=o.radialSamples,r=o.radius,i=o.height}this.radialSamples=e||8,this.radius=r||1,this.height="undefined"==typeof i?2:i;var n=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]);t.call(this,n,3*this.radialSamples+this.radialSamples+1,3*this.radialSamples*2),this.indexModes=["Triangles"],this.rebuild()}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.rebuild=function(){for(var e=[],r=[],i=[],o=[],n=Math.atan2(this.radius,this.height),a=2*Math.PI/this.radialSamples,s=1/this.radialSamples,h=0,u=0,c=0;h<this.radialSamples;h++,u+=a,c+=s)e.push(0,0,this.height,Math.cos(u)*this.radius,Math.sin(u)*this.radius,0,Math.cos(u+a)*this.radius,Math.sin(u+a)*this.radius,0),r.push(0,0,1,Math.cos(u)*Math.cos(n),Math.sin(u)*Math.cos(n),Math.sin(n),Math.cos(u+a)*Math.cos(n),Math.sin(u+a)*Math.cos(n),Math.sin(n)),i.push(c+s/2,1,c,.5,c+s,.5),o.push(3*h+0,3*h+1,3*h+2);var l=3*h+0;e.push(0,0,0),r.push(0,0,-1),i.push(.25,.25);for(var h=1,u=0;h<=this.radialSamples-1;h++,u+=a)e.push(Math.cos(u)*this.radius,Math.sin(u)*this.radius,0),r.push(0,0,-1),i.push(.25*Math.cos(u)+.25,.25*Math.sin(u)+.25),o.push(l+h,l,l+h+1);return e.push(Math.cos(u)*this.radius,Math.sin(u)*this.radius,0),r.push(0,0,-1),i.push(.25*Math.cos(u)+.25,.25*Math.sin(u)+.25),o.push(l+this.radialSamples,l,l+1),this.getAttributeBuffer(t.POSITION).set(e),this.getAttributeBuffer(t.NORMAL).set(r),this.getAttributeBuffer(t.TEXCOORD0).set(i),this.getIndexBuffer().set(o),this},r.prototype.clone=function(){var t=e.shallowSelectiveClone(this,["radialSamples","radius","height"]);return new r(t)},r}(goo.MeshData,goo.ObjectUtils),goo.ShapeCreatorMemoized=function(t,e,r,i,o,n,a,s){"use strict";function h(){}function u(t,e){var r=Object.keys(e),i=r.map(function(t){return t+""+e[t]}).join("");return t+i}function c(t,e,r){var i=u(t,e);if(l[i])return l[i];var o=r();return l[i]=o,o}var l={};return h.createQuad=function(t,r){var i=1,o=1,n=1,a=1;return r&&i===r.xExtent&&o===r.yExtent&&n===r.tileX&&a===r.tileY?r:c("quad",{},function(){return new e(i,o,n,a)})},h.createBox=function(e,r){e=e||{},s.defaults(e,{textureMode:"Uniform"});var i=1,o=1,n=1,a=1,h=1;return r&&i===r.xExtent&&o===r.yExtent&&n===r.zExtent&&a===r.tileX&&h===r.tileY&&e.textureMode===r.textureMode.name?r:c("box",e,function(){return new t(i,o,n,a,h,e.textureMode)})},h.createSphere=function(t,e){return t=t||{},s.defaults(t,{zSamples:8,radialSamples:8,textureMode:"Projected",radius:1}),e&&t.zSamples===e.zSamples-1&&t.radialSamples===e.radialSamples&&t.textureMode===e.textureMode.name&&t.radius===e.radius?e:c("sphere",t,function(){return new r(t.zSamples,t.radialSamples,t.radius,t.textureMode)})},h.createCylinder=function(t,e){return t=t||{},s.defaults(t,{radialSamples:8,radius:1}),e&&t.radialSamples===e.radialSamples&&t.radius===e.radius?e:c("cylinder",t,function(){return new i(t.radialSamples,t.radius)})},h.createTorus=function(t,e){return t=t||{},s.defaults(t,{radialSamples:8,circleSamples:12,tubeRadius:.2,centerRadius:1}),e&&t.radialSamples===e._radialSamples&&t.circleSamples===e._circleSamples&&t.tubeRadius===e._tubeRadius&&t.centerRadius===e._centerRadius?e:new o(t.circleSamples,t.radialSamples,t.tubeRadius,t.centerRadius)},h.createDisk=function(t,e){return t=t||{},s.defaults(t,{radialSamples:8,pointiness:0,radius:1}),e&&t.radialSamples===e.nSegments&&t.pointiness===e.pointiness&&t.radius===e.radius?e:t.pointiness===Math.floor(t.pointiness)?c("disk",t,function(){return new n(t.radialSamples,t.radius,t.pointiness)}):new n(t.radialSamples,t.radius,t.pointiness)},h.createCone=function(t,e){return t=t||{},s.defaults(t,{radialSamples:8,height:0,radius:1}),e&&t.radialSamples===e.radialSamples&&t.height===e.height&&t.radius===e.radius?e:t.height===Math.floor(t.height)?c("cone",t,function(){return new a(t.radialSamples,t.radius,t.height)}):new a(t.radialSamples,t.radius,t.height)},h.clearCache=function(t){for(var e=Object.keys(l),r=0;r<e[r];r++){var i=e[r],o=l[i];t&&o.destroy(t),delete l[i]}},h}(goo.Box,goo.Quad,goo.Sphere,goo.Cylinder,goo.Torus,goo.Disk,goo.Cone,goo.ObjectUtil),goo.CameraComponentHandler=function(t,e,r,i,o,n){"use strict";function a(){t.apply(this,arguments),this._type="CameraComponent"}return a.prototype=Object.create(t.prototype),t._registerClass("camera",a),a.prototype.constructor=a,a.prototype._prepare=function(t){n.defaults(t,{near:1,far:1e4,projectionMode:"Perspective",aspect:1,lockedRatio:!1}),"Perspective"===t.projectionMode&&void 0===t.fov&&(t.fov=45),"Parallel"===t.projectionMode&&void 0===t.size&&(t.size=100),"Perspective"!==t.projectionMode&&"Parallel"!==t.projectionMode&&(t.projectionMode="Perspective")},a.prototype._create=function(){var t=new r(45,1,1,1e3),i=new e(t);return i},a.prototype.update=function(e,i,o){return t.prototype.update.call(this,e,i,o).then(function(t){if(t){if(t.camera.setProjectionMode(r[i.projectionMode]),t.camera.lockedRatio=!1,"Perspective"===i.projectionMode)t.camera.setFrustumPerspective(i.fov,null,i.near,i.far);else{var e=i.size;t.camera.setFrustum(i.near,i.far,-e,e,e,-e,null),t.camera.size=e}return t}})},a}(goo.ComponentHandler,goo.CameraComponent,goo.Camera,goo.rsvp,goo.PromiseUtils,goo.ObjectUtils),goo.EntityHandler=function(t,e,r,i,o){"use strict";function n(){t.apply(this,arguments),this._componentHandlers={}}function a(t,e){if(t._tags.clear(),e)for(var r in e)t.setTag(r)}function s(t,e){if(t._attributes.clear(),e)for(var r in e)t.setAttribute(r,e[r])}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,t._registerClass("entity",n),n.prototype._create=function(){return this.world.createEntity()},n.prototype._remove=function(t){var e=this._objects.get(t),i=this;if(e){for(var o=[],n=e._components.slice(0),a=0;a<n.length;a++){var s=this._getComponentType(n[a]),h=this._updateComponent(e,s,null);h instanceof r.Promise&&o.push(h)}return r.all(o).then(function(){e.removeFromWorld(),i._objects["delete"](t)})}},n.prototype._update=function(e,r,i){var n=this;return t.prototype._update.call(this,e,r,i).then(function(t){if(t){t.id=e,t.name=r.name,t["static"]=!!r["static"],a(t,r.tags),s(t,r.attributes);var h=[];for(var u in r.components)if(r.components[u]){var c=n._updateComponent(t,u,r.components[u],i);c?h.push(c):console.error("Error handling component "+u)}for(var l=t._components,d=0;d<l.length;d++){var u=n._getComponentType(l[d]);r.components[u]||n._updateComponent(t,u,null,i)}return o.optimisticAll(h).then(function(){return r.hidden?t.hide():t.show(),t})}})},n.prototype._updateComponent=function(t,e,r,i){var o=this._getHandler(e);if(!o)return null;var n=o.update(t,r,i);return n&&n.then?n:null},n.prototype._getComponentType=function(t){var e=t.type;return e=e.slice(0,e.lastIndexOf("Component")),e=i.uncapitalize(e),"howler"===e&&(e="sound"),e},n.prototype._getHandler=function(t){if(!this._componentHandlers[t]){var r=e.getHandler(t);r&&(this._componentHandlers[t]=new r(this.world,this.getConfig,this.updateObject,this.loadObject))}return this._componentHandlers[t]},n}(goo.ConfigHandler,goo.ComponentHandler,goo.rsvp,goo.StringUtils,goo.PromiseUtils),goo.LightComponentHandler=function(t,e,r,i,o,n,a){"use strict";function s(){t.apply(this,arguments),this._type="LightComponent"}s.prototype=Object.create(t.prototype),s.prototype.constructor=s,t._registerClass("light",s);var h,u=function(){if(void 0===h){var t=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);h=!t}return h};return s.prototype._prepare=function(t){if(a.defaults(t,{direction:[0,0,0],color:[1,1,1],shadowCaster:!1,lightCookie:null}),"DirectionalLight"!==t.type&&(t.range=void 0!==t.range?t.range:1e3),t.shadowCaster&&u()){t.shadowSettings=t.shadowSettings||{},a.defaults(t.shadowSettings,{shadowType:"Basic",near:1,far:1e3,resolution:[512,512],darkness:.5});var e=t.shadowSettings;"Parallel"===e.projection?e.size=void 0!==e.size?e.size:400:e.fov=void 0!==e.fov?e.fov:55}},s.prototype._create=function(){return new e},s.prototype.update=function(e,s,h){var c=this,l={SpotLight:i,DirectionalLight:o,PointLight:r};return t.prototype.update.call(this,e,s,h).then(function(t){if(t){var e=t.light;e&&l[s.type]===e.constructor||(e=new l[s.type],t.light=e);for(var r in s){var i=s[r];if(e.hasOwnProperty(r))if("shadowSettings"===r)for(var r in i){var o=i[r];e.shadowSettings[r]instanceof n?e.shadowSettings[r].setDirect(o[0],o[1],o[2]):e.shadowSettings[r]=a.clone(o)}else e[r]instanceof n?e[r].setDirect(i[0],i[1],i[2]):e[r]=a.clone(i);
}if("PointLight"!==s.type&&u()||(e.shadowCaster=!1),s.lightCookie&&"PointLight"!==s.type){var d=s.lightCookie;return d&&d.textureRef&&d.enabled!==!1?c._load(d.textureRef,h).then(function(r){return e.lightCookie=r,t}):(e.lightCookie=null,t)}return e.lightCookie=null,t}})},s}(goo.ComponentHandler,goo.LightComponent,goo.PointLight,goo.SpotLight,goo.DirectionalLight,goo.Vector3,goo.ObjectUtils),goo.MaterialHandler=function(t,e,r,i,o,n){"use strict";function a(){t.apply(this,arguments)}return a.prototype=Object.create(t.prototype),a.prototype.constructor=a,t._registerClass("material",a),a.ENGINE_SHADER_PREFIX="GOO_ENGINE_SHADERS/",a.prototype._prepare=function(t){n.defaults(t,{blendState:{},cullState:{},depthState:{},renderQueue:-1,dualTransparency:!1,wireframe:!1,flat:!1}),n.defaults(t.blendState,{blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"}),n.defaults(t.cullState,{enabled:!0,cullFace:"Back",frontFace:"CCW"}),n.defaults(t.depthState,{enabled:!0,write:!0})},a.prototype._create=function(){return new e},a.prototype._remove=function(t){var e=this._objects.get(t);e&&(e.empty(),this._objects["delete"](t))},a.prototype._update=function(s,h,u){var c=this;return t.prototype._update.call(this,s,h,u).then(function(t){function s(e,r,i){return c._load(r,i).then(function(r){t.setTexture(e,r)}).then(null,function(t){throw new Error("Error loading texture: "+r+" - "+t)})}if(t){var l=[];n.extend(t.blendState,h.blendState),n.extend(t.cullState,h.cullState),n.extend(t.depthState,h.depthState),t.id=h.id,t.name=h.name,t.wireframe=h.wireframe,t.flat=h.flat,t.dualTransparency=h.dualTransparency,-1===h.renderQueue?"NoBlending"!==h.blendState.blending?t.renderQueue=i.TRANSPARENT:t.renderQueue=null:t.renderQueue=h.renderQueue,t.uniforms={};for(var d in h.uniforms)void 0===h.uniforms[d].enabled?t.uniforms[d]=n.clone(h.uniforms[d]):h.uniforms[d].enabled&&(t.uniforms[d]=n.clone(h.uniforms[d].value));void 0!==t.uniforms.materialSpecular&&void 0!==t.uniforms.materialSpecularPower&&(t.uniforms.materialSpecular[3]=t.uniforms.materialSpecularPower);var p=h.shaderRef;if(p)if(0===p.indexOf(a.ENGINE_SHADER_PREFIX)){var f=p.slice(a.ENGINE_SHADER_PREFIX.length);t.shader=e.createShader(r[f])}else{var m=c._load(p,u).then(function(e){t.shader=e}).then(null,function(t){throw new Error("Error loading shader: "+t)});l.push(m)}else t.shader=e.createShader(r.texturedLit,"DefaultShader");var g;for(var y in h.texturesMapping)g=h.texturesMapping[y],g&&g.textureRef&&g.enabled!==!1?l.push(s(y,g.textureRef,u)):t.removeTexture(y);for(var y in t._textureMaps)h.texturesMapping[y]||t.removeTexture(y);return o.all(l).then(function(){return t})}})},a}(goo.ConfigHandler,goo.Material,goo.ShaderLib,goo.RenderQueue,goo.rsvp,goo.ObjectUtils),goo.MeshDataComponentHandler=function(t,e,r,i,o,n,a){"use strict";function s(){t.apply(this,arguments),this._type="MeshDataComponent"}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,t._registerClass("meshData",s),s.prototype._prepare=function(t){return n.defaults(t,{})},s.prototype._create=function(){return new e},s.prototype._remove=function(t){t.meshDataComponent&&t.meshDataComponent.meshData&&this.world.gooRunner&&t.meshDataComponent.meshData.destroy(this.world.gooRunner.renderer.context),t.clearComponent("MeshDataComponent")},s.prototype.update=function(e,n,s){var h=this;return t.prototype.update.call(this,e,n,s).then(function(t){if(t)if(n.shape){var e=i["create"+a.capitalize(n.shape)];if(e)return t.meshData=e(n.shapeOptions,t.meshData),t.autoCompute=!0,t}else{if(n.meshRef){var u=[];return u.push(h._load(n.meshRef,s).then(function(e){if(t.meshData=e,e.boundingBox){var i=e.boundingBox.min,o=e.boundingBox.max,n=[o[0]-i[0],o[1]-i[1],o[2]-i[2]],a=[.5*(o[0]+i[0]),.5*(o[1]+i[1]),.5*(o[2]+i[2])],s=new r;s.xExtent=n[0]/2,s.yExtent=n[1]/2,s.zExtent=n[2]/2,s.center.setDirect(a[0],a[1],a[2]),t.modelBound=s,t.autoCompute=!1}})),n.poseRef?u.push(h._load(n.poseRef,s).then(function(e){t.currentPose=e})):t.currentPose=null,o.all(u).then(function(){return t})}console.warn("MeshDataComponent config does not contain a primitive spec or a reference to a mesh")}})},s}(goo.ComponentHandler,goo.MeshDataComponent,goo.BoundingBox,goo.ShapeCreatorMemoized,goo.rsvp,goo.ObjectUtils,goo.StringUtils),goo.MeshDataHandler=function(t,e,r,i,o){"use strict";function n(){t.apply(this,arguments)}var a=4;return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,t._registerClass("mesh",n),n.prototype._remove=function(t){var e=this._objects.get(t);e&&this.world.gooRunner&&e.destroy(this.world.gooRunner.renderer.context),this._objects["delete"](t)},n.prototype._update=function(t,e,r){if(!e)return this._remove(t),i.resolve();var o=this._objects.get(t);return o?i.resolve(o):this.loadObject(e.binaryRef,r).then(function(r){if(!r)throw new Error("Binary mesh data was empty");var i=this._createMeshData(e,r);return this._fillMeshData(i,e,r),this._objects.set(t,i),i}.bind(this))},n.prototype._createMeshData=function(t){var i="SkinnedMesh"===t.type,o=t.vertexCount;if(0===o)return null;var n=0;t.indexLengths?n=t.indexLengths.reduce(function(t,e){return t+e}):t.indices&&(n=t.indices.wordLength);var a={float32:"Float",uint8:"UnsignedByte",uint16:"UnsignedShort",uint32:"UnsignedInt"};"Trident"===r.browserType&&(a.uint8="UnsignedShort");var s={};for(var h in t.attributes){var u=t.attributes[h],c=u.value[2];s[h]=e.createAttribute(u.dimensions,a[c])}var l=new e(s,o,n);return l.type=i?e.SKINMESH:e.MESH,l},n.prototype._fillMeshData=function(t,r,i){var n=t.type===e.SKINMESH;for(var s in r.attributes)if("JOINTIDS"!==s){var h=r.attributes[s].value;t.getAttributeBuffer(s).set(o.getTypedArray(i,h))}if(n&&r.attributes.JOINTIDS){for(var u=t.getAttributeBuffer(e.JOINTIDS),c=o.getTypedArray(i,r.attributes.JOINTIDS.value),l=[],d=0,p=0;p<c.length;p++){var f=c[p];void 0===l[f]&&(l[f]=d++),u.set([l[f]],p)}for(var m=[],f=0;f<l.length;f++){var d=l[f];null!==d&&(m[d]=f)}t.paletteMap=m,t.weightsPerVertex=a}if(t.getIndexBuffer().set(o.getTypedArray(i,r.indices)),t.indexModes=r.indexModes.slice(),t.indexLengths=r.indexLengths.slice(),r.boundingVolume){if("BoundingBox"!==r.boundingVolume.type)throw new Error("Bounding volume was not BoundingBox");t.boundingBox={min:r.boundingVolume.min,max:r.boundingVolume.max}}return t},n}(goo.ConfigHandler,goo.MeshData,goo.BufferUtils,goo.PromiseUtils,goo.ArrayUtils),goo.MeshRendererComponentHandler=function(t,e,r,i,o,n,a){"use strict";function s(){t.apply(this,arguments),this._type="MeshRendererComponent"}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,t._registerClass("meshRenderer",s),s.DEFAULT_MATERIAL=new r(i.uber,"Default material"),s.prototype._prepare=function(t){return a.defaults(t,{cullMode:"Dynamic",castShadows:!0,receiveShadows:!0,reflectable:!0})},s.prototype._create=function(){return new e},s.prototype.update=function(e,r,i){var n=this;return t.prototype.update.call(this,e,r,i).then(function(t){if(t){t.cullMode=r.cullMode,t.castShadows=r.castShadows,t.receiveShadows=r.receiveShadows,t.isReflectable=r.reflectable;var e=r.materials;if(!e||!Object.keys(e).length){var h=t.materials.filter(function(t){return"gooSelectionIndicator"===t.name});return t.materials=[s.DEFAULT_MATERIAL].concat(h),t}var u=[];return a.forEach(e,function(t){u.push(n._load(t.materialRef,i))},null,"sortValue"),o.all(u).then(function(e){var r=t.materials.filter(function(t){return"gooSelectionIndicator"===t.name});return t.materials=e.concat(r),t})}})},s}(goo.ComponentHandler,goo.MeshRendererComponent,goo.Material,goo.ShaderLib,goo.rsvp,goo.PromiseUtils,goo.ObjectUtils),goo.SceneHandler=function(t,e,r,i,o){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,t._registerClass("scene",n),n.prototype._remove=function(t){var e=this._objects.get(t);if(e)for(var r=0;r<e.entities.length;r++)e.entities[r].removeFromWorld();this._objects["delete"](t)},n.prototype._create=function(){return{id:null,entities:{},posteffects:[],environment:null,initialCameraRef:null}},n.prototype._update=function(r,i,n){var a=this;return t.prototype._update.call(this,r,i,n).then(function(t){if(t){t.id=r;var s=[];return s.push(a._handleEntities(i,t,n)),i.posteffectsRef&&s.push(a._load(i.posteffectsRef,n)),i.environmentRef&&s.push(a._load(i.environmentRef,n)),n.scene&&n.scene.dontSetCamera||i.initialCameraRef&&i.initialCameraRef!==t.initialCameraRef&&s.push(a._load(i.initialCameraRef,n).then(function(r){r&&r.cameraComponent&&e.emit("goo.setCurrentCamera",{camera:r.cameraComponent.camera,entity:r}),t.initialCameraRef=i.initialCameraRef})),o.all(s).then(function(){return t})}})},n.prototype._handleEntities=function(t,e,r){var n=this,a=[],s=i.clone(t.entities),h=[];for(var u in e.entities)s[u]?delete s[u]:h[u]=u;return i.forEach(t.entities,function(t){a.push(n._load(t.entityRef,r))},null,"sortValue"),o.all(a).then(function(t){for(var r=0;r<t.length;r++){var i=t[r];s[i.id]&&i.addToWorld(),s[i.id]||h[i.id]||i._world.entityManager.containsEntity(i)||i.addToWorld(),e.entities[i.id]=i}for(var o in h)delete e.entities[o]})},n.prototype._handlePosteffects=function(t,e,r){return this._load(t.posteffectsRef,r)},n.prototype._handleEnvironment=function(t,e,r){return this._load(t.environmentRef,r)},n}(goo.ConfigHandler,goo.SystemBus,goo.ArrayUtils,goo.ObjectUtils,goo.rsvp),goo.ShaderHandler=function(t,e,r,i,o,n,a){"use strict";function s(){t.apply(this,arguments)}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,t._registerClass("shader",s),s.prototype._remove=function(t){var e=this._objects.get(t);e&&this.world.gooRunner&&(e.destroy(this.world.gooRunner.renderer.context),this._objects["delete"](t))},s.prototype._update=function(t,r,i){if(!r)return this._remove(t),a.resolve();if(!r.vshaderRef)return a.reject("Shader error, missing vertex shader ref");if(!r.fshaderRef)return a.reject("Shader error, missing fragment shader ref");var s=[this.loadObject(r.vshaderRef,i),this.loadObject(r.fshaderRef,i)];return n.all(s).then(function(i){var n=i[0],s=i[1];if(!n)return a.reject("Vertex shader"+r.vshaderRef+"in shader"+t+"not found");if(!s)return a.reject("Fragment shader"+r.fshaderRef+"in shader"+t+"not found");var h={defines:r.defines||{},attributes:r.attributes||{},uniforms:r.uniforms||{},vshader:n,fshader:s};if(r.processors){h.processors=[];for(var u=0;u<r.processors.length;u++){var c=r.processors[u];o[c]?h.processors.push(o[c].processor):console.error("Unknown processor "+c)}}var l=e.createShader(h,t);return this._objects.set(t,l),l}.bind(this))},s}(goo.ConfigHandler,goo.Material,goo.MeshData,goo.Shader,goo.ShaderBuilder,goo.rsvp,goo.PromiseUtils),goo.TransformComponentHandler=function(t,e,r,i,o){"use strict";function n(){t.apply(this,arguments),this._type="TransformComponent"}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,t._registerClass("transform",n),n.prototype._prepare=function(t){return i.defaults(t,{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})},n.prototype._create=function(){return new e},n.prototype._remove=function(t){var e=t.transformComponent;e.transform.translation.setDirect(0,0,0),e.transform.setRotationXYZ(0,0,0),e.transform.scale.setDirect(1,1,1);for(var r=0;r<e.children.length;r++){var i=e.children[r];e.detachChild(i)}e.setUpdated()},n.prototype.update=function(e,i,n){function a(t,e){return s.loadObject(e,n).then(function(e){if(e&&e.transformComponent){t.attachChild(e.transformComponent);var r=s.world.entityManager.containsEntity(e)||-1!==s.world._addedEntities.indexOf(e),i=s.world.entityManager.containsEntity(t.entity)||s.world._addedEntities.indexOf(t.entity)>-1;!r&&i&&e.addToWorld()}else console.error("Failed to add child to transform component");return t})}var s=this;return t.prototype.update.call(this,e,i,n).then(function(t){if(t){t.transform.translation.setDirect(i.translation[0],i.translation[1],i.translation[2]),t.transform.setRotationXYZ(r.DEG_TO_RAD*i.rotation[0],r.DEG_TO_RAD*i.rotation[1],r.DEG_TO_RAD*i.rotation[2]),t.transform.scale.setDirect(i.scale[0],i.scale[1],i.scale[2]);var e=[];if(i.children){for(var n=Object.keys(i.children),s=0;s<n.length;s++){var h=i.children[n[s]].entityRef;e.push(a(t,h))}for(var s=0;s<t.children.length;s++){var u=t.children[s],c=u.entity.id;i.children[c]||t.detachChild(u)}}else for(var s=0;s<t.children.length;s++){var u=t.children[s];t.detachChild(u)}return o.all(e).then(function(){return t.setUpdated(),t})}})},n}(goo.ComponentHandler,goo.TransformComponent,goo.MathUtils,goo.ObjectUtils,goo.rsvp),goo.ProjectHandler=function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,t._registerClass("project",e),e.prototype._remove=function(t,e){var r=this._objects.get(t);r&&this.updateObject(r.mainScene.id,null,e)},e.prototype._create=function(){return{mainScene:null}},e.prototype._update=function(e,r,i){var o=this;return t.prototype._update.call(this,e,r,i).then(function(t){function e(){return o._load(r.mainSceneRef,i).then(function(e){return t.mainScene=e,t})}if(t)return t.mainScene&&r.mainSceneRef!==t.mainScene.id?o.updateObject(t.mainScene.id,null,i).then(e):e()})},e}(goo.ConfigHandler),goo.SoundComponentHandler=function(t,e,r,i,o,n){"use strict";function a(){t.apply(this,arguments),this._type="SoundComponent"}return a.prototype=Object.create(t.prototype),a.prototype.constructor=a,t._registerClass("sound",a),a.prototype._remove=function(t){var e=t.soundComponent;if(e&&e.sounds)for(var r=e.sounds,i=0;i<r.length;i++)r[i].stop()},a.prototype._prepare=function(t){n.defaults(t,{volume:1,reverb:0})},a.prototype._create=function(){return new e},a.prototype.update=function(e,a,s){if(!r.isSupported())return o.resolve();var h=this;return t.prototype.update.call(this,e,a,s).then(function(t){if(t){t.updateConfig(a);for(var e=0;e<t.sounds.length;e++){var r=t.sounds[e];a.sounds[r.id]||t.removeSound(r)}var o=[];return n.forEach(a.sounds,function(t){o.push(h._load(t.soundRef,s))},null,"sortValue"),i.all(o).then(function(e){for(var r=0;r<e.length;r++)-1===t.sounds.indexOf(e[r])&&t.addSound(e[r]);return t})}})},a}(goo.ComponentHandler,goo.SoundComponent,goo.AudioContext,goo.rsvp,goo.PromiseUtils,goo.ObjectUtils),goo.PromiseUtil=function(t){return t}(goo.PromiseUtils),goo.Sound=function(t,e,r,i){"use strict";function o(){this.id=null,this.name=null,this._loop=!1,this._rate=1,this._offset=0,this._duration=null,this._volume=1,this._buffer=null,this._stream=null,this._streamSource=null,this._currentSource=null,this._outNode=t.getContext().createGain(),this.connectTo(),this._playStart=0,this._pausePos=0,this._endPromise=null,this._paused=!1}return o.prototype.play=function(e){if(e=e||0,this._currentSource)return this._endPromise;if(this._endPromise=new i.Promise,!this._buffer||this._stream)return this._endPromise;var r=this._currentSource=t.getContext().createBufferSource();this._paused=!1,this._currentSource.onended=function(){this._currentSource!==r||this._paused||this.stop()}.bind(this),this._currentSource.playbackRate.value=this._rate,this._currentSource.connect(this._outNode),this._currentSource.buffer=this._buffer,this._currentSource.loop=this._loop,this._loop&&(this._currentSource.loopStart=this._offset,this._currentSource.loopEnd=this._duration+this._offset),this._playStart=t.getContext().currentTime-this._pausePos;var o=this._duration-this._pausePos;return this._loop?this._currentSource.start(e,this._pausePos+this._offset):this._currentSource.start(e,this._pausePos+this._offset,o),this._endPromise},o.prototype.pause=function(){this._currentSource&&(this._paused=!0,this._pausePos=(t.getContext().currentTime-this._playStart)%this._duration,this._pausePos/=this._rate,this._stop())},o.prototype.stop=function(t){this._paused=!1,this._pausePos=0,this._endPromise&&this._endPromise.resolve(),this._currentSource&&this._stop(t)},o.prototype.fadeIn=function(t){this.stop();var e=this._volume;this._outNode.gain.value=0;var r=this.fade(e,t);return this.play(),r},o.prototype.fadeOut=function(t){return this.fade(0,t)},o.prototype.fade=function(e,i){return this._outNode.gain.setValueAtTime(this._outNode.gain.value,t.getContext().currentTime),this._outNode.gain.linearRampToValueAtTime(e,t.getContext().currentTime+i),r.delay(1e3*i)},o.prototype.isPlaying=function(){return!!this._currentSource},o.prototype._stop=function(t){t=t||0,this._currentSource.stop(t),this._currentSource=null},o.prototype.update=function(t){t=t||{},void 0!==t.id&&(this.id=t.id),void 0!==t.name&&(this.name=t.name),void 0!==t.loop&&(this._loop=!!t.loop,this._currentSource&&(this._currentSource.loop=this._loop)),void 0!==t.volume&&(this._volume=e.clamp(t.volume,0,1),this._outNode.gain.value=this._volume),void 0!==t.offset&&(this._offset=t.offset),void 0!==t.duration&&(this._duration=t.duration),void 0!==t.timeScale&&(this._rate=t.timeScale,this._currentSource&&(this._currentSource.playbackRate.value=t.timeScale)),this._buffer&&this._clampInterval()},o.prototype._clampInterval=function(){this._offset=Math.min(this._offset,this._buffer.duration),null!==this._duration?this._duration=Math.min(this._buffer.duration-this._offset,this._duration):this._duration=this._buffer.duration-this._offset,this._pausePos=e.clamp(this._pausePos,0,this._duration)},o.prototype.connectTo=function(t){if(t){t instanceof Array||(t=[t]);for(var e=0;e<t.length;e++)this._outNode.connect(t[e])}},o.prototype.disconnectFrom=function(t){if(t){t instanceof Array||(t=[t]);for(var e=0;e<t.length;e++)this._outNode.disconnect(t[e])}},o.prototype.setAudioBuffer=function(t){this.setAudioStream(null),this._buffer=t,this._clampInterval()},o.prototype.setAudioStream=function(e){return e?(this.stop(),this._stream=e,this._streamSource=t.getContext().createMediaStreamSource(e),void this._streamSource.connect(this._outNode)):void(this._streamSource&&(this._streamSource.disconnect(),this._streamSource=null))},o}(goo.AudioContext,goo.MathUtils,goo.PromiseUtil,goo.rsvp),goo.SoundHandler=function(t,e,r,i,o,n){"use strict";function a(){if(t.apply(this,arguments),this._audioCache={},void 0!==window.Audio){var e=new Audio;this._codecs=[{type:"mp3",enabled:!!e.canPlayType("audio/mpeg;")},{type:"ogg",enabled:!!e.canPlayType('audio/ogg; codecs="vorbis"')},{type:"wav",enabled:!!e.canPlayType('audio/wav; codecs="1"')}]}else this._codecs=[]}return a.prototype=Object.create(t.prototype),a.prototype.constructor=a,t._registerClass("sound",a),a.prototype._remove=function(t){var e=this._objects.get(t);e&&(e.stop(),this._objects["delete"](t))},a.prototype._prepare=function(t){n.defaults(t,{loop:!1,audioRefs:{},volume:1,name:"A Sound"})},a.prototype._create=function(){return new r},a.prototype._update=function(r,i,n){if(!e.isSupported())return o.resolve();var a=this;return t.prototype._update.call(this,r,i,n).then(function(t){if(t){t.update(i);for(var r=0;r<a._codecs.length;r++){var n=a._codecs[r],s=i.audioRefs[n.type];if(s&&n.enabled)return a._audioCache[s]?(t.setAudioBuffer(a._audioCache[s]),t):a.loadObject(s).then(function(t){return o.createPromise(function(r,i){e.getContext().decodeAudioData(t,function(t){r(t)},function(){console.error("Could not decode audio "+s),r(null)})})}).then(function(e){return e&&(a._audioCache[s]=e,t.setAudioBuffer(e)),t})}return console.warn("No supported audioformat was found"),t}})},a}(goo.ConfigHandler,goo.AudioContext,goo.Sound,goo.rsvp,goo.PromiseUtils,goo.ObjectUtils),goo.ParticleLib=function(){"use strict";function t(){}return t.getSmoke=function(t){return t=t||{},t.scale="undefined"!=typeof t.scale?t.scale:1,t.spread="undefined"!=typeof t.spread?t.spread:2,t.rate="undefined"!=typeof t.spread?t.rate:25,t.velocity="undefined"!=typeof t.velocity?t.velocity:function(e){var r=e.velocity;return r.x=2*(Math.random()-.5)*t.spread*t.scale,r.y=2*(Math.random()+4)*t.scale,r.z=2*(Math.random()-.5)*t.spread*t.scale,r},t.color=t.color||[0,0,0],{totalParticlesToSpawn:-1,releaseRatePerSecond:t.rate,minLifetime:.5,maxLifetime:4,getEmissionVelocity:t.velocity,timeline:[{timeOffset:0,spin:0,mass:1,size:3*t.scale,color:[t.color[0],t.color[1],t.color[2],1]},{timeOffset:1,size:6*t.scale,color:[t.color[0],t.color[1],t.color[2],0]}]}},t.getFire=function(t){return t=t||{},t.scale="undefined"!=typeof t.scale?t.scale:1,t.spread="undefined"!=typeof t.spread?t.spread:2,t.velocity="undefined"!=typeof t.velocity?t.velocity:10,t.startColor=t.startColor||[1,1,0],t.endColor=t.endColor||[1,0,0],{totalParticlesToSpawn:-1,releaseRatePerSecond:30,minLifetime:.5,maxLifetime:2,getEmissionVelocity:function(e){var r=e.velocity;return r.x=2*(Math.random()-.5)*t.spread*t.scale,r.y=(Math.random()+1)*t.velocity*t.scale,r.z=2*(Math.random()-.5)*t.spread*t.scale,r},timeline:[{timeOffset:0,spin:0,mass:1,size:2*t.scale,color:[t.startColor[0],t.startColor[1],t.startColor[2],0]},{timeOffset:.05,color:[t.startColor[0],t.startColor[1],t.startColor[2],1]},{timeOffset:.45,color:[t.endColor[0],t.endColor[1],t.endColor[2],.8]},{timeOffset:.5,size:3*t.scale,color:[0,0,0,0]}]}},t.getSnow=function(t){return t=t||{},t.scale="undefined"!=typeof t.scale?t.scale:2,t.spread="undefined"!=typeof t.spread?t.spread:50,t.velocity="undefined"!=typeof t.velocity?t.velocity:3,t.color=t.color||[1,1,1],{particleCount:1e3,totalParticlesToSpawn:-1,releaseRatePerSecond:50,minLifetime:15,maxLifetime:25,getEmissionPoint:function(e){var r=e.position;return t.getEmissionPoint(r),r},getEmissionVelocity:function(e){var r=e.velocity;return t.getEmissionVelocity(r),r},timeline:[{timeOffset:0,spin:0,mass:1,size:1*t.scale,color:[t.color[0],t.color[1],t.color[2],0]},{timeOffset:.05,color:[t.color[0],t.color[1],t.color[2],1]},{timeOffset:.7,color:[t.color[0],t.color[1],t.color[2],.8]},{timeOffset:.25,spin:5,size:.5*t.scale,color:[t.color[0],t.color[1],t.color[2],0]}]}},t}(),goo.ParticleUtils=function(t){"use strict";function e(){}return e.getRandomVelocityOffY=function(t,r,i,o,n){var a=r+Math.random()*(i-r),s=2*Math.PI*Math.random();return t.x=Math.cos(s)*Math.sin(a),t.y=Math.cos(a),t.z=Math.sin(s)*Math.sin(a),n&&e.applyEntityTransformVector(t,n),t.scale(o),t},e.randomPointInCube=function(t,e,r,i,o){return t.x=2*Math.random()*e-e+(o?o.x:0),t.y=2*Math.random()*r-r+(o?o.y:0),t.z=2*Math.random()*i-i+(o?o.z:0),t},e.createConstantForce=function(e){var r=new t(e);return{enabled:!0,prepare:function(){},apply:function(t,e){e.velocity.x+=r.x*t,e.velocity.y+=r.y*t,e.velocity.z+=r.z*t}}},e.applyEntityTransformPoint=function(t,e){return e.transformComponent&&e.transformComponent.worldTransform?e.transformComponent.worldTransform.applyForward(t,t):t},e.applyEntityTransformVector=function(t,e){return e.transformComponent&&e.transformComponent.worldTransform?e.transformComponent.worldTransform.applyForwardVector(t,t):t},e.applyTimeline=function(t,e){for(var r,i=t.age,o=t.lifeSpan,n=0,a=0,s=0,h=0,u=o,c=o,l=o,d=o,p=0,f=null,m=null,g=null,y=null,v=null,x=null,w=null,_=null,b=null,S=0,M=e.length;M>S;S++){var E=e[S];p+=(E.timeOffset?E.timeOffset:0)*o,null===x&&void 0!==E.color&&(p>i?(u=p,x=E):(n=p,f=E)),null===w&&void 0!==E.mass&&(p>i?(c=p,w=E):(a=p,m=E)),i>=p&&void 0!==E.uvIndex&&(v=E),null===_&&void 0!==E.size&&(p>i?(l=p,_=E):(s=p,g=E)),null===b&&void 0!==E.spin&&(p>i?(d=p,b=E):(h=p,y=E))}r=(i-n)/(u-n);var C=null!==f?f.color:[1,1,1,1],T=null!==x?x.color:C;t.color.x=(1-r)*C[0]+r*T[0],t.color.y=(1-r)*C[1]+r*T[1],t.color.z=(1-r)*C[2]+r*T[2],t.color.w=(1-r)*C[3]+r*T[3],r=(i-a)/(c-a);var C=null!==m?m.mass:1,T=null!==w?w.mass:C;t.mass=(1-r)*C+r*T,t.uvIndex=null!==v?v.uvIndex:0,r=(i-s)/(l-s);var C=null!==g?g.size:1,T=null!==_?_.size:C;t.size=(1-r)*C+r*T,r=(i-h)/(d-h);var C=null!==y?y.spin:0,T=null!==b?b.spin:C;t.spin=(1-r)*C+r*T},e}(goo.Vector3),goo.Particle=function(t,e,r,i,o){"use strict";function n(t,e){this.alive=!1,this.position=new r,this.velocity=new r,this.lifeSpan=0,this.parent=t,this.age=0,this.index=e,this.color=new i(1,0,0,1),this.size=0,this.spin=0,this.mass=1,this.emitter=null,this.uvIndex=0,this.lastUVIndex=-1,this.bbX=new r,this.bbY=new r,this.lastColor=new i}var a=new r;n.prototype.respawnParticle=function(t){this.emitter=t,this.lifeSpan=t.nextParticleLifeSpan(),this.alive=!0,this.age=0};var s=[];return n.prototype.update=function(e,r){if(this.alive){if(this.age+=e,this.age>this.lifeSpan)return void this.kill();if(this.position.addDirect(this.velocity.x*e,this.velocity.y*e,this.velocity.z*e),t.applyTimeline(this,this.emitter&&this.emitter.timeline?this.emitter.timeline:this.parent.timeline),!this.lastColor.equals(this.color)){var i=this.parent.meshData.getAttributeBuffer(o.COLOR),n=16*this.index;i[n+0+0]=this.color.r,i[n+0+1]=this.color.g,i[n+0+2]=this.color.b,i[n+0+3]=this.color.a,i[n+4+0]=this.color.r,i[n+4+1]=this.color.g,i[n+4+2]=this.color.b,i[n+4+3]=this.color.a,i[n+8+0]=this.color.r,i[n+8+1]=this.color.g,i[n+8+2]=this.color.b,i[n+8+3]=this.color.a,i[n+12+0]=this.color.r,i[n+12+1]=this.color.g,i[n+12+2]=this.color.b,i[n+12+3]=this.color.a,this.lastColor.set(this.color)}if(this.emitter&&this.emitter.getParticleBillboardVectors(this,r),0===this.spin)this.bbX.scale(this.size),this.bbY.scale(this.size);else{var h=Math.cos(this.spin)*this.size,u=Math.sin(this.spin)*this.size,c=this.bbY.x,l=this.bbY.y,d=this.bbY.z;this.bbY.set(this.bbX),this.bbX.scale(h).addDirect(c*u,l*u,d*u),this.bbY.scale(-u).addDirect(c*h,l*h,d*h)}var p=this.parent.meshData.getAttributeBuffer(o.POSITION),n=12*this.index;if(a.set(this.position).sub(this.bbX).sub(this.bbY),p[n+0+0]=a.x,p[n+0+1]=a.y,p[n+0+2]=a.z,a.set(this.position).sub(this.bbX).add(this.bbY),p[n+3+0]=a.x,p[n+3+1]=a.y,p[n+3+2]=a.z,a.set(this.position).add(this.bbX).add(this.bbY),p[n+6+0]=a.x,p[n+6+1]=a.y,p[n+6+2]=a.z,a.set(this.position).add(this.bbX).sub(this.bbY),p[n+9+0]=a.x,p[n+9+1]=a.y,p[n+9+2]=a.z,this.lastUVIndex!==this.uvIndex){var f=this.parent.meshData.getAttributeBuffer(o.TEXCOORD0),m=this.uvIndex%this.parent.uRange/this.parent.uRange,g=1-Math.floor(this.uvIndex/this.parent.vRange)/this.parent.vRange,y=1/this.parent.uRange,v=1/this.parent.vRange;s[0]=m+y,s[1]=g-v,f.set(s,8*this.index+0),s[0]=m+y,s[1]=g,f.set(s,8*this.index+2),s[0]=m,s[1]=g,f.set(s,8*this.index+4),s[0]=m,s[1]=g-v,f.set(s,8*this.index+6),this.lastUVIndex=this.uvIndex}}},n.prototype.kill=function(){this.alive=!1;var t=this.parent.meshData.getAttributeBuffer(o.POSITION),e=t.subarray(12*this.index,12*this.index+3);t.set(e,12*this.index+3),t.set(e,12*this.index+6),t.set(e,12*this.index+9)},n}(goo.ParticleUtils,goo.Vector,goo.Vector3,goo.Vector4,goo.MeshData),goo.ParticleEmitter=function(t,e,r){"use strict";function i(e){r.copyOptions(this,e,{totalParticlesToSpawn:-1,maxLifetime:3,minLifetime:2,timeline:void 0,influences:[],getEmissionPoint:function(e,r){var i=e.position;return i.setDirect(0,0,0),t.applyEntityTransformPoint(i,r)},getEmissionVelocity:function(e,r){var i=e.velocity;return i.setDirect(0,1,0),t.applyEntityTransformVector(i,r)},getParticleBillboardVectors:i.CAMERA_BILLBOARD_FUNC,releaseRatePerSecond:10,enabled:!0}),this.particlesWaitingToRelease=0}return i.CAMERA_BILLBOARD_FUNC=function(t){var r=e.mainCamera;r&&(t.bbX.set(r._left),t.bbY.set(r._up))},i.prototype.nextParticleLifeSpan=function(){return this.minLifetime+(this.maxLifetime-this.minLifetime)*Math.random()},i}(goo.ParticleUtils,goo.Renderer,goo.ObjectUtil),goo.ParticleComponent=function(t,e,r,i){"use strict";function o(e){if(t.apply(this,arguments),this.type="ParticleComponent",t.call(this),e=e||{},this.emitters=[],e.emitters)for(var i=0,o=e.emitters.length;o>i;i++)this.emitters.push(new r(e.emitters[i]));this.timeline=e.timeline?e.timeline:[],this.uRange=isNaN(e.uRange)?1:e.uRange,this.vRange=isNaN(e.vRange)?1:e.vRange;var n=isNaN(e.particleCount)?100:e.particleCount;this.recreateParticles(n),this.enabled=!0}return o.type="ParticleComponent",o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.generateMeshData=function(){var t=i.defaultMap([i.POSITION,i.COLOR,i.TEXCOORD0]);this.meshData=new i(t,4*this.particleCount,6*this.particleCount),this.meshData.vertexData.setDataUsage("DynamicDraw");for(var e=this.meshData.getAttributeBuffer(i.TEXCOORD0),r=this.meshData.getIndexBuffer(),o=0,n=this.particleCount;n>o;o++)e.set([1,0],8*o+0),e.set([1,1],8*o+2),e.set([0,1],8*o+4),e.set([0,0],8*o+6),r.set([4*o+0,4*o+3,4*o+1,4*o+1,4*o+3,4*o+2],6*o)},o.prototype.recreateParticles=function(t){this.particleCount=t,this.particles=[];for(var r=0;r<this.particleCount;r++)this.particles[r]=new e(this,r);this.generateMeshData()},o}(goo.Component,goo.Particle,goo.ParticleEmitter,goo.MeshData),goo.ParticleSystemUtils=function(t,e,r,i,o){"use strict";function n(){}return n.createParticleSystemEntity=function(i,n,a){var s=i.createEntity(),h=new t({particleCount:n.particleCount||500});h.emitters.push(new o(n)),s.setComponent(h);var u=new r(h.meshData);s.setComponent(u);var c=new e;return c.materials.push(a),c.cullMode="Never",s.setComponent(c),s},n.createFlareTexture=function(t,e){t=t||64,e=e||{},e.startRadius="undefined"!=typeof e.startRadius?e.startRadius:0,e.endRadius="undefined"!=typeof e.endRadius?e.endRadius:t/2,e.steps=e.steps||[{fraction:0,value:1},{fraction:1,value:0}];var r=document.createElement("canvas");r.width=t,r.height=t;for(var o=r.getContext("2d"),n=o.createRadialGradient(t/2,t/2,e.startRadius,t/2,t/2,e.endRadius),a=0;a<e.steps.length;a++){var s=e.steps[a];n.addColorStop(s.fraction,"rgba(255, 255, 255, "+s.value+")")}o.fillStyle=n,o.fillRect(0,0,t,t);var h=o.getImageData(0,0,t,t).data;h=new Uint8Array(h);var u=new i(h,null,t,t);return u},n.createSplashTexture=function(t,e){function r(t,e,r){var i=s.createRadialGradient(t,e,0,t,e,r);i.addColorStop(0,"rgba(255, 255, 255, 0.5)"),i.addColorStop(1,"rgba(255, 255, 255, 0)"),s.fillStyle=i,s.fillRect(t-r,e-r,2*r,2*r)}function o(t,e,i,o,n,a){for(var s=(i-t)/h,u=(o-e)/h,c=(a-n)/h,l=0,d=t,p=e,f=n;h>l;l++,d+=s,p+=u,f+=c)r(d,p,f)}function n(t,e,r,i,n,a,s){for(var h=0;s>h;h++){var u=Math.random()*Math.PI*2,c=4*Math.random()+r,l=4*Math.random()-i;o(t+Math.cos(u)*c,e+Math.sin(u)*c,t+Math.cos(u)*l,e+Math.sin(u)*l,n,a)}}t=t||64,e=e||{},e.nTrails="undefined"!=typeof e.nTrails?e.nTrails:8,e.trailStartRadius="undefined"!=typeof e.trailStartRadius?e.trailStartRadius:1,e.trailEndRadius="undefined"!=typeof e.trailEndRadius?e.trailEndRadius:4;var a=document.createElement("canvas");a.width=t,a.height=t;var s=a.getContext("2d"),h=30;n(t/2,t/2,t/2/10*1,t/2/10*9,e.trailStartRadius,e.trailEndRadius,e.nTrails);var u=s.getImageData(0,0,t,t).data;u=new Uint8Array(u);var c=new i(u,null,t,t);return c},n.createPlanktonTexture=function(t,e){function r(t,e,r){var i=a.createRadialGradient(t,e,0,t,e,r);i.addColorStop(0,"rgba(255, 255, 255, 1)"),i.addColorStop(.3,"rgba(255, 255, 255, 1)"),i.addColorStop(1,"rgba(255, 255, 255, 0)"),a.fillStyle=i,a.fillRect(t-r,e-r,2*r,2*r)}function o(i){for(var o=0;i>o;o++){var n=Math.random()*(t-2*e.maxRadius)+e.maxRadius,a=Math.random()*(t-2*e.maxRadius)+e.maxRadius;r(n,a,Math.random()*(e.maxRadius-e.minRadius)+e.minRadius)}}t=t||64,e=e||{},e.nPoints="undefined"!=typeof e.nPoints?e.nPoints:10,e.minRadius="undefined"!=typeof e.minRadius?e.minRadius:2,e.maxRadius="undefined"!=typeof e.maxRadius?e.maxRadius:5;var n=document.createElement("canvas");n.width=t,n.height=t;var a=n.getContext("2d");o(e.nPoints);var s=a.getImageData(0,0,t,t).data;s=new Uint8Array(s);var h=new i(s,null,t,t);return h},n.createSnowflakeTexture=function(t,e){function r(t,e){for(var r=2*Math.PI/t,i=0;t>i;i++)a.rotate(r),e()}function o(){a.beginPath(),a.moveTo(0,0),a.lineTo(0,90);for(var t=0;6>t;t++)a.moveTo(0,25+10*t),a.lineTo(16-1.5*t,35+10*t),a.moveTo(0,25+10*t),a.lineTo(-(16-1.5*t),35+10*t);a.stroke()}t=t||64,e=e||{};var n=document.createElement("canvas");n.width=t,n.height=t;var a=n.getContext("2d");a.strokeStyle="#FFF",a.lineWidth=4,a.lineCap="round",a.translate(t/2,t/2),a.scale(t/100/2,t/100/2),r(7,o);var s=a.getImageData(0,0,t,t).data;s=new Uint8Array(s);var h=new i(s,null,t,t);return h},n}(goo.ParticleComponent,goo.MeshRendererComponent,goo.MeshDataComponent,goo.Texture,goo.ParticleEmitter),
goo.Snow=function(t,e,r,i,o,n,a,s){"use strict";function h(t){this.velocity=10,this.height=25,this.material=new e(r.particles);var i=n.createFlareTexture(64);i.generateMipmaps=!0,this.material.setTexture("DIFFUSE_MAP",i),this.material.blendState.blending="AdditiveBlending",this.material.cullState.enabled=!1,this.material.depthState.write=!1,this.material.renderQueue=2002;var h=this;this.particleCloudEntity=n.createParticleSystemEntity(t.world,o.getSnow({getEmissionPoint:function(t){t.copy(a.mainCamera?a.mainCamera.translation:new s),t.x+=1e3*Math.random()-500,t.y+=h.height,t.z+=1e3*Math.random()-500},getEmissionVelocity:function(t){t.x=2*(Math.random()-.5),t.y=-(Math.random()+1)*h.velocity,t.z=2*(Math.random()-.5)}}),this.material),this.particleCloudEntity.name="_ParticleSystemSnow",this.onCameraChange=function(t){t.entity.attachChild(this.particleCloudEntity)}.bind(this),this.particleCloudEntity.transformComponent.transform.translation.copy(a.mainCamera?a.mainCamera.translation:new s),this.particleCloudEntity.addToWorld()}return h.prototype.setEmissionVelocity=function(t){if(t){this.velocity=t;for(var e=this.particleCloudEntity.particleComponent,r=e.particles,i=0;i<r.length;i++)r[i].velocity.y=-(Math.random()+1)*this.velocity}},h.prototype.setEmissionHeight=function(t){t&&(this.height=t)},h.prototype.setReleaseRatePerSecond=function(t){if(t){var e=this.particleCloudEntity.particleComponent,r=e.emitters[0];r.releaseRatePerSecond=t}},h.prototype.remove=function(){this.particleCloudEntity.removeFromWorld()},h}(goo.SystemBus,goo.Material,goo.ShaderLib,goo.TextureCreator,goo.ParticleLib,goo.ParticleSystemUtils,goo.Renderer,goo.Vector3),goo.EnvironmentHandler=function(t,e,r,i,o,n){"use strict";function a(){t.apply(this,arguments)}var s={backgroundColor:[.3,.3,.3,1],globalAmbient:[0,0,0],fog:{enabled:!1,color:[1,1,1],near:10,far:1e3}},h={volume:1,reverb:0,dopplerFactor:1,rolloffFactor:.4,maxDistance:100};return a.prototype=Object.create(t.prototype),a.prototype.constructor=a,t._registerClass("environment",a),a.prototype._prepare=function(t){e.defaults(t,s)},a.prototype._create=function(){return{weatherState:{}}},a.prototype._remove=function(t){var e=this._objects.get(t);if(this._objects["delete"](t),e){for(var o in e.weatherState)a.weatherHandlers[o].remove(e.weatherState);r.emit("goo.setClearColor",s.backgroundColor),i.CLEAR_COLOR=s.backgroundColor,i.GLOBAL_AMBIENT=s.globalAmbient.slice(0,3),i.USE_FOG=s.fog.enabled,i.FOG_COLOR=s.fog.color.slice(0,3),i.FOG_SETTINGS=[s.fog.near,s.fog.far];var n=this.world.getSystem("SoundSystem");n&&(n.updateConfig(h),n.setReverb(null))}},a.prototype._update=function(o,s,h){var u=this;return t.prototype._update.call(this,o,s,h).then(function(t){if(t){var o=s.backgroundColor,c=o[3];t.backgroundColor=[o[0]*c,o[1]*c,o[2]*c,o[3]],t.globalAmbient=s.globalAmbient.slice(0,3),t.fog=e.deepClone(s.fog),r.emit("goo.setClearColor",t.backgroundColor),i.CLEAR_COLOR=t.backgroundColor,i.GLOBAL_AMBIENT=t.globalAmbient,i.USE_FOG=t.fog.enabled,i.FOG_COLOR=t.fog.color.slice(0,3),i.FOG_SETTINGS=[t.fog.near,s.fog.far];for(var l in s.weather){var d=a.weatherHandlers[l];d&&d.update.call(u,s.weather[l],t.weatherState)}var p=[];if(s.skyboxRef)a.currentSkyboxRef=s.skyboxRef,p.push(u._load(s.skyboxRef,{reload:!0}));else if(a.currentSkyboxRef){var f=u.updateObject(a.currentSkyboxRef,null).then(function(){delete a.currentSkyboxRef});p.push(f)}var m=u.world.getSystem("SoundSystem");if(s.sound&&m)if(m.updateConfig(s.sound),s.sound.reverbRef){var f=u._load(s.sound.reverbRef,h).then(function(t){m.setReverb(t._buffer)});p.push(f)}else m.setReverb(null);return n.all(p).then(function(){return t})}})},a.weatherHandlers={snow:{update:function(t,e){t.enabled?(e.snow&&e.snow.enabled||(e.snow=e.snow||{},e.snow.enabled=!0,e.snow.snow=new o(this.world.gooRunner)),e.snow.snow.setEmissionVelocity(t.velocity),e.snow.snow.setReleaseRatePerSecond(t.rate),e.snow.snow.setEmissionHeight(t.height)):e.snow&&e.snow.enabled&&(e.snow.snow.remove(),e.snow.enabled=!1,delete e.snow.snow)},remove:function(t){t.snow&&t.snow.snow&&(t.snow.snow.remove(),t.snow.enabled=!1,delete t.snow.snow)}}},a}(goo.ConfigHandler,goo.ObjectUtils,goo.SystemBus,goo.ShaderBuilder,goo.Snow,goo.rsvp),goo.Skybox=function(t,e,r,i,o,n,a){"use strict";function s(r,u,c,l){var d;if(r===s.SPHERE)this.meshData=new e(48,48,1,c||e.TextureModes.Projected),u instanceof Array&&(u=u[0]),u&&(d=(new n).loadTexture2D(u));else{if(r!==s.BOX)throw new Error("Unknown geometry type");this.meshData=new t(1,1,1),u.length&&(d=(new n).loadTextureCube(u,{flipY:!1,wrapS:"EdgeClamp",wrapT:"EdgeClamp"}))}var p=new i(h[r],"Skybox material");d&&d.then(function(t){p.setTexture(o.DIFFUSE_MAP,t)}),p.cullState.cullFace="Front",p.depthState.enabled=!1,p.renderQueue=1,this.materials=[p],this.transform=new a;var f=r===s.SPHERE?Math.PI/2:0;this.transform.rotation.fromAngles(f,l,0),this.transform.update(),this.active=!0}s.SPHERE="sphere",s.BOX="box";var h={};return h.box={attributes:{vertexPosition:r.POSITION},uniforms:{viewMatrix:o.VIEW_MATRIX,projectionMatrix:o.PROJECTION_MATRIX,worldMatrix:o.WORLD_MATRIX,cameraPosition:o.CAMERA,near:o.NEAR_PLANE,diffuseMap:o.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform float near;","varying vec3 eyeVec;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition * near * 10.0, 1.0);"," worldPos += vec4(cameraPosition, 0.0);","	gl_Position = projectionMatrix * viewMatrix * worldPos;","	eyeVec = worldPos.xyz - cameraPosition;"," eyeVec.x = -eyeVec.x;"," eyeVec = (worldMatrix * vec4(eyeVec, 0.0)).xyz;","}"].join("\n"),fshader:["precision mediump float;","uniform samplerCube diffuseMap;","varying vec3 eyeVec;","void main(void)","{","	vec4 cube = textureCube(diffuseMap, eyeVec);"," if (cube.a < 0.05) discard;","	gl_FragColor = cube;","}"].join("\n")},h.sphere={attributes:{vertexPosition:r.POSITION,vertexUV0:r.TEXCOORD0},uniforms:{viewMatrix:o.VIEW_MATRIX,projectionMatrix:o.PROJECTION_MATRIX,worldMatrix:o.WORLD_MATRIX,cameraPosition:o.CAMERA,near:o.NEAR_PLANE,diffuseMap:o.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform float near;","varying vec2 texCoord0;","varying vec3 eyeVec;","void main(void) {","	texCoord0 = vertexUV0;","	vec4 worldPos = worldMatrix * vec4(vertexPosition * near * 10.0, 1.0);"," worldPos += vec4(cameraPosition, 0.0);","	gl_Position = projectionMatrix * viewMatrix * worldPos;","	eyeVec = cameraPosition - worldPos.xyz;","}"].join("\n"),fshader:["precision mediump float;","uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{"," vec4 sphere = texture2D(diffuseMap, texCoord0);"," if (sphere.a < 0.05) discard;","	gl_FragColor = sphere;","}"].join("\n")},s}(goo.Box,goo.Sphere,goo.MeshData,goo.Material,goo.Shader,goo.TextureCreator,goo.Transform),goo.SkyboxHandler=function(t,e,r,i,o,n,a,s){"use strict";function h(){t.apply(this,arguments),this._activeSkyboxRef=null;var e=new o("box",[],null,0);this._skybox=this.world.createEntity(e.meshData,e.materials[0],e.transform),this._skybox.transformComponent.updateWorldTransform(),this._skybox.isSkybox=!0,this._skybox.name="Skybox_box",this._skyboxTexture=new r(null,{flipY:!1}),this._skyboxTexture.variant="CUBE",this._skyboxTexture.wrapS="EdgeClamp",this._skyboxTexture.wrapT="EdgeClamp",this._skybox.meshRendererComponent.materials[0].setTexture("DIFFUSE_MAP",this._skyboxTexture);var i=new o("sphere",[],null,0);this._skysphere=this.world.createEntity(i.meshData,i.materials[0],i.transform),this._skysphere.transformComponent.updateWorldTransform(),this._skysphere.isSkybox=!0,this._skysphere.name="Skybox_sphere",this._skysphereTexture=new r(null,{flipY:!1,wrapS:"EdgeClamp",wrapT:"EdgeClamp"}),this._skysphere.meshRendererComponent.materials[0].setTexture("DIFFUSE_MAP",this._skysphereTexture),this._activeSkyshape=null}function u(t,e){var r=t.length;if(r!==e.length)return!1;for(;r--;)if(t[r]!==e[r])return!1;return!0}h.prototype=Object.create(t.prototype),h.prototype.constructor=h,t._registerClass("skybox",h),h.prototype._remove=function(t){this._objects["delete"](t),this._activeSkyboxRef===t&&(this._hide(this._skybox),this._hide(this._skysphere),this._skyboxTexture.setImage(null),this._activeSkyshape=null,i.SKYBOX=null,i.SKYSPHERE=null,this._activeSkyboxRef=null)},h.prototype._create=function(){return{textures:[],enabled:!1}},h.prototype._update=function(e,r,i){var o=this;return t.prototype._update.call(this,e,r,i).then(function(t){if(!t)return a.resolve([]);var s=[];return r.box&&s.push(o._updateBox(e,r.box,i,t)),r.sphere&&s.push(o._updateSphere(e,r.sphere,i,t)),n.all(s).then(function(t){return(r.box||r.sphere)&&(o._activeSkyboxRef=e),t})})},h.prototype._updateSphere=function(t,r,i,o){var n=this;return r.sphereRef?this._load(r.sphereRef,i).then(function(i){if(!i||!i.image)return s.emit("goo.error.skybox",{type:"Sphere",message:"The skysphere needs an image to display."}),void n._hide(n._skysphere);if(t===e.currentSkyboxRef&&r.enabled){var a=n._skysphereTexture;o.textures=[i],a.setImage(i.image),n._show(n._skysphere)}else r.enabled||n._hide(n._skysphere);return n._skysphere}):(n._skysphereTexture.setImage(null),n._hide(n._skysphere),a.resolve(n._skysphere))};var c=["rightRef","leftRef","topRef","bottomRef","frontRef","backRef"];return h.prototype._updateBox=function(t,r,i,o){var s=this,h=c.map(function(t){return r[t]?s._load(r[t],i):a.resolve()});return n.all(h).then(function(i){if(u(i,o.textures)&&s._activeSkyShape===s._skybox)return s._skybox;var n=i.map(function(t){return t?t.image:null});if(0===n.filter(Boolean).length)return s._skyboxTexture.setImage(null),s._hide(s._skybox),s._skybox;for(var a=1,h=1,c=0;c<n.length;c++)n[c]&&(a=Math.max(a,n[c].width),h=Math.max(h,n[c].width));if(t===e.currentSkyboxRef&&r.enabled){o.textures=i;var l=s._skyboxTexture;l.setImage(n),l.image.width=a,l.image.height=h,l.image.dataReady=!0,l.setNeedsUpdate(),s._show(s._skybox)}else r.enabled||s._hide(s._skybox);return s._skybox})},h.prototype._hide=function(t){var e=this.world.getSystem("RenderSystem");e.removed(t),t===this._skybox?i.SKYBOX=null:t===this._skysphere&&(i.SKYSPHERE=null)},h.prototype._show=function(t){var e=this.world.getSystem("RenderSystem");this._activeSkyshape&&e.removed(this._activeSkyshape),e.added(t),this._activeSkyshape=t,i.SKYBOX=t===this._skybox?this._skyboxTexture:null,i.SKYSPHERE=t===this._skysphere?this._skysphereTexture:null},h}(goo.ConfigHandler,goo.EnvironmentHandler,goo.Texture,goo.ShaderBuilder,goo.Skybox,goo.rsvp,goo.PromiseUtils,goo.SystemBus),goo.HtmlComponent=function(t){"use strict";function e(e){t.apply(this,arguments),this.type="HtmlComponent",this.domElement=e,this.hidden=!1,this.useTransformComponent=!0}return e.type="HtmlComponent",e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(goo.Component),goo.HtmlComponentHandler=function(t,e,r,i){"use strict";function o(){t.apply(this,arguments),this._type="HtmlComponent"}function n(t){return"__"+t.replace(a,"-")}o.prototype=Object.create(t.prototype),t._registerClass("html",o),o.prototype.constructor=o,o.prototype._prepare=function(){},o.prototype._create=function(){return new e};var a=/\W/g;return o.prototype.update=function(e,o,a){var s=this;return t.prototype.update.call(this,e,o,a).then(function(t){function h(t,e){return s.loadObject(e,a).then(function(e){return t.src=e.src,t},function(e){return console.error(e),delete t.src,t})}if(t){var u=n(e.id),c=t.domElement;if(!c){c=document.createElement("div"),c.id=u,c.className="goo-entity",c.addEventListener("mousedown",function(t){var r=e._world.gooRunner,i={entity:e,depth:0,x:t.pageX,y:t.pageY,domEvent:t,id:e.id,type:"mousedown"};r.triggerEvent("mousedown",i)}),c.addEventListener("mouseup",function(t){var r=e._world.gooRunner,i={entity:e,depth:0,x:t.pageX,y:t.pageY,domEvent:t,id:e.id,type:"mouseup"};r.triggerEvent("mouseup",i)}),c.addEventListener("click",function(t){var r=e._world.gooRunner,i={entity:e,depth:0,x:t.pageX,y:t.pageY,domEvent:t,id:e.id,type:"click"};r.triggerEvent("click",i)}),t.domElement=c,c.style.position="absolute",c.style.top=0,c.style.left=0,c.style.zIndex=1,c.style.display="none";var l=e._world.gooRunner.renderer.domElement.parentElement||document.body;l.appendChild(c)}var d=o.innerHtml!==c.prevInnerHtml,p=o.style!==c.prevStyle;if(c.prevInnerHtml=o.innerHtml,c.prevStyle=o.style,t.useTransformComponent=o.useTransformComponent!==!1,!d&&!p)return i.resolve();var f="";if(o.style){var m=o.style.replace("__entity","#"+u);f="<style>\n"+m+"\n</style>"}c.innerHTML=f+o.innerHtml;for(var g=c.getElementsByTagName("IMG"),y=[],v=0;v<g.length;v++){var x=g[v],w=x.getAttribute("data-id");if(w){var _=h(x,w);y.push(_)}}return r.all(y)}})},o.prototype._remove=function(e){var r=e.htmlComponent;t.prototype._remove.call(this,e),r.domElement&&r.domElement.parentNode.removeChild(r.domElement)},o}(goo.ComponentHandler,goo.HtmlComponent,goo.rsvp,goo.PromiseUtils),goo.DynamicLoader=function(t,e,r,i,o,n,a,s){"use strict";function h(t){if(!t.world)throw new Error("World argument cannot be null");if(this._world=t.world,t.ajax)this._ajax=t.ajax;else{if(!t.rootPath)throw new Error("ajax or rootPath must be defined");this._ajax=new r(t.rootPath)}this._objects=new Map,this._handlers={}}h.prototype.preload=function(t,e){this._ajax.prefill(t,e)},h.prototype.clear=function(){var t=[];for(var e in this._handlers)t.push(this._handlers[e].clear());if(this._ajax.clear instanceof Function&&this._ajax.clear(),this._world&&this._world.gooRunner){s.clearCache(this._world.gooRunner.renderer.context);for(var r=0;r<this._world.gooRunner.renderSystems.length;r++){var o=this._world.gooRunner.renderSystems[r].lights;if(o)for(var n=0;n<o.length;n++)o[n].destroy(this._world.gooRunner.renderer)}this._world.gooRunner.renderer.clearShaderCache()}return i.all(t)},h.prototype.load=function(t,e){e=e||{};var r=this._loadObject.bind(this,t,e);return e.preloadBinaries===!0?this._loadBinariesFromRefs(t,e).then(r):r()},h.prototype.update=function(t,e,r){var i=this;return r=r||{},this._ajax.update(t,e).then(function(e){return i._updateObject(t,e,r)}).then(null,function(e){throw console.error("Error updating "+t+" "+e),e})},h.prototype._loadObject=function(t,e){var r=h.getTypeForRef(t),i=this._getHandler(r);return i?i.load(t,e):this._loadRef(t,e)},h.prototype.remove=function(t){return this._objects["delete"](t),this.update(t,null)},h.prototype._updateObject=function(t,e,r){var i=h.getTypeForRef(t),o=this._getHandler(i);return o?o.update(t,e,r):h._isRefTypeInGroup(t,"binary")||"bundle"!==i?n.resolve(e):(console.warn("No handler for type "+i),n.resolve(e))},h.prototype._loadRef=function(t,e){return this._ajax.load(t,null==e?!1:e.noCache)},h.prototype._loadBinariesFromRefs=function(t,e){function r(t){function r(r){return u._loadRef(r,e).then(function(){o++,e.progressCallback instanceof Function&&e.progressCallback(o,t.length)})}var o=0;return i.all(t.map(r))}function o(t){function r(t){return u._loadRef(t,e).then(o)}function o(t){var e=[];if(t.lazy===!0)return n.resolve();for(var o=h._getRefsFromConfig(t),a=0,u=o.length;u>a;a++){var l=o[a];h._isRefTypeInGroup(l,"asset")&&!s.has(l)?s.add(l):h._isRefTypeInGroup(l,"json")&&!c.has(l)&&(c.add(l),e.push(r(l)))}return i.all(e)}var s=new Set,c=new Set;return o({collectionRefs:t}).then(function(){return a.fromValues(s)})}if("string"==typeof t){var s=t;t={},t[s]=s}var u=this;return o(t).then(r)},h.prototype._getHandler=function(e){var r=this._handlers[e];if(r)return r;var i=t.getHandler(e);return i?(this._handlers[e]=new i(this._world,this._loadRef.bind(this),this._updateObject.bind(this),this._loadObject.bind(this)),this._handlers[e]):null};var u=40,c=32,l=function(t){if("string"!=typeof t)return!1;var e=t.split(".");return e[0]&&(e[0].length===u||e[0].length===c)&&e[1]};return h._getRefsFromConfig=function(t){function e(t,i){if(o.endsWith(t.toLowerCase(),"refs")&&i instanceof Object){for(var n=0,a=0,s=Object.keys(i),h=s.length;h>a;a++)l(i[s[a]])&&(r.push(i[s[a]]),n++);if(n>0)return}if(o.endsWith(t.toLowerCase(),"ref")&&"thumbnailRef"!==t&&l(i))return void r.push(i);if(i instanceof Object&&"assets"!==t&&!(i instanceof Array))for(var a=0,s=Object.keys(i),h=s.length;h>a;a++)e(s[a],i[s[a]])}var r=[];return e("",t),r},h.getTypeForRef=function(t){return t.substr(t.lastIndexOf(".")+1).toLowerCase()},h._isRefTypeInGroup=function(t,e){var i=h.getTypeForRef(t);return i&&r.types[e]&&r.types[e][i]},h}(goo.ConfigHandler,goo.ComponentHandler,goo.Ajax,goo.rsvp,goo.StringUtils,goo.PromiseUtils,goo.ArrayUtils,goo.ShapeCreatorMemoized,goo.CameraComponentHandler,goo.EntityHandler,goo.LightComponentHandler,goo.MaterialHandler,goo.MeshDataComponentHandler,goo.MeshDataHandler,goo.MeshRendererComponentHandler,goo.SceneHandler,goo.ShaderHandler,goo.TextureHandler,goo.TransformComponentHandler,goo.ProjectHandler,goo.SoundComponentHandler,goo.SoundHandler,goo.EnvironmentHandler,goo.SkyboxHandler,goo.HtmlComponentHandler),goo.Matrix2=function(t,e,r){"use strict";function i(){if(e.call(this,2,2),0===arguments.length)this.data[0]=1,this.data[3]=1;else if(1===arguments.length&&"object"==typeof arguments[0])arguments[0]instanceof i?this.copy(arguments[0]):this.setArray(arguments[0]);else for(var t=0;t<arguments.length;t++)this.data[t]=arguments[t]}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,e.setupAliases(i.prototype,[["e00"],["e10"],["e01"],["e11"]]),i.IDENTITY=new i(1,0,0,1),i.prototype.add=function(t){var e=this.data,r=t.data;return e[0]+=r[0],e[1]+=r[1],e[2]+=r[2],e[3]+=r[3],this},i.prototype.sub=function(t){var e=this.data,r=t.data;return e[0]-=r[0],e[1]-=r[1],e[2]-=r[2],e[3]-=r[3],this},i.prototype.scale=function(t){var e=this.data;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,this},i.prototype.mul=function(t){var e=t.data,r=e[0],i=e[2],o=e[1],n=e[3],a=this.data,s=a[0],h=a[2],u=a[1],c=a[3],l=this.data;return l[0]=r*s+i*u,l[2]=r*u+i*c,l[1]=o*s+n*u,l[3]=o*h+n*c,this},i.prototype.mul2=function(t,e){var r=t.data,i=r[0],o=r[2],n=r[1],a=r[3],s=e.data,h=s[0],u=s[2],c=s[1],l=s[3],d=this.data;return d[0]=i*h+o*c,d[2]=i*c+o*l,d[1]=n*h+a*c,d[3]=n*u+a*l,this},i.prototype.transpose=function(){var t=this.data,e=t[1];return t[1]=t[2],t[2]=e,this},i.invert=function(e,r){if(r||(r=new i),r===e)return r.copy(i.invert(e));var o=e.determinant();return Math.abs(o)<t.EPSILON?r:(o=1/o,r.e00=e.e11*o,r.e10=0-e.e10*o,r.e01=0-e.e01*o,r.e11=e.e00*o,r)},i.prototype.invert=function(){return i.invert(this,this)},i.prototype.isOrthogonal=function(){var e;return e=this.e00*this.e01+this.e10*this.e11,Math.abs(e)>t.EPSILON?!1:!0},i.prototype.isNormal=function(){var e;return e=this.e00*this.e00+this.e10*this.e10,Math.abs(e-1)>t.EPSILON?!1:(e=this.e01*this.e01+this.e11*this.e11,Math.abs(e-1)>t.EPSILON?!1:!0)},i.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},i.prototype.determinant=function(){return this.e00*this.e11-this.e01*this.e10},i.prototype.setIdentity=function(){return this.set(i.IDENTITY),this},i.prototype.equals=function(e){var r=this.data,i=e.data;return Math.abs(r[0]-i[0])<=t.EPSILON&&Math.abs(r[1]-i[1])<=t.EPSILON&&Math.abs(r[2]-i[2])<=t.EPSILON&&Math.abs(r[3]-i[3])<=t.EPSILON},i.prototype.copy=function(t){var e=this.data,r=t.data;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],this},i.prototype.setArray=function(t){var e=this.data;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this},i.prototype.set=i.prototype.copy,i.prototype.clone=function(){return(new i).copy(this)},i.add=r.warnOnce("Matrix2.add is deprecated. Use Matrix2.prototype.add instead.",function(t,e,r){return r||(r=new i),e instanceof i?(r.e00=t.e00+e.e00,r.e10=t.e10+e.e10,r.e01=t.e01+e.e01,r.e11=t.e11+e.e11):(r.e00=t.e00+e,r.e10=t.e10+e,r.e01=t.e01+e,r.e11=t.e11+e),r}),i.combine=r.warnOnce("Matrix2.combine is deprecated. Use Matrix2.prototype.multiply instead.",function(t,r,o){return o||(o=new i),o===t||o===r?e.copy(i.combine(t,r),o):(o.e00=t.e00*r.e00+t.e01*r.e10,o.e10=t.e10*r.e00+t.e11*r.e10,o.e01=t.e00*r.e01+t.e01*r.e11,o.e11=t.e10*r.e01+t.e11*r.e11,o)}),i.div=r.warnOnce("Matrix2.div is deprecated. Use Matrix2.prototype.div instead.",function(t,e,r){return r||(r=new i),e instanceof i?(r.e00=t.e00/e.e00,r.e10=t.e10/e.e10,r.e01=t.e01/e.e01,r.e11=t.e11/e.e11):(e=1/e,r.e00=t.e00*e,r.e10=t.e10*e,r.e01=t.e01*e,r.e11=t.e11*e),r}),i.mul=r.warnOnce("Matrix2.mul is deprecated. Use Matrix2.prototype.mul instead.",function(t,e,r){return r||(r=new i),e instanceof i?(r.e00=t.e00*e.e00,r.e10=t.e10*e.e10,r.e01=t.e01*e.e01,r.e11=t.e11*e.e11):(r.e00=t.e00*e,r.e10=t.e10*e,r.e01=t.e01*e,r.e11=t.e11*e),r}),i.transpose=r.warnOnce("Matrix2.transpose is deprecated. Use Matrix2.prototype.transpose instead.",function(t,r){return r||(r=new i),r===t?e.copy(i.transpose(t),r):(r.e00=t.e00,r.e10=t.e01,r.e01=t.e10,r.e11=t.e11,r)}),i.sub=r.warnOnce("Matrix2.sub is deprecated. Use Matrix2.prototype.sub instead.",function(t,e,r){return r||(r=new i),e instanceof i?(r.e00=t.e00-e.e00,r.e10=t.e10-e.e10,r.e01=t.e01-e.e01,r.e11=t.e11-e.e11):(r.e00=t.e00-e,r.e10=t.e10-e,r.e01=t.e01-e,r.e11=t.e11-e),r}),i.prototype.combine=r.warnOnce("Matrix2.prototype.combine is deprecated. Use Matrix2.prototype.mul or Matrix2.prototype.mul2 instead.",function(t){return i.combine(this,t,this)}),i.prototype.div=r.warnOnce("Matrix2.prototype.div is deprecated.",function(t){return i.div(this,t,this)}),i}(goo.MathUtils,goo.Matrix,goo.ObjectUtils),goo.Matrix2x2=function(t,e){"use strict";var r=e.warnOnce("Matrix2x2 has been renamed to Matrix2.",function(){t.apply(this,arguments)});r.prototype=Object.create(t.prototype),r.prototype.constructor=r;for(var i in t)r[i]=t[i];return r}(goo.Matrix2,goo.ObjectUtils),goo.Matrix3x3=function(t,e){"use strict";var r=e.warnOnce("Matrix3x3 has been renamed to Matrix3.",function(){t.apply(this,arguments)});r.prototype=Object.create(t.prototype),r.prototype.constructor=r;for(var i in t)r[i]=t[i];return r}(goo.Matrix3,goo.ObjectUtils),goo.Matrix4x4=function(t,e){"use strict";var r=e.warnOnce("Matrix4x4 has been renamed to Matrix4.",function(){t.apply(this,arguments)});r.prototype=Object.create(t.prototype),r.prototype.constructor=r;for(var i in t)r[i]=t[i];return r}(goo.Matrix4,goo.ObjectUtils),goo.Quaternion=function(t,e,r,i,o,n){"use strict";function a(t,e,r,i){0===arguments.length?(this.x=0,this.y=0,this.z=0,this.w=1):1===arguments.length&&"object"==typeof arguments[0]?arguments[0]instanceof a?this.copy(arguments[0]):(this.x=arguments[0][0],this.y=arguments[0][1],this.z=arguments[0][2],this.w=arguments[0][3]):(this.x=t,this.y=e,this.z=r,this.w=i)}return a.prototype.setDirect=r.prototype.setDirect,a.prototype.dot=r.prototype.dot,a.prototype.length=r.prototype.length,a.prototype.lengthSquared=r.prototype.lengthSquared,a.prototype.normalize=r.prototype.normalize,a.prototype.equals=r.prototype.equals,a.IDENTITY=new a(0,0,0,1),a.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},a.prototype.set=function(t){return t instanceof a?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2],this.w=arguments[3]),this},a.slerp=function(t,e,r,i){if(0===r)return i.set(t);if(1===r)return i.set(e);if(t.equals(e))return i.set(t);var o=t.dot(e);i.set(e),0>o&&(i.negate(),o=-o);var n=1-r,a=r;if(1-o>.1){var s=Math.acos(o),h=1/Math.sin(s);n=Math.sin((1-r)*s)*h,a=Math.sin(r*s)*h}var u=n*t.x+a*i.x,c=n*t.y+a*i.y,l=n*t.z+a*i.z,d=n*t.w+a*i.w;return i.setDirect(u,c,l,d),i},a.prototype.negate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},a.prototype.conjugate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},a.prototype.invert=function(){return this.conjugate().normalize()},a.prototype.mul=function(t){var e=this.x,r=this.y,i=this.z,o=this.w,n=t.x,a=t.y,s=t.z,h=t.w;return this.x=e*h+o*n+r*s-i*a,this.y=r*h+o*a+i*n-e*s,this.z=i*h+o*s+e*a-r*n,this.w=o*h-e*n-r*a-i*s,this},function(){var t=new a;a.prototype.slerp=function(e,r){return t.copy(e),a.slerp(this,e,r,t),this.copy(t),this}}(),a.prototype.fromRotationMatrix=function(t){var e,r,i,o,n=t.e00+t.e11+t.e22;if(n>=0){var a=Math.sqrt(n+1);o=.5*a,a=.5/a,e=(t.e21-t.e12)*a,r=(t.e02-t.e20)*a,i=(t.e10-t.e01)*a}else if(t.e00>t.e11&&t.e00>t.e22){var a=Math.sqrt(1+t.e00-t.e11-t.e22);e=.5*a,a=.5/a,r=(t.e10+t.e01)*a,i=(t.e02+t.e20)*a,o=(t.e21-t.e12)*a}else if(t.e11>t.e22){var a=Math.sqrt(1+t.e11-t.e00-t.e22);r=.5*a,a=.5/a,e=(t.e10+t.e01)*a,i=(t.e21+t.e12)*a,o=(t.e02-t.e20)*a}else{var a=Math.sqrt(1+t.e22-t.e00-t.e11);i=.5*a,a=.5/a,e=(t.e02+t.e20)*a,r=(t.e21+t.e12)*a,o=(t.e10-t.e01)*a}return this.setDirect(e,r,i,o)},a.prototype.toRotationMatrix=function(t){var e=t||new i,r=this.lengthSquared(),o=r>0?2/r:0,n=this.x*o,a=this.y*o,s=this.z*o,h=this.x*n,u=this.x*a,c=this.x*s,l=this.w*n,d=this.y*a,p=this.y*s,f=this.w*a,m=this.z*s,g=this.w*s,y=e.data;return y[0]=1-(d+m),y[1]=u+g,y[2]=c-f,y[3]=u-g,y[4]=1-(h+m),y[5]=p+l,y[6]=c+f,y[7]=p-l,y[8]=1-(h+d),e},function(){var t=new e;a.prototype.fromVectorToVector=function(e,r){var i=e,n=r,s=i.length()*n.length();if(Math.abs(s)>o.EPSILON){var h=i.dot(n)/s,u=Math.acos(Math.max(-1,Math.min(h,1)));if(t.copy(i).cross(n),0>h&&t.length()<o.EPSILON){var c;c=Math.abs(i.x)>Math.abs(i.y)?Math.abs(i.x)>Math.abs(i.z)?0:2:Math.abs(i.y)>Math.abs(i.z)?1:2,t.setValue(c,-i[(c+1)%3]),t.setValue((c+1)%3,i[c]),t.setValue((c+2)%3,0)}return this.fromAngleAxis(u,t)}return this.set(a.IDENTITY)}}(),function(){var t=new e;a.prototype.fromAngleAxis=function(e,r){return t.copy(r).normalize(),this.fromAngleNormalAxis(e,t)}}(),a.prototype.fromAngleNormalAxis=function(t,r){if(r.equals(e.ZERO))return this.set(a.IDENTITY);var i=.5*t,o=Math.sin(i),n=Math.cos(i),s=o*r.x,h=o*r.y,u=o*r.z;return this.setDirect(s,h,u,n)},a.prototype.toAngleAxis=function(t){var e,r=this.x*this.x+this.y*this.y+this.z*this.z;if(Math.abs(r)<=o.EPSILON)e=0,null!==t&&(t.x=1,t.y=0,t.z=0);else if(e=2*Math.acos(this.w),null!==t){var i=1/Math.sqrt(r);t.x=this.x*i,t.y=this.y*i,t.z=this.z*i}return e},a.prototype.clone=function(){return new a(this.x,this.y,this.z,this.w)},a.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},a.prototype.setDirect=function(t,e,r,i){return this.x=t,this.y=e,this.z=r,this.w=i,this},Object.defineProperty(a.prototype,"data",{get:n.warnOnce("The .data property of Quaternion was removed. Please use the .x, .y, .z and .w properties instead.",function(){var t=[],e=this;return Object.defineProperties(t,{0:{get:function(){return e.x},set:function(t){e.x=t}},1:{get:function(){return e.y},set:function(t){e.y=t}},2:{get:function(){return e.z},set:function(t){e.z=t}},3:{get:function(){return e.w},set:function(t){e.w=t}}}),t})}),a.add=n.warnOnce("Quaternion.add is deprecated.",function(t,e,r){return r||(r=new a),r.x=t.x+e.x,r.y=t.y+e.y,r.z=t.z+e.z,r.w=t.w+e.w,r}),a.div=n.warnOnce("Quaternion.div is deprecated",function(t,e,r){r||(r=new a);var i=!0;return r.x=(i&=e.x<0||e.x>0)?t.x/e.x:0,r.y=(i&=e.y<0||e.y>0)?t.y/e.y:0,r.z=(i&=e.z<0||e.z>0)?t.z/e.z:0,r.w=(i&=e.w<0||e.w>0)?t.w/e.w:0,r}),a.mul=a.mul2=n.warnOnce("Quaternion.mul is deprecated.",function(t,e,r){var i=t.x,o=t.y,n=t.z,a=t.w,s=e.x,h=e.y,u=e.z,c=e.w;return r.x=i*c+a*s+o*u-n*h,r.y=o*c+a*h+n*s-i*u,r.z=n*c+a*u+i*h-o*s,r.w=a*c-i*s-o*h-n*u,r}),a.sub=n.warnOnce("Quaternion.sub is deprecated.",function(t,e,r){return r||(r=new a),r.x=t.x-e.x,r.y=t.y-e.y,r.z=t.z-e.z,r.w=t.w-e.w,r}),a.prototype.add=n.warnOnce("Quaternion.prototype.add is deprecated.",function(t){return a.add(this,t,this)}),a.prototype.div=n.warnOnce("Quaternion.prototype.div is deprecated.",function(t){return a.div(this,t,this)}),a.prototype.magnitude=n.warnOnce("Quaternion.prototype.magnitude is deprecated.",function(){var t=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;return 1===t?1:Math.sqrt(t)}),a.prototype.magnitudeSquared=n.warnOnce("Quaternion.prototype.magnitudeSquared is deprecated.",function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}),a.scalarAdd=n.warnOnce("Quaternion.prototype.scalarAdd is deprecated.",function(t,e,r){return r||(r=new a),r.x=t.x+e,r.y=t.y+e,r.z=t.z+e,r.w=t.w+e,r}),a.scalarDiv=n.warnOnce("Quaternion.scalarDiv is deprecated.",function(t,e,r){r||(r=new a);var i=!0;return e=(i&=0>e||e>0)?1/e:0,r.x=t.x*e,r.y=t.y*e,r.z=t.z*e,r.w=t.w*e,r}),a.scalarMul=n.warnOnce("Quaternion.scalarMul is deprecated.",function(t,e,r){return r||(r=new a),r.x=t.x*e,r.y=t.y*e,r.z=t.z*e,r.w=t.w*e,r}),a.scalarSub=n.warnOnce("Quaternion.scalarSub is deprecated.",function(t,e,r){return r||(r=new a),r.x=t.x-e,r.y=t.y-e,r.z=t.z-e,r.w=t.w-e,r}),a.prototype.setArray=n.warnOnce("Quaternion.prototype.setArray is deprecated.",function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3],this}),a.prototype.setVector=n.warnOnce("Quaternion.prototype.setVector is deprecated.",function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}),a.prototype.sub=n.warnOnce("Quaternion.prototype.sub is deprecated.",function(t){return a.sub(this,t,this)}),a.prototype.scalarAdd=n.warnOnce("Quaternion.prototype.scalarAdd is deprecated.",function(t){return a.scalarAdd(this,t,this)}),a.prototype.scalarSub=n.warnOnce("Quaternion.prototype.scalarSub is deprecated.",function(t){return a.scalarSub(this,t,this)}),a.prototype.scalarMul=n.warnOnce("Quaternion.prototype.scalarMul is deprecated.",function(t){return a.scalarMul(this,t,this)}),a.prototype.scalarDiv=n.warnOnce("Quaternion.prototype.scalarDiv is deprecated.",function(t){return a.scalarDiv(this,t,this)}),a}(goo.Vector,goo.Vector3,goo.Vector4,goo.Matrix3,goo.MathUtils,goo.ObjectUtils),goo.ParticleInfluence=function(){"use strict";function t(t){t=t||{},this.prepare=t.prepare?t.prepare:function(){},this.apply=t.apply?t.apply:function(){},this.enabled=void 0!==t.enabled?t.enabled===!0:!0}return t}(),goo.Noise=function(t){"use strict";function e(){}return e.shifter=[37,91,12,128,216,96,51,153,39,231,223,180,160,157,135,179,74,50,205,151,4,213,196,58,212,120,53,45,10,195,137,159,103,144,109,170,202,48,121,13,245,68,232,28,210,174,197,80,107,206,156,116,155,240,162,79,41,59,147,117,0,242,118,164,129,101,98,126,214,105,89,26,130,254,85,199,8,165,76,75,187,166,64,143,217,149,78,7,172,230,87,119,42,247,84,139,16,141,134,86,154,71,253,60,99,235,168,30,34,55,113,140,191,69,31,106,40,82,73,33,81,14,234,131,255,88,169,136,248,148,220,138,219,102,44,127,36,200,95,208,54,152,47,20,23,15,52,123,177,224,122,171,215,173,211,188,190,133,244,167,236,35,63,145,221,104,65,24,70,100,56,150,49,77,110,228,112,209,198,1,237,185,250,225,93,201,124,108,218,72,243,21,22,6,114,38,125,29,66,249,222,111,241,11,186,61,176,183,17,163,229,161,57,238,227,132,67,83,207,226,46,189,115,193,194,233,182,192,18,27,25,2,3,252,97,62,184,239,175,92,246,142,251,204,203,32,146,90,19,9,178,158,181,94,43,5],e.split=function(e){var r=Math.floor(e),i=t.scurve5(e-r);return{i0:r+0,i1:r+1,f0:1-i,f1:0+i}},e.fractal1d=function(t,e,r,i,o,n){for(var a=0,s=1,h=0,u=0;r>u;u++)a+=s*n.evaluate1d(t,e),h+=s,s*=i,t*=o;return a/h},e.fractal2d=function(t,e,r,i,o,n,a){for(var s=0,h=1,u=0,c=0;i>c;c++)s+=h*a.evaluate2d(t,e,r),u+=h,h*=o,t*=n,e*=n;return s/u},e.fractal3d=function(t,e,r,i,o,n,a,s){for(var h=0,u=1,c=0,l=0;o>l;l++)h+=u*s.evaluate3d(t,e,r,i),c+=u,u*=n,t*=a,e*=a,r*=a;return h/c},e.fractal4d=function(t,e,r,i,o,n,a,s,h){for(var u=0,c=1,l=0,d=0;n>d;d++)u+=c*h.evaluate4d(t,e,r,i,o),l+=c,c*=a,t*=s,e*=s,r*=s,i*=s;return u/l},e}(goo.MathUtils),goo.ValueNoise=function(t){"use strict";function e(){t.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.sources=[0,1/15,2/15,.2,4/15,5/15,.4,7/15,8/15,.6,10/15,11/15,.8,13/15,14/15,1],e.evaluate1d=function(r,i){var o=t.split(r/i),n=15&t.shifter[255&o.i0],a=15&t.shifter[255&o.i1],s=0;return s+=o.f0*e.sources[n],s+=o.f1*e.sources[a]},e.evaluate2d=function(r,i,o){var n=t.split(r/o),a=t.split(i/o),s=15&t.shifter[t.shifter[255&a.i0]+n.i0&255],h=15&t.shifter[t.shifter[255&a.i0]+n.i1&255],u=15&t.shifter[t.shifter[255&a.i1]+n.i0&255],c=15&t.shifter[t.shifter[255&a.i1]+n.i1&255],l=0;
return l+=a.f0*n.f0*e.sources[s],l+=a.f0*n.f1*e.sources[h],l+=a.f1*n.f0*e.sources[u],l+=a.f1*n.f1*e.sources[c]},e.evaluate3d=function(r,i,o,n){var a=t.split(r/n),s=t.split(i/n),h=t.split(o/n),u=15&t.shifter[t.shifter[t.shifter[255&h.i0]+s.i0&255]+a.i0&255],c=15&t.shifter[t.shifter[t.shifter[255&h.i0]+s.i0&255]+a.i1&255],l=15&t.shifter[t.shifter[t.shifter[255&h.i0]+s.i1&255]+a.i0&255],d=15&t.shifter[t.shifter[t.shifter[255&h.i0]+s.i1&255]+a.i1&255],p=15&t.shifter[t.shifter[t.shifter[255&h.i1]+s.i0&255]+a.i0&255],f=15&t.shifter[t.shifter[t.shifter[255&h.i1]+s.i0&255]+a.i1&255],m=15&t.shifter[t.shifter[t.shifter[255&h.i1]+s.i1&255]+a.i0&255],g=15&t.shifter[t.shifter[t.shifter[255&h.i1]+s.i1&255]+a.i1&255],y=0;return y+=h.f0*s.f0*a.f0*e.sources[u],y+=h.f0*s.f0*a.f1*e.sources[c],y+=h.f0*s.f1*a.f0*e.sources[l],y+=h.f0*s.f1*a.f1*e.sources[d],y+=h.f1*s.f0*a.f0*e.sources[p],y+=h.f1*s.f0*a.f1*e.sources[f],y+=h.f1*s.f1*a.f0*e.sources[m],y+=h.f1*s.f1*a.f1*e.sources[g]},e.evaluate4d=function(r,i,o,n,a){var s=t.split(r/a),h=t.split(i/a),u=t.split(o/a),c=t.split(n/a),l=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i0]+u.i0&255]+h.i0&255]+s.i0&255],d=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i0]+u.i0&255]+h.i0&255]+s.i1&255],p=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i0]+u.i0&255]+h.i1&255]+s.i0&255],f=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i0]+u.i0&255]+h.i1&255]+s.i1&255],m=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i0]+u.i1&255]+h.i0&255]+s.i0&255],g=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i0]+u.i1&255]+h.i0&255]+s.i1&255],y=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i0]+u.i1&255]+h.i1&255]+s.i0&255],v=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i0]+u.i1&255]+h.i1&255]+s.i1&255],x=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i1]+u.i0&255]+h.i0&255]+s.i0&255],w=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i1]+u.i0&255]+h.i0&255]+s.i1&255],_=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i1]+u.i0&255]+h.i1&255]+s.i0&255],b=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i1]+u.i0&255]+h.i1&255]+s.i1&255],S=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i1]+u.i1&255]+h.i0&255]+s.i0&255],M=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i1]+u.i1&255]+h.i0&255]+s.i1&255],E=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i1]+u.i1&255]+h.i1&255]+s.i0&255],C=15&t.shifter[t.shifter[t.shifter[t.shifter[255&c.i1]+u.i1&255]+h.i1&255]+s.i1&255],T=0;return T+=c.f0*u.f0*h.f0*s.f0*e.sources[l],T+=c.f0*u.f0*h.f0*s.f1*e.sources[d],T+=c.f0*u.f0*h.f1*s.f0*e.sources[p],T+=c.f0*u.f0*h.f1*s.f1*e.sources[f],T+=c.f0*u.f1*h.f0*s.f0*e.sources[m],T+=c.f0*u.f1*h.f0*s.f1*e.sources[g],T+=c.f0*u.f1*h.f1*s.f0*e.sources[y],T+=c.f0*u.f1*h.f1*s.f1*e.sources[v],T+=c.f1*u.f0*h.f0*s.f0*e.sources[x],T+=c.f1*u.f0*h.f0*s.f1*e.sources[w],T+=c.f1*u.f0*h.f1*s.f0*e.sources[_],T+=c.f1*u.f0*h.f1*s.f1*e.sources[b],T+=c.f1*u.f1*h.f0*s.f0*e.sources[S],T+=c.f1*u.f1*h.f0*s.f1*e.sources[M],T+=c.f1*u.f1*h.f1*s.f0*e.sources[E],T+=c.f1*u.f1*h.f1*s.f1*e.sources[C]},e}(goo.Noise),goo.BoundingTree=function(t,e,r){"use strict";function i(t){this.leftTree=null,this.rightTree=null,this.localBound=null,this.worldBound=null,this.boundType=t?t:i.BOUNDTYPE_BOX}return i.BOUNDTYPE_SPHERE="sphere",i.BOUNDTYPE_BOX="box",i.MAX_PRIMITIVES_PER_LEAF=16,i.prototype.construct=function(t){if(!t.meshRendererComponent||!t.meshDataComponent||!t.transformComponent)return void console.warn("Entity missing required components for boundingtree construction: ",t);var e=t.meshDataComponent.meshData;if(e.updatePrimitiveCounts(),1===e.getSectionCount()){this.primitiveIndices=[];for(var r=0,i=e.getPrimitiveCount(0);i>r;r++)this.primitiveIndices.push(r);this.createTree(t,0,0,this.primitiveIndices.length)}else this.split(t,0,e.getSectionCount())},i.prototype.createTree=function(t,e,r,o){var n=t.meshDataComponent.meshData;this.section=e,this.start=r,this.end=o,this.primitiveIndices&&(this.createBounds(),this.localBound.computeFromPrimitives(n,e,this.primitiveIndices,r,o),o-r+1<=i.MAX_PRIMITIVES_PER_LEAF||(this.leftTree||(this.leftTree=new i(this.boundType)),this.leftTree.primitiveIndices=this.primitiveIndices,this.leftTree.createTree(t,e,r,Math.floor((r+o)/2)),this.rightTree||(this.rightTree=new i(this.boundType)),this.rightTree.primitiveIndices=this.primitiveIndices,this.rightTree.createTree(t,e,Math.floor((r+o)/2),o)))},i.prototype.split=function(t,e,r){var o=r-e,n=Math.floor(o/2);if(1===n){var a=e;this.leftTree=new i(this.boundType),this.leftTree.primitiveIndices=[];for(var s=0;s<this.leftTree.primitiveIndices.length;s++)this.leftTree.primitiveIndices.push(s);this.leftTree.createTree(t,a,0,this.leftTree.primitiveIndices.length)}else this.leftTree=new i(this.boundType),this.leftTree.split(t,e,e+n);if(o-n===1){var a=e+1;this.rightTree=new i(this.boundType),this.rightTree._primitiveIndices=[];for(var s=0;s<this.rightTree.primitiveIndices.length;s++)this.rightTree.primitiveIndices.push(s);this.rightTree.createTree(t,a,0,this.rightTree.primitiveIndices.length)}else this.rightTree=new i(this.boundType),this.rightTree.split(t,e+n,r);this.localBound=this.leftTree.localBound.clone(),this.localBound.merge(this.rightTree.localBound),this.worldBound=this.localBound.clone()},i.prototype.createBounds=function(){switch(this.boundType){case i.BOUNDTYPE_BOX:this.localBound=new t,this.worldBound=new t;break;case i.BOUNDTYPE_SPHERE:this.localBound=new e,this.worldBound=new e}},i.prototype.findPick=function(t,e,i){var o=i;o||(o={});var n=e.transformComponent.worldTransform;if(this.localBound.transform(n,this.worldBound),!this.worldBound.intersectsRay(t))return o;if(this.leftTree&&this.leftTree.findPick(t,e,o),this.rightTree)this.rightTree.findPick(t,e,o);else if(!this.leftTree)for(var a=e.meshDataComponent.meshData,s=null,h=new r,u=this.start;u<this.end;u++){s=a.getPrimitiveVertices(this.primitiveIndices[u],this.section,s);for(var c=0;c<s.length;c++)n.matrix.applyPostPoint(s[c]);if(t.intersects(s,!1,h)){o.distances=o.distances||[],o.distances.push(t.origin.distance(h)),o.points=o.points||[];var l=new r;l.set(h),o.points.push(l),o.vertices=o.vertices||[];for(var d=[],p=s.length-1;p>=0;p--)d[p]=(new r).set(s[p]);o.vertices.push(d)}}return o},i}(goo.BoundingBox,goo.BoundingSphere,goo.Vector3),goo.PrimitivePickLogic=function(t){"use strict";function e(){}return e.prototype.getPickResult=function(t,e){var r=e.meshDataComponent.meshData.__boundingTree;return r?r.findPick(t,e,{}):null},e.prototype.added=function(t){this.isConstructed(t)||this.rebuild(t)},e.prototype.removed=function(t){t.meshDataComponent&&t.meshDataComponent.meshData&&(t.meshDataComponent.meshData.__boundingTree=null)},e.prototype.isConstructed=function(t){return!!t.meshDataComponent.meshData.__boundingTree},e.prototype.rebuild=function(e){e.meshDataComponent.meshData.__boundingTree=new t,e.meshDataComponent.meshData.__boundingTree.construct(e)},e}(goo.BoundingTree),goo.RendererContextLost=function(t,e){"use strict";t.prototype.invalidateBuffer=function(t){t.glBuffer=null},t.prototype.invalidateMeshData=function(t){this.invalidateBuffer(t.vertexData),t.indexData&&this.invalidateBuffer(t.indexData),t.wireframeData&&this.invalidateMeshData(t.wireframeData),t.flatMeshData&&this.invalidateMeshData(t.flatMeshData)},t.prototype.invalidateTexture=function(t){t.glTexture=null,t.textureRecord={}},t.prototype.invalidateShader=function(t){t.shaderProgram=null,t.vertexShader=null,t.fragmentShader=null},t.prototype.invalidateMaterial=function(t){for(var e=Object.keys(t._textureMaps),r=0;r<e.length;r++){var i=e[r],o=t._textureMaps[i];this.invalidateTexture(o)}this.invalidateShader(t.shader)},t.prototype.invalidateRenderTarget=function(t){t.glTexture=null,t._glRenderBuffer=null,t._glFrameBuffer=null,delete t.textureRecord},t.prototype.invalidateComposer=function(t){t.writeBuffer&&!t._passedWriteBuffer&&this.invalidateRenderTarget(t.writeBuffer),t.readBuffer&&this.invalidateRenderTarget(t.readBuffer),t.copyPass.invalidateHandles(this);for(var e=0;e<t.passes.length;e++){var r=t.passes[e];r.invalidateHandles(this)}},t.prototype.invalidatePicking=function(){this.hardwarePicking&&(this.hardwarePicking.pickingTarget&&this.invalidateRenderTarget(this.hardwarePicking.pickingTarget),this.invalidateMaterial(this.hardwarePicking.pickingMaterial))},t.prototype._restoreContext=function(){this.establishContext(),this.rendererRecord=new e,this.context.clearColor(this._clearColor.x,this._clearColor.y,this._clearColor.z,this._clearColor.w)}}(goo.Renderer,goo.RendererRecord),goo.Grid=function(t,e){"use strict";function r(e,r,i,o){if(1===arguments.length&&arguments[0]instanceof Object){var n=arguments[0];e=n.xSegments,r=n.ySegments,i=n.width,o=n.height}this.xSegments=e||10,this.ySegments=r||10,this.width=i||1,this.height=o||1;var a=t.defaultMap([t.POSITION]),s=4+2*(this.xSegments-1)+2*(this.ySegments-1),h=8+2*(this.xSegments-1)+2*(this.ySegments-1);t.call(this,a,s,h),this.indexModes[0]="Lines",this.rebuild()}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.rebuild=function(){var e=this.width/2,r=this.height/2,i=[],o=[];i.push(-e,-r,0,-e,r,0,e,r,0,e,-r,0),o.push(0,1,1,2,2,3,3,0);for(var n,a=this.width/this.xSegments,s=1;s<this.xSegments;s++)n=s*a-e,i.push(n,-r,0,n,r,0);var h;a=this.height/this.ySegments;for(var s=1;s<this.ySegments;s++)h=s*a-r,i.push(-e,h,0,e,h,0);for(var s=o.length/2;s<i.length/3;s+=2)o.push(s,s+1);this.getAttributeBuffer(t.POSITION).set(i),this.getIndexBuffer().set(o)},r.prototype.clone=function(){var t=e.shallowSelectiveClone(this,["xSegments","ySegments","width","height"]);return new r(t)},r}(goo.MeshData,goo.ObjectUtils),goo.SimpleBox=function(t){"use strict";function e(e,r,i){if(1===arguments.length&&arguments[0]instanceof Object){var o=arguments[0];e=o.width,r=o.height,i=o.length}this.xExtent=void 0!==e?.5*e:.5,this.yExtent=void 0!==r?.5*r:.5,this.zExtent=void 0!==i?.5*i:.5;var n=t.defaultMap([t.POSITION]);t.call(this,n,8,36),this.rebuild()}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.rebuild=function(){var e=this.xExtent,r=this.yExtent,i=this.zExtent;return this.getAttributeBuffer(t.POSITION).set([-e,-r,-i,e,-r,-i,e,r,-i,-e,r,-i,-e,-r,i,e,-r,i,e,r,i,-e,r,i]),this.getIndexBuffer().set([2,1,0,0,3,2,5,6,7,7,4,5,7,3,0,0,4,7,1,2,6,6,5,1,6,2,3,3,7,6,0,1,5,5,4,0]),this},e.prototype.clone=function(){var t={width:2*this.xExtent,height:2*this.yExtent,length:2*this.zExtent};return new e(t)},e}(goo.MeshData),goo.OrbitCamControlScript=function(t,e,r,i,o){"use strict";function n(i,o){o.dirty=!0,o.timeSamples=[0,0,0,0,0],o.xSamples=[0,0,0,0,0],o.ySamples=[0,0,0,0,0],o.sample=0,o.velocity=new e(0,0),o.cartesian=new t,o.worldUpVector=t.UNIT_Y.clone(),o.maxSampleTimeMS=200,o.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN},o.smoothness=Math.pow(r.clamp(i.smoothness,0,1),.3),o.inertia=Math.pow(r.clamp(i.drag,0,1),.3),o.dragButton=["Any","Left","Middle","Right","None"].indexOf(i.dragButton)-1,o.dragButton<-1?o.dragButton=-1:4===o.dragButton&&(o.dragButton=null);var n;if(i.lookAtDistance){var a=o.entity.getRotation();n=o.spherical=new t(i.lookAtDistance,-a.y+Math.PI/2,-a.x)}else if(i.spherical instanceof Array)var n=o.spherical=new t(i.spherical[0],i.spherical[1]*r.DEG_TO_RAD,i.spherical[2]*r.DEG_TO_RAD);else if(i.spherical)var n=o.spherical=new t(i.spherical.x,i.spherical.y*r.DEG_TO_RAD,i.spherical.z*r.DEG_TO_RAD);else var n=o.spherical=new t(15,0,0);if(o.targetSpherical=n.clone(),i.lookAtDistance){var s=o.entity.transformComponent.transform.rotation;o.lookAtPoint=new t(0,0,-i.lookAtDistance),o.lookAtPoint.applyPost(s),o.lookAtPoint.add(o.entity.getTranslation())}else i.lookAtPoint?o.lookAtPoint=i.lookAtPoint instanceof Array?t.fromArray(i.lookAtPoint):i.lookAtPoint.clone():o.lookAtPoint=new t;o.goingToLookAt=o.lookAtPoint.clone(),u(1,o),d(i,o)}function a(t,e,i,o){var n=o.dragButton,a=o.mouseState;(-1===n||n===t||e===!1)&&(a.buttonDown=e,e?(a.lastX=NaN,a.lastY=NaN,o.velocity.setDirect(0,0),o.spherical.y=r.moduloPositive(o.spherical.y,r.TWO_PI),o.targetSpherical.set(o.spherical)):l(i,o))}function s(t,e,r,i){var o=0,n=0,a=i.mouseState;isNaN(a.lastX)||isNaN(a.lastY)?(a.lastX=t,a.lastY=e):(o=-(t-a.lastX),n=e-a.lastY,a.lastX=t,a.lastY=e),!a.buttonDown||0===o&&0===n||(i.timeSamples[i.sample]=Date.now(),i.xSamples[i.sample]=o,i.ySamples[i.sample]=n,i.sample++,i.sample>i.timeSamples.length-1&&(i.sample=0),i.velocity.setDirect(0,0),h(r.orbitSpeed*o,r.orbitSpeed*n,r,i))}function h(t,e,i,o){var n=o.targetSpherical;if(i.clampAzimuth){var a=i.minAzimuth*r.DEG_TO_RAD,s=i.maxAzimuth*r.DEG_TO_RAD;n.y=r.radialClamp(n.y-t,a,s)}else n.y-=t;var h=i.minAscent*r.DEG_TO_RAD,u=i.maxAscent*r.DEG_TO_RAD;n.z=r.clamp(n.z+e,h,u),o.dirty=!0}function u(t,e){var r=e.entity.cameraComponent.camera;if(r.projectionMode===i.Parallel){e.size=r.top,e.size/=t;var o=e.size;r.setFrustum(null,null,-o,o,o,-o)}}function c(t,e,i){var o=Math.max(-1,Math.min(1,-t.wheelDelta||t.detail));o*=y*i.targetSpherical.x;var n=i.targetSpherical;n.x=r.clamp(n.x+e.zoomSpeed*o,e.minZoomDistance,e.maxZoomDistance),i.dirty=!0}function l(t,e){for(var r=e.timeSamples,i=Date.now(),o=0,n=0,a=!1,s=0,h=r.length;h>s;s++)i-r[s]<e.maxSampleTimeMS&&(o+=e.xSamples[s],n+=e.ySamples[s],a=!0);a?e.velocity.setDirect(o*t.orbitSpeed/r.length,n*t.orbitSpeed/r.length):e.velocity.setDirect(0,0)}function d(t,e){var r=0,i=!!navigator.userAgent.match(/Android/i),o={wheelDelta:0};e.listeners={mousedown:function(r){if(!t.whenUsed||e.entity===e.activeCameraEntity){var i=r.button;0===i&&(r.altKey?i=2:r.shiftKey&&(i=1)),a(i,!0,t,e)}},mouseup:function(r){var i=r.button;0===i&&(r.altKey?i=2:r.shiftKey&&(i=1)),a(i,!1,t,e)},mousemove:function(r){t.whenUsed&&e.entity!==e.activeCameraEntity||s(r.clientX,r.clientY,t,e)},mouseleave:function(t){e.orbitListeners.mouseup(t)},mousewheel:function(r){t.whenUsed&&e.entity!==e.activeCameraEntity||c(r,t,e)},touchstart:function(r){t.whenUsed&&e.entity!==e.activeCameraEntity||a(e.dragButton,1===r.targetTouches.length,t,e),i&&r.preventDefault()},touchend:function(){a(e.dragButton,!1,t,e),r=0},touchmove:function(i){if(!t.whenUsed||e.entity===e.activeCameraEntity){var n,a,h,u=i.targetTouches,l=u[0].clientX,d=u[0].clientY;if(2===u.length){var p=u[1].clientX,f=u[1].clientY;h=(l-p)*(l-p)+(d-f)*(d-f)}else n=l,a=d,s(n,a,t,e);var m=(h-r)/Math.max(e.domElement.offsetHeight,e.domElement.offsetWidth);m/=3,0===r?r=h:2===u.length&&Math.abs(m)>.3&&(o.wheelDelta=m,c(o,t,e),r=h)}}},e.listeners.DOMMouseScroll=e.listeners.mousewheel,e.listeners.mouseleave=e.listeners.mouseup;for(var n in e.listeners)e.domElement.addEventListener(n,e.listeners[n]);e.domElement.oncontextmenu=function(){return!1}}function p(t,e,i){if(i.velocity.lengthSquared()>v){h(i.velocity.x,i.velocity.y,e,i);var o=r.lerp(i.inertia,0,1-t/i.inertia);i.velocity.scale(o)}else i.velocity.setDirect(0,0,0)}function f(t,e){if(e.dirty){var i=e.spherical,n=e.targetSpherical,a=e.lookAtPoint,s=e.goingToLookAt,h=e.cartesian,c=e.entity,l=c.transformComponent,d=l.transform,f=r.lerp(e.smoothness,1,e.world.tpf);s.distanceSquared(a)<v?a.set(s):a.lerp(s,f),e.inertia>0&&p(c._world.tpf,t,e);var m=i,g=n;m.y=r.lerp(f,m.y,g.y),m.z=r.lerp(f,m.z,g.z);var y=m.x;m.x=r.lerp(f,m.x,g.x),y/=m.x,u(y,e),r.sphericalToCartesian(m.x,m.y,m.z,h),d.translation.set(h.add(a)),d.translation.equals(a)||d.lookAt(a,e.worldUpVector),i.distanceSquared(n)<v&&e.lookAtPoint.equals(e.goingToLookAt)&&(m.y=r.moduloPositive(m.y,r.TWO_PI),n.set(i),e.dirty=!1),l.setUpdated(),o.emit("goo.cameraPositionChanged",{spherical:e.spherical.toArray(),translation:d.translation.toArray(),lookAtPoint:e.lookAtPoint.toArray(),id:c.id})}}function m(t,e){for(var r in e.listeners)e.domElement.removeEventListener(r,e.listeners[r])}function g(){return{setup:n,update:f,cleanup:m}}var y=.035,v=1e-6;return g.externals={key:"OrbitCamControlScript",name:"OrbitCamera Control",description:"Enables camera to orbit around a point in 3D space using the mouse",parameters:[{key:"whenUsed","default":!0,name:"When Camera Used",description:"Script only runs when the camera to which it is added is being used.",type:"boolean"},{key:"dragButton",description:"Button to enable dragging","default":"Any",options:["Any","Left","Middle","Right","None"],type:"string",control:"select"},{key:"orbitSpeed","default":.005,type:"float",scale:.001,decimals:3},{key:"zoomSpeed","default":1,type:"float",scale:.1},{key:"drag",name:"Inertia","default":.9,type:"float",control:"slider",min:0,max:1},{key:"smoothness","default":.4,type:"float",min:0,max:1,control:"slider"},{key:"minZoomDistance","default":1,type:"float",min:.01},{key:"maxZoomDistance","default":1e3,type:"float",min:1},{key:"minAscent",description:"Maximum arc the camera can reach below the target point","default":-89.99,type:"float",control:"slider",min:-89.99,max:89.99},{key:"maxAscent",description:"Maximum arc the camera can reach above the target point","default":89.99,type:"float",control:"slider",min:-89.99,max:89.99},{key:"clampAzimuth","default":!1,type:"boolean"},{key:"minAzimuth",description:"Maximum arc the camera can reach clockwise of the target point","default":90,type:"int",control:"slider",min:0,max:360},{key:"maxAzimuth",description:"Maximum arc the camera can reach counter-clockwise of the target point","default":270,type:"int",control:"slider",min:0,max:360},{key:"lookAtDistance",description:"The point to orbit around","default":15,type:"float",min:.001}]},g}(goo.Vector3,goo.Vector2,goo.MathUtils,goo.Camera,goo.SystemBus),goo.TextureGrid=function(t,e){"use strict";function r(e,r){this.matrix=e,this.textureUnitsPerLine=r||8;var o=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]),n=i(e);t.call(this,o,4*n,6*n),this.rebuild()}function i(t){for(var e=0,r=0;r<t.length;r++)e+=t[r].length;return e}function o(t){var e=[],r=t.split("\n");return r.forEach(function(t){var r=t.split(""),i=r.map(function(t){return t.charCodeAt(0)});e.push(i)}),e}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.rebuild=function(){for(var e=[],r=[],i=[],o=[],n=0,a=0;a<this.matrix.length;a++)for(var s=0;s<this.matrix[a].length;s++){e.push(s,-a-1,0,s,-a,0,s+1,-a,0,s+1,-a-1,0),r.push(0,0,1,0,0,1,0,0,1,0,0,1);var h=this.matrix[a][s]%this.textureUnitsPerLine/this.textureUnitsPerLine,u=Math.floor(this.matrix[a][s]/this.textureUnitsPerLine)/this.textureUnitsPerLine;u=1-u,o.push(h,u-1/this.textureUnitsPerLine,h,u,h+1/this.textureUnitsPerLine,u,h+1/this.textureUnitsPerLine,u-1/this.textureUnitsPerLine),i.push(n+3,n+1,n+0,n+2,n+1,n+3),n+=4}return this.getAttributeBuffer(t.POSITION).set(e),this.getAttributeBuffer(t.NORMAL).set(r),this.getAttributeBuffer(t.TEXCOORD0).set(o),this.getIndexBuffer().set(i),this},r.prototype.clone=function(){var t=e.shallowSelectiveClone(this,["matrix","textureUnitsPerLine"]);return new r(t)},r.fromString=function(t){return new r(o(t),16)},r}(goo.MeshData,goo.ObjectUtils),goo.OscillatorSound=function(t,e){"use strict";function r(){this.id=null,this._volume=1,this._frequency=440,this._type="sine",this._outNode=t.getContext().createGain(),this.connectTo()}return r.prototype.stop=function(){this._oscNode.stop(),this._oscNode=null},r.prototype.play=function(){this._oscNode=t.getContext().createOscillator(),this._oscNode.connect(this._outNode),this._oscNode.frequency.value=this._frequency,this._oscNode.type=this._type,this._oscNode.start()},r.prototype.update=function(t){void 0!==t.volume&&(this._volume=e.clamp(t.volume,0,1),this._outNode.gain.value=this._volume),void 0!==t.frequency&&(this._frequency=t.frequency,this._oscNode&&(this._oscNode.frequency.value=this._frequency)),void 0!==t.type&&-1!==r.TYPES.indexOf(t.type)&&(this._type=t.type,this._oscNode&&(this._oscNode.type=this._type))},r.prototype.connectTo=function(e){if(!t.isSupported())return void console.warn("WebAudio not supported");if(this._outNode.disconnect(),e){e instanceof Array||(e=[e]);for(var r=0;r<e.length;r++)this._outNode.connect(e[r])}},r.TYPES=["sine","square","sawtooth","triangle","custom"],r}(goo.AudioContext,goo.MathUtils),goo.ArrayUtil=function(t){return t}(goo.ArrayUtils),goo.EventTarget=function(){"use strict";function t(){this._listenerMap=new Map,this._listenersCopy=[]}return t.prototype.fire=function(t){var e=this._listenerMap.get(t.type);if(e){t.target=this;for(var r=e.length,i=this._listenersCopy,o=0;r>o;o++)i[o]=e[o];for(var o=0;r>o;o++)i[o](t)}return this},t.prototype.on=function(t,e){var r=this._listenerMap.get(t);return r?-1===r.indexOf(e)&&r.push(e):(r=[e],this._listenerMap.set(t,r)),this},t.prototype.off=function(t,e){if(e){var r,i=this._listenerMap.get(t);i&&-1!==(r=i.indexOf(e))&&(i.splice(r,1),0===i.length&&this._listenerMap["delete"](t))}else this._listenerMap["delete"](t);return this},t.prototype.has=function(t){return this._listenerMap.has(t)},t}(),goo.MeshBuilder=function(t,e,r,i){"use strict";function o(){this.meshDatas=[],this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]}o.prototype.addEntity=function(t){t.traverse(function(t){t.transformComponent._dirty&&t.transformComponent.updateTransform()}),t.traverse(function(t){t.transformComponent._dirty&&i.updateWorldTransform(t.transformComponent)});var e=this;t.traverse(function(t){t.meshDataComponent&&e.addMeshData(t.meshDataComponent.meshData,t.transformComponent.worldTransform)})};var n=new r;return o.prototype.addMeshData=function(r,i){if(!e.ElementIndexUInt){if(r.vertexCount>=65536)throw new Error("Maximum number of vertices for a mesh to add is 65535. Got: "+r.vertexCount);this.vertexCounter+r.vertexCount>=65536&&this._generateMesh()}for(var o=i.matrix,a=i.rotation,s=r.attributeMap,h=Object.keys(s),u=0,c=h.length;c>u;u++){var l=h[u],d=s[l],p=this.vertexData[l];p||(this.vertexData[l]={},p=this.vertexData[l],p.array=[],p.map={count:d.count,type:d.type,stride:d.stride,offset:d.offset,normalized:d.normalized});var f=r.getAttributeBuffer(l),m=f.length,g=p.array,y=d.count,v=this.vertexCounter*y;if(l===t.POSITION)for(var x=0;m>x;x+=y)n.setDirect(f[x+0],f[x+1],f[x+2]),n.applyPostPoint(o),g[v+x+0]=n.x,g[v+x+1]=n.y,g[v+x+2]=n.z;else if(l===t.NORMAL)for(var x=0;m>x;x+=y)n.setDirect(f[x+0],f[x+1],f[x+2]),n.applyPost(a),g[v+x+0]=n.x,g[v+x+1]=n.y,g[v+x+2]=n.z;else if(l===t.TANGENT)for(var x=0;m>x;x+=y)n.setDirect(f[x+0],f[x+1],f[x+2]),n.applyPost(a),g[v+x+0]=n.x,g[v+x+1]=n.y,g[v+x+2]=n.z,g[v+x+3]=f.w;else for(var x=0;m>x;x++)g[v+x]=f[x]}for(var w=r.getIndexBuffer(),x=0,c=r.indexCount;c>x;x++)this.indexData[this.indexCounter+x]=w[x]+this.vertexCounter;this.vertexCounter+=r.vertexCount,this.indexCounter+=r.indexCount,r.indexLengths?this.indexLengths=this.indexLengths.concat(r.indexLengths):this.indexLengths=this.indexLengths.concat(r.getIndexBuffer().length),this.indexModes=this.indexModes.concat(r.indexModes)},o.prototype._generateMesh=function(){var e={};for(var r in this.vertexData){var i=this.vertexData[r];e[r]=i.map}var o=new t(e,this.vertexCounter,this.indexCounter);for(var r in this.vertexData){var i=this.vertexData[r].array;o.getAttributeBuffer(r).set(i)}o.getIndexBuffer().set(this.indexData),o.indexLengths=this.indexLengths,o.indexModes=this.indexModes;for(var n=o.indexModes[0],a=0,s=[],h=[],u=0;u<o.indexModes.length;u++){var c=o.indexModes[u];n!==c&&(s.push(n),h.push(a),n=c,a=0),a+=o.indexLengths[u],u===o.indexModes.length-1&&(s.push(c),h.push(a),n=c,a=0)}o.indexLengths=h,o.indexModes=s,this.meshDatas.push(o),this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]},o.prototype.build=function(){return this.vertexCounter>0&&this._generateMesh(),this.meshDatas},o.prototype.reset=function(){this.meshDatas=[],this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]},o}(goo.MeshData,goo.Capabilities,goo.Vector3,goo.EntityUtils),goo.Rc4Random=function(){"use strict";function t(t){function e(){i=(i+1)%256,o=(o+r[i])%256;var t=r[i];return r[i]=r[o],r[o]=t,r[(r[i]+r[o])%256]}var r=[],i=0,o=0;this.init=function(t){for(var e=0;256>e;e++)r[e]=e;for(var i=0,e=0;256>e;e++){i=(i+r[e]+t.charCodeAt(e%t.length))%256;var o=r[e];r[e]=r[i],r[i]=o}},this.init(t),this.getRandomNumber=function(){for(var t=0,r=1,i=0;8>i;i++)t+=e()*r,r*=256;return t/0x10000000000000000}}return t}(),goo.StringUtil=function(t){return t}(goo.StringUtils),goo.SoundCreator=function(t,e,r,i,o){"use strict";function n(){var e=this.ajax=new r;this.soundHandler=new t({},function(t,r){return e.load(t,r?r.noCache:!1)},function(){},function(t,r){return e.load(t,r?r.noCache:!1)})}return n.prototype.clear=function(){this.ajax.clear(),this.soundHandler.clear()},n.prototype.loadSound=function(t,r){if(!e.isSupported())return o.reject(new Error("AudioContext is not supported!"));var n=i.createUniqueId("sound");r=r||{},r.audioRefs={};var a=i.getAfterLast(t,".");r.audioRefs[a]=t;var s=this.soundHandler._create();return this.soundHandler._objects.set(n,s),this.soundHandler.update(n,r,{})},n}(goo.SoundHandler,goo.AudioContext,goo.Ajax,goo.StringUtils,goo.PromiseUtils),goo.TWEEN=function(){"use strict";var t=function(){var t=[];return{REVISION:"10",getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var r=t.indexOf(e);-1!==r&&t.splice(r,1)},update:function(e){if(0===t.length)return!1;var r=0,i=t.length;for(e=void 0!==e?e:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();i>r;)t[r].update(e)?r++:(t.splice(r,1),i--);return!0}}}();return t.Tween=function(e){var r=e,i={},o={},n={},a=1e3,s=0,h=0,u=null,c=t.Easing.Linear.None,l=t.Interpolation.Linear,d=[],p=null,f=!1,m=null,g=null;for(var y in e)i[y]=parseFloat(e[y],10);this.from=function(t){r=t;for(var e in t)i[e]=parseFloat(t[e],10);return this},this.to=function(t,e){return void 0!==e&&(a=e),o=t,this},this.start=function(e){t.add(this),f=!1,u=void 0!==e?e:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),u+=h;for(var a in o){if(o[a]instanceof Array){if(0===o[a].length)continue;o[a]=[r[a]].concat(o[a])}i[a]=r[a],i[a]instanceof Array==!1&&(i[a]*=1),n[a]=i[a]||0}return this},this.stop=function(){return t.remove(this),this},this.delay=function(t){return h=t,this},this.repeat=function(t){return s=t,this},this.easing=function(t){return c=t,this},this.interpolation=function(t){return l=t,this},this.chain=function(){return d=arguments,this},this.onStart=function(t){return p=t,this},this.onUpdate=function(t){return m=t,this},this.onComplete=function(t){return g=t,this},this.update=function(t){if(u>t)return!0;f===!1&&(null!==p&&p.call(r),f=!0);var e=(t-u)/a;e=e>1?1:e;var y=c(e);for(var v in o){var x=i[v]||0,w=o[v];w instanceof Array?r[v]=l(w,y):("string"==typeof w&&(w=x+parseFloat(w,10)),r[v]=x+(w-x)*y)}if(null!==m&&m.call(r,y),1==e){if(s>0){isFinite(s)&&s--;for(var v in n)"string"==typeof o[v]&&(n[v]=n[v]+parseFloat(o[v],10)),i[v]=n[v];return u=t+h,!0}null!==g&&g.call(r);for(var _=0,b=d.length;b>_;_++)d[_].start(t);return!1}return!0}},t.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,r=.1,i=.4;return 0===t?0:1===t?1:(!r||1>r?(r=1,e=i/4):e=i*Math.asin(1/r)/(2*Math.PI),-(r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)))},Out:function(t){var e,r=.1,i=.4;return 0===t?0:1===t?1:(!r||1>r?(r=1,e=i/4):e=i*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/i)+1)},InOut:function(t){var e,r=.1,i=.4;return 0===t?0:1===t?1:(!r||1>r?(r=1,e=i/4):e=i*Math.asin(1/r)/(2*Math.PI),(t*=2)<1?-.5*(r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)):r*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)*.5+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(e){return 1-t.Easing.Bounce.Out(1-e)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(e){return.5>e?.5*t.Easing.Bounce.In(2*e):.5*t.Easing.Bounce.Out(2*e-1)+.5}}},t.Interpolation={Linear:function(e,r){var i=e.length-1,o=i*r,n=Math.floor(o),a=t.Interpolation.Utils.Linear;return 0>r?a(e[0],e[1],o):r>1?a(e[i],e[i-1],i-o):a(e[n],e[n+1>i?i:n+1],o-n)},Bezier:function(e,r){var i,o=0,n=e.length-1,a=Math.pow,s=t.Interpolation.Utils.Bernstein;for(i=0;n>=i;i++)o+=a(1-r,n-i)*a(r,i)*e[i]*s(n,i);return o},CatmullRom:function(e,r){var i=e.length-1,o=i*r,n=Math.floor(o),a=t.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(0>r&&(n=Math.floor(o=i*(1+r))),a(e[(n-1+i)%i],e[n],e[(n+1)%i],e[(n+2)%i],o-n)):0>r?e[0]-(a(e[0],e[0],e[1],e[1],-o)-e[0]):r>1?e[i]-(a(e[i],e[i],e[i-1],e[i-1],o-i)-e[i]):a(e[n?n-1:0],e[n],e[n+1>i?i:n+1],e[n+2>i?i:n+2],o-n)},Utils:{Linear:function(t,e,r){return(e-t)*r+t},Bernstein:function(e,r){var i=t.Interpolation.Utils.Factorial;return i(e)/i(r)/i(e-r)},Factorial:function(){var t=[1];return function(e){var r,i=1;if(t[e])return t[e];for(r=e;r>1;r--)i*=r;return t[e]=i}}(),CatmullRom:function(t,e,r,i,o){var n=.5*(r-t),a=.5*(i-e),s=o*o,h=o*s;return(2*e-2*r+n+a)*h+(-3*e+3*r-2*n-a)*s+n*o+e}}},window.TWEEN=t,t}(),goo.CssTransformComponent=function(t){"use strict";function e(e,r){t.apply(this,arguments),this.type="CssTransformComponent",this.domElement=e,this.scale=1,this.faceCamera="undefined"==typeof r?!1:r}return e.type="CssTransformComponent",e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(goo.Component),goo.Dom3dComponent=function(t,e,r,i){"use strict";function o(o,n){t.apply(this,arguments),this.type="Dom3dComponent",n=n||{},this.hidden=!1,this.width=n.width||500,this.height=n.height||500,this.backfaceVisibility=n.backfaceVisibility||"hidden",this.updated=!0,this.entity=null,this.initDom(o),this.meshData=new e(1,1),this.meshDataComponent=new i(this.meshData),this.meshRendererComponent=new r}return o.type="Dom3dComponent",o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.attached=function(t){t.setComponent(this.meshDataComponent),t.setComponent(this.meshRendererComponent)},o.prototype.detached=function(t){null!==this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),t.clearComponent("meshRendererComponent"),t.clearComponent("meshDataComponent")},o.prototype.initDom=function(t){this.domElement&&null!==this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.domElement=document.createElement("div"),t&&(t.style.width||(t.style.width="100%"),t.style.height||(t.style.height="100%"),this.domElement.appendChild(t)),this.domElement.style.position="absolute",this.domElement.style.margin="0px",this.domElement.style.padding="0px",this.domElement.style.backgroundColor="white",this.domElement.style.backfaceVisibility=this.backfaceVisibility,
this.domElement.style.overflow="hidden",this.setSize(this.width,this.height)},o.prototype.setSize=function(t,e){this.width=t||this.width,this.height=e||this.height,this.domElement.style.width=this.width+"px",this.domElement.style.height=this.height+"px"},o.prototype.destroy=function(t){this.meshData.destroy(t)},o}(goo.Component,goo.Quad,goo.MeshRendererComponent,goo.MeshDataComponent),goo.MovementComponent=function(t,e){"use strict";function r(){e.apply(this,arguments),this.type="MovementComponent",this.velocity=new t,this.rotationVelocity=new t}return r.type="MovementComponent",r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.addVelocity=function(t){this.velocity.add(t)},r.prototype.setVelocity=function(t){this.velocity.set(t)},r.prototype.getVelocity=function(){return this.velocity},r.prototype.addRotationVelocity=function(t){this.rotationVelocity.add(t)},r.prototype.setRotationVelocity=function(t){this.rotationVelocity.set(t)},r.prototype.getRotationVelocity=function(){return this.rotationVelocity},r}(goo.Vector3,goo.Component),goo.PortalComponent=function(t,e){"use strict";function r(r,i,o,n){t.apply(this,arguments),i=i||200,this.options=o||{},this.options.preciseRecursion=!!this.options.preciseRecursion,this.options.autoUpdate=this.options.autoUpdate!==!1,this.options.alwaysRender=!!this.options.alwaysRender,this.overrideMaterial=n,this.doUpdate=!0;var a=r.aspect;this.type="PortalComponent",this.camera=r,this.target=new e(i,i/a),this.options.preciseRecursion&&(this.secondaryTarget=new e(i,i/a))}return r.type="PortalComponent",r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.requestUpdate=function(){this.doUpdate=!0},r}(goo.Component,goo.RenderTarget),goo.TextComponent=function(t){"use strict";function e(e){t.apply(this,arguments),this.type="TextComponent",this.text=e||"",this.dirty=!0}return e.type="TextComponent",e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.setText=function(t){return this.text=t,this.dirty=!0,this},e}(goo.Component,goo.TextureGrid,goo.MeshDataComponent),goo.HtmlSystem=function(t,e,r,i,o){"use strict";function n(e){t.call(this,"HtmlSystem",["TransformComponent","HtmlComponent"]),this.renderer=e,this.prefixes=["","-webkit-"],this.styleCache=new Map}n.prototype=Object.create(t.prototype),n.prototype.constructor=n;var a=2147483647,s=new o;return n.prototype.setStyle=function(t,e,r){var i=this.styleCache.get(t);if(r!==i){for(var o=0;o<this.prefixes.length;o++)t.style[this.prefixes[o]+e]=r;this.styleCache.set(t,r)}},n.prototype.process=function(t){if(0!==t.length)for(var r=e.mainCamera,i=this.renderer.domElement.width,o=this.renderer.domElement.height,n=0;n<t.length;n++){var h=t[n],u=h.htmlComponent;if(u.useTransformComponent)if(u.hidden)u.domElement.style.display="none";else if(s.set(r.translation).sub(h.transformComponent.worldTransform.translation),r._direction.dot(s)>0)u.domElement.style.display="none";else if(r.getScreenCoordinates(h.transformComponent.worldTransform.translation,i,o,s),s.z<0)u.hidden!==!0&&(u.domElement.style.display="none");else{u.domElement.style.display="";var c=this.renderer,l=c._useDevicePixelRatio&&window.devicePixelRatio?window.devicePixelRatio/c.svg.currentScale:1,d=Math.floor(s.x/l),p=Math.floor(s.y/l);this.setStyle(u.domElement,"transform","translate(-50%, -50%) translate("+d+"px, "+p+"px)translate("+c.domElement.offsetLeft+"px, "+c.domElement.offsetTop+"px)"),u.domElement.style.zIndex=a-Math.round(s.z*a)}else u.domElement.style.display=u.hidden?"none":"",this.setStyle(u.domElement,"transform","")}},n.prototype.deleted=function(t){if(t&&t.htmlComponent){var e=t.htmlComponent;e.domElement.parentNode&&e.domElement.parentNode.removeChild(e.domElement),e.domElement=null}},n}(goo.System,goo.Renderer,goo.Matrix4,goo.MathUtils,goo.Vector3),goo.Dom3dSystem=function(t,e,r,i,o,n,a,s,h,u){"use strict";function c(r){t.call(this,"Dom3dSystem",["TransformComponent","Dom3dComponent"]),this.renderer=r,this.camera=null,e.addListener("goo.setCurrentCamera",function(t){this.camera=t.camera}.bind(this),!0),this.playing=!0;var n=new i(o.simple);n.blendState.blending="CustomBlending",n.blendState.blendSrc="ZeroFactor",n.blendState.blendDst="ZeroFactor";var a=new i(o.uber);a.uniforms.materialDiffuse=[.5,.5,.5,1],a.cullState.cullFace="Front",this.materials=[n,a],this.prefixes=["","-webkit-"],this.styleCache=new Map,this.precisionScale=1e3}return c.prototype=Object.create(t.prototype),c.prototype.constructor=c,c.prototype.init=function(){var t=new h,r=[new s,new s,new s,new s],i=[new s(-.5,-.5,0),new s(-.5,.5,0),new s(.5,.5,0),new s(.5,-.5,0)],o=!1,n=!1,a=this,u=function(e){var n,s,h=a.renderer.domElement;if("touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type)n=e.changedTouches[0].pageX-h.getBoundingClientRect().left,s=e.changedTouches[0].pageY-h.getBoundingClientRect().top;else{var u=h.getBoundingClientRect();n=e.clientX-u.left,s=e.clientY-u.top}a.camera.getPickRay(n,s,a.renderer.domElement.offsetWidth,a.renderer.domElement.offsetHeight,t);for(var c=0;c<a._activeEntities.length;c++){for(var l=a._activeEntities[c],d=0;d<r.length;d++){var p=r[d];p.set(i[d]),p.applyPostPoint(l.transformComponent.worldTransform.matrix)}if(t.intersects(r,o,null,!0))return!0}return!1},c=function(t){if(!a.camera||0===a._activeEntities.length)return!1;var r=u(t);r&&!n?(e.emit("goo.dom3d.enabled",!0),a.renderer.domElement.style.pointerEvents="none",n=!0):!r&&n&&(e.emit("goo.dom3d.enabled",!1),a.renderer.domElement.style.pointerEvents="",n=!1)},l=!1;document.addEventListener("mousedown",function(t){a.camera&&0!==a._activeEntities.length&&(l=!u(t))},!1),document.addEventListener("mouseup",function(t){a.camera&&0!==a._activeEntities.length&&(l=!1,a.playing&&c(t))},!1),document.addEventListener("mousemove",function(t){!l&&a.camera&&0!==a._activeEntities.length&&a.playing&&c(t)},!1);var d=this.rootDom=document.createElement("div");this.renderer.domElement.parentNode.insertBefore(d,this.renderer.domElement),d.style.position="absolute",d.style.overflow="hidden",d.style.webkitUserSelect="none",d.style.mozUserSelect="none",d.style.msUserSelect="none",d.style.transformStyle="preserve-3d",d.style.width="100%",d.style.height="100%",d.style.top="0px",d.style.bottom="0px",d.style.left="0px",d.style.right="0px";var p=this.cameraDom=document.createElement("div");p.style.webkitUserSelect="none",p.style.mozUserSelect="none",p.style.msUserSelect="none",p.style.transformStyle="preserve-3d",p.style.width="100%",p.style.height="100%",d.appendChild(p)},c.prototype.play=function(){this.playing=!0},c.prototype.pause=function(){},c.prototype.resume=c.prototype.play,c.prototype.stop=function(){this.playing=!1,e.emit("goo.dom3d.enabled",!1),this.renderer.domElement&&(this.renderer.domElement.style.pointerEvents="")},c.prototype.getCameraCSSMatrix=function(t){var e=t.data;return"matrix3d("+e[0]+","+-e[1]+","+e[2]+","+e[3]+","+e[4]+","+-e[5]+","+e[6]+","+e[7]+","+e[8]+","+-e[9]+","+e[10]+","+e[11]+","+e[12]*this.precisionScale+","+-e[13]*this.precisionScale+","+e[14]*this.precisionScale+","+e[15]+")"},c.prototype.getEntityCSSMatrix=function(t){var e=t.data;return"translate3d(-50%,-50%,0) matrix3d("+e[0]+","+e[1]+","+e[2]+","+e[3]+","+-e[4]+","+-e[5]+","+-e[6]+","+-e[7]+","+e[8]+","+e[9]+","+e[10]+","+e[11]+","+e[12]*this.precisionScale+","+e[13]*this.precisionScale+","+e[14]*this.precisionScale+","+e[15]+")"},c.prototype.setStyle=function(t,e,r){var i=this.styleCache.get(t);if(r!==i){for(var o=0;o<this.prefixes.length;o++)t.style[this.prefixes[o]+e]=r;this.styleCache.set(t,r)}},c.prototype.inserted=function(t){var e=t.dom3dComponent;e.meshRendererComponent.materials=this.materials},c.prototype.process=function(t){var e=this.camera;if(e&&0!==t.length){this.renderer.domElement.parentNode&&!this.rootDom&&this.init();var r=this.renderer.viewportWidth/this.renderer.devicePixelRatio,i=this.renderer.viewportHeight/this.renderer.devicePixelRatio,o=.5/Math.tan(u.DEG_TO_RAD*e.fov*.5)*i;this.setStyle(this.rootDom,"perspective",o+"px");var n=e.getViewMatrix(),a="translate3d(0,0,"+o+"px) "+this.getCameraCSSMatrix(n)+" translate3d("+r/2+"px,"+i/2+"px, 0)";this.setStyle(this.cameraDom,"transform",a);for(var s=0,h=t.length;h>s;s++){var c=t[s],l=c.dom3dComponent,d=l.domElement;if(d.parentNode!==this.cameraDom&&this.cameraDom.appendChild(d),l.hidden)l.domElement.style.display="none";else if(l.domElement.style.display="",l.updated||c.transformComponent._updated){l.updated=!1;var p=c.transformComponent.worldTransform;a=this.getEntityCSSMatrix(p.matrix)+" scale("+this.precisionScale/l.width+", "+this.precisionScale/l.height+")",this.setStyle(d,"transform",a)}}}},c.prototype.cleanup=function(){t.prototype.cleanup.apply(this,arguments),null!==this.rootDom.parentNode&&this.rootDom.parentNode.removeChild(this.rootDom)},c}(goo.System,goo.SystemBus,goo.Renderer,goo.Material,goo.ShaderLib,goo.Quad,goo.Matrix4x4,goo.Vector3,goo.Ray,goo.MathUtils),goo.GridRenderSystem=function(t,e,r,i,o,n,a,s,h,u,c){"use strict";function l(){t.call(this,"GridRenderSystem",[]),this.renderList=[],this.doRender={grid:!0},this.scale=62.5,this.count=100,this.camera=null,this.lights=[],this.transform1=new h,this.transform1.rotation.rotateX(-Math.PI/2),this.transform1.scale.setDirect(this.scale,this.scale,this.scale),this.transform1.update(),this.transform2=new h,this.transform2.rotation.rotateX(-Math.PI/2),this.transform2.scale.setDirect(this.scale,this.scale,this.scale),this.transform2.update();var r=.2,i=new o(p,"Grid Material");i.blendState.blending="TransparencyBlending",i.uniforms.color=[r,r,r,1],i.depthState.write=!1,i.depthState.enabled=!0;var n=new o(p,"Grid Material");n.blendState.blending="TransparencyBlending",n.uniforms.color=[r,r,r,1],n.depthState.write=!1,n.depthState.enabled=!0;var a=new c(this.count,this.count);this.grid1={meshData:a,materials:[i],transform:this.transform1},this.grid2={meshData:a,materials:[n],transform:this.transform2},this.oldHeightScale1=0,this.oldX1=0,this.oldZ1=0,this.oldHeightScale1=0,this.oldX1=0,this.oldZ1=0;var s=this;e.addListener("goo.setCurrentCamera",function(t){s.camera=t.camera}),e.addListener("goo.setLights",function(t){s.lights=t})}function d(t,e){for(var r=0;e>r;++r)t=Math.pow(t,2)*(3-2*t);return t}l.prototype=Object.create(t.prototype),l.prototype.constructor=l,l.prototype.inserted=function(){},l.prototype.deleted=function(){},l.prototype.process=function(){if(this.doRender.grid){var t=Math.max(Math.abs(this.camera.translation.y)/10,0),e=Math.pow(t,.15),r=1-2*Math.abs(e-Math.floor(e)-.5);r=Math.min(2*r,1);var i=Math.pow(2,4*Math.floor(e)+2)*this.scale,o=Math.pow(t,.15)+.5,n=1-2*Math.abs(o-Math.floor(o)-.5);n=Math.min(2*n,1);var a=Math.pow(2,4*Math.floor(o))*this.scale;r=d(r,1),n=d(n,1),this.grid1.materials[0].uniforms.scale=i,this.grid1.materials[0].uniforms.opacity=r,this.grid2.materials[0].uniforms.scale=a,this.grid2.materials[0].uniforms.opacity=n;var s=Math.floor(this.camera.translation.x*this.count/i),h=Math.floor(this.camera.translation.z*this.count/i);(i!==this.oldHeightScale1||s!==this.oldX1||h!==this.oldZ1)&&(this.transform1.scale.setDirect(i,i,i),this.transform1.translation.x=s*i/this.count,this.transform1.translation.z=h*i/this.count,this.transform1.update(),this.oldX1=s,this.oldZ1=h,this.oldHeightScale1=i),s=Math.floor(this.camera.translation.x*this.count/a),h=Math.floor(this.camera.translation.z*this.count/a),(a!==this.oldHeightScale2||s!==this.oldX2||h!==this.oldZ2)&&(this.transform2.scale.setDirect(a,a,a),this.transform2.translation.x=s*a/this.count,this.transform2.translation.z=h*a/this.count,this.transform2.update(),this.oldX2=s,this.oldZ2=h,this.oldHeightScale2=a),r>n?(this.renderList[0]=this.grid1,this.renderList[1]=this.grid2):(this.renderList[0]=this.grid2,this.renderList[1]=this.grid1)}},l.prototype.render=function(t){t.checkResize(this.camera),this.camera&&this.doRender.grid&&t.render(this.renderList,this.camera,this.lights,null,!1)},l.prototype.invalidateHandles=function(t){this.renderList.forEach(function(e){e.materials.forEach(function(e){t.invalidateMaterial(e)}),t.invalidateMeshData(e.meshData)})};var p={attributes:{vertexPosition:i.POSITION},uniforms:{viewMatrix:n.VIEW_MATRIX,projectionMatrix:n.PROJECTION_MATRIX,worldMatrix:n.WORLD_MATRIX,color:[.55,.55,.55,1],fogNear:n.NEAR_PLANE,fogFar:n.FAR_PLANE,opacity:1,scale:1},vshader:["attribute vec3 vertexPosition;","uniform mat4 worldMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying float depth;","void main(void) {","vec4 viewPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","depth = -viewPosition.z;","gl_Position = projectionMatrix * viewPosition;","}"].join("\n"),fshader:["precision mediump float;","uniform vec4 color;","uniform float fogNear;","uniform float fogFar;","uniform float opacity;","uniform float scale;","varying float depth;","void main(void) {","gl_FragColor = color;","float lerpVal = 1.0 - clamp(depth * 3.0 / min(scale, fogFar * 3.0), 0.0, 1.0);","gl_FragColor.a = opacity * lerpVal;","}"].join("\n")};return l}(goo.System,goo.SystemBus,goo.SimplePartitioner,goo.MeshData,goo.Material,goo.Shader,goo.ShaderLib,goo.ObjectUtils,goo.Transform,goo.MathUtils,goo.Grid),goo.MovementSystem=function(t){"use strict";function e(){t.call(this,"MovementSystem",["MovementComponent"])}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.addVelocityToTransform=function(t,e,r){e.translation.addDirect(t.x*r,t.y*r,t.z*r)},e.prototype.addRotToTransform=function(t,e,r){e.rotation.rotateX(t.x*r),e.rotation.rotateY(t.y*r),e.rotation.rotateZ(t.z*r)},e.prototype.applyMovementToEntity=function(t){var e=t._world.tpf,r=t.movementComponent.getRotationVelocity(),i=t.movementComponent.getVelocity(),o=t.transformComponent.transform;this.addVelocityToTransform(i,o,e),this.addRotToTransform(r,o,e),t.transformComponent.setUpdated()},e.prototype.process=function(t){for(var e=0;e<t.length;e++)this.applyMovementToEntity(t[e])},e}(goo.System),goo.PickingSystem=function(t){"use strict";function e(e){t.call(this,"PickingSystem",["MeshRendererComponent","TransformComponent"]),this.passive=!0,this.pickRay=null,this.onPick=null,e=e||{},this.setPickLogic(e.pickLogic||null)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.setPickLogic=function(t){this.pickLogic=t,t&&-1===this.interests.indexOf("MeshDataComponent")&&this.interests.push("MeshDataComponent")},e.prototype.inserted=function(t){t.meshRendererComponent.isPickable&&this.pickLogic&&this.pickLogic.added(t)},e.prototype.deleted=function(t){this.pickLogic&&this.pickLogic.removed(t)},e.prototype.process=function(t){if(this.pickRay&&this.onPick){for(var e=[],r=0;r<t.length;r++){var i=t[r],o=i.meshRendererComponent;if(o.isPickable)if(this.pickLogic){this.pickLogic.isConstructed(i)||this.pickLogic.added(i);var n=this.pickLogic.getPickResult(this.pickRay,i);n&&n.distances&&n.distances.length&&e.push({entity:i,intersection:n})}else if(o.worldBound){var n=o.worldBound.intersectsRayWhere(this.pickRay);n&&n.distances.length&&e.push({entity:i,intersection:n})}}e.sort(function(t,e){return t.intersection.distances[0]-e.intersection.distances[0]}),this.onPick(e)}},e}(goo.System),goo.PortalSystem=function(t){"use strict";function e(e,r){t.call(this,"PortalSystem",["MeshRendererComponent","MeshDataComponent","PortalComponent"]),this.renderer=e,this.renderSystem=r,this.renderList=[]}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.process=function(t){for(var e=0;e<t.length;e++){var r=t[e],i=r.portalComponent;if(i.options.autoUpdate||i.doUpdate){i.doUpdate=!1;var o=i.camera,n=i.target,a=i.secondaryTarget,s=i.overrideMaterial;if(i.alwaysRender||r.isVisible){this.render(this.renderer,o,n,s);var h=r.meshRendererComponent.materials[0];if(h.setTexture("DIFFUSE_MAP",n),i.options.preciseRecursion){var u=n;i.target=a,i.secondaryTarget=u}}}}},e.prototype.render=function(t,e,r,i){t.updateShadows(this.renderSystem.partitioner,this.renderSystem.entities,this.renderSystem.lights);for(var o=0;o<this.renderSystem.preRenderers.length;o++){var n=this.renderSystem.preRenderers[o];n.process(t,this.renderSystem.entities,this.renderSystem.partitioner,e,this.renderSystem.lights)}if(this.renderSystem.partitioner.process(e,this.renderSystem.entities,this.renderList),this.renderSystem.composers.length>0)for(var o=0;o<this.renderSystem.composers.length;o++){var a=this.renderSystem.composers[o];a.render(t,this.renderSystem.currentTpf,e,this.renderSystem.lights,null,!0)}else t.render(this.renderList,e,this.renderSystem.lights,r,!0,i)},e}(goo.System),goo.TextSystem=function(t,e,r){"use strict";function i(){t.call(this,"TextSystem",["TextComponent"])}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.process=function(t){for(var i=0;i<t.length;i++){var o=t[i],n=o.textComponent;if(n.dirty){if(o.hasComponent("MeshDataComponent"))o.getComponent("MeshDataComponent").meshData=e.fromString(n.text);else{var a=e.fromString(n.text),s=new r(a);o.setComponent(s)}this.dirty=!1}}},i}(goo.System,goo.TextureGrid,goo.MeshDataComponent),goo.CssTransformSystem=function(t,e,r,i,o){"use strict";function n(e){t.call(this,"CssTransformSystem",["TransformComponent","CssTransformComponent"]),this.renderer=e,document.querySelector&&(this.viewDom=document.querySelector("#view"),this.containerDom=document.querySelector("#cam1"),this.containerDom2=document.querySelector("#cam2"))}var a=new r,s=new r,h=new o;n.prototype=Object.create(t.prototype),n.prototype.constructor=n;var u=function(t){return Math.abs(t)<1e-6?0:t},c=["","-webkit-","-moz-","-ms-","-o-"],l=function(t,e,r){for(var i=0;i<c.length;i++)t.style[c[i]+e]=r},d=function(t){var e=t.data;return"matrix3d("+u(e[0])+","+u(-e[1])+","+u(e[2])+","+u(e[3])+","+u(e[4])+","+u(-e[5])+","+u(e[6])+","+u(e[7])+","+u(e[8])+","+u(-e[9])+","+u(e[10])+","+u(e[11])+","+u(e[12])+","+u(-e[13])+","+u(e[14])+","+u(e[15])+")"};return n.prototype.process=function(t){if(0!==t.length){var r=e.mainCamera;if(r){var n=.5/Math.tan(i.DEG_TO_RAD*r.fov*.5)*this.renderer.domElement.offsetHeight;l(this.viewDom,"perspective",n+"px"),a.copy(r.getViewInverseMatrix()),s.copy(a),a.invert(),a.setTranslation(new o(0,0,n));var u=d(a);l(this.containerDom,"transform",u),s.e03=-s.e03,s.e23=-s.e23,s.data[0]=1,s.data[1]=0,s.data[2]=0,s.data[4]=0,s.data[5]=1,s.data[6]=0,s.data[8]=0,s.data[9]=0,s.data[10]=1,u=d(s),l(this.containerDom2,"transform",u);for(var c=0;c<t.length;c++){var p=t[c],f=p.getComponent("CssTransformComponent"),m=f.domElement,g=f.scale;g=[g,-g,g].join(","),f.faceCamera?(p.transformComponent.worldTransform.matrix.getTranslation(h),a.copy(r.getViewInverseMatrix()),a.setTranslation(h)):a.copy(p.transformComponent.worldTransform.matrix),u="translate3d(-50%,-50%,0) "+d(a)+"scale3d("+g+")",l(m,"transform",u),m.parentNode!==this.containerDom2&&this.containerDom2.appendChild(m)}}}},n}(goo.System,goo.Renderer,goo.Matrix4,goo.MathUtils,goo.Vector3),goo.Spline=function(t,e,r){"use strict";function i(t){this.controlPoints=t,this.segments=(this.controlPoints.length-1)/3}return function(){var o=new r,n=new r,a=new r,s=new e,h=new e,u=new e,c=new t,l=new t,d=new t;i.quadraticInterpolation=function(i,p,f,m,g){var y=m*m,v=1-m,x=v*v;g instanceof r?(i.copyTo(o),o.scale(x),p.copyTo(n),n.scale(v*m*2),f.copyTo(a),a.scale(y),g.set(o).add(n).add(a)):g instanceof e?(i.copyTo(s),s.scale(x),p.copyTo(h),h.scale(v*m*2),f.copyTo(u),u.scale(y),g.set(s).add(h).add(u)):g instanceof t&&(i.copyTo(c),c.scale(x),p.copyTo(l),l.scale(v*m*2),f.copyTo(d),d.scale(y),g.set(c).add(l).add(d))}}(),function(){var o=new r,n=new r,a=new r,s=new r,h=new e,u=new e,c=new e,l=new e,d=new t,p=new t,f=new t,m=new t;i.cubicInterpolation=function(i,g,y,v,x,w){var _=x*x,b=_*x,S=1-x,M=S*S,E=M*S;w instanceof r?(i.copyTo(o),o.scale(E),g.copyTo(n),n.scale(M*x*3),y.copyTo(a),a.scale(S*_*3),v.copyTo(s),s.scale(b),w.set(o).add(n).add(a).add(s)):w instanceof e?(i.copyTo(h),h.scale(E),g.copyTo(u),u.scale(M*x*3),y.copyTo(c),c.scale(S*_*3),v.copyTo(l),l.scale(b),w.set(h).add(u).add(c).add(l)):w instanceof t&&(i.copyTo(d),d.scale(E),g.copyTo(p),p.scale(M*x*3),y.copyTo(f),f.scale(S*_*3),v.copyTo(m),m.scale(b),w.set(d).add(p).add(f).add(m))}}(),i.prototype.getPoint=function(t,e){if(0>=t)return void e.set(this.controlPoints[0]);if(t>=1)return void e.set(this.controlPoints[this.controlPoints.length-1]);var r=this.segments*t,o=Math.floor(r),n=r-o,a=this.controlPoints[3*o+0],s=this.controlPoints[3*o+1],h=this.controlPoints[3*o+2],u=this.controlPoints[3*o+3];i.cubicInterpolation(a,s,h,u,n,e)},i}(goo.Vector2,goo.Vector3,goo.Vector4),goo.SplineWalker=function(t){"use strict";function e(t,e){this.substepSize=e||.01,this._spline=t,this._segment=0,this._localT=0,this._pointer=t.controlPoints[0].clone()}return e.prototype._localInterpolation=function(e){var r=this._spline.controlPoints[3*this._segment+0],i=this._spline.controlPoints[3*this._segment+1],o=this._spline.controlPoints[3*this._segment+2],n=this._spline.controlPoints[3*this._segment+3];t.cubicInterpolation(r,i,o,n,this._localT,e)},e.prototype._step=function(t,e){return this._localT+=t,this._localT>1&&(this._localT-=1,this._segment++,this._segment>=this._spline.segments)?void e.copy(this._spline.controlPoints[this._spline.controlPoints.length-1]):void this._localInterpolation(e)},e.prototype.advance=function(t,e){for(var r=0;t>r&&this._segment<this._spline.segments;)this._step(this.substepSize,e),r+=this._pointer.distance(e),this._pointer.copy(e)},e.prototype.canWalk=function(){return this._segment<this._spline.segments},e}(goo.Spline),goo.Dom3dComponentHandler=function(t,e,r,i){"use strict";function o(){t.apply(this,arguments),this._type="Dom3dComponent"}function n(t){return"__"+t.replace(a,"-")}o.prototype=Object.create(t.prototype),t._registerClass("dom3d",o),o.prototype.constructor=o,o.prototype._prepare=function(){},o.prototype._create=function(){return new e};var a=/\W/g;return o.prototype.update=function(e,o,a){var s=this;return t.prototype.update.call(this,e,o,a).then(function(t){function h(t,e){return s.loadObject(e,a).then(function(e){return t.src=e.src,t},function(e){return console.error(e),delete t.src,t})}if(t){var u=n(e.id),c=t.domElement;c||(c=document.createElement("div"),c.id=u,c.className="goo-entity",t.initDom(c)),t.setSize(void 0!==o.width?o.width:500,void 0!==o.height?o.height:500);var l=o.innerHtml!==c.prevInnerHtml,d=o.style!==c.prevStyle;if(c.prevInnerHtml=o.innerHtml,c.prevStyle=o.style,e.meshRendererComponent!==t.meshRendererComponent&&e.setComponent(t.meshRendererComponent),e.meshDataComponent!==t.meshDataComponent&&e.setComponent(t.meshDataComponent),!l&&!d)return i.resolve();var p="";if(o.style){var f=o.style.replace("__entity","#"+u);p="<style>\n"+f+"\n</style>"}c.innerHTML=p+o.innerHtml;var m=c.childNodes;if(1===m.length){var g=m[0];g.style.width||(g.style.width="100%"),g.style.height||(g.style.height="100%")}for(var y=c.getElementsByTagName("IMG"),v=[],x=0;x<y.length;x++){var w=y[x],_=w.getAttribute("data-id");if(_){var b=h(w,_);v.push(b)}}return r.all(v)}})},o.prototype._remove=function(e){var r=e.dom3dComponent;t.prototype._remove.call(this,e),r.domElement&&r.domElement.parentNode&&r.domElement.parentNode.removeChild(r.domElement),(e.meshRendererComponent||e.meshDataComponent)&&(e.clearComponent("meshDataComponent"),e.clearComponent("meshRendererComponent")),r.destroy(this.world.gooRunner.renderer.context)},o}(goo.ComponentHandler,goo.Dom3dComponent,goo.rsvp,goo.PromiseUtils),goo.Composer=function(t,e,r,i){"use strict";function o(o){if(this._passedWriteBuffer=!!o,this.writeBuffer=o,void 0===this.writeBuffer){var n=window.innerWidth||1,a=window.innerHeight||1;this.writeBuffer=new t(n,a)}this.readBuffer=this.writeBuffer.clone(),this.passes=[],this._clearColor=[0,0,0,1],this.copyPass=new e(r.copy),this.size=null,this.dirty=!1,this._viewportResizeHandler=function(t){this.dirty=!0,this.size=t}.bind(this),i.addListener("goo.viewportResize",this._viewportResizeHandler,!0)}return o.prototype.destroy=function(t){this.deallocateBuffers(t);for(var e=0;e<this.passes.length;e++){var r=this.passes[e];r.destroy(t)}i.removeListener("goo.viewportResize",this._viewportResizeHandler)},o.prototype.deallocateBuffers=function(t){this.writeBuffer&&!this._passedWriteBuffer&&this.writeBuffer.destroy(t.context),this.readBuffer&&this.readBuffer.destroy(t.context),this.copyPass.destroy(t)},o.prototype.swapBuffers=function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},o.prototype._checkPassResize=function(t,e){return!t.viewportSize||t.viewportSize.x!==e.x||t.viewportSize.y!==e.y||t.viewportSize.width!==e.width||t.viewportSize.height!==e.height},o.prototype.addPass=function(t,e){this.passes.push(t),t.updateSize&&this.size&&this._checkPassResize(t,this.size)&&(t.updateSize(this.size,e),t.viewportSize=this.size)},o.prototype.setClearColor=function(t){this._clearColor[0]=t[0],this._clearColor[1]=t[1],this._clearColor[2]=t[2],this._clearColor[3]=t[3]},o.prototype.updateSize=function(e){var r=this.size;if(r){var i=r.width,o=r.height;this.deallocateBuffers(e),this.writeBuffer=new t(i,o),this.readBuffer=this.writeBuffer.clone();for(var n=0,a=this.passes.length;a>n;n++){var s=this.passes[n];s.updateSize&&this._checkPassResize(s,r)&&(s.updateSize(r,e),s.viewportSize=r)}}},o.prototype.render=function(t,e,r,i){this.dirty&&(this.updateSize(t),this.dirty=!1);var o,n,a=!1,s=this.passes.length;for(n=0;s>n;n++)if(o=this.passes[n],o.enabled&&(o.render(t,this.writeBuffer,this.readBuffer,e,a,r,i,this._clearColor),o.needsSwap)){if(a){var h=this.renderer.context;h.stencilFunc(h.NOTEQUAL,1,4294967295),this.copyPass.render(t,this.writeBuffer,this.readBuffer,e,r,i),h.stencilFunc(h.EQUAL,1,4294967295)}this.swapBuffers()}},o}(goo.RenderTarget,goo.FullscreenPass,goo.ShaderLib,goo.SystemBus),goo.FullscreenUtil=function(t){"use strict";return t}(goo.FullscreenUtils),goo.RenderPass=function(t,e,r){"use strict";function i(t,e){this.renderList=t,this.filter=e,this.clearColor=new r(0,0,0,0),this.oldClearColor=new r,this.renderToScreen=!1,this.overrideMaterial=null,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.viewportSize=void 0}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.render=function(e,r,i,o,n,a,s,h){if(a=a||t.mainCamera){s=s||[];var u;u=this.filter?this.renderList.filter(this.filter):this.renderList,this.renderToScreen?e.render(u,a,s,null,this.clear,this.overrideMaterial):e.render(u,a,s,i,this.clear,this.overrideMaterial),this.clearColor,1}},i}(goo.Renderer,goo.Pass,goo.Vector4),goo.Rectangle=function(){"use strict";function t(t,e,r,i){this.x=t,this.y=e,this.w=r,this.h=i}return t}(),goo.AtlasNode=function(t){"use strict";function e(e,r){this.isLeaf=!0,this.isSet=!1,this.children=[],void 0!==e&&void 0!==r?this.localRectangle=new t(0,0,e,r):this.localRectangle=null}return e.prototype.getRectangles=function(){var t=[];return this._getRectangles(t),t},e.prototype._getRectangles=function(t){this.isSet&&t.push(this.localRectangle),this.isLeaf||(this.children[0]._getRectangles(t),this.children[1]._getRectangles(t))},e.prototype.insert=function(e,r){return this._insert(new t(0,0,e,r))},e.prototype._insert=function(r){if(this.isLeaf){if(this.isSet)return null;if(r.w>this.localRectangle.w||r.h>this.localRectangle.h)return null;if(r.w===this.localRectangle.w&&r.h===this.localRectangle.h)return this.isSet=!0,this;this.isLeaf=!1,this.children[0]=new e,this.children[1]=new e;var i=this.localRectangle.w-r.w,o=this.localRectangle.h-r.h;return i>o?(this.children[0].localRectangle=new t(this.localRectangle.x,this.localRectangle.y,r.w,this.localRectangle.h),this.children[1].localRectangle=new t(this.localRectangle.x+r.w,this.localRectangle.y,i,this.localRectangle.h)):(this.children[0].localRectangle=new t(this.localRectangle.x,this.localRectangle.y,this.localRectangle.w,r.h),this.children[1].localRectangle=new t(this.localRectangle.x,this.localRectangle.y+r.h,this.localRectangle.w,o)),this.children[0]._insert(r)}var n=this.children[0]._insert(r);return null!==n?n:this.children[1]._insert(r)},e}(goo.Rectangle),goo.EntityCombiner=function(t,e,r,i,o,n,a){"use strict";function s(t,e,r,i){this.world=t,this.gridCount=e||1,this.gridSize=1,this.removeOldData=void 0!==r?r:!0,this.keepEntities=void 0!==i?i:!1,this.createdEntities=[]}function h(){var t=[],e=[];return{put:function(r,i){var o=t.indexOf(r);-1===o?(t.push(r),e.push(i)):e[o]=i},get:function(r){return e[t.indexOf(r)]},getKeys:function(){return t},getValues:function(){return e}}}return s.prototype.combine=function(){this.world.processEntityChanges(),this.world.getSystem("TransformSystem")._process(),this.world.getSystem("BoundingUpdateSystem")._process();var t=this.world.entityManager.getTopEntities();this.gridSize>1&&(this.gridSize=this._calculateBounds(t)/this.gridCount),this._combineList(t)},s.prototype._combineList=function(t){var r=t;this.createdEntities=[],t instanceof e==!0&&(r=[t]);for(var i=new h,o=[],n=0;n<r.length;n++)this._buildSubs(r[n],i,o);o.length>1&&(r=this.world.createEntity("RootCombined").addToWorld(),i.put(r,o));for(var a=i.getKeys(),n=0;n<a.length;n++){var s=a[n],u=i.get(s);u.length>0&&this._combine(s,u)}},s.prototype._buildSubs=function(t,e,r){if(!(t._hidden||t.skip||t.animationComponent||t.particleComponent)){r&&t["static"]!==!1||(r=[],e.put(t,r)),t["static"]&&t.meshDataComponent&&t.meshRendererComponent&&t.meshRendererComponent.worldBound&&r.push(t);for(var i=0;i<t.transformComponent.children.length;i++){var o=t.transformComponent.children[i];this._buildSubs(o.entity,e,r)}}},s.prototype._combine=function(t,e){var o=t.transformComponent.worldTransform,n=new i,a=new i;o.invert(n);for(var s=new h,u=0;u<e.length;u++){var c=e[u],l=c.meshRendererComponent.materials[0],d=c.meshDataComponent.meshData.attributeMap,p=Object.keys(d);if(p.sort(),p=p.join("_"),this.gridSize>1){var f=c.meshRendererComponent.worldBound.center.x/this.gridSize,m=c.meshRendererComponent.worldBound.center.z/this.gridSize;p=p+"_"+Math.round(f)+"_"+Math.round(m)}var g=s.get(l);g||(g=new h,s.put(l,g));var y=g.get(p);y||(y=[],g.put(p,y)),y.push(c)}for(var v=s.getKeys(),u=0;u<v.length;u++)for(var x=v[u],w=s.get(x),_=w.getKeys(),b=0;b<_.length;b++){var S=w.get(_[b]);if(1!==S.length){for(var M=new r,E=0;E<S.length;E++){var c=S[E];t!==c?a.multiply(n,c.transformComponent.worldTransform):a.setIdentity(),M.addMeshData(c.meshDataComponent.meshData,a),this.removeOldData?(c.clearComponent("meshDataComponent"),c.clearComponent("meshRendererComponent"),this.keepEntities||1!==c._components.length||0!==c.transformComponent.children.length||c.removeFromWorld()):(c.skip=!0,c._hidden=!0)}var C=M.build();for(var l in C){var c=this.world.createEntity(C[l],x);c.addToWorld(),t.attachChild(c),this.createdEntities.push(c)}}}},s.prototype._calculateBounds=function(t){for(var e=!0,r=new n,i=0;i<t.length;i++){var s=t[i];s.traverse(function(t){if(t.meshRendererComponent&&!t.particleComponent)if(e){var i=t.meshRendererComponent.worldBound;i instanceof n?r.copy(i):i instanceof a?(r.center.set(i.center),r.xExtent=r.yExtent=r.zExtent=i.radius):(r.center.set(o.ZERO),r.xExtent=r.yExtent=r.zExtent=10),e=!1}else r.merge(t.meshRendererComponent.worldBound)})}return 2*Math.max(r.xExtent,r.zExtent)},s.prototype.cleanup=function(t){for(var e=0;e<this.createdEntities.length;e++){var r=this.createdEntities[e];r.removeFromWorld(),r.parent().each(function(t){t.detachChild(r)})}},s}(goo.EntityUtils,goo.Entity,goo.MeshBuilder,goo.Transform,goo.Vector3,goo.BoundingBox,goo.BoundingSphere),"function"==typeof require&&(define("goo/entities/Bus",[],function(){return goo.Bus}),define("goo/entities/Selection",[],function(){return goo.Selection}),define("goo/entities/EntitySelection",[],function(){return goo.EntitySelection}),define("goo/entities/components/Component",[],function(){return goo.Component}),define("goo/util/StringUtils",[],function(){return goo.StringUtils}),define("goo/entities/Entity",[],function(){
return goo.Entity}),define("goo/util/ObjectUtils",[],function(){return goo.ObjectUtils}),define("goo/scripts/ScriptUtils",[],function(){return goo.ScriptUtils}),define("goo/scripts/Scripts",[],function(){return goo.Scripts}),define("goo/math/MathUtils",[],function(){return goo.MathUtils}),define("goo/math/Vector",[],function(){return goo.Vector}),define("goo/math/Vector4",[],function(){return goo.Vector4}),define("goo/math/Vector3",[],function(){return goo.Vector3}),define("goo/renderer/bounds/BoundingVolume",[],function(){return goo.BoundingVolume}),define("goo/renderer/Capabilities",[],function(){return goo.Capabilities}),define("goo/renderer/BufferUtils",[],function(){return goo.BufferUtils}),define("goo/renderer/BufferData",[],function(){return goo.BufferData}),define("goo/renderer/RendererUtils",[],function(){return goo.RendererUtils}),define("goo/math/Vector2",[],function(){return goo.Vector2}),define("goo/renderer/MeshData",[],function(){return goo.MeshData}),define("goo/renderer/bounds/BoundingSphere",[],function(){return goo.BoundingSphere}),define("goo/renderer/bounds/BoundingBox",[],function(){return goo.BoundingBox}),define("goo/entities/EntityUtils",[],function(){return goo.EntityUtils}),define("goo/entities/SystemBus",[],function(){return goo.SystemBus}),define("goo/entities/managers/Manager",[],function(){return goo.Manager}),define("goo/entities/managers/EntityManager",[],function(){return goo.EntityManager}),define("goo/math/Matrix",[],function(){return goo.Matrix}),define("goo/math/Matrix3",[],function(){return goo.Matrix3}),define("goo/math/Matrix4",[],function(){return goo.Matrix4}),define("goo/math/Transform",[],function(){return goo.Transform}),define("goo/entities/components/TransformComponent",[],function(){return goo.TransformComponent}),define("goo/entities/systems/System",[],function(){return goo.System}),define("goo/entities/World",[],function(){return goo.World}),define("goo/renderer/RendererRecord",[],function(){return goo.RendererRecord}),define("goo/util/rsvp",[],function(){return goo.rsvp}),define("goo/util/PromiseUtils",[],function(){return goo.PromiseUtils}),define("goo/renderer/Texture",[],function(){return goo.Texture}),define("goo/loaders/handlers/ConfigHandler",[],function(){return goo.ConfigHandler}),define("goo/loaders/dds/DdsUtils",[],function(){return goo.DdsUtils}),define("goo/loaders/dds/DdsLoader",[],function(){return goo.DdsLoader}),define("goo/loaders/crunch/CrunchLoader",[],function(){return goo.CrunchLoader}),define("goo/loaders/tga/TgaLoader",[],function(){return goo.TgaLoader}),define("goo/util/CanvasUtils",[],function(){return goo.CanvasUtils}),define("goo/loaders/handlers/TextureHandler",[],function(){return goo.TextureHandler}),define("goo/util/Ajax",[],function(){return goo.Ajax}),define("goo/renderer/TextureCreator",[],function(){return goo.TextureCreator}),define("goo/util/ObjectUtil",[],function(){return goo.ObjectUtil}),define("goo/renderer/pass/RenderTarget",[],function(){return goo.RenderTarget}),define("goo/renderer/ShaderCall",[],function(){return goo.ShaderCall}),define("goo/renderer/RenderQueue",[],function(){return goo.RenderQueue}),define("goo/renderer/Shader",[],function(){return goo.Shader}),define("goo/renderer/Material",[],function(){return goo.Material}),define("goo/renderer/shaders/ShaderFragment",[],function(){return goo.ShaderFragment}),define("goo/renderer/light/Light",[],function(){return goo.Light}),define("goo/renderer/light/PointLight",[],function(){return goo.PointLight}),define("goo/renderer/light/DirectionalLight",[],function(){return goo.DirectionalLight}),define("goo/renderer/light/SpotLight",[],function(){return goo.SpotLight}),define("goo/util/TangentGenerator",[],function(){return goo.TangentGenerator}),define("goo/renderer/shaders/ShaderBuilder",[],function(){return goo.ShaderBuilder}),define("goo/renderer/shaders/ShaderLib",[],function(){return goo.ShaderLib}),define("goo/shapes/Quad",[],function(){return goo.Quad}),define("goo/math/Plane",[],function(){return goo.Plane}),define("goo/math/Ray",[],function(){return goo.Ray}),define("goo/renderer/Camera",[],function(){return goo.Camera}),define("goo/renderer/pass/FullscreenUtils",[],function(){return goo.FullscreenUtils}),define("goo/renderer/pass/Pass",[],function(){return goo.Pass}),define("goo/renderer/pass/FullscreenPass",[],function(){return goo.FullscreenPass}),define("goo/renderer/shadow/ShadowHandler",[],function(){return goo.ShadowHandler}),define("goo/renderer/RenderStats",[],function(){return goo.RenderStats}),define("goo/renderer/TaskScheduler",[],function(){return goo.TaskScheduler}),define("goo/renderer/RenderInfo",[],function(){return goo.RenderInfo}),define("goo/renderer/Renderer",[],function(){return goo.Renderer}),define("goo/entities/systems/TransformSystem",[],function(){return goo.TransformSystem}),define("goo/renderer/SimplePartitioner",[],function(){return goo.SimplePartitioner}),define("goo/entities/systems/RenderSystem",[],function(){return goo.RenderSystem}),define("goo/entities/systems/BoundingUpdateSystem",[],function(){return goo.BoundingUpdateSystem}),define("goo/entities/systems/ScriptSystem",[],function(){return goo.ScriptSystem}),define("goo/entities/systems/LightingSystem",[],function(){return goo.LightingSystem}),define("goo/entities/systems/CameraSystem",[],function(){return goo.CameraSystem}),define("goo/entities/systems/ParticlesSystem",[],function(){return goo.ParticlesSystem}),define("goo/util/Stats",[],function(){return goo.Stats}),define("goo/sound/AudioContext",[],function(){return goo.AudioContext}),define("goo/entities/systems/SoundSystem",[],function(){return goo.SoundSystem}),define("goo/entities/components/MeshDataComponent",[],function(){return goo.MeshDataComponent}),define("goo/entities/components/MeshRendererComponent",[],function(){return goo.MeshRendererComponent}),define("goo/entities/components/CameraComponent",[],function(){return goo.CameraComponent}),define("goo/entities/components/LightComponent",[],function(){return goo.LightComponent}),define("goo/entities/components/ScriptComponent",[],function(){return goo.ScriptComponent}),define("goo/entities/components/SoundComponent",[],function(){return goo.SoundComponent}),define("goo/util/GameUtils",[],function(){return goo.GameUtils}),define("goo/util/Logo",[],function(){return goo.Logo}),define("goo/entities/GooRunner",[],function(){return goo.GooRunner}),define("goo/loaders/handlers/ComponentHandler",[],function(){return goo.ComponentHandler}),define("goo/util/ArrayUtils",[],function(){return goo.ArrayUtils}),define("goo/shapes/Box",[],function(){return goo.Box}),define("goo/shapes/Sphere",[],function(){return goo.Sphere}),define("goo/shapes/Cylinder",[],function(){return goo.Cylinder}),define("goo/shapes/Torus",[],function(){return goo.Torus}),define("goo/shapes/Disk",[],function(){return goo.Disk}),define("goo/shapes/Cone",[],function(){return goo.Cone}),define("goo/util/ShapeCreatorMemoized",[],function(){return goo.ShapeCreatorMemoized}),define("goo/loaders/handlers/CameraComponentHandler",[],function(){return goo.CameraComponentHandler}),define("goo/loaders/handlers/EntityHandler",[],function(){return goo.EntityHandler}),define("goo/loaders/handlers/LightComponentHandler",[],function(){return goo.LightComponentHandler}),define("goo/loaders/handlers/MaterialHandler",[],function(){return goo.MaterialHandler}),define("goo/loaders/handlers/MeshDataComponentHandler",[],function(){return goo.MeshDataComponentHandler}),define("goo/loaders/handlers/MeshDataHandler",[],function(){return goo.MeshDataHandler}),define("goo/loaders/handlers/MeshRendererComponentHandler",[],function(){return goo.MeshRendererComponentHandler}),define("goo/loaders/handlers/SceneHandler",[],function(){return goo.SceneHandler}),define("goo/loaders/handlers/ShaderHandler",[],function(){return goo.ShaderHandler}),define("goo/loaders/handlers/TransformComponentHandler",[],function(){return goo.TransformComponentHandler}),define("goo/loaders/handlers/ProjectHandler",[],function(){return goo.ProjectHandler}),define("goo/loaders/handlers/SoundComponentHandler",[],function(){return goo.SoundComponentHandler}),define("goo/util/PromiseUtil",[],function(){return goo.PromiseUtil}),define("goo/sound/Sound",[],function(){return goo.Sound}),define("goo/loaders/handlers/SoundHandler",[],function(){return goo.SoundHandler}),define("goo/particles/ParticleLib",[],function(){return goo.ParticleLib}),define("goo/particles/ParticleUtils",[],function(){return goo.ParticleUtils}),define("goo/particles/Particle",[],function(){return goo.Particle}),define("goo/particles/ParticleEmitter",[],function(){return goo.ParticleEmitter}),define("goo/entities/components/ParticleComponent",[],function(){return goo.ParticleComponent}),define("goo/util/ParticleSystemUtils",[],function(){return goo.ParticleSystemUtils}),define("goo/util/Snow",[],function(){return goo.Snow}),define("goo/loaders/handlers/EnvironmentHandler",[],function(){return goo.EnvironmentHandler}),define("goo/util/Skybox",[],function(){return goo.Skybox}),define("goo/loaders/handlers/SkyboxHandler",[],function(){return goo.SkyboxHandler}),define("goo/entities/components/HtmlComponent",[],function(){return goo.HtmlComponent}),define("goo/loaders/handlers/HtmlComponentHandler",[],function(){return goo.HtmlComponentHandler}),define("goo/loaders/DynamicLoader",[],function(){return goo.DynamicLoader}),define("goo/math/Matrix2",[],function(){return goo.Matrix2}),define("goo/math/Matrix2x2",[],function(){return goo.Matrix2x2}),define("goo/math/Matrix3x3",[],function(){return goo.Matrix3x3}),define("goo/math/Matrix4x4",[],function(){return goo.Matrix4x4}),define("goo/math/Quaternion",[],function(){return goo.Quaternion}),define("goo/particles/ParticleInfluence",[],function(){return goo.ParticleInfluence}),define("goo/noise/Noise",[],function(){return goo.Noise}),define("goo/noise/ValueNoise",[],function(){return goo.ValueNoise}),define("goo/picking/BoundingTree",[],function(){return goo.BoundingTree}),define("goo/picking/PrimitivePickLogic",[],function(){return goo.PrimitivePickLogic}),define("goo/renderer/Renderer+ContextLost",[],function(){return goo.RendererContextLost}),define("goo/shapes/Grid",[],function(){return goo.Grid}),define("goo/shapes/SimpleBox",[],function(){return goo.SimpleBox}),define("goo/scripts/OrbitCamControlScript",[],function(){return goo.OrbitCamControlScript}),define("goo/shapes/TextureGrid",[],function(){return goo.TextureGrid}),define("goo/sound/OscillatorSound",[],function(){return goo.OscillatorSound}),define("goo/util/ArrayUtil",[],function(){return goo.ArrayUtil}),define("goo/util/EventTarget",[],function(){return goo.EventTarget}),define("goo/util/MeshBuilder",[],function(){return goo.MeshBuilder}),define("goo/util/Rc4Random",[],function(){return goo.Rc4Random}),define("goo/util/StringUtil",[],function(){return goo.StringUtil}),define("goo/util/SoundCreator",[],function(){return goo.SoundCreator}),define("goo/util/TWEEN",[],function(){return goo.TWEEN}),define("goo/entities/components/CssTransformComponent",[],function(){return goo.CssTransformComponent}),define("goo/entities/components/Dom3dComponent",[],function(){return goo.Dom3dComponent}),define("goo/entities/components/MovementComponent",[],function(){return goo.MovementComponent}),define("goo/entities/components/PortalComponent",[],function(){return goo.PortalComponent}),define("goo/entities/components/TextComponent",[],function(){return goo.TextComponent}),define("goo/entities/systems/HtmlSystem",[],function(){return goo.HtmlSystem}),define("goo/entities/systems/Dom3dSystem",[],function(){return goo.Dom3dSystem}),define("goo/entities/systems/GridRenderSystem",[],function(){return goo.GridRenderSystem}),define("goo/entities/systems/MovementSystem",[],function(){return goo.MovementSystem}),define("goo/entities/systems/PickingSystem",[],function(){return goo.PickingSystem}),define("goo/entities/systems/PortalSystem",[],function(){return goo.PortalSystem}),define("goo/entities/systems/TextSystem",[],function(){return goo.TextSystem}),define("goo/entities/systems/CssTransformSystem",[],function(){return goo.CssTransformSystem}),define("goo/math/splines/Spline",[],function(){return goo.Spline}),define("goo/math/splines/SplineWalker",[],function(){return goo.SplineWalker}),define("goo/loaders/handlers/Dom3dComponentHandler",[],function(){return goo.Dom3dComponentHandler}),define("goo/renderer/pass/Composer",[],function(){return goo.Composer}),define("goo/renderer/pass/FullscreenUtil",[],function(){return goo.FullscreenUtil}),define("goo/renderer/pass/RenderPass",[],function(){return goo.RenderPass}),define("goo/util/combine/Rectangle",[],function(){return goo.Rectangle}),define("goo/util/combine/AtlasNode",[],function(){return goo.AtlasNode}),define("goo/util/combine/EntityCombiner",[],function(){return goo.EntityCombiner}));
